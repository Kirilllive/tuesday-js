<!doctype html>
<html>
<head>
<title>Tuesday JS visual editor</title>
<link rel="shortcut icon" href="icon.jpg" type="image/x-icon">
<meta charset="UTF-8">
<meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'/>
<style>
*{
	font-family:Arial;
	border-collapse:collapse;
	border:none;
	margin:0;
	padding:0;
	border-spacing:0px;
	-webkit-touch-callout:none;
	-webkit-user-select:none;
	-khtml-user-select:none;
	-moz-user-select:none;
	-ms-user-select:none;
	user-select:none;
	outline:none;
}
:root {
  --cw:#efefff;
  --cb:#cec8e3;
  --cl:#6e5fa5;
  --cs:rgba(110,95,165,0.25);
  --cm:rgba(110,95,165,0.5);
  --cf:rgba(90,75,145,1);
}
.panel{background-color:#fff;box-shadow:0px 2px 24px var(--cs);border-radius:16px;padding:4px;}
@keyframes flash{0%{box-shadow:0px 2px 32px var(--cf);background-color:var(--cb);}25%{box-shadow:0px 2px 32px var(--cf);background-color:var(--cb);}100%{box-shadow:0px 2px 24px var(--cs);background-color:#fff;}}
@keyframes flash2{0%{box-shadow:0px 0px 16px var(--cb);background-color:var(--cw);}50%{box-shadow:0px 0px 12px var(--cb);background-color:var(--cb);;}}
.story_block{min-height:28px;width:256px;position:absolute;cursor:all-scroll;}
#world{position:absolute;-ms-transform:scale(1);transform:scale(1);-webkit-transform-origin: 0 0;-moz-transform-origin: 0 0;}
line{stroke:var(--cl);stroke-dasharray:20;stroke-width:2;animation:dash 4s linear infinite;}
@keyframes dash{from{stroke-dashoffset:0} to{stroke-dashoffset:200;}}
#toast{
	position:fixed;
	opacity:0;
	bottom:-10%;
	transform:translateX(-50%);
	padding:0px 32px;
	height:40px;
	min-width:128px;
	box-shadow:0px 2px 24px var(--cs);
	z-index:10000;
}
.toast_anim{left:50%;border-radius:32px;animation:viwe 0.25s,stop 2s 0.25s,close 0.5s 2s linear;}
@keyframes viwe{from{opacity:0;bottom:64px} to{opacity:1;bottom:64px}}
@keyframes stop{from{opacity:1;bottom:64px} to{opacity:1;bottom:64px}}
@keyframes close{from{opacity:1;bottom:64px} to{opacity:0;bottom:-32px}}
#new_story_block, #scene_controll{
	position:fixed;
	height:40px;
	z-index:1000;
	bottom:32px;
	right:32px;
    border-radius:20px;
    background-color:#fff;
    box-shadow:0px 2px 24px var(--cs);
    cursor:pointer;
}
#menu_panel{
	z-index:1000;
	top:0;
	left:0;
	background-color:#fff;
	box-shadow:0px 2px 24px var(--cs);
	border-radius:0 0 16px 0;
	position:fixed;
	height:40px;
	max-width:620px;
	width:100%;
}
.button_block{height:26px;width:26px;background-size:70% 70%;background-repeat:no-repeat;background-position:center;}
.icon{background-size:22px 22px;background-repeat:no-repeat;background-position:center;}
.icon_m{background-size:18px 18px;background-repeat:no-repeat;background-position:center;cursor:pointer;}
.button_menu{background-position:center;cursor:pointer;}
.button_menu:hover{background-color:var(--cb);}
.icon_new{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTIyMyw1MlYyNDlIMzVWNkgxNzZaTTIyMyw1M0gxNzZWNiIvPjwvc3ZnPgo=")}
.icon_load{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTQ4LDg1SDI1MkwyMDgsMjI2SDVaTTQ4LDg1TDUsMjI2VjUxTDE4LDM0SDY1bDEzLDE3SDIwOFY4NUg0OFoiLz48L3N2Zz4K")}
.icon_save{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTIzOCw1MVYyMjhhMTAsMTAsMCwwLDEtMTAsMTBIMjdhMTAsMTAsMCwwLDEtMTAtMTBWMjdBMTAsMTAsMCwwLDEsMjcsMTdIMjAzWk0zOSwyMzhWMTI3YTEwLDEwLDAsMCwxLDEwLTEwSDIwNWExMCwxMCwwLDAsMSwxMCwxMFYyMzhIMzlaTTE3NCw5NUg3OWExMCwxMCwwLDAsMS0xMC0xMFYxN0gxODRWODVBMTAsMTAsMCwwLDEsMTc0LDk1Wk0xNjgsNDJhMTAsMTAsMCwwLDAtMTAtMTBIMTQ0YTEwLDEwLDAsMCwwLTEwLDEwVjcxYTEwLDEwLDAsMCwwLDEwLDEwaDE0YTEwLDEwLDAsMCwwLDEwLTEwVjQyWk02MywxNjJIMTkybTAsNDlINjMiLz48L3N2Zz4K")}
.icon_play{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTcsMjRMMjQ4LDEyNlYxMjhMNywyMzBWMjRaIi8+PC9zdmc+Cg==")}
.icon_edit{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTE2NCwzN2w1Myw1My0xMzEsMTMxTDMzLDE2OVpNMjI1LDE2TDIzOCwyOWEyOCwyOCwwLDAsMSwwLDQwbC0yMCwyMEwxNjQsMzcsMTg1LDE2QTI4LDI4LDAsMCwxLDIyNSwxNlpNNTksMTk1TDE5MCw2NE05LDI0NWgwbDczLTIyTDMyLDE3M1oiLz48L3N2Zz4K")}
.icon_show{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTI0Niw0MEgxME0yNDYsMTMwSDEwTTI0NiwyMjBIMTAiLz48L3N2Zz4K")}
.icon_setup{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMjgsNmExNCwxNCwwLDEsMS0xNCwxNEExNCwxNCwwLDAsMSwyOCw2Wm03NCw0NEExNCwxNCwwLDEsMSw4OCw2NCwxNCwxNCwwLDAsMSwxMDIsNTBaTTYzLDkzYTE0LDE0LDAsMSwxLTE0LDE0QTE0LDE0LDAsMCwxLDY0LDkzWk00OSwxMDdIMm0wLTg2aDExbS0xMSw0M0g4N20zNyw0M0g3N000MiwyMGg4Mm0tOCw0NGg4Ii8+PC9zdmc+Cg==")}
.icon_about{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEwNiwxMDRoMjJ2ODZNMTA2LDE5Mmg0MiIvPjxjaXJjbGUgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGN4PSIxMjgiIGN5PSI2NCIgcj0iNiIvPjxjaXJjbGUgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGN4PSIxMjgiIGN5PSIxMjgiIHI9IjEyMCIvPjwvc3ZnPgo=")}
.icon_close{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMjAiLz48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTcxLDE4NEwxODQsNzBNMTg0LDE4NEw3MSw3MCIvPjwvc3ZnPgo=")}
.icon_ok{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgPjxjaXJjbGUgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+PHBhdGggZD0iTTE5NCw4MmwtODYsODZMNjEsMTI0Ii8+PC9nPjwvc3ZnPgo=")}
.icon_build{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTQ3LDE3SDIwOWEzMCwzMCwwLDAsMSwzMCwzMFYyMDlhMzAsMzAsMCwwLDEtMzAsMzBINDdhMzAsMzAsMCwwLDEtMzAtMzBWNDdBMzAsMzAsMCwwLDEsNDcsMTdaTTE0OCwxNjJIMzhtMTgwLDBIMTc2bS0xMDcsMTktMTQsMjRtOTItMTU1LTY3LDExMm01OS02Miw2MywxMDVtLTkzLTE1NSwxOSwzMSIvPjwvc3ZnPgo=")}
.icon_go{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTgyLDM2bDkxLDkxTDgyLDIxOSIvPjwvc3ZnPgo=")}
.icon_add{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMjAiLz48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTQ3LDEyOGgxNjFNMTI4LDIwOFY0NyIvPjwvc3ZnPgo=")}
.icon_del{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE5NCw2MlYyMzBINjNWNjJNNDcsNDVIMjEwTTEwOCwyM2gzOVY0NUgxMDhWMjNaTTEyOCw2MlYyMTNNOTIsNjJWMjEzTTE2NCw2MlYyMTMiLz48L3N2Zz4K")}
.icon_json{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTE3Nyw0aDI0YzcsMCwxMywxLDE4LDZzNiwxMCw2LDE4djgybDI3LDE3TDIyNSwxNDZ2ODJjMCw3LTEsMTItNiwxN3MtMTAsNy0xOCw3SDE3N004NCw3SDYwYy03LDAtMTMsMS0xOCw2cy02LDEwLTYsMTh2NzlMOCwxMjgsMzYsMTQ2djc5YzAsNywxLDEyLDYsMTdzMTAsNywxOCw3SDg0TTExMywyMTJjOSwwLDE4LTQsMjItMTAsMy00LDQtMTIsNC0yNVY3MiIvPjxjaXJjbGUgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGN4PSIxMzkuMzc1IiBjeT0iNDMuNTk0IiByPSIyLjUiLz48L3N2Zz4K")}
.icon_csv{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiI+PHBhdGggZD0iTTIxNywxOTZIMTA5TDQzLDI0OVYxOTZIMzhjLTE2LjU2OCwwLTI5LTEzLjQzMS0yOS0zMFYzOEM5LDIxLjQzMiwyMi40MzIsOSwzOSw5SDIxOGMxNi41NjksMCwyOSwxMi40MzIsMjksMjlWMTY2QTMwLDMwLDAsMCwxLDIxNywxOTZaIi8+PHBhdGggZD0ibTEyOSw2MXY5NCIvPjxwYXRoIGQ9Im04NCwxMDEgNDUsLTQ4IDQ0LDQ3Ii8+PC9nPjwvc3ZnPgoK")}
.icon_text{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTIxNywxOTZIMTA5TDQzLDI0OVYxOTZIMzhjLTE2LDAtMjktMTMtMjktMzBWMzhDOSwyMSwyMiw5LDM5LDlIMjE4YzE2LDAsMjksMTIsMjksMjlWMTY2QTMwLDMwLDAsMCwxLDIxNywxOTZaIi8+PC9zdmc+Cg==")}
.icon_up{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMTIsMTg4IDEyOCw2MCAyNDYsMTg4eiIvPgkgDQo8L3N2Zz4=")}
.icon_down{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xMiw2MCAxMjgsMTg4IDI0Niw2MHoiLz4JIAo8L3N2Zz4=")}
.icon_goto{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTExOCw4OGw0Miw0MC00Miw0Nk03MCwxMjhoODRNMzQsMjIwVjM2TTI0OCwyMjBIMTkyVjM2aDU2Ii8+PC9zdmc+Cg==")}
.icon_back{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTEzOCw4OEw5NiwxMjhsNDIsNDZNMTg2LDEyOEgxMDJNMjIyLDIyMFYzNk04LDIyMEg2NFYzNkg4Ii8+PC9zdmc+Cg==")}
.icon_edit2{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE3MCw1NWg1OGEyMCwyMCwwLDAsMSwyMCwyMFYyMjVhMjAsMjAsMCwwLDEtMjAsMjBIMjlBMjAsMjAsMCwwLDEsOSwyMjVWNzVjMC0xMSw5LTIxLDIxLTIxSDg3TTEwNSw5aDQ2VjE2MUgxMDVWOVpNMTI3LDIwNGgybDIyLTQzSDEwNVoiLz48L3N2Zz4K")}
.icon_art{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGN4PSI2MCIgY3k9Ijk2IiByPSIxOSIvPjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0xOS41NjMsMjQuMzc1aDIxNy4yM2ExMCwxMCwwLDAsMSwxMCwxMFYyMjguOTFhMTAsMTAsMCwwLDEtMTAsMTBIMTkuNTYzYTEwLDEwLDAsMCwxLTEwLTEwVjM0LjM3NUExMCwxMCwwLDAsMSwxOS41NjMsMjQuMzc1Wk03MSwyMDFIMjQyTTI4LDIwMUg1M005MSwxOThsNDItNDMsNDIsNDNNMTU3LDE3Nmw0Mi00Miw0Myw0MiIvPjwvc3ZnPgo=")}
.icon_textadd{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTIxNywxOTZIMTA5TDQzLDI0OVYxOTZIMzhjLTE2LDAtMjktMTMtMjktMzBWMzhDOSwyMSwyMiw5LDM5LDlIMjE4YzE2LDAsMjksMTIsMjksMjlWMTY2QTMwLDMwLDAsMCwxLDIxNywxOTZaTTg2LDEwM2g4NE0xMjgsNjF2ODQiLz48L3N2Zz4K")}
.icon_audio_off{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTUyLDkwTDEzMywzMFYyMjVMNTIsMTY0VjkwWk0xMCw5MUg1MnY3M0gxMFY5MVpNMTczLDk4bDU5LDU5bTAtNTktNTksNTkiLz48L3N2Zz4K")}
.icon_audio_play{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik01Miw5MEwxMzMsMzBWMjI1TDUyLDE2NFY5MFpNMTAsOTFINTJ2NzNIMTBWOTFaTTE4OCw2MGMyNSwzNywyNSw5NywwLDEzNG0tMjctOTRjMTAsMTQsMTAsMzksMCw1M00yMTYsMThjNDAsNTksNDAsMTU2LDAsMjE1Ii8+PC9zdmc+Cg==")}
.icon_event{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTEyOCwxN0ExMTEsMTExLDAsMCwwLDI0MCwxMjhjMCwwLDAsMCwwLTB2MUExMTEsMTExLDAsMCwwLDEyOSwyNDBoLTFBMTExLDExMSwwLDAsMCwxNiwxMjljLTAsMC0uODguMDEyLTEsMHYtMWMwLDAsLjI5My4wMDYsMCwwQTExMSwxMTEsMCwwLDAsMTI3LDE2Ii8+PC9zdmc+Cg==")}
.icon_var{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTQyLDIxNkMyNSwyMTYsMTIsMTc2LDEyLDEyOFMyNSw0MCw0Miw0MG0xNzEsMTc2YzE2LDAsMzAtMzksMzAtODhzLTEzLTg4LTMwLTg4TTgwLDU1bDk3LDE0NW0wLTE0NUw4MCwyMDAiLz48L3N2Zz4KCg==")}
.icon_controll{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+CjxjaXJjbGUgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGN4PSIxMjgiIGN5PSIxMjgiIHI9IjYwIi8+Cjwvc3ZnPgo=")}
.icon_choice{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTE2NSwyNDdWMTY1aDgydjgySDE2NVptMC0yMzdoODJWOTJIMTY1VjEwWk0xMCwxMEg5MlY5MkgxMFYxMFpNMTY1LDIwNkgxMjhWNTFNMTY1LDUxSDkyIi8+PC9zdmc+Cg==")}
.icon_html{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTc4LDIwNUwxLDEyOCw3OCw1Mk0xNzQsMjA1TDI1MCwxMjgsMTc0LDUyTTk0LDIxMUwxNTksNDMiLz48L3N2Zz4K")}
.icon_equal{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTQ3LDEyN2gxNjFNMTI4LDIwOFY0NyIvPjwvc3ZnPgo=")}
.icon_minus{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTQ3LDEyN2gxNjEiLz48L3N2Zz4K")}
.icon_scale{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iOTIiLz4KPC9zdmc+Cg==")}
.icon_color{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNiw3SDQxVjEyM0g2VjdaTTUyLDUxTDgwLDIzbDI1LDI1TDUyLDEwME03OCw4N2g0NHYzNUg1NU00MSw4NEg2TTYsNDZINDFtMTEsNUw3Niw3NW03LDEydjM1Ii8+PGNpcmNsZSBpZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjIzLjUiIGN5PSIxMDQuNSIgcj0iNi41Ii8+PC9zdmc+Cg==")}
.icon_right{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Im0gMTc1LDM2IC05MSw5MSA5MSw5MSIvPgo8L3N2Zz4K")}
.icon_layout{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgPjxwYXRoIGQ9Ik03NywxNDBjMC0yMSwyMi0zOSw1MC0zOVMxNzgsMTE4LDE3OCwxNDBNMTQsMTQwVjE1SDI0MlYxNDAiLz48cmVjdCB4PSIxNCIgeT0iMTYxIiB3aWR0aD0iMjI4IiBoZWlnaHQ9Ijc3IiByeD0iMTUiIHJ5PSIxNSIvPjxjaXJjbGUgY3g9IjEyNy41IiBjeT0iNjAuNSIgcj0iMjUuNSIvPjwvZz48L3N2Zz4K")}
.icon_copu{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgPjxwYXRoIGQ9Ik0xNzQsMjA2djI2YTIwLDIwLDAsMCwxLTIwLDIwSDM3YTIwLDIwLDAsMCwxLTIwLTIwVjY5QTIwLDIwLDAsMCwxLDM3LDQ5SDgyIi8+PHJlY3QgeD0iODIiIHk9IjQiIHdpZHRoPSIxNTciIGhlaWdodD0iMjAzIiByeD0iMjAiIHJ5PSIyMCIvPjwvZz48L3N2Zz4K")}
.icon_more{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiID48Y2lyY2xlIGN4PSIyMTMiIGN5PSIxMjgiIHI9IjEyIi8+PGNpcmNsZSBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMiIvPjxjaXJjbGUgY3g9IjQyIiBjeT0iMTI4IiByPSIxMiIvPjwvZz48L3N2Zz4K")}
.icon_toast{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgPjxyZWN0IHg9IjI4IiB5PSI2OCIgd2lkdGg9IjE5OSIgaGVpZ2h0PSIxMDAiIHJ4PSIzMCIgcnk9IjMwIi8+PHBhdGggZD0iTTI1MSwyMTVINSIvPjwvZz48L3N2Zz4K")}
.icon_timer{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48ZyBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgPjxwYXRoIGQ9Ik0xMjgsNjRWMTNBMTE1LDExNSwwLDEsMSwxMywxMjgsMTEyLDExMi4zODQsMCwwLDEsMjUsNzciIC8+PHBhdGggZD0ibSAxMzksMTM0IGMgLTMsNSAtMTIsNiAtMTgsMyBsIC02NywtNDUgNzgsMjYgYyA2LDIgMTAsMTAgNywxNiB6IiAvPjwvZz48L3N2Zz4K")}
.icon_refrash{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTI1MSw5NGwtMjMsMzQtMzQtMjNNNiwxNjFsMjQtMzMsMzUsMjVNMjI4LDEyOG0tMTUsNTJjLTE3LjExMiwyOC4wODgtNDcuNjI4LDQ3LTgzLDQ3LTU0LjE4NiwwLTk5LjQzNC00My45NDgtMTAwLTk4TTQ2LDc2YzE3LjMtMjguMSw0Ny42MDgtNDcsODMtNDdhOTkuMTc4LDk5LjE3OCwwLDAsMSw5OSw5OSIvPjwvc3ZnPgo=")}
.icon_search{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNDYsMTFjMjAsMCwzNywxNiwzNywzNkEzNywzNywwLDAsMSw0Niw4NEMyNSw4NCwxMCw2NywxMCw0N0EzNSwzNSwwLDAsMSw0NiwxMVpNNzksNzdsNDIsNDJNNDcsMjRBMjMsMjMsMCwwLDEsNzAsNDciLz48L3N2Zz4K")}
.icon_clear{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik01MywxMTNIMjRMMyw5MlY3M0w3MywzbDQ1LDQ1Wk0yMCw1Nmw0NSw0NU03NCwyOEw0NSw1OE05LDEyM0g2NE0xMjAsMTEyaDZNMTA1LDExMmg2TTcwLDExMkg5NiIvPgo8L3N2Zz4K")}
.icon_left{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOSwxNjBIMTBNMTI5LDMySDEwTTI0NSw5NkgxME0xOTEsMjI0SDkiLz48L3N2Zz4K")}
.icon_cent{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE4NywxNjBINjhNMTg3LDMySDY4TTI0NSw5NkgxME0yMTgsMjI0SDM2Ii8+PC9zdmc+Cg==")}
.icon_char{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJNNSwxMjZjMC0yNSwyNy00Niw2MC00NnM1OSwyMC41ODQsNTksNDZNNjUsNjNBMzAsMzAsMCwxLDEsOTUsMzMsMzAsMzAsMCwwLDEsNjUsNjNaIi8+PC9zdmc+Cg==")}
.icon_js{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJNMjYsNjlzLTUsMzgsMzYsMzhjMzksMCwzNi0zOSwzNi0zOU0xMDYsNzJzMTItNSwxMiw1LTE4LDE3LTE4LDE3TTI4LDEwN3MtMTcsMy0xNyw2YzAsMywyOSw4LDUzLDgsMjQsMCw1MC01LDUwLTgsMC0zLTE5LTYtMTktNk0zOCw1M3MtMTQsMi0xNCw2YzAsMywyOCw1LDM4LDUsOSwwLDM2LTMsMzYtOCwwLTMtMTEtNS0xMS01TTQ3LDE4QzMyLDMwLDYwLDM1LDUzLDU0TTc1LDRzLTgsMy04LDE0Yy0wLDksOSwxOCw5LDIzLDAsMTItNiwxMy02LDEzIi8+PC9zdmc+Cg==")}
.icon_video{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJNOCw1NEgxMjB2NzBIOFY1NFpNNjAsNTRMNTAsNzNNMjEsNzNMMzEsNTRNMTE5LDU0TDEwOSw3M004MCw3M0w5MCw1NE0xMjAsNzNIOE01OCwzOUw0MywyM00xNSwzMUwzMCw0N00xMTYsMjNMMTAwLDdNNzIsMTVMODcsMzFNMywzNEwxMTAsNGw2LDE5TDgsNTNaIi8+PC9zdmc+Cg==")}
.icon_copy{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTgsNjFMMjksNDBNMzAsNTNWMzlIMTZNMTcsMzFWMTRhNCw0LDAsMCwxLDQtNGg2djRINDVWMTBoNmE0LDQsMCwwLDEsNCw0VjQ4YTQsNCwwLDAsMS00LDRIMzdNMjcsMThWN2g1YTQsNCwwLDAsMSw4LDBoNVYxOEgyN1oiLz48L3N2Zz4K")}
.icon_paste{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTMzLDM5TDU0LDYwTTU1LDQ3VjYxSDQxTTQ2LDM4VjE0YTQsNCwwLDAsMC00LTRIMzZ2NEgxOFYxMEgxMmE0LDQsMCwwLDAtNCw0VjQ4YTQsNCwwLDAsMCw0LDRIMzFNMzYsMThWN0gzMWE0LDQsMCwwLDAtOCwwSDE4VjE4SDM2WiIvPjwvc3ZnPgo=")}
.icon_undo{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE3LDI5TDUsMTcsMTcsNU02LDE3SDM3YzExLjMyMiwwLDIwLDYuNjc4LDIwLDE4UzQ4LjMyMiw1MywzNyw1M0gxNyIvPjwvc3ZnPgo=")}
.bg_1{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij48ZyBzdHJva2Utb3BhY2l0eT0iMC40IiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSI+PHBhdGggZD0iTTAsMUg2NE0wLDE3SDY0TTAsNDlINjRNMCw5SDY0TTAsNDFINjRNMCwyNUg2NE0wLDU3SDY0TTEtNFY2NE00OS00VjY0TTE3LTRWNjRNNTctNFY2NE0yNS00VjY0TTQxLTRWNjRNOS00VjY0Ii8+PC9nPjxwYXRoIHN0cm9rZS1vcGFjaXR5PSIxIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSIgZD0iTS0xLDMySDY4TTMyLTRWNjUiLz48L3N2Zz4K")}
.bg_2{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTY0LDE0LjQwNnY5LjI2OUw0MC4zMjUsMGg5LjI2OVptLTY0LDBMMTQuNDA2LDBoOS4yNjlMMCwyMy42NzVWMTQuNDA2Wk0wLDQ5LjU5NFY0MC4zMjVMMjMuNjc1LDY0SDE0LjQwNlpNOC4zMjUsMzJMMzIsOC4zMjUsNTUuNjc1LDMyLDMyLDU1LjY3NVpNMzIsMTcuNTk0TDE3LjU5NCwzMiwzMiw0Ni40MDYsNDYuNDA2LDMyWm0zMiwzMkw0OS41OTQsNjRINDAuMzI1TDY0LDQwLjMyNXY5LjI2OVoiLz4KPC9zdmc+Cg==")}
.bg_3{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTMyLDMyVjBINjRWMzJIMzJaTTAsNjRWMzJIMzJWNjRIMFoiLz4KPC9zdmc+Cg==")}
.bg_4{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTMyLDBMNjMuOTc3LDMxLjk3NywzMiw2My45NTUsMC4wMjMsMzEuOTc3WiIvPgo8L3N2Zz4K")}
.bg_5{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTQxLjkzMSwzNS4zMUgzNS4zMXY2LjYyMUgyOC42OVYzNS4zMUgyMi4wNjlWMjguNjlIMjguNjlWMjIuMDY5SDM1LjMxVjI4LjY5aDYuNjIxVjM1LjMxWiIvPgo8L3N2Zz4K")}
.bg_6{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTY0LDcuMTg4QTcuMTg4LDcuMTg4LDAsMCwxLDU2LjgxMywwSDY0VjcuMTg4Wm0tNjQsMFYwSDcuMTg4QTcuMTg3LDcuMTg3LDAsMCwxLDAsNy4xODhaTTcuMTg4LDY0SDBWNTYuODEzQTcuMTg4LDcuMTg4LDAsMCwxLDcuMTg4LDY0Wk0zMiwzOS4yQTcuMiw3LjIsMCwxLDEsMzkuMiwzMiw3LjIsNy4yLDAsMCwxLDMyLDM5LjJaTTY0LDU2LjgxM1Y2NEg1Ni44MTNBNy4xODgsNy4xODgsMCwwLDEsNjQsNTYuODEzWiIvPgo8L3N2Zz4K")}
.bg_7{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHJlY3Qgb3BhY2l0eT0iMC4yNSIgZmlsbD0iI2ZmZiIgeD0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSI2NCIvPgo8cmVjdCBvcGFjaXR5PSIwLjI1IiBmaWxsPSIjZmZmIiB5PSIxNiIgd2lkdGg9IjY0IiBoZWlnaHQ9IjMyIi8+Cjwvc3ZnPgo=")}
.bg_8{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTY0LDUzLjQ3djkuMjdoMEw2Mi43MzksNjRINTMuNDdabTAtOC4zODZMNDUuMTI0LDY0SDM2LjAwN2wtMC4xLS4xaDBMNjQsMzUuODE0djkuMjY5aDBaTTQwLjU3MSw0LjY0NUwzNS45MjUsMGg5LjI4Wm0tMTcuMTQzLDBMMTguNzkxLDBoOS4yODRaTTMyLDQ4LjQ5MWwtNS44LDUuOC00LjYzNS00LjYzNUwzMiwzOS4yMjEsNDIuNDM0LDQ5LjY1NSwzNy44LDU0LjI5Wm0wLTE3LjY1NUwxNy4zNzMsNDUuNDYybC00LjYzNS00LjYzNUwzMiwyMS41NjYsNTEuMjYyLDQwLjgyOGwtNC42MzUsNC42MzVaTTE0LjYyNywxMy40NDhMMS4xNzksMGg5LjI2OWw4LjgxMyw4LjgxM1pNNS44LDIyLjI3NUwwLDE2LjQ3NlY3LjIwN0wxMC40MzQsMTcuNjQxWk0zMiwxMy4xOEw4LjU3LDM2LjY2LDMuOTExLDMyaDBMMzIsMy45MTEsNjAuMDg5LDMybC00LjY2Miw0LjY2MlptMjYuMiw5LjEtNC42MzUtNC42MzVMNjQsNy4yMDd2OS4yNjloMFpNNDQuNzM4LDguODEzTDUzLjU1MSwwaDkuMjdMNDkuMzczLDEzLjQ0OFpNMjcuOTkzLDY0aC05LjEyTDAsNDUuMDg0VjM1LjgxNEwyOC4wODksNjMuOVpNMS4yNjEsNjRMMCw2Mi43MzlWNTMuNDdMMTAuNTMxLDY0SDEuMjYxWiIvPgo8L3N2Zz4K")}
.bg_9{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij48ZyBmaWxsPSIjZmZmIj4KICA8cGF0aCBvcGFjaXR5PSIwLjkiIGQ9Ik0xNiw0OEgwTDgsNjRNNjQsMTZINDhsOCwxNm0wLDMySDQwbDgtMTZNNDAsMEgyNGw4LDE2Ii8+CiAgPHBhdGggb3BhY2l0eT0iMC43IiBkPSJNMTYsNDhIMEw4LDMyTTQ4LDQ4SDMybDgsMTZNNjQsNDhINDhsOC0xNk00MCwzMkgyNGw4LTE2bTAsMEgxNkwyNCwwTTU2LDMySDQwbDgtMTZNNTYsMEg0MGw4LDE2Ii8+CiAgPHBhdGggb3BhY2l0eT0iMC41IiBkPSJNNzIsNjRINTZsOC0xNk0xNiwxNkgwTDgsMzJNMjQsNjRIOGw4LTE2TTcyLDBINTZsOCwxNk04LDBILThMMCwxNk0yNCwzMkg4bDgsMTZNNDAsMzJIMjRsOCwxNk01NiwzMkg0MGw4LDE2TTgsNjRILThMMCw0OCIvPgogIDxwYXRoIG9wYWNpdHk9IjAuMyIgZD0iTTE2LDE2SDBMOCwwTTMyLDE2SDE2bDgsMTZtOCwxNkgxNmw4LDE2TTQ4LDE2SDMyTDQwLDBNNjQsNDhINDhsOCwxNk03MiwzMkg1Nmw4LTE2TTgsMzJILThMMCwxNiIvPgogIDxwYXRoIG9wYWNpdHk9IjAuMSIgZD0iTTMyLDQ4SDE2bDgtMTZNNDgsNDhIMzJsOC0xNiIvPjwvZz4KPC9zdmc+Cg==")}
.bg_0{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPGcgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgPgo8cGF0aCBkPSJNMCw0MS41TDE2LDMybDE2LDkuNW0wLDBMNDgsMzJsMTYsOS41TTAsMjIuNUwxNiwzMm0wLDAsMTYtOS41TDQ4LDMyTTAsMEwxNiw5LjVtMCwwTDMyLDAsNDgsOS41TTAsNjRsMTYtOS41TDMyLDY0bTAsMCwxNi05LjVMNjQsNjQiLz4KPHBhdGggZD0iTTQ4LDkuNUw2NCwwIi8+PHBhdGggZD0iTTQ4LDMybDE2LTkuNSIvPjxwYXRoIGQ9Ik0xNiw1NC41VjkuNSIvPjxwYXRoIGQ9Ik0zMiw2NFY0MS41Ii8+PHBhdGggZD0iTTMyLDIyLjVWMCIvPjxwYXRoIGQ9Ik00OCw1NC41VjkuNSIvPjxwYXRoIGQ9Ik0wLDY0VjQxLjUiLz48cGF0aCBkPSJNMCwyMi41VjAiLz48L2c+Cjwvc3ZnPgo=")}
.bg_a{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPGcgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgPgogIDxwYXRoIGQ9Ik02NCwxNkg0OFY4SDY0VjBoOFYxNkg2NFpNNTYsNDB2OGg4djhINDhWNDhINDBWNDBINTZaTTMyLDQ4SDI0VjMyaDhWMjRoOFY0MEgzMnY4WiIvPgogIDxwYXRoIGQ9Ik01NiwyNFYxNkg4OHY4SDU2Wk00OC04SDY0VjhINDhWLThabTAsMzJ2OEg0MFYyNEgzMlY4aDh2OGg4djhaTTMyLDY0SDE2VjQwaDhWNTZoOHY4Wk0tOCwxNkgyNHY4SC04VjE2Wk04LDQwVjY0SDBWNDhILThWNDBIOFpNNDgsODBINDBWNDhoOFY4MFpNNzIsNDBWNjRINjRWNDhINTZWNDBINzJaIi8+CiAgPHBhdGggZD0iTTU2LDQwVjI0SDcyVjQwSDU2Wm04LDMySDQ4VjU2SDY0VjcyWk00MC0xNmg4VjE2SDQwVi0xNlptMCw1NlY2NEgzMlY1NkgyNFY0OGg4VjQwaDhaTTE2LDMyVjI0aDhWOGg4VjMySDE2Wk04LTE2aDhWMTZIOFYtMTZaTTgsNDBILThWMjRIOFY0MFptOCw0MEg4VjQ4aDhWODBaIi8+CiAgPHBhdGggZD0iTTQ4LDQwSDQwVjMyaDhWMTZoOFY0MEg0OFpNMjQsMTZIMTZWMEg0MFY4SDI0djhaTTE2LDMyaDh2OEgxNnY4SDhWMjRoOHY4Wk0tMTYsMTZWOEgwVjBIOFYxNkgtMTZaIi8+PC9nPgo8L3N2Zz4K")}
.img_mouse{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTI4LDM2YTU1LDU1LDAsMCwxLDU1LDU1djczYTU1LDU1LDAsMCwxLTExMSwwdi03M0E1NSw1NSwwLDAsMSwxMjgsMzZaTTEyNyw1MWE4LDgsMCwwLDEsOCw4VjgxYTgsOCwwLDAsMS0xNiwwVjU5QTgsOCwwLDAsMSwxMjcsNTFabTU1LDUxSDczbTU0LDBWODltMC0zOFYzNyIvPjwvc3ZnPgo=");}
.img_touch{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNDIsNDdIMjEzYTEwLDEwLDAsMCwxLDEwLDEwVjE5OGExMCwxMCwwLDAsMS0xMCwxMEg0MmExMCwxMCwwLDAsMS0xMC0xMFY1N0ExMCwxMCwwLDAsMSw0Miw0N1pNMzMsMTY2SDIyM20tOTUsNDJWMTY3Ii8+PC9zdmc+Cgo=")}
.img_html{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTExLDI3djk3SDE4VjNIODhaTTExMSwyN0g4OFYzTTUxLDk1TDMwLDc0LDUxLDUzTTc3LDk1TDk3LDc0LDc3LDUzTTU1LDk1TDcyLDUzIi8+PC9zdmc+Cgo=")}
.img_zip{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTksNGg5MGExNiwxNiwwLDAsMSwxNiwxNnY4OGExNiwxNiwwLDAsMS0xNiwxNkgxOUExNiwxNiwwLDAsMSwzLDEwOFYyMEExNiwxNiwwLDAsMSwxOSw0Wk0zMCwxOEg0MVYzOUgzMFYxOFpNMzAsMzlINDFWNTBIMzBWMzlaTTEyNSwzMWExNiwxNiwwLDAsMC0xNi0xNkgxOUExNiwxNiwwLDAsMCwzLDMxbTEwNiw4NEgxOU00MCw5MUgzMW05LTZIMzFtOS02SDMxbTktNkgzMW05LTZIMzFtOS02SDMxbTktNkgzMW05LDYwSDMxbTktNkgzMW05LTZIMzFtOS02SDMxIi8+PC9zdmc+Cg==")}
.img_wait{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSI1NiIgc3R5bGU9InN0cm9rZTogIzAwMDsgc3Ryb2tlLWRhc2hhcnJheTozNjA7IHN0cm9rZS1kYXNob2Zmc2V0OjM2MDsgc3Ryb2tlLXdpZHRoOjY7IGZpbGw6dHJhbnNwYXJlbnQiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InN0cm9rZS1kYXNob2Zmc2V0IiBkdXI9IjEuNXMiIHRvPSItMzYwIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgNjQgNjQ7MzYwIDY0IDY0IiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvY2lyY2xlPjwvc3ZnPgo=")}
.img_base{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTksNGg5MGExNiwxNiwwLDAsMSwxNiwxNnY4OGExNiwxNiwwLDAsMS0xNiwxNkgxOUExNiwxNiwwLDAsMSwzLDEwOFYyMEExNiwxNiwwLDAsMSwxOSw0Wk02NCwxMjRWMTAyLjkyNmExMiwxMiwwLDEsMCwwLTE3Ljg1MlY2NEg4NS4wNzRhMTIsMTIsMCwxLDEsMTcuODUyLDBIMTI1TTY0LDRWMjUuMDc0YTEyLDEyLDAsMSwwLDAsMTcuODUzVjY0SDQyLjkyNmExMiwxMiwwLDEsMS0xNy44NTMsMEgzIi8+PC9zdmc+Cg==")}
.scene{background-color:var(--cb);border-radius:12px;padding:4px;margin-top:4px;}
.dialog_element{padding:4px;font-size:12px;border-radius:6px;background-color:#fff;margin-bottom:4px;}
.dialog{margin-top:4px;padding:4px;border-radius:8px;background-color:var(--cw);}
.scene_bg{
	padding:4px 8px;
	border-radius:8px;
	background-color:#fff;
	background-size:cover;
	background-repeat:no-repeat;
	background-position:center;
	width:calc(100% - 16px);
	height:128px;
}
.element{padding:4px;border-radius:6px;font-size:12px;background-color:#fff;margin-bottom:4px;}
.choice_b{
	background-color:var(--cw);
	margin-bottom:8px;
	margin-top:8px;
	min-height:20px;
	text-align:center;
	padding:4px;
	border-radius:6px;
    font-size:12px;
}
#add_element{position:absolute;left:0;top:0;visibility:hidden;width:190px;}
#window_zone{height:100vh;width:100%;position:fixed;left:0;top:0;visibility:hidden;transition-duration:0.5s;z-index:10000;}
.window{
	position:absolute;
	top:50%;
	transform:translate(-50%,-50%);
	left:50%;
	background-color:#fff;
	border-radius:16px;
	box-shadow:0px 2px 24px var(--cs);
}
.add_w{
	background-color:#fff;
	border-radius:16px;
	box-shadow:0px 2px 24px var(--cs);
}
.button{border-radius:8px;width:100%;height:90%;background-color:var(--cw);}
.button:hover{background-color:var(--cb);}
.big_button{border-radius:20px;height:40px;background-color:var(--cw);cursor:pointer;}
.big_button:hover{background-color:var(--cb);}
.big_button2{border-radius:20px;height:40px;background-color:#fff;box-shadow:0px 2px 24px var(--cs);cursor:pointer;}
.big_button2:hover{background-color:var(--cb);}
.big_button3{border-radius:16px;height:32px;background-color:var(--cw);cursor:pointer;}
.big_button3:hover{background-color:var(--cb);}
.big_button3b{background-color:var(--cw);}
.edit_button{background-color:none;cursor:pointer;height:40px;}
.edit_button:hover{background-color:var(--cw);cursor:pointer;}
.search{
	height:40px;
	border-left:1px solid var(--cb);
	border-right:1px solid var(--cb);
	width:88px;
	padding-left:8px;
    -webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;
}
.add_button{height:28px;width:28px;}
.input_text_b{
	border:0;
	font-family:Arial;
	font-size:12px;
	-webkit-appearance:none;
	background-color:transparent;
	cursor:text;
	height:20px;
	width:100%;
	-webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;
}
.input_text{
	border:0;
	font-family:Arial;
	font-size:12px;
	-webkit-appearance:none;
	border-bottom:1px solid var(--cb);
	background-color:transparent;
	cursor:text;
	height:28px;
	width:100%;
	-webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;
}
.input_slider{-webkit-appearance:none;height:8px;background: var(--cw);outline:none;border-radius:8px;}
.input_slider::-webkit-slider-thumb {-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:var(--cb);cursor:pointer;border:3px solid #fff;}
.input_slider::-moz-range-thumb {-moz-appearance:none;appearance:none;width:16px;height:16px;border-radius:50%;background:var(--cb);cursor:pointer;border:3px solid #fff;}
input[type="text"]{text-indent:4px;}
select{text-align-last:center;}
.input_text:focus{border-bottom:1px solid #000;}
hr{border-top:1px solid var(--cb);margin:4px 0px;}
.checkbox_a{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMzIiIGN5PSIzMiIgcj0iMjgiLz48L3N2Zz4NCg==");background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:16px;width:16px;cursor:pointer;}
.checkbox_a:checked {content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMzIiIGN5PSIzMiIgcj0iMjgiLz48Y2lyY2xlIGZpbGw9IiMwMDAiIGN4PSIzMiIgY3k9IjMyIiByPSIxOCIvPjwvc3ZnPg0K");}
.checkbox_b{height:24px;width:24px;content:none;background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:16px;}
.checkbox_b:checked {content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgLTggMjU2IDI1NiI+CiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTgiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xODgsODQgMTE0LDE2NiA2NywxMjIiLz4KPC9zdmc+");}
.set_button{height:40px;border-right:1px solid var(--cb);padding:0px 12px;background-color:var(--cw);}
.set_select{background-color:var(--cb);}
.set_blank{overflow-x:hidden;position:absolute;overflow-y:auto;width:100%;height:60vh;min-height:360px;}
.window_close{position:absolute;right:0px;top:0px;height:40px;width:40px;cursor:pointer;}
.namber{padding-left:8px;font-size:12px;color:#888;}
.add_el{height:40px;background-color:#fff;}
.add_el:hover{background-color:var(--cb);}
.text_tutorials_a{font-size:12px;text-align:left;background-color:var(--cw);padding:8px;color:#999;}
.text_tutorials_b{font-size:12px;text-align:left;padding-top:4px;color:#999;}
.select_tutorials{-webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;}
.chec_bg{border:2px solid var(--cw);border-radius:8px;background-color:var(--cb);height:68px;width:68px;content:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;}
.chec_bg:checked{background-color:var(--cw);border:2px solid var(--cb);}
#scene_maker{height:100vh;width:100%;position:fixed;left:0px;top:0px;display:none;}
#scene_canvas{height:calc(100vh - 40px);width:calc(98vh - 40px);position:relative;}
@media only screen and (max-width: 120vh){#scene_canvas{height:72vw;width:72vw;}}
#scene_layout{
    overflow:hidden;
    height:100%;
    width:50%;
    background-color:#000;
    position:absolute;
    top:50%;left:50%;
    transform:translate(-50%,-50%);
    border-radius:8px;
    background-color:#fff;
    background-repeat:no-repeat;
    background-position:center;
    box-shadow:0px 2px 24px var(--cs);
}
.set_title{background-color:var(--cb);cursor:pointer;}
.input_color{cursor:pointer;border: none;height:100%;width:100%;opacity: 0;}
.show_color{background-color:var(--cb);border-radius:50%;width:26px;height:26px;}
#resizers{box-sizing:border-box;width:100px;height:100px;position:absolute;top:100px;left:100px;cursor:move;border: 1px dashed var(--cb);}
.resizer{width:7px;height:7px;border-radius:50%;background:var(--cw);border: 1px solid var(--cb);position:absolute;z-index:4000;}
.top-left{left:-5px;top:-5px;cursor:nwse-resize;}
.top-right{right:-5px;top:-5px;cursor:nesw-resize;}
.bottom-left{left:-5px;bottom:-5px;cursor:nesw-resize;}
.bottom-right{right:-5px;bottom:-5px;cursor:nwse-resize;}
.size-right{right:-5px;top:50%;cursor:ew-resize;transform:translateY(-50%);}
.size-top{left:50%;top:-5px;cursor:ns-resize;transform:translateX(-50%);}
.size-left{left:-5px;top:50%;cursor:ew-resize;transform:translateY(-50%);}
.size-bottom{left:50%;bottom:-5px;cursor:ns-resize;transform:translateX(-50%);}
.rotate {left:50%;top:-32px;cursor:crosshair;transform:translateX(-50%);}
.proportion_c{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgNTEyIj4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgIGQ9Ik0xMjgsMTg4YTEyLDEyLDAsMCwxLDEyLDEydjMyYTEyLDEyLDAsMCwxLTI0LDBWMjAwQTEyLDEyLDAsMCwxLDEyOCwxODhaIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjgiIHN0cm9rZS1saW5lam9pbj0icm91bmQiICBkPSJNMTI4LDI2OGExMiwxMiwwLDAsMSwxMiwxMnYzMmExMiwxMiwwLDAsMS0yNCwwVjI4MEExMiwxMiwwLDAsMSwxMjgsMjY4WiIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI4IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiAgZD0iTTEyOCwyODNWMjMyIi8+Cjwvc3ZnPgo=");height:64px;width:32px;background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;}
.proportion_c:checked{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgNTEyIj4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOCwzNTUuNVYzOThhMzAsMzAsMCwwLDEtMzAsMzBILTZNLTYsODVIOThhMzAsMzAsMCwwLDEsMzAsMzB2NDIuNSIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI4IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiAgZD0iTTEyOCwxODhhMTIsMTIsMCwwLDEsMTIsMTJ2MzJhMTIsMTIsMCwwLDEtMjQsMFYyMDBBMTIsMTIsMCwwLDEsMTI4LDE4OFoiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgIGQ9Ik0xMjgsMjY4YTEyLDEyLDAsMCwxLDEyLDEydjMyYTEyLDEyLDAsMCwxLTI0LDBWMjgwQTEyLDEyLDAsMCwxLDEyOCwyNjhaIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjgiIHN0cm9rZS1saW5lam9pbj0icm91bmQiICBkPSJNMTI4LDI4M1YyMzIiLz4KPC9zdmc+Cg==");}
.align{
    -webkit-appearance:none;-moz-appearance:none;appearance:none;
    height:32px;width:32px;
    border-radius:4px;cursor:pointer;
}
.align:checked {background-color:var(--cb);}
</style>
</head>
<body onload="world_size();" style='background-color:var(--cw);font-size:12px;'>
    <input type="file" id="json_file" style="display:none;position:fixed;" multiple webkitdirectory/>
    <input type="color" id="paletr" style="position:fixed;visibility:hidden;" name="paletr">
	<div id="menu_panel">
		<table  width="100%" height="100%">
			<tbody>
				<tr>
					<td align='center' title='New project' onclick='load_files=[];new_project();menu_add.style.visibility="hidden";' class='icon button_menu icon_new'></td>
                    <td align='center' title='Load project folder ' onclick='load_new=false;json_file.click();menu_add.style.visibility="hidden";' class='icon button_menu icon_load'></td>
					<td align='center' title='Save JSON script project' onclick='save_file();menu_add.style.visibility="hidden";' class='icon button_menu icon_save'></td>
                    <td align='center' title='Undo' onclick='state_back(1);' class='icon button_menu icon_undo'></td>
                    <td align='center' title='Redo' onclick='state_back(-1);' class='icon button_menu icon_undo' style='transform:scaleX(-1);'></td>
                    <td align='center' title='Settings project' onclick='setup();menu_add.style.visibility="hidden";' class='icon button_menu icon_setup'></td>
                    <td align='center' title='Edit json text' onclick='jsonedit();menu_add.style.visibility="hidden";' class='icon button_menu icon_json'></td>
                    <td align='center' title='Export all text to CSV file' onclick='csv_export();menu_add.style.visibility="hidden";' class='icon button_menu icon_csv'></td>
                    <td align='center' title='About visual editor' onclick='about();menu_add.style.visibility="hidden";' class='icon button_menu icon_about'></td>
                    <td align='center' style='width:88px;'><input type="text" id="search_block" class="search" onkeyup="search_block()" placeholder="search block"></td>
                    <td align='center' style='width:40px;'><select class='input_text' id='language_view' style='height:40px;border-right:1px solid var(--cb);border-bottom:0;'><option value='en'>EN</option></select></td>
					<td align='center' title='Build project' onclick='build_choice();menu_add.style.visibility="hidden";' class='icon button_menu icon_build'></td>
					<td align='center' style='border-radius:0 0 16px 0;' title='Run preview Project' onclick='play_novel();menu_add.style.visibility="hidden";' class='icon button_menu icon_play'></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div id="new_story_block">
        <table height="100%">
        <tbody>
            <tr>
                <td class='button_menu' style='border-radius:20px 0 0 20px;border-right:1px solid var(--cb);'><table onclick='new_block()' height="100%"><tbody><tr><td width='42px' class='icon icon_add'></td><td align='center'>Add story block</td><td width='16px'></td></tr></tbody></table></td>
                <td width="42px" class='icon button_menu icon_equal' onclick='world_scale(2)'></td>
                <td width="42px" class='icon button_menu icon_scale' onclick='world_scale(1)'></td>
                <td width="42px" class='icon button_menu icon_minus' onclick='world_scale(false)' style='border-radius:0 20px 20px 0;'></td>
            </tr>
        </tbody>
        </table>
	</div>
	<a id="downloadAnchorElem" style="display:none;position:fixed;"></a>
    <div id='world'>
	<svg id="story_lines" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"></svg>
	<div id="story_blocks"></div>
    </div>
    <!--scene_maker-->
    <div id='scene_maker'>
        <table style="height:100vh;width:100%;">
            <tbody>
                <tr><td rowspan="3">
                    <div id='scene_view' style='width:calc(100vw - 286px);height:100vh;overflow:auto;box-sizing:border-box;' align='center'>
                        <div id='screen_preview' style='transform-origin:0 0;min-width:100%;min-height:100%;padding-top:40px;display:flex;justify-content:center;align-items:center;' onmouseup="window.getSelection().removeAllRanges();">
                            <div id='scene_canvas'><div id='scene_layout'>
                                <div id='resizers' style='visibility:hidden;'>
                                    <div class='resizer size-right'></div>
                                    <div class='resizer top-right'></div>
                                    <div class='resizer size-top'></div>
                                    <div class='resizer top-left'></div>
                                    <div class='resizer size-left'></div>
                                    <div class='resizer bottom-left'></div>
                                    <div class='resizer size-bottom'></div>
                                    <div class='resizer bottom-right'></div>
                                    <div class='resizer rotate'></div>
                                </div>
                            <table id="tue_text_block" align="center">
                                <tbody>
                                   <tr>
                                        <td id="tue_text_element" style="position:relative;" valign='top'>
                                            <div id="tue_text_view" ></div>
                                            <div id="tue_name_block"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div></div>
                        </div>
                    </div>
                    <div id="scene_controll" style="right:320px;">
                        <table height="100%">
                        <tbody>
                            <tr>
                                <td width="42px" class='icon button_menu icon_right' onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_editor(scen_data[0],scen_data[1],scen_data[2]-1);scen_edit_data();' style='border-radius:20px 0 0 20px;'></td>
                                <td width="42px" class='icon button_menu icon_go'    onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_editor(scen_data[0],scen_data[1],scen_data[2]+1);scen_edit_data();' style='border-right:1px solid var(--cb);'></td>
                                <td width="42px" class='icon button_menu icon_equal' onclick='world_scale(2)'></td>
                                <td width="42px" class='icon button_menu icon_scale' onclick='world_scale(1)'></td>
                                <td width="42px" class='icon button_menu icon_minus' onclick='world_scale(false)' style='border-radius:0 20px 20px 0;'></td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                </td>
                    <td id='scrnr_title' height="40px" align='center' style="background-color:#fff;width:286px;" class='namber'>block name (scene:1 | dialog:1)</td></tr>
                <tr>
                    <td style="background-color:#fff;border-bottom:1px solid var(--cb);border-top:1px solid var(--cb);"><div style='height:calc(100vh - 80px);overflow-x:hidden;overflow-y:auto;'>
                        <table onclick="block_open('set_preview');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Preview</td></tr></tbody></table>
                        <div class="set_panel" id="set_preview" style="width:100%;display:block;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Orientation</td><td style='padding-right:8px;'>
                                <select id='ratio_screen' class='input_text' oninput='setup_editor.preview[1]=this.selectedIndex;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));preview_size();video_size();' style='width:100%;'>
                                      <option value=true selected>landscape</option>
                                      <option value=false>Portrait</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Size</td><td style='padding-right:8px;'>
                               <select id='screen_size' class='input_text' oninput='preview_size();' style='width:100%;'>
                                    <option value="0" selected>My screen</option>
                                    <option value="-1">Preview size</option>
                                    <option value="1080">1080</option>
                                    <option value="720">720</option>
                                    <option value="480">480</option>
                                    <option value="360">360</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Screen</td><td style='padding-right:8px;'>
                               <select class='input_text' oninput='p_width.value=this.value;setup_editor.preview[0]=this.value;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));preview_size();video_size();' style='width:100%;'>
                                    <option value="100">1:1</option>
                                    <option value="75">4:3</option>
                                    <option value="56">16:9</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Ratio</td><td style='padding-right:8px;'>
                                <input id='p_width' class='input_slider' onchange='setup_editor.preview[0]=this.value;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));' oninput='preview_size();video_size();' type="range" value='100' min="50" max="100" style='width:100%;'>
                            </td></tr>
                        </tbody></table></div>
                        <table onclick="block_open('text_panel_g');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Text panel (global)</td></tr></tbody></table>
                        <div class="set_panel" id="text_panel_g" style="width:100%;display:none;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_w' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='95%' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_h' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='25%' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='2'>
                                <input id='style' class='input_text' onchange='scen_edit_updare(true)' type="text" value='' style='width:100%;'>
                            </td><td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.text_panel;edit_code('style','Style CSS');">
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color panel</td><td style='width:40px;' align='center'><div class='show_color' id='color_t_s'></div></td><td style='padding-right:8px;'>
                                <input id='color_t' class='input_text' onchange='color_t_b.value=this.value;color_t_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='color_t_b' type="color" name="paletr" class='input_color' oninput='color_t.value=this.value;color_t_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color text</td><td style='width:40px;' align='center'><div class='show_color' id='color_text_s'></div></td><td style='padding-right:8px;'>
                                <input id='color_text' class='input_text' onchange='color_text_b.value=this.value;color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='color_text_b' type="color" name="paletr" class='input_color' oninput='color_text.value=this.value;color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_text' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font family</td><td style='padding-right:8px;' colspan='3'>
                                <input id='font_family' class='input_text' onchange='scen_edit_updare(true)' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Class name</td><td style='padding-right:8px;' colspan='3'>
                                <input id='className' class='input_text' onchange='scen_edit_updare(true)' type="text" value='100' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Dialog speed</td><td style='padding-right:8px;' colspan='3'>
                                <input id='dialog_speed' class='input_text' onchange='this.value=correct_value(this.value,true);scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Top position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_t' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Left position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_l' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Bottom position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='indent_bottom' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Right position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_r' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Indent text</td><td style='padding-right:8px;' colspan='3'>
                                <input id='indent_text' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" style='width:100%;'>
                            </tbody><tbody id='atp_edit'>
                        </tbody></table>
                        </div>
                        <table onclick="block_open('name_panel_g');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left'
                        ='center'>Name panel (global)</td></tr></tbody></table>
                        <div class="set_panel" id="name_panel_g" style="width:100%;display:none;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_w' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_h' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='48px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='2'>
                                <input id='n_style' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td><td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.name_panel;edit_code('style','Style CSS');">
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color panel</td><td style='width:40px;' align='center'><div class='show_color' id='n_color_s'></div></td><td style='padding-right:8px;'>
                                <input id='n_color' class='input_text' onchange='n_color_b.value=this.value;n_color_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='n_color_b' type="color" name="paletr" class='input_color' oninput='n_color.value=this.value;n_color_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color text</td><td style='width:40px;' align='center'><div class='show_color' id='n_color_text_s'></div></td><td style='padding-right:8px;'>
                                <input id='n_color_text' class='input_text' onchange='n_color_text_b.value=this.value;n_color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='n_color_text_b' type="color" name="paletr" class='input_color' oninput='n_color_text.value=this.value;n_color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_text' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='18px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font family</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_font_family' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Class name</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_className' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Top position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_t' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Left position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_l' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Bottom position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_b' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Right position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_r' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Indent text</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_indent_text' class='input_text' onchange='this.value=correct_value(this.value);scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            </tbody><tbody id='anp_edit'>
                        </tbody></table>
                        </div>
                        <table onclick="block_open('interface_buttons');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Interface buttons (global)</td></tr></tbody></table>
                        <div class="interface_buttons" id="interface_buttons" style="width:100%;display:none;"><div id='interface_buttons_c'></div>
                            <div style='width:100%;margin-bottom:16px;' onclick='interface_buttons_c.innerHTML+=button_panel_edit(-1);button_panel_update();' align='center'><div id='add_scen_items' class='add_button icon_m icon_add'></div></div>
                        </div>
                        <table onclick="block_open('set_scene');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Scene content</td></tr></tbody></table>
                        <div class="set_panel" id="set_scene" style="width:100%;display:none;">
                            <table style="width:100%;"><tbody>
                                <tr><td align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_edit'><tbody><tr><td width='60px' class='icon_m icon_setup'></td><td align='left'>Scene edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_json'><tbody><tr><td width='60px' class='icon_m icon_json'></td><td align='left'>JSON edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_text'><tbody><tr><td width='60px' class='icon_m icon_edit2'></td><td align='left'>Text edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_video'><tbody><tr><td width='60px' class='icon_m icon_video'></td><td align='left'>Video</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_audio_play'><tbody><tr><td width='60px' class='icon_m icon_audio_play'></td><td align='left'>Play Sound</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_audio_off'><tbody><tr><td width='60px' class='icon_m icon_audio_off'></td><td align='left'>Stop Sound</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_var'><tbody><tr><td width='60px' class='icon_m icon_var'></td><td align='left'>Variable</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_html'><tbody><tr><td width='60px' class='icon_m icon_html'></td><td align='left'>HTML edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_js'><tbody><tr><td width='60px' class='icon_m icon_js'></td><td align='left'>JavaScript edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr>
                            </tbody></table>
                        </div>
                        <table onclick="block_open('arts_e');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Arts</td></tr></tbody></table>
                        <div class="set_panel" id="arts_e" style="width:100%;display:block;"><div id='arts_ec'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_art' class='add_button icon_m icon_add'></div></div>
                        </div>
                        <table onclick="block_open('choice_e');" class="set_title"  height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Buttons & hoice</td></tr></tbody></table>
                        <div class="set_panel" id="choice_e" style="width:100%;display:block;"><div id='choice_ec'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_choice' class='add_button icon_m icon_add'></div></div>
                        </div>
                    </div></td>
                </tr>
                <tr>
                    <td height="40px" align='center' style="background-color:#fff;" class='button_menu'><table class='button_menu' width='100%' height="100%" onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_edit_updare(false);'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Back</td><td width='42px'></td></tr></tbody></table></td>
                </tr>
            </tbody>
        </table>
    </div>
    <!--scene_maker-->
	<div id='window_zone' align='center'></div>
    <div id='add_element' align='center' style='z-index:10001;'></div>
    <div id="toast">
        <table border="0" height="100%" width="100%">
            <tbody>
                <tr>
                    <td align="center" valign="center" >
                        <div id="toast_message"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
<script>
function set_ui(t){
    var r=document.querySelector(':root');
    r.style.setProperty('--cb', color_ui[t][0]);
    r.style.setProperty('--cw', color_ui[t][1]);
    r.style.setProperty('--cs', color_ui[t][2]);
    r.style.setProperty('--cf', color_ui[t][3]);
    r.style.setProperty('--cm', color_ui[t][4]);
    r.style.setProperty('--cl', color_ui[t][5]);
}
var body=document.body,html=document.documentElement;
var all_blocks=document.getElementsByClassName("story_block");
var story_lines=document.getElementById("story_lines");
var menu_add=document.getElementById('add_element');
var img_file=document.getElementById('json_file');
var color_chois=document.getElementById('paletr');
var languare="en";
var runtime="let story_json=new Array;var tuesday=document.getElementById(\"tuesday\"),tue_text_view,tue_text_block,tue_text_element,tue_name_block=document.createElement(\"div\"),languare,scene=0,dialog=0,dialog_text,dialog_speed=50,dialog_letter=0,dialog_timeout,tue_story,tue_bg_music,tue_fullScreen=!1,arr_dialog,timers;function cmenu(){return!1}function get_lang(){var e;languare=null!=navigator.languages?navigator.languages[0].substring(0,2):navigator.languagesubstring(0,2);for(var t=0;t<story_json.parameters.languares.length;t++)languare==story_json.parameters.languares[t]&&(e=!0);e||(languare=story_json.parameters.languares[0])}function load_story(e,t){if(\"data\"==e)story_json=t,base_creation(),tuesday.dispatchEvent(new Event(\"script_loaded\")),story_json.parameters.sounds&&creation_sound();else if(\"file\"==e){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&(200==this.status||0==this.status)){try{story_json=JSON.parse(this.responseText)}catch(e){this.status>0&&alert(\"Json structure error\")}base_creation(),tuesday.dispatchEvent(new Event(\"script_loaded\")),story_json.parameters.sounds&&creation_sound()}},a.open(\"GET\",t,!0),a.send(),a.onerror=function(){0==this.status&&alert(\"Error load json file Cross-Origin Resource Sharing(CORS)\")}}}function name_block_update(){story_json.parameters.name_panel.color&&(tue_name_block.style.backgroundColor=story_json.parameters.name_panel.color),story_json.parameters.name_panel.color_text?tue_name_block.style.color=story_json.parameters.name_panel.color_text:tue_name_block.style.color=story_json.parameters.text_panel.color_text,tue_name_block.style.position=\"absolute\",tue_name_block.id=\"tue_name_block\",tue_name_block.style.padding=story_json.parameters.name_panel.indent_text,tue_name_block.style.fontSize=story_json.parameters.name_panel.size_text,tue_name_block.style.fontFamily=story_json.parameters.name_panel.font_family?story_json.parameters.name_panel.font_family:story_json.parameters.font,tue_name_block.style.textAlign=\"center\",(tue_name_block.style.width=0!=story_json.parameters.name_panel.size[0])&&(tue_name_block.style.width=story_json.parameters.name_panel.size[0]),tue_name_block.style.height=story_json.parameters.name_panel.size[1],tue_name_block.style.lineHeight=story_json.parameters.name_panel.size[1],0!=story_json.parameters.name_panel.position[0]&&(tue_name_block.style.left=story_json.parameters.name_panel.position[0]),0!=story_json.parameters.name_panel.position[1]&&(tue_name_block.style.right=story_json.parameters.name_panel.position[1]),0!=story_json.parameters.name_panel.position[2]&&(tue_name_block.style.top=story_json.parameters.name_panel.position[2]),0!=story_json.parameters.name_panel.position[3]&&(tue_name_block.style.bottom=story_json.parameters.name_panel.position[3]),tue_name_block.style.zIndex=1001}function base_creation(){if(get_lang(),story_json.parameters.style_file&&add_style(story_json.parameters.style_file),dialog_speed=story_json.parameters.text_panel.dialog_speed,story_json.parameters.title&&(story_json.parameters.title[languare]?document.title=story_json.parameters.title[languare]:document.title=story_json.parameters.title),tuesday.style.backgroundRepeat=\"no-repeat\",tuesday.style.backgroundPosition=\"center\",tuesday.style.position=\"relative\",tuesday.style.overflow=\"hidden\",tuesday.innerHTML=\"<table id='tue_text_block' align='center'><tbody><tr><td id='tue_text_element'><div id='tue_text_view'></div></td></tr></tbody></table>\",tue_text_block=document.getElementById(\"tue_text_block\"),(tue_text_element=document.getElementById(\"tue_text_element\")).style.position=\"relative\",story_json.parameters.text_panel.className&&(tue_text_block.className=story_json.parameters.text_panel.className),story_json.parameters.text_panel.style&&(tue_text_block.style=story_json.parameters.text_panel.style),tue_text_block.style.position=\"absolute\",story_json.parameters.text_panel.size&&(tue_text_block.style.width=story_json.parameters.text_panel.size[0],tue_text_block.style.height=story_json.parameters.text_panel.size[1]),story_json.parameters.text_panel.position?(tue_text_block.style.left=0!=story_json.parameters.text_panel.position[0]?story_json.parameters.text_panel.position[0]:\"0\",tue_text_block.style.right=0!=story_json.parameters.text_panel.position[1]?story_json.parameters.text_panel.position[1]:\"0\",0!=story_json.parameters.text_panel.position[2]&&(tue_text_block.style.top=story_json.parameters.text_panel.position[2]),0!=story_json.parameters.text_panel.position[3]&&(tue_text_block.style.bottom=story_json.parameters.text_panel.position[3])):(tue_text_block.style.left=\"0\",tue_text_block.style.right=\"0\"),story_json.parameters.text_panel.indent_bottom&&(tue_text_block.style.bottom=story_json.parameters.text_panel.indent_bottom),tue_text_block.style.zIndex=1e3,tue_text_block.style.borderSpacing=0,(tue_text_view=document.getElementById(\"tue_text_view\")).style.boxSizing=\"border-box\",tue_text_view.style.padding=story_json.parameters.text_panel.indent_text,tue_text_view.style.fontSize=story_json.parameters.text_panel.size_text,tue_text_view.style.fontFamily=story_json.parameters.text_panel.font_family?story_json.parameters.text_panel.font_family:story_json.parameters.font,tue_text_view.style.height=\"100%\",story_json.parameters.name_panel&&(story_json.parameters.name_panel.className&&(tue_name_block.className=story_json.parameters.name_panel.className),story_json.parameters.name_panel.style&&(tue_name_block.style=story_json.parameters.name_panel.style),tue_text_element.appendChild(tue_name_block),name_block_update()),(tue_bg_music=document.createElement(\"AUDIO\")).id=\"tue_bg_music\",tuesday.appendChild(tue_bg_music),story_json.parameters.launch_story)tue_story=story_json.parameters.launch_story;else for(var e=0;e<2;e++)if(\"parameters\"!=Object.getOwnPropertyNames(story_json)[e]){story_json.parameters.launch_story=Object.getOwnPropertyNames(story_json)[1],tue_story=story_json.parameters.launch_story;break}function t(e,t){(t=document.getElementById(t)).style.backgroundRepeat=\"no-repeat\",t.style.backgroundPosition=\"center\",e.art&&(t.style.backgroundImage=\"url('\"+art_data(e.art)+\"')\"),e.art_size&&(\"patch\"==e.art_size&&(t.style.backgroundImage=\"none\"),\"object\"==typeof e.art_size?t.style.backgroundSize=e.art_size[0]+\" \"+e.art_size[1]:\"patch\"==e.art_size?(t.style.backgroundImage=\"none\",t.style.backgroundSize=\"none\",t.style.backgroundClip=\"padding-box\",t.style.borderStyle=\"solid\",t.style.borderWidth=e.patch[0]+\"px \"+e.patch[1]+\"px \"+e.patch[2]+\"px \"+e.patch[3]+\"px\",t.style.borderImage=\"url('\"+art_data(e.art)+\"') \"+e.patch[0]+\" \"+e.patch[1]+\" \"+e.patch[2]+\" \"+e.patch[3]+\" stretch stretch\"):t.style.backgroundSize=e.art_size)}t(story_json.parameters.name_panel,\"tue_name_block\"),t(story_json.parameters.text_panel,\"tue_text_block\"),tuesday.dispatchEvent(new Event(\"script_executed\")),localStorage.getItem(story_json.parameters.autosave)&&(story_json.parameters.variables=JSON.parse(localStorage.getItem(\"tue_auto_data\"))),creation_buttons(),creation_scene()}function creation_buttons(){for(i=0;i<story_json.parameters.buttons.length;i++){var e=document.createElement(\"div\"),t=\"\";story_json.parameters.buttons[i].sound&&(t+=story_json.parameters.buttons[i].sound?get_sound(story_json.parameters.buttons[i].sound):(story_json.parameters.buttons[i].sound_stop?\";\"+get_stop_sound(story_json.parameters.buttons[i].sound_stop):\"\")+\";\"),story_json.parameters.buttons[i].js&&(t+=story_json.parameters.buttons[i].js),e.setAttribute(\"onclick\",t+\";\"),story_json.parameters.buttons[i].className&&(e.className=story_json.parameters.buttons[i].className),story_json.parameters.buttons[i].style&&(e.style=story_json.parameters.buttons[i].style),story_json.parameters.buttons[i].text&&(\"object\"!=typeof story_json.parameters.buttons[i].text||story_json.parameters.buttons[i].text[languare]&&\"object\"!=typeof story_json.parameters.buttons[i].text[languare])&&(e.innerHTML=values_button(art_data(story_json.parameters.buttons[i].text)),e.style.padding=story_json.parameters.buttons[i].indent_text,e.style.display=\"flex\",e.style.justifyContent=story_json.parameters.buttons[i].align?story_json.parameters.buttons[i].align[0]:\"center\",e.style.alignItems=story_json.parameters.buttons[i].align?story_json.parameters.buttons[i].align[1]:\"center\",e.style.color=story_json.parameters.buttons[i].color_text,e.style.fontSize=story_json.parameters.buttons[i].size_text,e.style.fontFamily=story_json.parameters.buttons[i].font_family?story_json.parameters.buttons[i].font_family:story_json.parameters.font),e.style.zIndex=2e3+i,e.id=story_json.parameters.buttons[i].name,e.classList.add(\"tue_controll\"),e.style.position=\"absolute\",e.style.width=story_json.parameters.buttons[i].size[0],e.style.height=story_json.parameters.buttons[i].size[1],e.style.backgroundColor=story_json.parameters.buttons[i].color,e.style.backgroundRepeat=\"no-repeat\",e.style.backgroundPosition=\"center\",story_json.parameters.buttons[i].art&&(e.style.backgroundImage=\"url('\"+art_data(story_json.parameters.buttons[i].art)+\"')\"),story_json.parameters.buttons[i].art_size&&(\"patch\"==story_json.parameters.buttons[i].art_size&&(e.style.backgroundImage=\"none\"),\"object\"==typeof story_json.parameters.buttons[i].art_size?e.style.backgroundSize=story_json.parameters.buttons[i].art_size[0]+\" \"+story_json.parameters.buttons[i].art_size[1]:\"patch\"==story_json.parameters.buttons[i].art_size?(e.style.backgroundImage=\"none\",e.style.backgroundSize=\"none\",e.style.backgroundClip=\"padding-box\",e.style.borderStyle=\"solid\",e.style.borderWidth=story_json.parameters.buttons[i].patch[0]+\"px \"+story_json.parameters.buttons[i].patch[1]+\"px \"+story_json.parameters.buttons[i].patch[2]+\"px \"+story_json.parameters.buttons[i].patch[3]+\"px\",e.style.borderImage=\"url('\"+art_data(story_json.parameters.buttons[i].art)+\"') \"+story_json.parameters.buttons[i].patch[0]+\" \"+story_json.parameters.buttons[i].patch[1]+\" \"+story_json.parameters.buttons[i].patch[2]+\" \"+story_json.parameters.buttons[i].patch[3]+\" stretch stretch\"):e.style.backgroundSize=story_json.parameters.buttons[i].art_size),e.style.transform=(story_json.parameters.buttons[i].hotspot?\" translate(\"+story_json.parameters.buttons[i].hotspot[0]+\",\"+story_json.parameters.buttons[i].hotspot[1]+\")\":\"\")+(story_json.parameters.buttons[i].angle?\"rotate(\"+story_json.parameters.buttons[i].angle+\"deg)\":\"\"),0!=story_json.parameters.buttons[i].position[0]&&(e.style.left=story_json.parameters.buttons[i].position[0]),0!=story_json.parameters.buttons[i].position[1]&&(e.style.right=story_json.parameters.buttons[i].position[1]),0!=story_json.parameters.buttons[i].position[2]&&(e.style.top=story_json.parameters.buttons[i].position[2]),0!=story_json.parameters.buttons[i].position[3]&&(e.style.bottom=story_json.parameters.buttons[i].position[3]),tuesday.appendChild(e)}document.getElementById(\"tue_next\")&&document.getElementById(\"tue_next\").addEventListener(\"click\",function(){go_story()}),document.getElementById(\"tue_back\")&&document.getElementById(\"tue_back\").addEventListener(\"click\",function(){back_story()}),document.getElementById(\"tue_home\")&&document.getElementById(\"tue_home\").addEventListener(\"click\",function(){go_to(story_json.parameters.launch_story)}),document.getElementById(\"tue_save\")&&document.getElementById(\"tue_save\").addEventListener(\"click\",function(){save_stag(\"bookmark\")}),document.getElementById(\"tue_load\")&&document.getElementById(\"tue_load\").addEventListener(\"click\",function(){load_stag(\"bookmark\")}),document.getElementById(\"tue_fullScreen\")&&document.getElementById(\"tue_fullScreen\").addEventListener(\"click\",function(){full_screen()})}function creation_scene(){if(arr_dialog=story_json[tue_story][scene],del_element(\"tue_html_scene\"),arr_dialog.legacy_choice)for(var e=0;e<arr_dialog.legacy_choice.length;e++){var t=arr_dialog.legacy_choice[e][0],a=arr_dialog.legacy_choice[e][1],o=arr_dialog.legacy_choice[e][2],r=arr_dialog.legacy_choice[e][3];if(\">\"==a&&story_json.parameters.variables[t]>o){go_to(r);break}if(\"<\"==a&&story_json.parameters.variables[t]<o){go_to(r);break}if(\"=\"==a&&story_json.parameters.variables[t]==o){go_to(r);break}if(arr_dialog.legacy_choice[e].go_to){go_to(arr_dialog.legacy_choice[e].go_to);break}e==arr_dialog.legacy_choice.length-1&&(scene++,dialog=0,creation_scene())}var s;(tuesday.style.backgroundSize=arr_dialog.background_size?arr_dialog.background_size:\"cover\",arr_dialog.background_class?tuesday.className=arr_dialog.background_class:tuesday.className=\"\",arr_dialog.background_color&&(tuesday.style.backgroundColor=arr_dialog.background_color),arr_dialog.background_image&&(tuesday.style.backgroundImage=\"url('\"+art_data(arr_dialog.background_image)+\"')\"),document.getElementById(\"tue_home\")&&(tue_story==story_json.parameters.launch_story?document.getElementById(\"tue_home\").style.visibility=\"hidden\":document.getElementById(\"tue_home\").style.visibility=\"visible\"),arr_dialog.html)&&(arr_dialog.html[languare]?((s=document.createElement(\"div\")).className=\"tue_html_scene\",s.innerHTML=arr_dialog.html[languare],tuesday.appendChild(s)):((s=document.createElement(\"div\")).className=\"tue_html_scene\",s.innerHTML=arr_dialog.html,tuesday.appendChild(s)));arr_dialog.background_music&&search_music(),arr_dialog.dialogs&&arr_dialog.dialogs.length>0?creation_dialog():(del_element(\"tue_art\"),del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"),tue_text_block.style.visibility=\"hidden\")}function creation_dialog(){if(arr_dialog=story_json[tue_story][scene].dialogs[dialog],scene!=story_json[tue_story].length-1||dialog!=story_json[tue_story][scene].dialogs.length-1||arr_dialog.go_to?document.getElementById(\"tue_next\").style.visibility=\"visible\":document.getElementById(\"tue_next\").style.visibility=\"hidden\",0!=scene||0!=dialog||arr_dialog.back_to?document.getElementById(\"tue_back\").style.visibility=\"visible\":document.getElementById(\"tue_back\").style.visibility=\"hidden\",\"hidden\"==arr_dialog.controll)for(var buttons=document.getElementById(\"tuesday\").getElementsByClassName(\"tue_controll\"),i=0;i<buttons.length;i++)buttons[i].style.visibility=\"hidden\";else if(\"visible\"==arr_dialog.controll)for(var buttons=document.getElementById(\"tuesday\").getElementsByClassName(\"tue_controll\"),i=0;i<buttons.length;i++)buttons[i].style.visibility=\"visible\";if(arr_dialog.text&&\"\"!=arr_dialog.text&&\"\"!=arr_dialog.text[languare]?(tue_text_block.style.visibility=\"visible\",tue_text_view.innerHTML=\"\",values_in_text(!1),clearTimeout(dialog_timeout),anim_text(),arr_dialog.text.className&&(tue_text_block.className=arr_dialog.text.className),arr_dialog.text.style&&(tue_text_block.style=arr_dialog.text.style)):arr_dialog.text_add&&\"\"!=arr_dialog.text_add&&\"\"!=arr_dialog.text_add[languare]?(tue_text_block.style.visibility=\"visible\",tue_text_view.innerHTML=\"\",values_in_text(!0),clearTimeout(dialog_timeout),anim_text()):tue_text_block.style.visibility=\"hidden\",arr_dialog.color?tue_text_block.style.backgroundColor=arr_dialog.color:story_json.parameters.text_panel.color&&(tue_text_block.style.backgroundColor=story_json.parameters.text_panel.color),arr_dialog.color_text?tue_text_view.style.color=arr_dialog.color_text:story_json.parameters.text_panel.color_text&&(tue_text_view.style.color=story_json.parameters.text_panel.color_text),arr_dialog.name?(arr_dialog.name[languare]?(arr_dialog.name.style?(tue_name_block.style=arr_dialog.name.style,name_block_update()):story_json.parameters.name_panel.style&&(tue_name_block.style=story_json.parameters.name_panel.style,name_block_update()),tue_name_block.innerHTML=arr_dialog.name[languare],tue_name_block.style.backgroundColor=arr_dialog.name.color,tue_name_block.style.color=arr_dialog.name.color_text,arr_dialog.name.className&&(tue_name_block.className=arr_dialog.name.className)):story_json.parameters.characters?story_json.parameters.characters[arr_dialog.name]?(story_json.parameters.characters[arr_dialog.name].style?(tue_name_block.style=story_json.parameters.characters[arr_dialog.name].style,name_block_update()):story_json.parameters.name_panel.style&&(tue_name_block.style=story_json.parameters.name_panel.style,name_block_update()),tue_name_block.innerHTML=story_json.parameters.characters[arr_dialog.name][languare],tue_name_block.style.backgroundColor=story_json.parameters.characters[arr_dialog.name].color,tue_name_block.style.color=story_json.parameters.characters[arr_dialog.name].color_text,story_json.parameters.characters[arr_dialog.name].className&&(tue_name_block.className=story_json.parameters.characters[arr_dialog.name].className)):(tue_name_block.innerHTML=arr_dialog.name,tue_name_block.style.backgroundColor=arr_dialog.name.color,tue_name_block.style.color=arr_dialog.name.color_text,arr_dialog.name.className&&(tue_name_block.className=arr_dialog.name.className)):tue_name_block.innerHTML=arr_dialog.name,tue_name_block.style.visibility=\"visible\"):tue_name_block.style.visibility=\"hidden\",arr_dialog.video){var video=document.getElementById(\"tue_video\");video||(video=document.createElement(\"video\"),video.id=\"tue_video\",video.classList.add(\"tue_v\")),arr_dialog.video.style?video.style=arr_dialog.video.style:video.style=\"\",arr_dialog.video.className&&(video.style=arr_dialog.video.className+\" tue_v\"),video.style.position=\"absolute\",video.setAttribute(\"onloadedmetadata\",\"\"),video.src=art_data(arr_dialog.video.url),video.style.left=\"50%\",video.style.top=\"50%\",video.style.transform=\"translate(-50%,-50%)\",arr_dialog.video.fit&&(\"contain\"==arr_dialog.video.fit?(video.style.width=\"100%\",video.style.height=\"100%\"):\"position\"==arr_dialog.video.fit&&(video.style.transform=\"none\",video.style.width=arr_dialog.video.size[0],video.style.height=arr_dialog.video.size[1],0!=arr_dialog.video.position[0]&&(video.style.left=arr_dialog.video.position[0]),0!=arr_dialog.video.position[1]&&(video.style.right=arr_dialog.video.position[1]),0!=arr_dialog.video.position[2]&&(video.style.top=arr_dialog.video.position[2]),0!=arr_dialog.video.position[3]&&(video.style.bottom=arr_dialog.video.position[3]))),arr_dialog.video.loop?video.loop=arr_dialog.video.loop:video.loop=!1,arr_dialog.video.sound&&arr_dialog.video.sound>0?(video.muted=!1,video.volume=arr_dialog.video.sound/100):video.muted=!0,arr_dialog.video.time_start&&(video.onloadedmetadata=function(){this.currentTime=arr_dialog.video.time_start,arr_dialog.video.fit&&\"cover\"!=arr_dialog.video.fit||video_size(),arr_dialog.video.stop&&this.pause()}),arr_dialog.video.time_end?arr_dialog.video.loop?video.ontimeupdate=function(){video.currentTime>=arr_dialog.video.time_end&&(video.currentTime=arr_dialog.video.time_start?arr_dialog.video.time_start:0)}:arr_dialog.video.go_to?video.ontimeupdate=function(){video.currentTime>=arr_dialog.video.time_end&&(video.pause(),\"tue_go\"==arr_dialog.video.go_to?go_story(!0):go_to(arr_dialog.video.go_to))}:video.ontimeupdate=function(){video.currentTime>=arr_dialog.video.time_end&&video.pause()}:video.onended=function(){\"tue_go\"==arr_dialog.video.go_to?go_story(!0):go_to(arr_dialog.video.go_to)},arr_dialog.video.stop&&1==arr_dialog.video.stop||(video.autoplay=!0),tuesday.appendChild(video),\"cover\"!=arr_dialog.video.fit&&arr_dialog.video.fit||video_size()}else del_element(\"tue_v\");if(arr_dialog.art){var old=document.getElementById(\"tuesday\").getElementsByClassName(\"tue_art\"),src=!1;if(old.length>0){for(d=0;d<old.length;d++)old[d].classList.add(\"img_del\");for(i=0;i<arr_dialog.art.length;i++){for(src=!1,o=0;o<old.length;o++)if(arr_dialog.art[i].url==old[o].getAttribute(\"volume\")||arr_dialog.art[i].url[languare]==old[o].getAttribute(\"volume\")){arr_dialog.art[i].move&&0!=arr_dialog.art[i].move?(old[o].style.transitionDuration=arr_dialog.art[i].move+\"s\",arr_dialog.art[i].speed&&\"\"!=arr_dialog.art[i].speed?old[o].style.transitionTimingFunction=arr_dialog.art[i].speed:old[o].style.transitionTimingFunction=null):(old[o].style.transitionDuration=null,old[o].style.transitionTimingFunction=null),arr_dialog.art[i].opacity?old[o].style.opacity=arr_dialog.art[i].opacity:old[o].style.opacity=null,arr_dialog.art[i].fit&&(old[o].style.objectFit=arr_dialog.art[i].fit),arr_dialog.art[i].size&&(old[o].style.width=arr_dialog.art[i].size[0],old[o].style.height=arr_dialog.art[i].size[1]),old[o].style.transform=(arr_dialog.art[i].hotspot?\" translate(\"+arr_dialog.art[i].hotspot[0]+\",\"+arr_dialog.art[i].hotspot[1]+\")\":\"\")+(arr_dialog.art[i].angle?\"rotate(\"+arr_dialog.art[i].angle+\"deg)\":\"\"),0!=arr_dialog.art[i].position[0]&&(old[o].style.left=arr_dialog.art[i].position[0]),0!=arr_dialog.art[i].position[1]&&(old[o].style.left=\"calc(100% - \"+arr_dialog.art[i].position[1]+\" - \"+arr_dialog.art[i].size[0]+\")\"),0!=arr_dialog.art[i].position[2]&&(old[o].style.top=arr_dialog.art[i].position[2]),0!=arr_dialog.art[i].position[3]&&(old[o].style.top=\"calc(100% - \"+arr_dialog.art[i].position[3]+\" - \"+arr_dialog.art[i].size[1]+\")\"),src=!0,old[o].classList.remove(\"img_del\");break}0==src&&creation_art(i)}del_element(\"img_del\")}else for(i=0;i<arr_dialog.art.length;i++)creation_art(i);function creation_art(e){var t=document.createElement(\"img\");t.src=art_data(arr_dialog.art[e].url),t.setAttribute(\"volume\",arr_dialog.art[e].url[languare]?arr_dialog.art[e].url[languare]:arr_dialog.art[e].url),t.classList.add(\"tue_art\"),t.style=\"user-select:text;\"+(arr_dialog.art[e].style?arr_dialog.art[e].style:\"\"),t.style.position=\"absolute\",arr_dialog.art[e].fit&&(t.style.objectFit=arr_dialog.art[e].fit),arr_dialog.art[e].opacity?t.style.opacity=arr_dialog.art[e].opacity:t.style.opacity=null,arr_dialog.art[e].size&&(t.style.width=arr_dialog.art[e].size[0],t.style.height=arr_dialog.art[e].size[1]),t.style.transform=(arr_dialog.art[e].hotspot?\" translate(\"+arr_dialog.art[e].hotspot[0]+\",\"+arr_dialog.art[e].hotspot[1]+\")\":\"\")+(arr_dialog.art[e].angle?\"rotate(\"+arr_dialog.art[e].angle+\"deg)\":\"\"),0!=arr_dialog.art[e].position[0]&&(t.style.left=arr_dialog.art[e].position[0]),0!=arr_dialog.art[e].position[1]&&(t.style.left=\"calc(100% - \"+arr_dialog.art[e].position[1]+\" - \"+arr_dialog.art[e].size[0]+\")\"),0!=arr_dialog.art[e].position[2]&&(t.style.top=arr_dialog.art[e].position[2]),0!=arr_dialog.art[e].position[3]&&(t.style.top=\"calc(100% - \"+arr_dialog.art[e].position[3]+\" - \"+arr_dialog.art[e].size[1]+\")\"),t.setAttribute(\"draggable\",\"false\"),tuesday.appendChild(t)}}else del_element(\"tue_art\");var button_ui=document.getElementsByClassName(\"tue_controll\");for(i=0;i<button_ui.length;i++)story_json.parameters.buttons[i].text&&(button_ui[i].innerHTML=values_button(art_data(story_json.parameters.buttons[i].text)));if(arr_dialog.choice)for(tue_next.style.visibility=\"hidden\",i=0;i<arr_dialog.choice.length;i++){var choice=document.createElement(\"div\");arr_dialog.choice[i].className&&(choice.className=arr_dialog.choice[i].className),arr_dialog.choice[i].style&&(choice.style=arr_dialog.choice[i].style),choice.classList.add(\"tue_choice\"),choice.style.position=\"absolute\",choice.style.backgroundColor=arr_dialog.choice[i].color,choice.style.backgroundRepeat=\"no-repeat\",choice.style.backgroundPosition=\"center\",arr_dialog.choice[i].art&&(choice.style.backgroundImage=\"url('\"+art_data(arr_dialog.choice[i].art)+\"')\"),arr_dialog.choice[i].size&&(0!=arr_dialog.choice[i].size[0]&&(choice.style.width=arr_dialog.choice[i].size[0]),0!=arr_dialog.choice[i].size[1]&&(choice.style.height=arr_dialog.choice[i].size[1])),arr_dialog.choice[i].art_size&&(\"patch\"==arr_dialog.choice[i].art_size&&(choice.style.backgroundImage=\"none\"),\"object\"==typeof arr_dialog.choice[i].art_size?choice.style.backgroundSize=arr_dialog.choice[i].art_size[0]+\" \"+arr_dialog.choice[i].art_size[1]:\"patch\"==arr_dialog.choice[i].art_size?(choice.style.backgroundImage=\"none\",choice.style.backgroundSize=\"none\",choice.style.backgroundClip=\"padding-box\",choice.style.borderStyle=\"solid\",choice.style.borderWidth=arr_dialog.choice[i].patch[0]+\"px \"+arr_dialog.choice[i].patch[1]+\"px \"+arr_dialog.choice[i].patch[2]+\"px \"+arr_dialog.choice[i].patch[3]+\"px\",choice.style.borderImage=\"url('\"+art_data(arr_dialog.choice[i].art)+\"') \"+arr_dialog.choice[i].patch[0]+\" \"+arr_dialog.choice[i].patch[1]+\" \"+arr_dialog.choice[i].patch[2]+\" \"+arr_dialog.choice[i].patch[3]+\" stretch stretch\"):choice.style.backgroundSize=arr_dialog.choice[i].art_size),choice.style.transform=(arr_dialog.choice[i].hotspot?\" translate(\"+arr_dialog.choice[i].hotspot[0]+\",\"+arr_dialog.choice[i].hotspot[1]+\")\":\"\")+(arr_dialog.choice[i].angle?\"rotate(\"+arr_dialog.choice[i].angle+\"deg)\":\"\"),0!=arr_dialog.choice[i].position[0]&&(choice.style.left=arr_dialog.choice[i].position[0]),0!=arr_dialog.choice[i].position[1]&&(choice.style.right=arr_dialog.choice[i].position[1]),0!=arr_dialog.choice[i].position[2]&&(choice.style.top=arr_dialog.choice[i].position[2]),0!=arr_dialog.choice[i].position[3]&&(choice.style.bottom=arr_dialog.choice[i].position[3]),choice.style.color=arr_dialog.choice[i].color_text,choice.style.padding=arr_dialog.choice[i].indent_text,choice.style.fontSize=arr_dialog.choice[i].size_text,choice.style.fontFamily=arr_dialog.choice[i].font_family?arr_dialog.choice[i].font_family:story_json.parameters.font,choice.style.display=\"flex\",choice.style.justifyContent=arr_dialog.choice[i].align?arr_dialog.choice[i].align[0]:\"center\",choice.style.alignItems=arr_dialog.choice[i].align?arr_dialog.choice[i].align[1]:\"center\",choice.style.zIndex=1001+i,arr_dialog.choice[i].text&&(\"object\"!=typeof arr_dialog.choice[i].text||arr_dialog.choice[i].text[languare]&&\"object\"!=typeof arr_dialog.choice[i].text[languare])&&(choice.innerHTML=values_button(art_data(arr_dialog.choice[i].text)));var v=\"\";if(arr_dialog.choice[i].variables)for(var g=0;g<arr_dialog.choice[i].variables.length;g++)\"add\"==arr_dialog.choice[i].variables[g][1]?v+=\"story_json.parameters.variables.\"+arr_dialog.choice[i].variables[g][0]+\"+=\"+(\"number\"==typeof arr_dialog.choice[i].variables[g][2]?arr_dialog.choice[i].variables[g][2]:\"'\"+arr_dialog.choice[i].variables[g][2]+\"'\")+\";\":\"set\"==arr_dialog.choice[i].variables[g][1]&&(v+=\"story_json.parameters.variables.\"+arr_dialog.choice[i].variables[g][0]+\"=\"+(\"number\"==typeof arr_dialog.choice[i].variables[g][2]?arr_dialog.choice[i].variables[g][2]:\"'\"+arr_dialog.choice[i].variables[g][2]+\"'\")+\";\");if(arr_dialog.choice[i].js&&(v+=arr_dialog.choice[i].js+\";\"),arr_dialog.choice[i].go_to){var g=arr_dialog.choice[i].go_to;\"tue_go\"==g?choice.setAttribute(\"onclick\",\"del_element('tue_choice'); \"+v+\"go_story(true);\"+add_sound()):\"tue_load_autosave\"==g?choice.setAttribute(\"onclick\",v+\"load_stag('auto');\"+add_sound()):\"load\"==g||\"tue_load\"==g?choice.setAttribute(\"onclick\",v+\"load_stag('bookmark');\"+add_sound()):\"tue_save\"==g?choice.setAttribute(\"onclick\",v+\"save_stag('bookmark');\"+add_sound()):\"tue_no\"==g||\"\"==g?choice.setAttribute(\"onclick\",v):\"tue_fullScreen\"==g?choice.setAttribute(\"onclick\",v+\"full_screen();\"):\"tue_home\"==g?choice.setAttribute(\"onclick\",v+'go_to(\"'+story_json.parameters.launch_story+'\");'):\"tue_back\"==g?choice.setAttribute(\"onclick\",v+\"back_story();\"):\"tue_next\"==g?choice.setAttribute(\"onclick\",v+\"go_story();\"):choice.setAttribute(\"onclick\",v+\"go_to('\"+g+\"');\"+add_sound())}else choice.setAttribute(\"onclick\",v+\"go_story(true);del_element('tue_choice');\"+add_sound());function add_sound(){var e=\"\";return arr_dialog.choice[i].sound&&(e=get_sound(arr_dialog.choice[i].sound)),arr_dialog.choice[i].sound_stop&&(e+=get_stop_sound(arr_dialog.choice[i].sound_stop)),e}tuesday.appendChild(choice)}if(del_element(\"tue_html_dialog\"),arr_dialog.html)if(arr_dialog.html[languare]){var html=document.createElement(\"div\");html.className=\"tue_html_dialog\",html.innerHTML=arr_dialog.html[languare],tuesday.appendChild(html)}else{var html=document.createElement(\"div\");html.className=\"tue_html_dialog\",html.innerHTML=arr_dialog.html,tuesday.appendChild(html)}if(arr_dialog.variables)for(var i=0;i<arr_dialog.variables.length;i++){var choice_n=arr_dialog.variables[i][0];\"add\"==arr_dialog.variables[i][1]?(story_json.parameters.variables[choice_n]+=arr_dialog.variables[i][2],tuesday.dispatchEvent(new Event(arr_dialog.variables[i][0]+\"_add\"))):\"set\"==arr_dialog.variables[i][1]&&(story_json.parameters.variables[choice_n]=arr_dialog.variables[i][2]),tuesday.dispatchEvent(new Event(arr_dialog.variables[i][0]+\"_set\"))}if(arr_dialog.event&&tuesday.dispatchEvent(new Event(arr_dialog.event)),arr_dialog.sound_stop){var s=arr_dialog.sound_stop;sound_stop(s[languare]?s[languare]:s)}if(arr_dialog.sound){var s=arr_dialog.sound;sound_play(s[languare]?s[languare]:s)}arr_dialog.js&&eval(arr_dialog.js),clearTimeout(timers),arr_dialog.timer&&(timers=setTimeout(function(){\"tue_go\"==arr_dialog.timer[1]?go_story(!0):go_to(arr_dialog.timer[1])},arr_dialog.timer[0])),tuesday.dispatchEvent(new Event(\"creation_dialog\"))}function values_in_text(e){arr_dialog=story_json[tue_story][scene].dialogs[dialog];var t=\"\";e?(dialog_letter=dialog_text.length,t=dialog_text,t+=arr_dialog.text_add[languare]?arr_dialog.text_add[languare]:arr_dialog.text_add):(dialog_letter=0,t=arr_dialog.text[languare]?arr_dialog.text[languare]:arr_dialog.text);let a=t.matchAll(/<(.*?)>/g);a=Array.from(a);for(var o=0;o<a.length;o++){let e=a[o];t=t.replace(e[0],story_json.parameters.variables[e[1]])}dialog_text=t}function values_button(e){let t=e.matchAll(/<(.*?)>/g);t=Array.from(t);for(var a=0;a<t.length;a++){let o=t[a];e=e.replace(o[0],story_json.parameters.variables[o[1]])}return e}function go_story(e){if(!(arr_dialog=story_json[tue_story][scene].dialogs[dialog]).choice||e){if(arr_dialog.go_to)go_to(arr_dialog.go_to);else dialog<story_json[tue_story][scene].dialogs.length-1?(dialog++,arr_dialog.text?\"skip\"==arr_dialog.text[languare]?go_story():creation_dialog():arr_dialog.text_add&&\"skip\"==arr_dialog.text_add[languare]?go_story():creation_dialog()):++scene>=story_json[tue_story].length?scene=story_json[tue_story].length-1:(dialog=0,creation_scene());story_json.parameters.autosave&&save_stag(\"auto\")}}function back_story(){(arr_dialog=story_json[tue_story][scene].dialogs[dialog],del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"),arr_dialog.back_to)?go_to(arr_dialog.back_to):dialog>0?(dialog-=1,arr_dialog.text?\"skip\"==arr_dialog.text[languare]?back_story():creation_dialog():arr_dialog.text_add?\"skip\"==arr_dialog.text_add[languare]?back_story():(dialog_text=arr_dialog.text_add[languare]?dialog_text.replace(arr_dialog.text_add[languare],\"\"):dialog_text.replace(arr_dialog.text_add,\"\"),dialog_text=story_json[tue_story][scene].dialogs[dialog+1].text_add[languare]?dialog_text.replace(story_json[tue_story][scene].dialogs[dialog+1].text_add[languare],\"\"):dialog_text.replace(story_json[tue_story][scene].dialogs[dialog+1].text_add,\"\"),creation_dialog()):(creation_dialog(),del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"))):((scene-=1)<0?(scene=0,dialog=0):dialog=story_json[tue_story][scene].dialogs.length-1,creation_scene());story_json.parameters.autosave&&save_stag(\"auto\")}function save_stag(e){localStorage.setItem(\"tue_\"+e+\"_scene\",scene),localStorage.setItem(\"tue_\"+e+\"_dialog\",dialog),localStorage.setItem(\"tue_\"+e+\"_story\",tue_story),story_json.parameters.variables&&localStorage.setItem(\"tue_\"+e+\"_data\",JSON.stringify(story_json.parameters.variables)),\"bookmark\"==e&&tuesday.dispatchEvent(new Event(\"save\"))}function load_stag(e){del_element(\"tue_choice\"),del_element(\"tue_html_sc\"),scene=localStorage.getItem(\"tue_\"+e+\"_scene\"),dialog=localStorage.getItem(\"tue_\"+e+\"_dialog\"),tue_story=localStorage.getItem(\"tue_\"+e+\"_story\"),story_json.parameters.variables=JSON.parse(localStorage.getItem(\"tue_\"+e+\"_data\")),creation_scene(),search_music(),tuesday.dispatchEvent(new Event(\"load\"))}function go_to(e){del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"),dialog=0,scene=0,tue_story=e,creation_scene()}function del_element(e){for(var t=document.getElementById(\"tuesday\").getElementsByClassName(e),a=t.length,o=0;o<a;o++)t[0].parentNode.removeChild(t[0])}function anim_text(){0==dialog_speed?tue_text_view.innerHTML=dialog_text:0!=dialog_speed&&dialog_letter<dialog_text.length?dialog_timeout=setTimeout(add_letter,dialog_speed):dialog_letter==dialog_text.length&&(tue_text_view.innerHTML=dialog_text,tuesday.dispatchEvent(new Event(\"dialog_end\")))}function add_letter(){tue_text_view.innerHTML=dialog_text.slice(0,dialog_letter),dialog_letter++,anim_text()}function search_music(){for(var e=scene;e>=0;e--)if(story_json[tue_story][e].background_music){tue_bg_music.canPlayType(\"audio/mpeg\")?story_json[tue_story][e].background_music.indexOf(\"blob:\")>-1?tue_bg_music.src=story_json[tue_story][e].background_music:story_json[tue_story][e].background_music.indexOf(\".mp3\")>-1?tue_bg_music.src=story_json[tue_story][e].background_music:tue_bg_music.src=story_json[tue_story][e].background_music+\".mp3\":tue_bg_music.src=story_json[tue_story][e].background_music+\".ogg\",tue_bg_music.loop=!0,tue_bg_music.play();break}}function creation_sound(){for(var e=0;Object.keys(story_json.parameters.sounds)[e];){var t=document.createElement(\"audio\");t.preload=\"auto\",t.id=Object.keys(story_json.parameters.sounds)[e],t.canPlayType(\"audio/mpeg\")?story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].indexOf(\"blob:\")>-1?t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]:story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].indexOf(\".mp3\")>-1?t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]:t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]+\".mp3\":t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]+\".ogg\",tuesday.appendChild(t),e++}}function get_sound(e){return e[languare]?\"sound_play('\"+e[languare]+\"');\":\"sound_play('\"+e+\"');\"}function get_stop_sound(e){return e[languare]?\"sound_stop('\"+e[languare]+\"');\":\"sound_stop('\"+e+\"');\"}function sound_play(e){var t=document.getElementById(e);t&&(t.currentTime=0,t.volume=1,t.play())}function sound_stop(e){document.getElementById(e).currentTime=0,document.getElementById(e).pause()}function add_style(e){var t=document.createElement(\"link\");t.setAttribute(\"rel\",\"stylesheet\"),t.setAttribute(\"type\",\"text/css\"),t.setAttribute(\"href\",e),document.getElementsByTagName(\"head\").item(0).appendChild(t)}function full_screen(){tue_fullScreen?(tue_fullScreen=!1,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(tue_fullScreen=!0,tuesday.requestFullscreen?tuesday.requestFullscreen():tuesday.mozRequestFullScreen?tuesday.mozRequestFullScreen():tuesday.webkitRequestFullscreen?tuesday.webkitRequestFullscreen():tuesday.msRequestFullscreen&&tuesday.msRequestFullscreen())}function art_data(e){return e[languare]?\"number\"==typeof e[languare]?story_json.base[e[languare]-1]:e[languare]:\"number\"==typeof e?story_json.base[e-1]:e}function video_size(){var e=document.getElementById(\"tue_video\"),t=tuesday.getBoundingClientRect();t.width>t.height?e.videoWidth<e.videoHeight?(e.style.height=\"100%\",e.style.width=\"auto\"):(e.style.height=\"auto\",e.style.width=\"100%\"):e.videoWidth<e.videoHeight?(e.style.height=\"auto\",e.style.width=\"100%\"):(e.style.height=\"100%\",e.style.width=\"auto\")}document.oncontextmenu=cmenu,window.onmousedown=window.onselectstart=function(){return!1},document.addEventListener(\"keydown\",function(e){var t=e.code;if(t==story_json.parameters.key.next)go_story();else if(t==story_json.parameters.key.back)back_story();else if(t==story_json.parameters.key.main){go_to(story_json.parameters.launch_story)}else t==story_json.parameters.key.save?save_stag(\"bookmark\"):t==story_json.parameters.key.load?load_stag(\"bookmark\"):t==story_json.parameters.key.autosave?load_stag(\"auto\"):t==story_json.parameters.key.full_screen&&full_screen()});"
let arr_l;
let arr_n;
let color_ui=[
    ['#cec8e3','#efefff','rgba(110,95,165,0.25)' ,'rgb(90,75,145)'  ,'rgba(110,95,165,0.5)' ,'#6e5fa5'],
    ['#a3cdf0','#e8f3ff','rgba(83,150,204,0.25)' ,'rgb(83,150,204)' ,'rgba(83,150,204,0.5)' ,'#596c7f'],
    ['#adced1','#def9fb','rgba(103,123,124,0.25)','rgb(103,123,124)','rgba(103,123,124,0.5)','#677b7c'],
    ['#ccc','#eee','rgba(0,0,0,0.25)','#444','rgba(0,0,0,0.25)','#777'],
    ['#c4cebb','#dfebd5','rgba(109,124,91,0.25)' ,'rgb(109,124,91)' ,'rgba(109,124,91,0.5)' ,'#427e00'],
    ['#d2c4a5','#fcf1d8','rgba(121,103,63,0.25)' ,'rgb(121,103,63)' ,'rgba(121,103,63,0.5)' ,'#7b6f54'],
    ['#beb3af','#dfd9d7','rgba(64,55,51,0.25)' ,'rgb(160,142,136)' ,'rgba(160,142,136,0.5)' ,'#5a4d46']
]
let story_script={};
let line_controll=[];
let scen_data=[];
let scen_element={};
let plugins_list={
    "show_toast":{
        "name":"show toast",
        "text":"small message appears for a while",
        "code":"let tue_toast;function creation_tost(){var t=document.createElement(\"style\");t.type=\"text/css\",t.innerHTML=\"#toast{position: fixed;opacity: 0;top: -96px;z-index: 1000;}.toast_anim{left: 50%;transform: translateX(-50%);animation: viwe 0.25s, stop 2s 0.25s, close 0.5s 2s linear;}@keyframes viwe {from {opacity: 0;top: 3em}to {opacity: 1;top: 3em}}@keyframes stop {from {opacity: 1;top: 3em}to {opacity: 1;top: 3em}}@keyframes close {from {opacity: 1;top: 3em}to {opacity: 0;top: -96px}}\",document.getElementsByTagName(\"head\")[0].appendChild(t),(tue_toast=document.createElement(\"div\")).id=\"toast\",tue_toast.innerHTML=\"<table border=\'0\' height=\'100%\' width=\'100%\'><tbody><tr><td id=\'toast_message\' align=\'center\' valign=\'center\' ></td></tr></tbody></table>\",document.body.appendChild(tue_toast)}function toast(t){tue_toast.classList.remove(\"toast_anim\"),document.getElementById(\"toast_message\").innerHTML=t,tue_toast.offsetParent,tue_toast.classList.add(\"toast_anim\")}creation_tost(),tuesday.addEventListener(\"creation_dialog\",function(t){story_json[tue_story][scene].dialogs[dialog].toast&&(story_json[tue_story][scene].dialogs[dialog].toast[languare]?toast(story_json[tue_story][scene].dialogs[dialog].toast[languare]):toast(story_json[tue_story][scene].dialogs[dialog].toast))});"
    },
    "touch_swipe":{
        "name":"touch swipe",
        "text":"switches dialogue by swiping your finger across the touchscreen",
        "code":"var endTime,starttouch=null;window.addEventListener(\"touchstart\",function(t){startTime=new Date,starttouch=1===t.touches.length?t.touches.item(0).clientX:null}),window.addEventListener(\"touchend\",function(t){var e=new Date-startTime;if(starttouch&&e<500){var n=t.changedTouches.item(0).clientX;n>starttouch+40&&back_story(),n<starttouch-40&&go_story()}});"
    }
}
let languares= {"English":"en","Japanese":"ja","French":"fr","Russian":"ru","Spanish":"es","Chinese":"zh","Korean":"ko","Dutch":"nl","Afar":"aa","Abkhazian":"ab","Afrikaans":"af","Akan":"ak","Albanian":"sq","Amharic":"am","Arabic":"ar","Aragonese":"an","Armenian":"hy","Assamese":"as","Avaric":"av","Avestan":"ae","Aymara":"ay","Azerbaijani":"az","Bambara":"bm","Bashkir":"ba","Basque":"eu","Belarusian":"be","Bengali (Bangla)":"bn","Bihari":"bh","Bislama":"bi","Bosnian":"bs","Breton":"br","Bulgarian":"bg","Burmese":"my","Catalan":"ca","Chamorro":"ch","Chechen":"ce","Chichewa,Chewa,Nyanja":"ny","Chinese (Simplified)":"zh-Hans","Chinese (Traditional)":"zh-Hant","Chuvash":"cv","Cornish":"kw","Corsican":"co","Cree":"cr","Croatian":"hr","Czech":"cs","Danish":"da","Divehi,Dhivehi,Maldivian":"dv","Dzongkha":"dz","Esperanto":"eo","Estonian":"et","Ewe":"ee","Faroese":"fo","Fijian":"fj","Finnish":"fi","Fula,Fulah,Pulaar,Pular":"ff","Galician":"gl","Gaelic (Scottish)":"gd","Gaelic (Manx)":"gv","Georgian":"ka","German":"de","Greek":"el","Greenlandic":"kl","Guarani":"gn","Gujarati":"gu","Haitian Creole":"ht","Hausa":"ha","Hebrew":"he","Herero":"hz","Hindi":"hi","Hiri Motu":"ho","Hungarian":"hu","Icelandic":"is","Ido":"io","Igbo":"ig","Indonesian":"id","Interlingua":"ia","Interlingue":"ie","Inuktitut":"iu","Inupiak":"ik","Irish":"ga","Italian":"it","Javanese":"jv","Kalaallisut,Greenlandic":"kl","Kannada":"kn","Kanuri":"kr","Kashmiri":"ks","Kazakh":"kk","Khmer":"km","Kikuyu":"ki","Kinyarwanda (Rwanda)":"rw","Kirundi":"rn","Kyrgyz":"ky","Komi":"kv","Kongo":"kg","Kurdish":"ku","Kwanyama":"kj","Lao":"lo","Latin":"la","Latvian (Lettish)":"lv","Limburgish ( Limburger)":"li","Lingala":"ln","Lithuanian":"lt","Luga-Katanga":"lu","Luganda,Ganda":"lg","Luxembourgish":"lb","Manx":"gv","Macedonian":"mk","Malagasy":"mg","Malay":"ms","Malayalam":"ml","Maltese":"mt","Maori":"mi","Marathi":"mr","Marshallese":"mh","Moldavian":"mo","Mongolian":"mn","Nauru":"na","Navajo":"nv","Ndonga":"ng","Northern Ndebele":"nd","Nepali":"ne","Norwegian":"no","Norwegian bokml":"nb","Norwegian nynorsk":"nn","Nuosu":"ii","Occitan":"oc","Ojibwe":"oj","Old Church Slavonic,Old Bulgarian":"cu","Oriya":"or","Oromo (Afaan Oromo)":"om","Ossetian":"os","Pli":"pi","Pashto,Pushto":"ps","Persian (Farsi)":"fa","Polish":"pl","Portuguese":"pt","Punjabi (Eastern)":"pa","Quechua":"qu","Romansh":"rm","Romanian":"ro","Sami":"se","Samoan":"sm","Sango":"sg","Sanskrit":"sa","Serbian":"sr","Serbo-Croatian":"sh","Sesotho":"st","Setswana":"tn","Shona":"sn","Sichuan Yi":"ii","Sindhi":"sd","Sinhalese":"si","Siswati":"ss","Slovak":"sk","Slovenian":"sl","Somali":"so","Southern Ndebele":"nr","Sundanese":"su","Swahili (Kiswahili)":"sw","Swati":"ss","Swedish":"sv","Tagalog":"tl","Tahitian":"ty","Tajik":"tg","Tamil":"ta","Tatar":"tt","Telugu":"te","Thai":"th","Tibetan":"bo","Tigrinya":"ti","Tonga":"to","Tsonga":"ts","Turkish":"tr","Turkmen":"tk","Twi":"tw","Uyghur":"ug","Urdu":"ur","Uzbek":"uz","Venda":"ve","Vietnamese":"vi","Volapk":"vo","Wallon":"wa","Welsh":"cy","Wolof":"wo","Western Frisian":"fy","Xhosa":"xh","Yiddish":"yi","Yoruba":"yo","Zhuang,Chuang":"za","Zulu":"zu"}
let color_bg=['#ffd4d4','#ebd4d4','#ffedd2','#edffca','#cfffd8','#deffff','#FFF','#d3f2ff','#d8e7ff','#d3d1ff','#f0e0ff','#fbddff','#e9e9e9']
let texts={"tutorials":[{
        "en":"Move to the next block based on the values in variables. Variables are created in the 'Settings project' in the 'Variables' section."
        },{
        "en":"Text and character name settings that will be displayed in the text area"
        },{
        "en":"Customize the look of the scene, its background image and music, for subsequent dialogues and actions."
        },{
        "en":"Select working media folder for project (images & sounds)."
        },{
        "en":"Changes in the values of variables, their values can be displayed in the text as <values name> or in \"Legacy Choice\" to go to another block of script."
        },{
        "en":"Select an input device for ease of use. You can change the device in the settings in the 'editor' section."
        },{
        "en":"Mouse<br>control with the zoom wheel"
        },{
        "en":"TouchPad<br>recommended for laptops and MacBooks"
        },{
        "en":"Html file<br><br>Only index.html file will be created, after its creation it is necessary to transfer it to the working folder of the project."
        },{
        "en":"Zip file<br><br>All files from the working folder and index.html will be packed into a zip archive."
        },{
        "en":"Base64<br><br>Not recommended! All files will be combined into one html file in base64 format. Use only with a small number of files."
        }
]}
let setup_editor={
        'wheel':true,
        'fon':'',
        'ui':0,
        'lines':false,
        'preview':[76,0],
        'ferst':true,
        'pvw':[640,480]
};
let buf=['',''],back_up=[];
if(localStorage.getItem("editor_setup")){setup_editor=JSON.parse(localStorage.getItem("editor_setup"))}
if(setup_editor.ferst){
    var sel="<div class='window' style='padding:24px 8px;'><p>Select input device</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[5].en+"</p>"
    +"<table style=' border-spacing:10px;border-collapse:separate;'><tbody><tr>"
    +"<td><div style='width:256px;height:256px;border-radius:8px;' class='button_menu img_mouse' onclick='setup_editor.ferst=false;setup_editor.wheel=true;modal_window(\"close\");editor_setup();localStorage.setItem(\"editor_setup\",JSON.stringify(setup_editor));'></div><br><p style='font-size:12px;text-align:center;width:256px;' class='select_tutorials'>"+texts.tutorials[6].en+"</p></td>"
    +"<td><div style='width:256px;height:256px;border-radius:8px;' class='button_menu img_touch' onclick='setup_editor.ferst=false;setup_editor.wheel=false;modal_window(\"close\");editor_setup();localStorage.setItem(\"editor_setup\",JSON.stringify(setup_editor));'></div><br><p style='font-size:12px;text-align:center;width:256px;' class='select_tutorials'>"+texts.tutorials[7].en+"</p></td>"
    +"</tr></tbody></table></div>"
    modal_window("open",sel);
}else{editor_setup();}
function editor_setup(){
    world.className=setup_editor.fon;
    screen_preview.className=setup_editor.fon;
    preview_size();
    if(setup_editor.wheel){html.style.overflow='hidden';}
    if(setup_editor.ui&&setup_editor.ui!=0){set_ui(setup_editor.ui);}
    if(!setup_editor.pvw){setup_editor.pvw=[640,480];}
    else{html.style.overflow='auto';}
}
function color_element(id,color){
    var pos=document.getElementById(id).getBoundingClientRect();
    color_chois.name=id;
    color_chois.value=color;
    color_chois.style.top=pos.top+"px";
    color_chois.style.left=pos.right+"px";
    color_chois.click();
};
color_chois.addEventListener("input", function(){
    document.getElementById(color_chois.name).value=color_chois.value;
    if(color_chois.name=='scene_color'){scene_bg_preview.style.backgroundColor=color_chois.value}
}, false);
// jszip
!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function t(e,r,i){function n(a,o){if(!r[a]){if(!e[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};e[a][0].call(l.exports,function(t){return n(e[a][1][t]||t)},l,l.exports,t,e,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(t,e,r){"use strict";var i=t("./utils"),n=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(t){for(var e,r,n,a,o,h,u,l=[],f=0,d=t.length,c=d,p="string"!==i.getTypeOf(t);f<t.length;)c=d-f,n=p?(e=t[f++],r=f<d?t[f++]:0,f<d?t[f++]:0):(e=t.charCodeAt(f++),r=f<d?t.charCodeAt(f++):0,f<d?t.charCodeAt(f++):0),a=e>>2,o=(3&e)<<4|r>>4,h=1<c?(15&r)<<2|n>>6:64,u=2<c?63&n:64,l.push(s.charAt(a)+s.charAt(o)+s.charAt(h)+s.charAt(u));return l.join("")},r.decode=function(t){var e,r,i,a,o,h,u=0,l=0,f="data:";if(t.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var d,c=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===s.charAt(64)&&c--,t.charAt(t.length-2)===s.charAt(64)&&c--,c%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=n.uint8array?new Uint8Array(0|c):new Array(0|c);u<t.length;)e=s.indexOf(t.charAt(u++))<<2|(a=s.indexOf(t.charAt(u++)))>>4,r=(15&a)<<4|(o=s.indexOf(t.charAt(u++)))>>2,i=(3&o)<<6|(h=s.indexOf(t.charAt(u++))),d[l++]=e,64!==o&&(d[l++]=r),64!==h&&(d[l++]=i);return d}},{"./support":30,"./utils":32}],2:[function(t,e,r){"use strict";var i=t("./external"),n=t("./stream/DataWorker"),s=t("./stream/DataLengthProbe"),a=t("./stream/Crc32Probe");function o(t,e,r,i,n){this.compressedSize=t,this.uncompressedSize=e,this.crc32=r,this.compression=i,this.compressedContent=n}s=t("./stream/DataLengthProbe"),o.prototype={getContentWorker:function(){var t=new n(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new n(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,r){return t.pipe(new a).pipe(new s("uncompressedSize")).pipe(e.compressWorker(r)).pipe(new s("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,r){"use strict";var i=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(t){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,r){"use strict";var i=t("./utils"),n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==i.getTypeOf(t)?function(t,e,r,i){var s=n,a=0+r;t^=-1;for(var o=0;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}(0|e,t,t.length):function(t,e,r,i){var s=n,a=0+r;t^=-1;for(var o=0;o<a;o++)t=t>>>8^s[255&(t^e.charCodeAt(o))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,e,r){"use strict";var i;i="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:i}},{lie:37}],7:[function(t,e,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=t("pako"),s=t("./utils"),a=t("./stream/GenericWorker"),o=i?"uint8array":"array";function h(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}r.magic="\b\0",s.inherits(h,a),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,t.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},r.compressWorker=function(t){return new h("Deflate",t)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,r){"use strict";function i(t,e){var r,i="";for(r=0;r<e;r++)i+=String.fromCharCode(255&t),t>>>=8;return i}function n(t,e,r,n,a,l){var f,d,c=t.file,p=t.compression,m=l!==o.utf8encode,_=s.transformTo("string",l(c.name)),g=s.transformTo("string",o.utf8encode(c.name)),b=c.comment,v=s.transformTo("string",l(b)),y=s.transformTo("string",o.utf8encode(b)),w=g.length!==c.name.length,k=y.length!==b.length,x="",S="",z="",C=c.dir,E=c.date,A={crc32:0,compressedSize:0,uncompressedSize:0};e&&!r||(A.crc32=t.crc32,A.compressedSize=t.compressedSize,A.uncompressedSize=t.uncompressedSize);var I=0;e&&(I|=8),m||!w&&!k||(I|=2048);var O=0,B=0;C&&(O|=16),"UNIX"===a?(B=798,O|=function(t,e){var r=t;return t||(r=C?16893:33204),(65535&r)<<16}(c.unixPermissions)):(B=20,O|=63&(c.dosPermissions||0)),f=E.getUTCHours(),f<<=6,f|=E.getUTCMinutes(),f<<=5,f|=E.getUTCSeconds()/2,d=E.getUTCFullYear()-1980,d<<=4,d|=E.getUTCMonth()+1,d<<=5,d|=E.getUTCDate(),w&&(S=i(1,1)+i(h(_),4)+g,x+="up"+i(S.length,2)+S),k&&(z=i(1,1)+i(h(v),4)+y,x+="uc"+i(z.length,2)+z);var R="";return R+="\n\0",R+=i(I,2),R+=p.magic,R+=i(f,2),R+=i(d,2),R+=i(A.crc32,4),R+=i(A.compressedSize,4),R+=i(A.uncompressedSize,4),R+=i(_.length,2),R+=i(x.length,2),{fileRecord:u.LOCAL_FILE_HEADER+R+_+x,dirRecord:u.CENTRAL_FILE_HEADER+i(B,2)+R+i(v.length,2)+"\0\0\0\0"+i(O,4)+i(n,4)+_+x+v}}var s=t("../utils"),a=t("../stream/GenericWorker"),o=t("../utf8"),h=t("../crc32"),u=t("../signature");function l(t,e,r,i){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(l,a),l.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,a.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-i-1))/r:100}}))},l.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var r=n(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},l.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=n(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),e)this.push({data:function(t){return u.DATA_DESCRIPTOR+i(t.crc32,4)+i(t.compressedSize,4)+i(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},l.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,n=function(t,e,r,n,a){var o=s.transformTo("string",a(n));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(t,2)+i(t,2)+i(e,4)+i(r,4)+i(o.length,2)+o}(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},l.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},l.prototype.error=function(t){var e=this._sources;if(!a.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0},l.prototype.lock=function(){a.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=l},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,r){"use strict";var i=t("../compressions"),n=t("./ZipFileWorker");r.generateWorker=function(t,e,r){var s=new n(e.streamFiles,r,e.platform,e.encodeFileName),a=0;try{t.forEach(function(t,r){a++;var n=function(t,e){var r=t||e,n=i[r];if(!n)throw new Error(r+" is not a valid compression method !");return n}(r.options.compression,e.compression),o=r.options.compressionOptions||e.compressionOptions||{},h=r.dir,u=r.date;r._compressWorker(n,o).withStreamInfo("file",{name:t,dir:h,date:u,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(s)}),s.entriesCount=a}catch(t){s.error(t)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,r){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new i;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.5.0",i.loadAsync=function(t,e){return(new i).loadAsync(t,e)},i.external=t("./external"),e.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,r){"use strict";var i=t("./utils"),n=t("./external"),s=t("./utf8"),a=(i=t("./utils"),t("./zipEntries")),o=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function u(t){return new n.Promise(function(e,r){var i=t.decompressed.getContentWorker().pipe(new o);i.on("error",function(t){r(t)}).on("end",function(){i.streamInfo.crc32!==t.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var r=this;return e=i.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),h.isNode&&h.isStream(t)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var r=new a(e);return r.load(t),r}).then(function(t){var r=[n.Promise.resolve(t)],i=t.files;if(e.checkCRC32)for(var s=0;s<i.length;s++)r.push(u(i[s]));return n.Promise.all(r)}).then(function(t){for(var i=t.shift(),n=i.files,s=0;s<n.length;s++){var a=n[s];r.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return i.zipComment.length&&(r.comment=i.zipComment),r})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,r){"use strict";var i=t("../utils"),n=t("../stream/GenericWorker");function s(t,e){n.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}i.inherits(s,n),s.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},s.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,r){"use strict";var i=t("readable-stream").Readable;function n(t,e,r){i.call(this,e),this._helper=t;var n=this;t.on("data",function(t,e){n.push(t)||n._helper.pause(),r&&r(e)}).on("error",function(t){n.emit("error",t)}).on("end",function(){n.push(null)})}t("../utils").inherits(n,i),n.prototype._read=function(){this._helper.resume()},e.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,e,r){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,r){"use strict";function i(t,e,r){var i,n=s.getTypeOf(e),o=s.extend(r||{},h);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(t=m(t)),o.createFolders&&(i=p(t))&&_.call(this,i,!0);var f="string"===n&&!1===o.binary&&!1===o.base64;r&&void 0!==r.binary||(o.binary=!f),(e instanceof u&&0===e.uncompressedSize||o.dir||!e||0===e.length)&&(o.base64=!1,o.binary=!0,e="",o.compression="STORE",n="string");var g;g=e instanceof u||e instanceof a?e:d.isNode&&d.isStream(e)?new c(t,e):s.prepareContent(t,e,o.binary,o.optimizedBinaryString,o.base64);var b=new l(t,g,o);this.files[t]=b}var n=t("./utf8"),s=t("./utils"),a=t("./stream/GenericWorker"),o=t("./stream/StreamHelper"),h=t("./defaults"),u=t("./compressedObject"),l=t("./zipObject"),f=t("./generate"),d=t("./nodejsUtils"),c=t("./nodejs/NodejsStreamInputAdapter"),p=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},_=function(t,e){return e=void 0!==e?e:h.createFolders,t=m(t),this.files[t]||i.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function g(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,r,i;for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,i))},filter:function(t){var e=[];return this.forEach(function(r,i){t(r,i)&&e.push(i)}),e},file:function(t,e,r){if(1!==arguments.length)return t=this.root+t,i.call(this,t,e,r),this;if(g(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var s=this.files[this.root+t];return s&&!s.dir?s:null},folder:function(t){if(!t)return this;if(g(t))return this.filter(function(e,r){return r.dir&&t.test(e)});var e=this.root+t,r=_.call(this,e),i=this.clone();return i.root=r.name,i},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var r=this.filter(function(e,r){return r.name.slice(0,t.length)===t}),i=0;i<r.length;i++)delete this.files[r[i].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,r={};try{if((r=s.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");s.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var i=r.comment||this.comment||"";e=f.generateWorker(this,r,i)}catch(t){(e=new a("error")).error(t)}return new o(e,r.type||"string",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=b},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,r){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,r){"use strict";var i=t("./DataReader");function n(t){i.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(n,i),n.prototype.byteAt=function(t){return this.data[this.zero+t]},n.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2),n=t.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===e&&this.data[s+1]===r&&this.data[s+2]===i&&this.data[s+3]===n)return s-this.zero;return-1},n.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2),n=t.charCodeAt(3),s=this.readData(4);return e===s[0]&&r===s[1]&&i===s[2]&&n===s[3]},n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],18:[function(t,e,r){"use strict";var i=t("../utils");function n(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,r=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);return this.index+=t,r},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=n},{"../utils":32}],19:[function(t,e,r){"use strict";var i=t("./Uint8ArrayReader");function n(t){i.call(this,t)}t("../utils").inherits(n,i),n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,r){"use strict";var i=t("./DataReader");function n(t){i.call(this,t)}t("../utils").inherits(n,i),n.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},n.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],21:[function(t,e,r){"use strict";var i=t("./ArrayReader");function n(t){i.call(this,t)}t("../utils").inherits(n,i),n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,r){"use strict";var i=t("../utils"),n=t("../support"),s=t("./ArrayReader"),a=t("./StringReader"),o=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");e.exports=function(t){var e=i.getTypeOf(t);return i.checkSupport(e),"string"!==e||n.uint8array?"nodebuffer"===e?new o(t):n.uint8array?new h(i.transformTo("uint8array",t)):new s(i.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,r){"use strict";var i=t("./GenericWorker"),n=t("../utils");function s(t){i.call(this,"ConvertWorker to "+t),this.destType=t}n.inherits(s,i),s.prototype.processChunk=function(t){this.push({data:n.transformTo(this.destType,t.data),meta:t.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,r){"use strict";var i=t("./GenericWorker"),n=t("../crc32");function s(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(s,i),s.prototype.processChunk=function(t){this.streamInfo.crc32=n(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,r){"use strict";var i=t("../utils"),n=t("./GenericWorker");function s(t){n.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}i.inherits(s,n),s.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}n.prototype.processChunk.call(this,t)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,r){"use strict";var i=t("../utils"),n=t("./GenericWorker");function s(t){n.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=i.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}i.inherits(s,n),s.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,r){"use strict";function i(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=i},{}],29:[function(t,e,r){"use strict";var i=t("../utils"),n=t("./ConvertWorker"),s=t("./GenericWorker"),a=t("../base64"),o=t("../support"),h=t("../external"),u=null;if(o.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function l(t,e,r){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=e,this._mimeType=r,i.checkSupport(a),this._worker=t.pipe(new n(a)),t.lock()}catch(t){this._worker=new s("error"),this._worker.error(t)}}l.prototype={accumulate:function(t){return function(t,e){return new h.Promise(function(r,n){var s=[],o=t._internalType,h=t._outputType,u=t._mimeType;t.on("data",function(t,r){s.push(t),e&&e(r)}).on("error",function(t){s=[],n(t)}).on("end",function(){try{var t=function(t,e,r){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),r);case"base64":return a.encode(e);default:return i.transformTo(t,e)}}(h,function(t,e){var r,i=0,n=null,s=0;for(r=0;r<e.length;r++)s+=e[r].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(n=new Uint8Array(s),r=0;r<e.length;r++)n.set(e[r],i),i+=e[r].length;return n;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,s),u);r(t)}catch(t){n(t)}s=[]}).resume()})}(this,t)},on:function(t,e){var r=this;return"data"===t?this._worker.on(t,function(t){e.call(r,t.data,t.meta)}):this._worker.on(t,function(){i.delay(e,arguments,r)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof Buffer,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(t){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(i),r.blob=0===n.getBlob("application/zip").size}catch(t){r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch(t){r.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,r){"use strict";for(var i=t("./utils"),n=t("./support"),s=t("./nodejsUtils"),a=t("./stream/GenericWorker"),o=new Array(256),h=0;h<256;h++)o[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function u(){a.call(this,"utf-8 decode"),this.leftOver=null}function l(){a.call(this,"utf-8 encode")}o[254]=o[254]=1,r.utf8encode=function(t){return n.nodebuffer?s.newBufferFrom(t,"utf-8"):function(t){var e,r,i,s,a,o=t.length,h=0;for(s=0;s<o;s++)55296==(64512&(r=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=t.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),h+=r<128?1:r<2048?2:r<65536?3:4;for(e=n.uint8array?new Uint8Array(h):new Array(h),s=a=0;a<h;s++)55296==(64512&(r=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=t.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),r<128?e[a++]=r:(r<2048?e[a++]=192|r>>>6:(r<65536?e[a++]=224|r>>>12:(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63),e[a++]=128|r>>>6&63),e[a++]=128|63&r);return e}(t)},r.utf8decode=function(t){return n.nodebuffer?i.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,r,n,s,a=t.length,h=new Array(2*a);for(e=r=0;e<a;)if((n=t[e++])<128)h[r++]=n;else if(4<(s=o[n]))h[r++]=65533,e+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&e<a;)n=n<<6|63&t[e++],s--;1<s?h[r++]=65533:n<65536?h[r++]=n:(n-=65536,h[r++]=55296|n>>10&1023,h[r++]=56320|1023&n)}return h.length!==r&&(h.subarray?h=h.subarray(0,r):h.length=r),i.applyFromCharCode(h)}(t=i.transformTo(n.uint8array?"uint8array":"array",t))},i.inherits(u,a),u.prototype.processChunk=function(t){var e=i.transformTo(n.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var s=e;(e=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),e.set(s,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+o[t[r]]>e?r:e}(e),h=e;a!==e.length&&(n.uint8array?(h=e.subarray(0,a),this.leftOver=e.subarray(a,e.length)):(h=e.slice(0,a),this.leftOver=e.slice(a,e.length))),this.push({data:r.utf8decode(h),meta:t.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=u,i.inherits(l,a),l.prototype.processChunk=function(t){this.push({data:r.utf8encode(t.data),meta:t.meta})},r.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,r){"use strict";var i=t("./support"),n=t("./base64"),s=t("./nodejsUtils"),a=t("set-immediate-shim"),o=t("./external");function h(t){return t}function u(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}r.newBlob=function(t,e){r.checkSupport("blob");try{return new Blob([t],{type:e})}catch(r){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(t),i.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(t,e,r){var i=[],n=0,s=t.length;if(s<=r)return String.fromCharCode.apply(null,t);for(;n<s;)"array"===e||"nodebuffer"===e?i.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+r,s)))):i.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+r,s)))),n+=r;return i.join("")},stringifyByChar:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(t){return!1}}()}};function f(t){var e=65536,i=r.getTypeOf(t),n=!0;if("uint8array"===i?n=l.applyCanBeUsed.uint8array:"nodebuffer"===i&&(n=l.applyCanBeUsed.nodebuffer),n)for(;1<e;)try{return l.stringifyByChunk(t,i,e)}catch(t){e=Math.floor(e/2)}return l.stringifyByChar(t)}function d(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}r.applyFromCharCode=f;var c={};c.string={string:h,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return c.string.uint8array(t).buffer},uint8array:function(t){return u(t,new Uint8Array(t.length))},nodebuffer:function(t){return u(t,s.allocBuffer(t.length))}},c.array={string:f,array:h,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(t)}},c.arraybuffer={string:function(t){return f(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:h,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(new Uint8Array(t))}},c.uint8array={string:f,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:h,nodebuffer:function(t){return s.newBufferFrom(t)}},c.nodebuffer={string:f,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return c.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:h},r.transformTo=function(t,e){if(e=e||"",!t)return e;r.checkSupport(t);var i=r.getTypeOf(e);return c[i][t](e)},r.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":i.nodebuffer&&s.isBuffer(t)?"nodebuffer":i.uint8array&&t instanceof Uint8Array?"uint8array":i.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(t){if(!i[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(t){var e,r,i="";for(r=0;r<(t||"").length;r++)i+="\\x"+((e=t.charCodeAt(r))<16?"0":"")+e.toString(16).toUpperCase();return i},r.delay=function(t,e,r){a(function(){t.apply(r||null,e||[])})},r.inherits=function(t,e){function r(){}r.prototype=e.prototype,t.prototype=new r},r.extend=function(){var t,e,r={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===r[e]&&(r[e]=arguments[t][e]);return r},r.prepareContent=function(t,e,s,a,h){return o.Promise.resolve(e).then(function(t){return i.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new o.Promise(function(e,r){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(t){r(t.target.error)},i.readAsArrayBuffer(t)}):t}).then(function(e){var l=r.getTypeOf(e);return l?("arraybuffer"===l?e=r.transformTo("uint8array",e):"string"===l&&(h?e=n.decode(e):s&&!0!==a&&(e=function(t){return u(t,i.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):o.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,r){"use strict";var i=t("./reader/readerFor"),n=t("./utils"),s=t("./signature"),a=t("./zipEntry"),o=(t("./utf8"),t("./support"));function h(t){this.files=[],this.loadOptions=t}h.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(e)+", expected "+n.pretty(t)+")")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var i=this.reader.readString(4)===e;return this.reader.setIndex(r),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.uint8array?"uint8array":"array",r=n.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,r,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),r=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? ifit is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var i=e-r;if(0<i)this.isSignature(e,s.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(t){this.reader=i(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,r){"use strict";var i=t("./reader/readerFor"),n=t("./utils"),s=t("./compressedObject"),a=t("./crc32"),o=t("./utf8"),h=t("./compressions"),u=t("./support");function l(t,e){this.options=t,this.loadOptions=e}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,r;if(t.skip(22),this.fileNameLength=t.readInt(2),r=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,r,i,n=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<n;)e=t.readInt(2),r=t.readInt(2),i=t.readData(r),this.extraFields[e]={id:e,length:r,value:i};t.setIndex(n)},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var r=n.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var s=n.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=i(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=i(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,r){"use strict";function i(t,e,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=e,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var n=t("./stream/StreamHelper"),s=t("./stream/DataWorker"),a=t("./utf8"),o=t("./compressedObject"),h=t("./stream/GenericWorker");i.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),e=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(e=e.pipe(new a.Utf8EncodeWorker)),!s&&i&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new h("error")).error(t)}return new n(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof o&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new s(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)i.prototype[u[f]]=l;e.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,r){(function(t){"use strict";var r,i,n=t.MutationObserver||t.WebKitMutationObserver;if(n){var s=0,a=new n(l),o=t.document.createTextNode("");a.observe(o,{characterData:!0}),r=function(){o.data=s=++s%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var h=new t.MessageChannel;h.port1.onmessage=l,r=function(){h.port2.postMessage(0)}}var u=[];function l(){var t,e;i=!0;for(var r=u.length;r;){for(e=u,u=[],t=-1;++t<r;)e[t]();r=u.length}i=!1}e.exports=function(t){1!==u.push(t)||i||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,r){"use strict";var i=t("immediate");function n(){}var s={},a=["REJECTED"],o=["FULFILLED"],h=["PENDING"];function u(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,t!==n&&c(this,t)}function l(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(t,e,r){i(function(){var i;try{i=e(r)}catch(i){return s.reject(t,i)}i===t?s.reject(t,new TypeError("Cannot resolve promise with itself")):s.resolve(t,i)})}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function c(t,e){var r=!1;function i(e){r||(r=!0,s.reject(t,e))}function n(e){r||(r=!0,s.resolve(t,e))}var a=p(function(){e(n,i)});"error"===a.status&&i(a.value)}function p(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}(e.exports=u).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){throw r})})},u.prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){if("function"!=typeof t&&this.state===o||"function"!=typeof e&&this.state===a)return this;var r=new this.constructor(n);return this.state!==h?f(r,this.state===o?t:e,this.outcome):this.queue.push(new l(r,t,e)),r},l.prototype.callFulfilled=function(t){s.resolve(this.promise,t)},l.prototype.otherCallFulfilled=function(t){f(this.promise,this.onFulfilled,t)},l.prototype.callRejected=function(t){s.reject(this.promise,t)},l.prototype.otherCallRejected=function(t){f(this.promise,this.onRejected,t)},s.resolve=function(t,e){var r=p(d,e);if("error"===r.status)return s.reject(t,r.value);var i=r.value;if(i)c(t,i);else{t.state=o,t.outcome=e;for(var n=-1,a=t.queue.length;++n<a;)t.queue[n].callFulfilled(e)}return t},s.reject=function(t,e){t.state=a,t.outcome=e;for(var r=-1,i=t.queue.length;++r<i;)t.queue[r].callRejected(e);return t},u.resolve=function(t){return t instanceof this?t:s.resolve(new this(n),t)},u.reject=function(t){var e=new this(n);return s.reject(e,t)},u.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,i=!1;if(!r)return this.resolve([]);for(var a=new Array(r),o=0,h=-1,u=new this(n);++h<r;)l(t[h],h);return u;function l(t,n){e.resolve(t).then(function(t){a[n]=t,++o!==r||i||(i=!0,s.resolve(u,a))},function(t){i||(i=!0,s.reject(u,t))})}},u.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,r=!1;if(!e)return this.resolve([]);for(var i,a=-1,o=new this(n);++a<e;)i=t[a],this.resolve(i).then(function(t){r||(r=!0,s.resolve(o,t))},function(t){r||(r=!0,s.reject(o,t))});return o}},{immediate:36}],38:[function(t,e,r){"use strict";var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,r){"use strict";var i=t("./zlib/deflate"),n=t("./utils/common"),s=t("./utils/strings"),a=t("./zlib/messages"),o=t("./zlib/zstream"),h=Object.prototype.toString,u=0,l=-1,f=0,d=8;function c(t){if(!(this instanceof c))return new c(t);this.options=n.assign({level:l,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==u)throw new Error(a[r]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=i.deflateSetDictionary(this.strm,p))!==u)throw new Error(a[r]);this._dict_set=!0}}function p(t,e){var r=new c(e);if(r.push(t,!0),r.err)throw r.msg||a[r.err];return r.result}c.prototype.push=function(t,e){var r,a,o=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=s.string2buf(t):"[object ArrayBuffer]"===h.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new n.Buf8(l),o.next_out=0,o.avail_out=l),1!==(r=i.deflate(o,a))&&r!==u)return this.onEnd(r),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(n.shrinkBuf(o.output,o.next_out))):this.onData(n.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==r);return 4===a?(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===u):2!==a||(this.onEnd(u),!(o.avail_out=0))},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=c,r.deflate=p,r.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},r.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,r){"use strict";var i=t("./zlib/inflate"),n=t("./utils/common"),s=t("./utils/strings"),a=t("./zlib/constants"),o=t("./zlib/messages"),h=t("./zlib/zstream"),u=t("./zlib/gzheader"),l=Object.prototype.toString;function f(t){if(!(this instanceof f))return new f(t);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(o[r]);this.header=new u,i.inflateGetHeader(this.strm,this.header)}function d(t,e){var r=new f(e);if(r.push(t,!0),r.err)throw r.msg||o[r.err];return r.result}f.prototype.push=function(t,e){var r,o,h,u,f,d,c=this.strm,p=this.options.chunkSize,m=this.options.dictionary,_=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?c.input=s.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?c.input=new Uint8Array(t):c.input=t,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new n.Buf8(p),c.next_out=0,c.avail_out=p),(r=i.inflate(c,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(d="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===l.call(m)?new Uint8Array(m):m,r=i.inflateSetDictionary(this.strm,d)),r===a.Z_BUF_ERROR&&!0===_&&(r=a.Z_OK,_=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);c.next_out&&(0!==c.avail_out&&r!==a.Z_STREAM_END&&(0!==c.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(h=s.utf8border(c.output,c.next_out),u=c.next_out-h,f=s.buf2string(c.output,h),c.next_out=u,c.avail_out=p-u,u&&n.arraySet(c.output,c.output,h,u,0),this.onData(f)):this.onData(n.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(_=!0)}while((0<c.avail_in||0===c.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(c.avail_out=0))},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=f,r.inflate=d,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},r.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,r){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,r,i,n){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+i),n);else for(var s=0;s<i;s++)t[n+s]=e[r+s]},flattenChunks:function(t){var e,r,i,n,s,a;for(e=i=0,r=t.length;e<r;e++)i+=t[e].length;for(a=new Uint8Array(i),e=n=0,r=t.length;e<r;e++)s=t[e],a.set(s,n),n+=s.length;return a}},s={arraySet:function(t,e,r,i,n){for(var s=0;s<i;s++)t[n+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,n)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(i)},{}],42:[function(t,e,r){"use strict";var i=t("./common"),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var a=new i.Buf8(256),o=0;o<256;o++)a[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function h(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&n))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}a[254]=a[254]=1,r.string2buf=function(t){var e,r,n,s,a,o=t.length,h=0;for(s=0;s<o;s++)55296==(64512&(r=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=t.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),h+=r<128?1:r<2048?2:r<65536?3:4;for(e=new i.Buf8(h),s=a=0;a<h;s++)55296==(64512&(r=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=t.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),r<128?e[a++]=r:(r<2048?e[a++]=192|r>>>6:(r<65536?e[a++]=224|r>>>12:(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63),e[a++]=128|r>>>6&63),e[a++]=128|63&r);return e},r.buf2binstring=function(t){return h(t,t.length)},r.binstring2buf=function(t){for(var e=new i.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,i,n,s,o=e||t.length,u=new Array(2*o);for(r=i=0;r<o;)if((n=t[r++])<128)u[i++]=n;else if(4<(s=a[n]))u[i++]=65533,r+=s-1;else{for(n&=2===s?31:3===s?15:7;1<s&&r<o;)n=n<<6|63&t[r++],s--;1<s?u[i++]=65533:n<65536?u[i++]=n:(n-=65536,u[i++]=55296|n>>10&1023,u[i++]=56320|1023&n)}return h(u,i)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+a[t[r]]>e?r:e}},{"./common":41}],43:[function(t,e,r){"use strict";e.exports=function(t,e,r,i){for(var n=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(n=n+e[i++]|0)|0,--a;);n%=65521,s%=65521}return n|s<<16|0}},{}],44:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,r){"use strict";var i=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,n){var s=i,a=n+r;t^=-1;for(var o=n;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}},{}],46:[function(t,e,r){"use strict";var i,n=t("../utils/common"),s=t("./trees"),a=t("./adler32"),o=t("./crc32"),h=t("./messages"),u=0,l=4,f=0,d=-2,c=-1,p=4,m=2,_=8,g=9,b=286,v=30,y=19,w=2*b+1,k=15,x=3,S=258,z=S+x+1,C=42,E=113,A=1,I=2,O=3,B=4;function R(t,e){return t.msg=h[e],e}function T(t){return(t<<1)-(4<t?9:0)}function D(t){for(var e=t.length;0<=--e;)t[e]=0}function F(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(n.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function N(t,e){s._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,F(t.strm)}function U(t,e){t.pending_buf[t.pending++]=e}function P(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function L(t,e){var r,i,n=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-z?t.strstart-(t.w_size-z):0,u=t.window,l=t.w_mask,f=t.prev,d=t.strstart+S,c=u[s+a-1],p=u[s+a];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(u[(r=e)+a]===p&&u[r+a-1]===c&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<d);if(i=S-(d-s),s=d-S,a<i){if(t.match_start=e,o<=(a=i))break;c=u[s+a-1],p=u[s+a]}}}while((e=f[e&l])>h&&0!=--n);return a<=t.lookahead?a:t.lookahead}function j(t){var e,r,i,s,h,u,l,f,d,c,p=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-z)){for(n.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=r=t.hash_size;i=t.head[--e],t.head[e]=p<=i?i-p:0,--r;);for(e=r=p;i=t.prev[--e],t.prev[e]=p<=i?i-p:0,--r;);s+=p}if(0===t.strm.avail_in)break;if(u=t.strm,l=t.window,f=t.strstart+t.lookahead,c=void 0,(d=s)<(c=u.avail_in)&&(c=d),r=0===c?0:(u.avail_in-=c,n.arraySet(l,u.input,u.next_in,c,f),1===u.state.wrap?u.adler=a(u.adler,l,c,f):2===u.state.wrap&&(u.adler=o(u.adler,l,c,f)),u.next_in+=c,u.total_in+=c,c),t.lookahead+=r,t.lookahead+t.insert>=x)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+x-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<x)););}while(t.lookahead<z&&0!==t.strm.avail_in)}function Z(t,e){for(var r,i;;){if(t.lookahead<z){if(j(t),t.lookahead<z&&e===u)return A;if(0===t.lookahead)break}if(r=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-z&&(t.match_length=L(t,r)),t.match_length>=x)if(i=s._tr_tally(t,t.strstart-t.match_start,t.match_length-x),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=x){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<x-1?t.strstart:x-1,e===l?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}function W(t,e){for(var r,i,n;;){if(t.lookahead<z){if(j(t),t.lookahead<z&&e===u)return A;if(0===t.lookahead)break}if(r=0,t.lookahead>=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=x-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-z&&(t.match_length=L(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===x&&4096<t.strstart-t.match_start)&&(t.match_length=x-1)),t.prev_length>=x&&t.match_length<=t.prev_length){for(n=t.strstart+t.lookahead-x,i=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-x),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+x-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=x-1,t.strstart++,i&&(N(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((i=s._tr_tally(t,0,t.window[t.strstart-1]))&&N(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<x-1?t.strstart:x-1,e===l?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}function M(t,e,r,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i,this.func=n}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*w),this.dyn_dtree=new n.Buf16(2*(2*v+1)),this.bl_tree=new n.Buf16(2*(2*y+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(k+1),this.heap=new n.Buf16(2*b+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*b+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=m,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?C:E,t.adler=2===e.wrap?0:1,e.last_flush=u,s._tr_init(e),f):R(t,d)}function K(t){var e=G(t);return e===f&&function(t){t.window_size=2*t.w_size,D(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=x-1,t.match_available=0,t.ins_h=0}(t.state),e}function Y(t,e,r,i,s,a){if(!t)return d;var o=1;if(e===c&&(e=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),s<1||g<s||r!==_||i<8||15<i||e<0||9<e||a<0||p<a)return R(t,d);8===i&&(i=9);var h=new H;return(t.state=h).strm=t,h.wrap=o,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+x-1)/x),h.window=new n.Buf8(2*h.w_size),h.head=new n.Buf16(h.hash_size),h.prev=new n.Buf16(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new n.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=a,h.method=r,K(t)}i=[new M(0,0,0,0,function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(j(t),0===t.lookahead&&e===u)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+r;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,N(t,!1),0===t.strm.avail_out))return A;if(t.strstart-t.block_start>=t.w_size-z&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===l?(N(t,!0),0===t.strm.avail_out?O:B):(t.strstart>t.block_start&&(N(t,!1),t.strm.avail_out),A)}),new M(4,4,8,4,Z),new M(4,5,16,8,Z),new M(4,6,32,32,Z),new M(4,4,16,16,W),new M(8,16,32,32,W),new M(8,16,128,128,W),new M(8,32,128,256,W),new M(32,128,258,1024,W),new M(32,258,258,4096,W)],r.deflateInit=function(t,e){return Y(t,e,_,15,8,0)},r.deflateInit2=Y,r.deflateReset=K,r.deflateResetKeep=G,r.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?d:(t.state.gzhead=e,f):d},r.deflate=function(t,e){var r,n,a,h;if(!t||!t.state||5<e||e<0)return t?R(t,d):d;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||666===n.status&&e!==l)return R(t,0===t.avail_out?-5:d);if(n.strm=t,r=n.last_flush,n.last_flush=e,n.status===C)if(2===n.wrap)t.adler=0,U(n,31),U(n,139),U(n,8),n.gzhead?(U(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),U(n,255&n.gzhead.time),U(n,n.gzhead.time>>8&255),U(n,n.gzhead.time>>16&255),U(n,n.gzhead.time>>24&255),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(U(n,255&n.gzhead.extra.length),U(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=o(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(U(n,0),U(n,0),U(n,0),U(n,0),U(n,0),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,3),n.status=E);else{var c=_+(n.w_bits-8<<4)<<8;c|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(c|=32),c+=31-c%31,n.status=E,P(n,c),0!==n.strstart&&(P(n,t.adler>>>16),P(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),F(t),a=n.pending,n.pending!==n.pending_buf_size));)U(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),F(t),a=n.pending,n.pending===n.pending_buf_size)){h=1;break}h=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,U(n,h)}while(0!==h);n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),0===h&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),F(t),a=n.pending,n.pending===n.pending_buf_size)){h=1;break}h=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,U(n,h)}while(0!==h);n.gzhead.hcrc&&n.pending>a&&(t.adler=o(t.adler,n.pending_buf,n.pending-a,a)),0===h&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&F(t),n.pending+2<=n.pending_buf_size&&(U(n,255&t.adler),U(n,t.adler>>8&255),t.adler=0,n.status=E)):n.status=E),0!==n.pending){if(F(t),0===t.avail_out)return n.last_flush=-1,f}else if(0===t.avail_in&&T(e)<=T(r)&&e!==l)return R(t,-5);if(666===n.status&&0!==t.avail_in)return R(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==u&&666!==n.status){var p=2===n.strategy?function(t,e){for(var r;;){if(0===t.lookahead&&(j(t),0===t.lookahead)){if(e===u)return A;break}if(t.match_length=0,r=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===l?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}(n,e):3===n.strategy?function(t,e){for(var r,i,n,a,o=t.window;;){if(t.lookahead<=S){if(j(t),t.lookahead<=S&&e===u)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=x&&0<t.strstart&&(i=o[n=t.strstart-1])===o[++n]&&i===o[++n]&&i===o[++n]){a=t.strstart+S;do{}while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<a);t.match_length=S-(a-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=x?(r=s._tr_tally(t,1,t.match_length-x),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(N(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===l?(N(t,!0),0===t.strm.avail_out?O:B):t.last_lit&&(N(t,!1),0===t.strm.avail_out)?A:I}(n,e):i[n.level].func(n,e);if(p!==O&&p!==B||(n.status=666),p===A||p===O)return 0===t.avail_out&&(n.last_flush=-1),f;if(p===I&&(1===e?s._tr_align(n):5!==e&&(s._tr_stored_block(n,0,0,!1),3===e&&(D(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),F(t),0===t.avail_out))return n.last_flush=-1,f}return e!==l?f:n.wrap<=0?1:(2===n.wrap?(U(n,255&t.adler),U(n,t.adler>>8&255),U(n,t.adler>>16&255),U(n,t.adler>>24&255),U(n,255&t.total_in),U(n,t.total_in>>8&255),U(n,t.total_in>>16&255),U(n,t.total_in>>24&255)):(P(n,t.adler>>>16),P(n,65535&t.adler)),F(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?f:1)},r.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==C&&69!==e&&73!==e&&91!==e&&103!==e&&e!==E&&666!==e?R(t,d):(t.state=null,e===E?R(t,-3):f):d},r.deflateSetDictionary=function(t,e){var r,i,s,o,h,u,l,c,p=e.length;if(!t||!t.state)return d;if(2===(o=(r=t.state).wrap)||1===o&&r.status!==C||r.lookahead)return d;for(1===o&&(t.adler=a(t.adler,e,p,0)),r.wrap=0,p>=r.w_size&&(0===o&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new n.Buf8(r.w_size),n.arraySet(c,e,p-r.w_size,r.w_size,0),e=c,p=r.w_size),h=t.avail_in,u=t.next_in,l=t.input,t.avail_in=p,t.next_in=0,t.input=e,j(r);r.lookahead>=x;){for(i=r.strstart,s=r.lookahead-(x-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+x-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--s;);r.strstart=i,r.lookahead=x-1,j(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=x-1,r.match_available=0,t.next_in=u,t.input=l,t.avail_in=h,r.wrap=o,f},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,r){"use strict";e.exports=function(t,e){var r,i,n,s,a,o,h,u,l,f,d,c,p,m,_,g,b,v,y,w,k,x,S,z,C;r=t.state,i=t.next_in,z=t.input,n=i+(t.avail_in-5),s=t.next_out,C=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),h=r.dmax,u=r.wsize,l=r.whave,f=r.wnext,d=r.window,c=r.hold,p=r.bits,m=r.lencode,_=r.distcode,g=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;t:do{p<15&&(c+=z[i++]<<p,p+=8,c+=z[i++]<<p,p+=8),v=m[c&g];e:for(;;){if(c>>>=y=v>>>24,p-=y,0==(y=v>>>16&255))C[s++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=m[(65535&v)+(c&(1<<y)-1)];continue e}if(32&y){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}w=65535&v,(y&=15)&&(p<y&&(c+=z[i++]<<p,p+=8),w+=c&(1<<y)-1,c>>>=y,p-=y),p<15&&(c+=z[i++]<<p,p+=8,c+=z[i++]<<p,p+=8),v=_[c&b];r:for(;;){if(c>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=_[(65535&v)+(c&(1<<y)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(k=65535&v,p<(y&=15)&&(c+=z[i++]<<p,(p+=8)<y&&(c+=z[i++]<<p,p+=8)),h<(k+=c&(1<<y)-1)){t.msg="invalid distance too far back",r.mode=30;break t}if(c>>>=y,p-=y,(y=s-a)<k){if(l<(y=k-y)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(S=d,(x=0)===f){if(x+=u-y,y<w){for(w-=y;C[s++]=d[x++],--y;);x=s-k,S=C}}else if(f<y){if(x+=u+f-y,(y-=f)<w){for(w-=y;C[s++]=d[x++],--y;);if(x=0,f<w){for(w-=y=f;C[s++]=d[x++],--y;);x=s-k,S=C}}}else if(x+=f-y,y<w){for(w-=y;C[s++]=d[x++],--y;);x=s-k,S=C}for(;2<w;)C[s++]=S[x++],C[s++]=S[x++],C[s++]=S[x++],w-=3;w&&(C[s++]=S[x++],1<w&&(C[s++]=S[x++]))}else{for(x=s-k;C[s++]=C[x++],C[s++]=C[x++],C[s++]=C[x++],2<(w-=3););w&&(C[s++]=C[x++],1<w&&(C[s++]=C[x++]))}break}}break}}while(i<n&&s<o);i-=w=p>>3,c&=(1<<(p-=w<<3))-1,t.next_in=i,t.next_out=s,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=s<o?o-s+257:257-(s-o),r.hold=c,r.bits=p}},{}],49:[function(t,e,r){"use strict";var i=t("../utils/common"),n=t("./adler32"),s=t("./crc32"),a=t("./inffast"),o=t("./inftrees"),h=1,u=2,l=0,f=-2,d=1,c=852,p=592;function m(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function g(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=d,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(c),e.distcode=e.distdyn=new i.Buf32(p),e.sane=1,e.back=-1,l):f}function b(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,g(t)):f}function v(t,e){var r,i;return t&&t.state?(i=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?f:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=r,i.wbits=e,b(t))):f}function y(t,e){var r,i;return t?(i=new _,(t.state=i).window=null,(r=v(t,e))!==l&&(t.state=null),r):f}var w,k,x=!0;function S(t){if(x){var e;for(w=new i.Buf32(512),k=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(h,t.lens,0,288,w,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(u,t.lens,0,32,k,0,t.work,{bits:5}),x=!1}t.lencode=w,t.lenbits=9,t.distcode=k,t.distbits=5}function z(t,e,r,n){var s,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),n>=a.wsize?(i.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n<(s=a.wsize-a.wnext)&&(s=n),i.arraySet(a.window,e,r-n,s,a.wnext),(n-=s)?(i.arraySet(a.window,e,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}r.inflateReset=b,r.inflateReset2=v,r.inflateResetKeep=g,r.inflateInit=function(t){return y(t,15)},r.inflateInit2=y,r.inflate=function(t,e){var r,c,p,_,g,b,v,y,w,k,x,C,E,A,I,O,B,R,T,D,F,N,U,P,L=0,j=new i.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return f;12===(r=t.state).mode&&(r.mode=13),g=t.next_out,p=t.output,v=t.avail_out,_=t.next_in,c=t.input,b=t.avail_in,y=r.hold,w=r.bits,k=b,x=v,N=l;t:for(;;)switch(r.mode){case d:if(0===r.wrap){r.mode=13;break}for(;w<16;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(2&r.wrap&&35615===y){j[r.check=0]=255&y,j[1]=y>>>8&255,r.check=s(r.check,j,2,0),w=y=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&y)){t.msg="unknown compression method",r.mode=30;break}if(w-=4,F=8+(15&(y>>>=4)),0===r.wbits)r.wbits=F;else if(F>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<F,t.adler=r.check=1,r.mode=512&y?10:12,w=y=0;break;case 2:for(;w<16;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(r.flags=y,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=y>>8&1),512&r.flags&&(j[0]=255&y,j[1]=y>>>8&255,r.check=s(r.check,j,2,0)),w=y=0,r.mode=3;case 3:for(;w<32;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}r.head&&(r.head.time=y),512&r.flags&&(j[0]=255&y,j[1]=y>>>8&255,j[2]=y>>>16&255,j[3]=y>>>24&255,r.check=s(r.check,j,4,0)),w=y=0,r.mode=4;case 4:for(;w<16;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&r.flags&&(j[0]=255&y,j[1]=y>>>8&255,r.check=s(r.check,j,2,0)),w=y=0,r.mode=5;case 5:if(1024&r.flags){for(;w<16;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}r.length=y,r.head&&(r.head.extra_len=y),512&r.flags&&(j[0]=255&y,j[1]=y>>>8&255,r.check=s(r.check,j,2,0)),w=y=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(b<(C=r.length)&&(C=b),C&&(r.head&&(F=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),i.arraySet(r.head.extra,c,_,C,F)),512&r.flags&&(r.check=s(r.check,c,C,_)),b-=C,_+=C,r.length-=C),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===b)break t;for(C=0;F=c[_+C++],r.head&&F&&r.length<65536&&(r.head.name+=String.fromCharCode(F)),F&&C<b;);if(512&r.flags&&(r.check=s(r.check,c,C,_)),b-=C,_+=C,F)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===b)break t;for(C=0;F=c[_+C++],r.head&&F&&r.length<65536&&(r.head.comment+=String.fromCharCode(F)),F&&C<b;);if(512&r.flags&&(r.check=s(r.check,c,C,_)),b-=C,_+=C,F)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;w<16;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(y!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}w=y=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;w<32;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}t.adler=r.check=m(y),w=y=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=g,t.avail_out=v,t.next_in=_,t.avail_in=b,r.hold=y,r.bits=w,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){y>>>=7&w,w-=7&w,r.mode=27;break}for(;w<3;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}switch(r.last=1&y,w-=1,3&(y>>>=1)){case 0:r.mode=14;break;case 1:if(S(r),r.mode=20,6!==e)break;y>>>=2,w-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}y>>>=2,w-=2;break;case 14:for(y>>>=7&w,w-=7&w;w<32;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&y,w=y=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(C=r.length){if(b<C&&(C=b),v<C&&(C=v),0===C)break t;i.arraySet(p,c,_,C,g),b-=C,_+=C,v-=C,g+=C,r.length-=C;break}r.mode=12;break;case 17:for(;w<14;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(r.nlen=257+(31&y),y>>>=5,w-=5,r.ndist=1+(31&y),y>>>=5,w-=5,r.ncode=4+(15&y),y>>>=4,w-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;w<3;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}r.lens[Z[r.have++]]=7&y,y>>>=3,w-=3}for(;r.have<19;)r.lens[Z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,U={bits:r.lenbits},N=o(0,r.lens,0,19,r.lencode,0,r.work,U),r.lenbits=U.bits,N){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;O=(L=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,B=65535&L,!((I=L>>>24)<=w);){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(B<16)y>>>=I,w-=I,r.lens[r.have++]=B;else{if(16===B){for(P=I+2;w<P;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(y>>>=I,w-=I,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}F=r.lens[r.have-1],C=3+(3&y),y>>>=2,w-=2}else if(17===B){for(P=I+3;w<P;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}w-=I,F=0,C=3+(7&(y>>>=I)),y>>>=3,w-=3}else{for(P=I+7;w<P;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}w-=I,F=0,C=11+(127&(y>>>=I)),y>>>=7,w-=7}if(r.have+C>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;C--;)r.lens[r.have++]=F}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,U={bits:r.lenbits},N=o(h,r.lens,0,r.nlen,r.lencode,0,r.work,U),r.lenbits=U.bits,N){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,U={bits:r.distbits},N=o(u,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,U),r.distbits=U.bits,N){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=b&&258<=v){t.next_out=g,t.avail_out=v,t.next_in=_,t.avail_in=b,r.hold=y,r.bits=w,a(t,x),g=t.next_out,p=t.output,v=t.avail_out,_=t.next_in,c=t.input,b=t.avail_in,y=r.hold,w=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;O=(L=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,B=65535&L,!((I=L>>>24)<=w);){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(O&&0==(240&O)){for(R=I,T=O,D=B;O=(L=r.lencode[D+((y&(1<<R+T)-1)>>R)])>>>16&255,B=65535&L,!(R+(I=L>>>24)<=w);){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}y>>>=R,w-=R,r.back+=R}if(y>>>=I,w-=I,r.back+=I,r.length=B,0===O){r.mode=26;break}if(32&O){r.back=-1,r.mode=12;break}if(64&O){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&O,r.mode=22;case 22:if(r.extra){for(P=r.extra;w<P;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,w-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;O=(L=r.distcode[y&(1<<r.distbits)-1])>>>16&255,B=65535&L,!((I=L>>>24)<=w);){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(0==(240&O)){for(R=I,T=O,D=B;O=(L=r.distcode[D+((y&(1<<R+T)-1)>>R)])>>>16&255,B=65535&L,!(R+(I=L>>>24)<=w);){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}y>>>=R,w-=R,r.back+=R}if(y>>>=I,w-=I,r.back+=I,64&O){t.msg="invalid distance code",r.mode=30;break}r.offset=B,r.extra=15&O,r.mode=24;case 24:if(r.extra){for(P=r.extra;w<P;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,w-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===v)break t;if(C=x-v,r.offset>C){if((C=r.offset-C)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}E=C>r.wnext?(C-=r.wnext,r.wsize-C):r.wnext-C,C>r.length&&(C=r.length),A=r.window}else A=p,E=g-r.offset,C=r.length;for(v<C&&(C=v),v-=C,r.length-=C;p[g++]=A[E++],--C;);0===r.length&&(r.mode=21);break;case 26:if(0===v)break t;p[g++]=r.length,v--,r.mode=21;break;case 27:if(r.wrap){for(;w<32;){if(0===b)break t;b--,y|=c[_++]<<w,w+=8}if(x-=v,t.total_out+=x,r.total+=x,x&&(t.adler=r.check=r.flags?s(r.check,p,x,g-x):n(r.check,p,x,g-x)),x=v,(r.flags?y:m(y))!==r.check){t.msg="incorrect data check",r.mode=30;break}w=y=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;w<32;){if(0===b)break t;b--,y+=c[_++]<<w,w+=8}if(y!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}w=y=0}r.mode=29;case 29:N=1;break t;case 30:N=-3;break t;case 31:return-4;case 32:default:return f}return t.next_out=g,t.avail_out=v,t.next_in=_,t.avail_in=b,r.hold=y,r.bits=w,(r.wsize||x!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&z(t,t.output,t.next_out,x-t.avail_out)?(r.mode=31,-4):(k-=t.avail_in,x-=t.avail_out,t.total_in+=k,t.total_out+=x,r.total+=x,r.wrap&&x&&(t.adler=r.check=r.flags?s(r.check,p,x,t.next_out-x):n(r.check,p,x,t.next_out-x)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==k&&0===x||4===e)&&N===l&&(N=-5),N)},r.inflateEnd=function(t){if(!t||!t.state)return f;var e=t.state;return e.window&&(e.window=null),t.state=null,l},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?f:((r.head=e).done=!1,l):f},r.inflateSetDictionary=function(t,e){var r,i=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?f:11===r.mode&&n(1,e,i,0)!==r.check?-3:z(t,e,i,i)?(r.mode=31,-4):(r.havedict=1,l):f},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,r){"use strict";var i=t("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,h,u,l,f,d){var c,p,m,_,g,b,v,y,w,k=d.bits,x=0,S=0,z=0,C=0,E=0,A=0,I=0,O=0,B=0,R=0,T=null,D=0,F=new i.Buf16(16),N=new i.Buf16(16),U=null,P=0;for(x=0;x<=15;x++)F[x]=0;for(S=0;S<h;S++)F[e[r+S]]++;for(E=k,C=15;1<=C&&0===F[C];C--);if(C<E&&(E=C),0===C)return u[l++]=20971520,u[l++]=20971520,d.bits=1,0;for(z=1;z<C&&0===F[z];z++);for(E<z&&(E=z),x=O=1;x<=15;x++)if(O<<=1,(O-=F[x])<0)return-1;if(0<O&&(0===t||1!==C))return-1;for(N[1]=0,x=1;x<15;x++)N[x+1]=N[x]+F[x];for(S=0;S<h;S++)0!==e[r+S]&&(f[N[e[r+S]]++]=S);if(b=0===t?(T=U=f,19):1===t?(T=n,D-=257,U=s,P-=257,256):(T=a,U=o,-1),x=z,g=l,I=S=R=0,m=-1,_=(B=1<<(A=E))-1,1===t&&852<B||2===t&&592<B)return 1;for(;;){for(v=x-I,w=f[S]<b?(y=0,f[S]):f[S]>b?(y=U[P+f[S]],T[D+f[S]]):(y=96,0),c=1<<x-I,z=p=1<<A;u[g+(R>>I)+(p-=c)]=v<<24|y<<16|w|0,0!==p;);for(c=1<<x-1;R&c;)c>>=1;if(0!==c?(R&=c-1,R+=c):R=0,S++,0==--F[x]){if(x===C)break;x=e[r+f[S]]}if(E<x&&(R&_)!==m){for(0===I&&(I=E),g+=z,O=1<<(A=x-I);A+I<C&&!((O-=F[A+I])<=0);)A++,O<<=1;if(B+=1<<A,1===t&&852<B||2===t&&592<B)return 1;u[m=R&_]=E<<24|A<<16|g-l|0}}return 0!==R&&(u[g+R]=x-I<<24|64<<16|0),d.bits=E,0}},{"../utils/common":41}],51:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,r){"use strict";var i=t("../utils/common");function n(t){for(var e=t.length;0<=--e;)t[e]=0}var s=0,a=256,o=a+1+29,h=30,u=19,l=2*o+1,f=15,d=16,c=256,p=16,m=17,_=18,g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],b=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w=new Array(2*(o+2));n(w);var k=new Array(2*h);n(k);var x=new Array(512);n(x);var S=new Array(256);n(S);var z=new Array(29);n(z);var C,E,A,I=new Array(h);function O(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function B(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function R(t){return t<256?x[t]:x[256+(t>>>7)]}function T(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function D(t,e,r){t.bi_valid>d-r?(t.bi_buf|=e<<t.bi_valid&65535,T(t,t.bi_buf),t.bi_buf=e>>d-t.bi_valid,t.bi_valid+=r-d):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function F(t,e,r){D(t,r[2*e],r[2*e+1])}function N(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function U(t,e,r){var i,n,s=new Array(f+1),a=0;for(i=1;i<=f;i++)s[i]=a=a+r[i-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=N(s[o]++,o))}}function P(t){var e;for(e=0;e<o;e++)t.dyn_ltree[2*e]=0;for(e=0;e<h;e++)t.dyn_dtree[2*e]=0;for(e=0;e<u;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*c]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function L(t){8<t.bi_valid?T(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function j(t,e,r,i){var n=2*e,s=2*r;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[r]}function Z(t,e,r){for(var i=t.heap[r],n=r<<1;n<=t.heap_len&&(n<t.heap_len&&j(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!j(e,i,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=i}function W(t,e,r){var i,n,s,o,h=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],n=t.pending_buf[t.l_buf+h],h++,0===i?F(t,n,e):(F(t,(s=S[n])+a+1,e),0!==(o=g[s])&&D(t,n-=z[s],o),F(t,s=R(--i),r),0!==(o=b[s])&&D(t,i-=I[s],o)),h<t.last_lit;);F(t,c,e)}function M(t,e){var r,i,n,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,h=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=l,r=0;r<h;r++)0!==s[2*r]?(t.heap[++t.heap_len]=u=r,t.depth[r]=0):s[2*r+1]=0;for(;t.heap_len<2;)s[2*(n=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=a[2*n+1]);for(e.max_code=u,r=t.heap_len>>1;1<=r;r--)Z(t,s,r);for(n=h;r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z(t,s,1),i=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=i,s[2*n]=s[2*r]+s[2*i],t.depth[n]=(t.depth[r]>=t.depth[i]?t.depth[r]:t.depth[i])+1,s[2*r+1]=s[2*i+1]=n,t.heap[1]=n++,Z(t,s,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var r,i,n,s,a,o,h=e.dyn_tree,u=e.max_code,d=e.stat_desc.static_tree,c=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,m=e.stat_desc.extra_base,_=e.stat_desc.max_length,g=0;for(s=0;s<=f;s++)t.bl_count[s]=0;for(h[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<l;r++)_<(s=h[2*h[2*(i=t.heap[r])+1]+1]+1)&&(s=_,g++),h[2*i+1]=s,u<i||(t.bl_count[s]++,a=0,m<=i&&(a=p[i-m]),o=h[2*i],t.opt_len+=o*(s+a),c&&(t.static_len+=o*(d[2*i+1]+a)));if(0!==g){do{for(s=_-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[_]--,g-=2}while(0<g);for(s=_;0!==s;s--)for(i=t.bl_count[s];0!==i;)u<(n=t.heap[--r])||(h[2*n+1]!==s&&(t.opt_len+=(s-h[2*n+1])*h[2*n],h[2*n+1]=s),i--)}}(t,e),U(s,u,t.bl_count)}function H(t,e,r){var i,n,s=-1,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),e[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=e[2*(i+1)+1],++o<h&&n===a||(o<u?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[2*p]++):o<=10?t.bl_tree[2*m]++:t.bl_tree[2*_]++,s=n,u=(o=0)===a?(h=138,3):n===a?(h=6,3):(h=7,4))}function G(t,e,r){var i,n,s=-1,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),i=0;i<=r;i++)if(n=a,a=e[2*(i+1)+1],!(++o<h&&n===a)){if(o<u)for(;F(t,n,t.bl_tree),0!=--o;);else 0!==n?(n!==s&&(F(t,n,t.bl_tree),o--),F(t,p,t.bl_tree),D(t,o-3,2)):o<=10?(F(t,m,t.bl_tree),D(t,o-3,3)):(F(t,_,t.bl_tree),D(t,o-11,7));s=n,u=(o=0)===a?(h=138,3):n===a?(h=6,3):(h=7,4)}}n(I);var K=!1;function Y(t,e,r,n){D(t,(s<<1)+(n?1:0),3),function(t,e,r,n){L(t),T(t,r),T(t,~r),i.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r)}r._tr_init=function(t){K||(function(){var t,e,r,i,n,s=new Array(f+1);for(i=r=0;i<28;i++)for(z[i]=r,t=0;t<1<<g[i];t++)S[r++]=i;for(S[r-1]=i,i=n=0;i<16;i++)for(I[i]=n,t=0;t<1<<b[i];t++)x[n++]=i;for(n>>=7;i<h;i++)for(I[i]=n<<7,t=0;t<1<<b[i]-7;t++)x[256+n++]=i;for(e=0;e<=f;e++)s[e]=0;for(t=0;t<=143;)w[2*t+1]=8,t++,s[8]++;for(;t<=255;)w[2*t+1]=9,t++,s[9]++;for(;t<=279;)w[2*t+1]=7,t++,s[7]++;for(;t<=287;)w[2*t+1]=8,t++,s[8]++;for(U(w,o+1,s),t=0;t<h;t++)k[2*t+1]=5,k[2*t]=N(t,5);C=new O(w,g,a+1,o,f),E=new O(k,b,0,h,f),A=new O(new Array(0),v,0,u,7)}(),K=!0),t.l_desc=new B(t.dyn_ltree,C),t.d_desc=new B(t.dyn_dtree,E),t.bl_desc=new B(t.bl_tree,A),t.bi_buf=0,t.bi_valid=0,P(t)},r._tr_stored_block=Y,r._tr_flush_block=function(t,e,r,i){var n,s,o=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<a;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),M(t,t.l_desc),M(t,t.d_desc),o=function(t){var e;for(H(t,t.dyn_ltree,t.l_desc.max_code),H(t,t.dyn_dtree,t.d_desc.max_code),M(t,t.bl_desc),e=u-1;3<=e&&0===t.bl_tree[2*y[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=n&&(n=s)):n=s=r+5,r+4<=n&&-1!==e?Y(t,e,r,i):4===t.strategy||s===n?(D(t,2+(i?1:0),3),W(t,w,k)):(D(t,4+(i?1:0),3),function(t,e,r,i){var n;for(D(t,e-257,5),D(t,r-1,5),D(t,i-4,4),n=0;n<i;n++)D(t,t.bl_tree[2*y[n]+1],3);G(t,t.dyn_ltree,e-1),G(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),W(t,t.dyn_ltree,t.dyn_dtree)),P(t),i&&L(t)},r._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(S[r]+a+1)]++,t.dyn_dtree[2*R(e)]++),t.last_lit===t.lit_bufsize-1},r._tr_align=function(t){D(t,2,3),F(t,c,w),function(t){16===t.bi_valid?(T(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,r){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)});
//
document.addEventListener("wheel",function(e){if(setup_editor.wheel&&(!scroll_block||scene_screen)){if(e.deltaY>0) world_scale(false);else world_scale(2);}});
let project_files=[];
var load_files
img_file.addEventListener('change',loadFiles);
var load_new=false;
var wf;
function clear_Files(){
    if(scene_screen){scen_edit_updare(false)};
    for(var i=0;i<project_files.length;i++){URL.revokeObjectURL(project_files[i][1])}
    project_files=[];
}
function loadFiles(e){
    load_files=e.target.files
    wf=e.target.files[0].webkitRelativePath.split("/")[0]+"/";
    if(load_new){
        clear_Files();
        for(var i=0;i<e.target.files.length;i++){project_files.push([e.target.files[i].webkitRelativePath.replace(wf,'').replace('.mp3',''),URL.createObjectURL(e.target.files[i]),e.target.files[i].type]);}
        project_foler.value=wf;
    }else{
        var jsons=[];clear_Files();
        for(var i=0;i<e.target.files.length;i++){
            project_files.push([e.target.files[i].webkitRelativePath.replace(wf,'').replace('.mp3',''),URL.createObjectURL(e.target.files[i]),e.target.files[i].type]);
            if(e.target.files[i].type=="application/json"){jsons.push([i,e.target.files[i].name])}
        }
        if(jsons.length==1){load_story_edit(URL.createObjectURL(e.target.files[jsons[0][0]]))}
        else if(jsons.length>1){
            var html="<div class='window'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><br><p>Select JSON project file</p><br><hr><div style='margin:0 16px 8px 16px;max-height:75vh;overflow-x:hidden;'>"
            for(var f=0;f<jsons.length;f++){html+="<table class='button' style='width:412px;margin:8px 0px;' onclick='load_story_edit(open_file(\""+jsons[f][1]+"\"));modal_window(\"close\");'><tbody><tr><td width='48px' height='48px' class='icon icon_new'> </td><td align='left'><div style='width:364px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;'>"+jsons[f][1]+"</div></td></tr></tbody></table>"}
            html+="</div></div>"
            modal_window("open",html)
        }else if(jsons.length==0){alert('json file no found')}
    }
}
function open_file(name){
    for(var f=0;f<project_files.length;f++){if(project_files[f][0]==name){name=(project_files[f][1]);break;}} return name;
}
function new_novel(){
    story_script={"parameters":{"text_panel":{"size":["95%","25%"],"color":"#efefff","indent_text":"8px","indent_bottom":"32px","size_text":"20px","style":"border-radius:16px;","dialog_speed":"10"},"name_panel":{"size":["0","48px"],"position":["0","0","-48px","0"],"size_text":"18px"},"title":{"en":"new novel"},"launch_story":"","key":{"next":"","back":"","save":"","load":"","full_screen":"","launch_story":"","load_autosave":""},"languares":["en"],"buttons":[{"name":"tue_back","style":"border-radius:26px;","position":["2.5%","0","0","32px"],"size":["38px","38px"],"color":"","size_text":"28px","text":"<"},{"name":"tue_next","style":"border-radius:26px;","position":["0","2.5%","0","32px"],"size":["38px","38px"],"color":"","size_text":"28px","text":">"}],"style_file":"","autosave":false,"font":"Arial","font_size":"18px","variables":{},"sounds":{}},"blocks":{}};
    update_novel();
    state_num=0;back_up=[];state_save();
}
function update_novel(){
    if(scene_screen){scen_edit_updare(true)}
    else{
        menu_add.style.visibility="hidden";
        story_blocks.innerHTML=""
        line_controll=[];
        search_block.value=""
        while(story_lines.hasChildNodes()){story_lines.removeChild(story_lines.firstChild);}
        parse_story();
        lines();
    }
}
function load_story_edit(url){
    var xmlhttp=new XMLHttpRequest();
    xmlhttp.onreadystatechange=function(){
        if(this.readyState==4&&this.status==200){
            new_novel()
            story_script=JSON.parse(this.responseText);
            if(!story_script.parameters){alert("error in json file")}
			else{
                toast("json file loading completed");
                languare=story_script.parameters.languares[0]
                parse_story()
                lines()
                document.dispatchEvent(new Event('tue_story_open'));
                state_num=0;back_up=[];state_save();
            }
        }
    };
    xmlhttp.open("GET",url,true);
    xmlhttp.send();
    xmlhttp.onerror=function(){if(this.status==0){alert('json file not loaded');}}
}
var all_blocks=0;
function parse_story(){
    story_blocks=document.getElementById("story_blocks");
    story_blocks.innerHTML=""
    story_lines=document.getElementById("story_lines");
	story_blocks.setAttribute("align","center");
    while(story_lines.hasChildNodes()){story_lines.removeChild(story_lines.firstChild);}
    all_blocks=0;
	if(!story_script.blocks){story_script.blocks={}}
    if(!story_script.parameters.key){story_script.parameters.key={}}
    if(!story_script.parameters.title){story_script.parameters.title=""}
    if(!story_script.parameters.variables){story_script.parameters.variables={}}
    if(!story_script.parameters.characters){story_script.parameters.characters={}}
    while(Object.keys(story_script)[all_blocks]){creation_block(all_blocks);all_blocks++;}
	if(story_script.parameters.languares){lang_select()}
    control_dlock();
    world_size();
}
function lang_select(){
	var lang_list=document.getElementById('language_view');
	lang_list.innerHTML=project_languares(languare);
}
language_view.onchange=function(e){
	languare=language_view.value;
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2]);}
    update_novel()
};
function creation_block(b){
    var chapter=document.createElement("div");
    var element="";
    var all=0;
    chapter.id=Object.keys(story_script)[b];
    var go="";
    if(chapter.id!="parameters"&&chapter.id!="blocks"){
        for(var i=0;i<story_script[chapter.id].length;i++){
            element+="<div id='s_"+chapter.id+"_"+i+"' class='scene' align='center'>"
            if(story_script[chapter.id][i].legacy_choice){
				element+="<table height='22px' width='100%' style='margin:4px;'><tbody><tr><td width='24px' class='icon_m icon_up' title='Scene up' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",-1)'></td><td width='24px' class='icon_m icon_down' title='Scene down' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",1)'></td><td><p class='namber'>scene:"+(i+1)+"</p></td><td width='48px' class='icon_m icon_show' id='"+chapter.id+"_"+i+"_edit' onmouseup='arr_l=story_script."+chapter.id+";arr_n="+i+";legacy_choice_m(this.id);' title='Scene edit'></td></tr></tbody></table><div width='100%'>"
                for(var l=0;l<story_script[chapter.id][i].legacy_choice.length;l++){
                    if(story_script[chapter.id][i].legacy_choice[l][0]){
                        go=story_script[chapter.id][i].legacy_choice[l][3];
                        if(story_script[go]){
                            element+="<table id='"+all+"l"+l+go+all_blocks+"' class='choice_b to_go' width='100%'><tbody><tr><td style=padding:4px;>"+story_script[chapter.id][i].legacy_choice[l][0]+" "+story_script[chapter.id][i].legacy_choice[l][1]+" "+story_script[chapter.id][i].legacy_choice[l][2]+"</td><td></td><td colspan='3' align='right'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"][3]=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</td><td class='icon button_block icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"l"+l+go+all_blocks]);
                            creaton_line(all+"l"+l+go+all_blocks)
                            all++
                        }else{element+="<table id='"+all+"l"+l+go+all_blocks+"' class='choice_b' width='100%'><tbody><tr><td>"+story_script[chapter.id][i].legacy_choice[l][0]+" "+story_script[chapter.id][i].legacy_choice[l][1]+" "+story_script[chapter.id][i].legacy_choice[l][2]+"</td><td align='center'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"][3]=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</td><td class='icon button_block icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"}
                    }else if(story_script[chapter.id][i].legacy_choice[l].go_to){
                        go=story_script[chapter.id][i].legacy_choice[l].go_to;
                        if(story_script[go]){
                            element+="<table id='"+all+"l"+l+go+all_blocks+"' class='choice_b to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"].go_to=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"l"+l+go+all_blocks]);
                            creaton_line(all+"l"+l+go+all_blocks)
                            all++
                        }else{element+="<div id='"+all+"l"+l+go+all_blocks+"' class='choice_b'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,0)+"</select>"+"</div>"}
                    }
                }
                element+="</div>"
            }else{element+="<table height='22px' width='100%' style='margin:4px;'><tbody><tr><td width='24px' class='icon_m icon_up' title='Scene up' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",-1)'></td><td width='24px' class='icon_m icon_down' title='Scene down' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",1)'></td><td><p class='namber'>scene:"+(i+1)+"</p></td><td width='45px' class='icon_m icon_show' id='"+chapter.id+"_"+i+"_edit' onmouseup='arr_l=story_script."+chapter.id+";arr_n="+i+";scene_m(this.id,"+(i+1)+",\""+chapter.id+"\");' title='Scene edit'></td></tr></tbody></table>"}
            if(story_script[chapter.id][i].background_image&&(typeof story_script[chapter.id][i].background_image!=='object'||(story_script[chapter.id][i].background_image[languare]&&typeof story_script[chapter.id][i].background_image[languare]!=='object'))||story_script[chapter.id][i].background_color){element+="<div class='scene_bg' ondblclick='arr_l=story_script."+chapter.id+";arr_n="+i+";scene_edit();' style='background-size:"+((story_script[chapter.id][i].background_size)?story_script[chapter.id][i].background_size:"cover")+";background-image:url("+open_file(languare_data(story_script[chapter.id][i].background_image))+");background-color:"+story_script[chapter.id][i].background_color+";' width='100%'></div>"}
            if(story_script[chapter.id][i].dialogs){
                for(var d=0;d<story_script[chapter.id][i].dialogs.length;d++){
					element+="<div class='dialog' id='d_"+chapter.id+"_"+i+"_"+d+"'>"+"<table height='22px' width='100%' style='margin-bottom:4px'><tbody><tr><td width='24px' class='icon_m icon_up' title='Dialog up' onmouseup='move_elenetn(story_script."+chapter.id+"["+i+"].dialogs,"+d+",-1)'></td><td width='24px' class='icon_m icon_down' title='Dialog down' onmouseup='move_elenetn(story_script."+chapter.id+"["+i+"].dialogs,"+d+",1)'></td><td><p class='namber'>scene:"+(i+1)+" | dialog:"+(d+1)+"</p></td><td id='m_"+chapter.id+"_"+i+"_"+d+"' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs;arr_n="+d+";dialog_m(this.id,'"+(d+1)+"','"+chapter.id+"',"+i+")\" class='add_button icon_m icon_show' title='Dialog'></td></tr></tbody></table>"
                    var n=(story_script[chapter.id][i].dialogs[d].name&&story_script.parameters.characters[story_script[chapter.id][i].dialogs[d].name])?story_script.parameters.characters[story_script[chapter.id][i].dialogs[d].name][languare]:languare_data(story_script[chapter.id][i].dialogs[d].name)
					if(story_script[chapter.id][i].dialogs[d].back_to){
                        go=story_script[chapter.id][i].dialogs[d].back_to;
                        if(story_script[go]){
						element+="<div class='dialog_element'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Back to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_back_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='back_to';dialog_el(this.id,'Back to',false)\"  width='24px' class='icon_m icon_edit' title='hange next block'></td></tr></tbody></table>"
								+"<table id='"+all+"b"+d+go+all_blocks+"' class='choice_b to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].back_to=this.value;' class='input_text_b'>"+option_block(go,0)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"b"+d+go+all_blocks]);
                            creaton_line(all+"b"+d+go+all_blocks)
                            all++
                        }else{element+="<div class='dialog_element'>"
						+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Back to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_go_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='back_to';dialog_el(this.id,'Back to',false)\"  width='24px' class='icon_m icon_edit' title='hange next block'></td></tr></tbody></table>"
						+"<div id='"+all+"b"+d+go+all_blocks+"' class='choice_b'>"+"<select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].back_to=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</div></div>";}
						element+="</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].video){
                        element+="<div class='dialog_element' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"video\";dialog_video_edit();'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Video</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_video' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='video';dialog_el(this.id,'Video',true);\" width='24px' class='icon_m icon_edit' title='Video'></td></tr></tbody></table>"
                        go=(story_script[chapter.id][i].dialogs[d].video.go_to)?story_script[chapter.id][i].dialogs[d].video.go_to:'tue_no';
                            if(go&&go!=""&&go!="undefined"){
                            if(story_script[go]){
                                element+="<table id='video_"+all+"c"+d+go+all_blocks+"' style='width:100%;' class='choice_b to_go'><tbody><tr><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].video.go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,1)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"></td></tr></tbody></table>"
                                line_controll.push([go,chapter.id,"video_"+all+"c"+d+go+all_blocks]);
                                creaton_line("video_"+all+"c"+d+go+all_blocks);
                            }else{element+="<table style='width:100%;' class='choice_b'><tbody><tr><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].video.go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,1)+"</select></td><td class='button_block icon'></td></tr></tbody></table>"}
                        }all++
                        element+="</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].art){
                        var t="<table width='100%' height='48px' style='margin:4px 0;'><tbody><tr>"
                            +((story_script[chapter.id][i].dialogs[d].art[0])?"<td width='20%' style='background: url("+open_file(languare_data(story_script[chapter.id][i].dialogs[d].art[0].url))+") no-repeat center;background-size:contain;'></td>":"")
                            +((story_script[chapter.id][i].dialogs[d].art[1])?"<td width='20%' style='background: url("+open_file(languare_data(story_script[chapter.id][i].dialogs[d].art[1].url))+") no-repeat center;background-size:contain;'></td>":"")
                            +((story_script[chapter.id][i].dialogs[d].art[2])?"<td width='20%' style='background: url("+open_file(languare_data(story_script[chapter.id][i].dialogs[d].art[2].url))+") no-repeat center;background-size:contain;'></td>":"")
                            +((story_script[chapter.id][i].dialogs[d].art[3])?"<td width='20%' style='background: url("+open_file(languare_data(story_script[chapter.id][i].dialogs[d].art[3].url))+") no-repeat center;background-size:contain;'></td>":"")
                            +((story_script[chapter.id][i].dialogs[d].art[4])?"<td width='20%' style='background: url("+open_file(languare_data(story_script[chapter.id][i].dialogs[d].art[4].url))+") no-repeat center;background-size:contain;'></td>":"")
                            +"</tr></tbody></table>"
                        element+="<div class='dialog_element' align='left' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"art\";scen_data=[\""+chapter.id+"\","+i+","+(d+1)+"];scen_editor(scen_data[0],scen_data[1],scen_data[2]);'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Art<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_art' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='art';scen_data=[\'"+chapter.id+"\',"+i+","+(d+1)+"];dialog_el(this.id,'Art',true);\" width='24px' class='icon_m icon_edit' title='Scen editor'></td></tr></tbody></table>"+t+"</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].text){
						var t=languare_data(story_script[chapter.id][i].dialogs[d].text)
                        element+="<div class='dialog_element' align='left' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"text\";dialog_text_edit();'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'>"
                                +((n)?"<p><b>"+n+"</p></b>" :"&nbsp;")
                                +"</td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_text' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='text';dialog_el(this.id,'Text',true)\" width='24px' class='icon_m icon_edit' title='Edit dialog'></td></tr></tbody></table>"
								+"<p style='padding:4px;'>"+((t.length>0)?t:'&nbsp;')+"</p></div>"
					}
                    if(story_script[chapter.id][i].dialogs[d].text_add){
                        var t=languare_data(story_script[chapter.id][i].dialogs[d].text_add)
                        element+="<div class='dialog_element' align='left' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"text_add\";dialog_text_edit();'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'>"+((n.length>0)?"<p><b>"+n+" " :"<p><b>")+"text add</b></p></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_text_add' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='text_add';dialog_el(this.id,'Text add',true)\" width='24px' class='icon_m icon_edit' title='Edit dialog'></td></tr></tbody></table>"
                                +"<p>"+((t.length>0)?t:'&nbsp;')+"</p></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].choice){
                        element+="<div class='dialog_element'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"choice\";edit_choice();'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Choice</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_choice' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='choice';dialog_el(this.id,'Choice',true)\" width='24px' class='icon_m icon_edit' title='Edit choice'></td></tr></tbody></table>"
                        for(var c=0;c<story_script[chapter.id][i].dialogs[d].choice.length;c++){
                            go=story_script[chapter.id][i].dialogs[d].choice[c].go_to;
                            if(go&&go!=""&&go!="undefined"){
                                if(story_script[chapter.id][i].dialogs[d].choice[c].text){data_corr(story_script[chapter.id][i].dialogs[d].choice[c],'text')}
                                var t=languare_data(story_script[chapter.id][i].dialogs[d].choice[c].text)
                                if(story_script[go]){
                                    element+="<table id='"+all+"c"+d+go+all_blocks+"' style='width:100%;' class='choice_b to_go'><tbody><tr><td style='padding-left:8px;width:50%;'><input style='width:100%;' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].text=this.value' value='"+((t=="")?go:t)+"' type='text'></td><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,2)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"></td></tr></tbody></table>"
                                    line_controll.push([go,chapter.id,all+"c"+d+go+all_blocks]);
                                    creaton_line(all+"c"+d+go+all_blocks);
                                }else{element+="<table style='width:100%;' class='choice_b'><tbody><tr><td style='padding-left:8px;width:50%;'><input style='width:100%;' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].text=this.value' value='"+((t=="")?go:t)+"' type='text'></td><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,2)+"</select></td><td class='button_block icon'></td></tr></tbody></table>"}
                            }else{var t=languare_data(story_script[chapter.id][i].dialogs[d].choice[c].text)
								element+="<table style='width:100%;' class='choice_b'><tbody><tr><td class='button_block'></td><td style='padding:4px;'>"+((t=="")?go:t)+"</td><td class='button_block icon'></td></tr></tbody></table>"
                            }all++
                        }
                        element+="</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].sound_stop){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"sound_stop\";dialog_audio_edit(\"sound_stop_"+all+"_"+d+go+all_blocks+"\");'><tbody><tr><td align='left' valign='center'><b>Stop sound<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_sound_stop' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='sound_stop';dialog_el(this.id,'Stop sound',true)\" width='24px' class='icon_m icon_edit' title='Edit sound'></td></tr></tbody></table>"
                                +"<input id='sound_stop_"+all+"_"+d+go+all_blocks+"' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].sound_stop=this.value' value='"+story_script[chapter.id][i].dialogs[d].sound_stop+"' type='text'></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].sound){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"sound\";dialog_audio_edit(\"sound_"+all+"_"+d+go+all_blocks+"\");'><tbody><tr><td align='left' valign='center'><b>Play sound<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_sound' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='sound';dialog_el(this.id,'Play sound',true)\" width='24px' class='icon_m icon_edit' title='Edit sound'></td></tr></tbody></table>"
                                +"<input id='sound_"+all+"_"+d+go+all_blocks+"' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].sound=this.value' value='"+story_script[chapter.id][i].dialogs[d].sound+"' type='text'></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].timer){
                        go=story_script[chapter.id][i].dialogs[d].timer[1];
                        element+="<div class='dialog_element' align='left'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Timer<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_timer' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='timer';dialog_el(this.id,'Timer',false)\" width='24px' class='icon_m icon_edit' title='Edit timer'></td></tr></tbody></table><table style='width:100%;' id='"+all+"t"+d+go+all_blocks+"' class='"+((go!="tue_go"&&go!="tue_no")?'to_go':'')+" choice_b'><tbody><tr><td style='padding-left:8px;'><input style='width:100%;' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].timer[0]=(this.value*1000)' value='"+(story_script[chapter.id][i].dialogs[d].timer[0]/1000)+"' type='text'></td><td valign='center'>seconds</td><td style='width:40%;'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].timer[1]=this.value;update_novel();' class='input_text_b'>"+option_block(go,1)+"</select></td>"
                        if(go!="tue_go"&&go!="tue_no"){
                            element+="<td class='button_block icon icon_go' style='cursor:pointer;' onmouseup='go_to_block(\""+go+"\")'></td>"
                            line_controll.push([go,chapter.id,all+"t"+d+go+all_blocks]);
                            creaton_line(all+"t"+d+go+all_blocks);
                        }else{element+="<td class='button_block'></td>"}
                        all++
                        element+="</tr></tbody></table></div>"}
                    if(story_script[chapter.id][i].dialogs[d].variables){
                        var t="";
                        for(var c=0;c<story_script[chapter.id][i].dialogs[d].variables.length;c++){t+="<table width='100%' height='28px' class='choice_b'><tbody><tr><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].variables["+c+"][0]=this.value;' class='input_text_b'>"+option_var(story_script[chapter.id][i].dialogs[d].variables[c][0])+"</select></td><td width='15%'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].variables["+c+"][1]=this.value;' class='input_text_b'><option value='add'>add</option><option value='set' "+((story_script[chapter.id][i].dialogs[d].variables[c][1]=="set")?"selected":"")+">set</option></select></td><td width='34%'> <input class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].variables["+c+"][2]=this.value' value='"+story_script[chapter.id][i].dialogs[d].variables[c][2]+"' type='text'> </td><td width='5%'></td></tr></tbody></table>"};
                        element+="<div class='dialog_element' align='left'><table height='22px' width='100%' style='margin:4px 0px;' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"variables\";variables_set_edit();'><tbody><tr><td align='left' valign='center'><b>Variables<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_variables' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='variables';dialog_el(this.id,'Variables',true)\" width='24px' class='icon_m icon_edit' title='Edit variables'></td></tr></tbody></table>"+t+"</div>"
                    }
					if(story_script[chapter.id][i].dialogs[d].go_to){
                        go=story_script[chapter.id][i].dialogs[d].go_to;
                        if(story_script[go]){
						element+="<div class='dialog_element'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Go to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_go_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='go_to';dialog_el(this.id,'Go to',false)\"  width='24px' class='icon_m icon_edit' title='hange next block'></td></tr></tbody></table>"
								+"<table id='"+all+"g"+d+go+all_blocks+"' class='choice_b to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,0)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"g"+d+go+all_blocks]);
                            creaton_line(all+"g"+d+go+all_blocks)
                            all++
                        }else{element+="<div class='dialog_element'>"
							+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Go to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_go_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='go_to';dialog_el(this.id,'Go to',false)\"  width='24px' class='icon_m icon_edit' title='hange next block'></td></tr></tbody></table>"+"<div id='"+all+"g"+d+go+all_blocks+"' class='choice_b'>"
							+"<select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,0)+"</select>"+"</div></div>";}
						element+="</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].event){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Event<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_event' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='event';dialog_el(this.id,'Event',false)\" width='24px' class='icon_m icon_edit' title='Edit event'></td></tr></tbody></table>"
                                +"<input class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].event=this.value' value='"+story_script[chapter.id][i].dialogs[d].event+"' type='text'></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].controll){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Interface<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_controll' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='controll';dialog_el(this.id,'Interface',false)\" width='24px' class='icon_m icon_edit' title='Edit interface'></td></tr></tbody></table>"
                                +"<div class='choice_b'><select class='input_text_b' oninput='story_script."+chapter.id+"["+i+"].dialogs["+d+"].controll=this.value'><option value='hidden'>Hidden</option><option value='visible' "+((story_script[chapter.id][i].dialogs[d].controll=="visible")?"selected":"")+">Visible</option></select></div></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].html){
                        element+="<div class='dialog_element' ondblclick='arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n=\"html\";edit_html();'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>HTML code</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_html' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='html';dialog_el(this.id,'HTML code',true);\" width='24px' class='icon_m icon_edit' title='Edit html'></td></tr></tbody></table></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].js){
                        element+="<div class='dialog_element' ondblclick='copy_arr=story_script."+chapter.id+"["+i+"].dialogs["+d+"];edit_code(\"js\",\"JavaScript\");'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>JavaScript code</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_js' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='js';dialog_el(this.id,'JavaScript code',true);\" width='24px' class='icon_m icon_edit' title='JavaScript html'></td></tr></tbody></table></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].toast){
                        element+="<div class='dialog_element' align='left'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Toast</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_html' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='toast';dialog_el(this.id,'HTML code',true);\" width='24px' class='icon_m icon_edit' title='Edit toast'></td></tr></tbody></table><p style='padding:4px;'>"+languare_data(story_script[chapter.id][i].dialogs[d].toast)+"</p></div>"
                    }
					element+="<div align='right'><div id='add_d_"+chapter.id+"_"+i+"_"+d+"' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];scen_data=[\'"+chapter.id+"\',"+i+","+(d+1)+"];add_element_d(this.id,'"+(d+1)+"')\" class='add_button icon_m icon_add' title='Add element to dialog'></div></div></div>"
                }
				element+="<div align='right' style='margin-right:4px;'><div id='add_s_"+chapter.id+"_"+i+"' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs;arr_n="+d+";scen_data=[\'"+chapter.id+"\',"+i+","+(d+1)+"];add_element_s(this.id,'"+(i+1)+"')\" class='add_button icon_m icon_add' title='Add element to scene'></div></div>"
            }
            element+="</div>"
        }
        element+="<div align='right' style='margin-right:8px;'><div id='add_b_"+chapter.id+"' onmouseup=\"add_element_b(this.id,\'"+chapter.id+"\')\" class='add_button icon_m icon_add' title='Add element to block'></div></div>"
        chapter.innerHTML="<div style='margin:2px;'><table height='100%' width='100%'><tbody><tr><td align='center' style='cursor:pointer;' onmousedown=\"block_open('"+chapter.id+"_content')\" class='button_block icon icon_more'></td><td align='center'>"+((chapter.id.length>17)?chapter.id.slice(0,15)+"...":chapter.id )+"</td><td align='center' style='cursor:pointer;width:48px;' onmouseup=\"edit_block('"+chapter.id+"')\" class='icon_m button_block icon_edit'></td><td align='center' style='cursor:pointer;' onmouseup=\"play_novel('"+chapter.id+"')\" class='icon_m button_block icon_play'></td> <td style='width:8px;'></td> </tr></tbody></table></div><div id='"+chapter.id+"_content' style='display:"+((story_script.blocks[chapter.id])?story_script.blocks[chapter.id][2]:"none" )+";'>"+element+"</div>";
        chapter.className="story_block panel";
		if(!story_script.blocks[chapter.id]){
			chapter.style.left=64+(320*(all_blocks-1))+"px";
			chapter.style.top=64+(128*(all_blocks-1))+"px";
			story_script.blocks[chapter.id]=[chapter.style.left,chapter.style.top,'none','#fff']
		}else{
			chapter.style.left=story_script.blocks[chapter.id][0];
			chapter.style.top=story_script.blocks[chapter.id][1];
			chapter.style.backgroundColor=story_script.blocks[chapter.id][3];
		}
        story_blocks.appendChild(chapter);
    }
}
function languare_data(data){
    if(data){return ((data[languare])?data[languare]:data);}
	else{return ""}
}
function data_corr(arr,key){
    if(!arr[key][languare]){
        if(typeof arr[key]!=='object'){
            data_la(arr,key)
        }else if(arr[key][story_script.parameters.languares[0]]){
            arr[key][languare]=arr[key][story_script.parameters.languares[0]]
        }
    }
}
function data_la(arr,key){
    var s=((Object.keys(arr[key])[0]==languare)?arr[key][languare]:arr[key]);
    arr[key]={};
    if(typeof s!=='object'){for(var i=0;i<story_script.parameters.languares.length;i++){arr[key][story_script.parameters.languares[i]]=s;}}else{arr[key]=s}
}
function data_only(arr,key){
if(arr[key]&&arr[key][languare]){
	var n=arr[key][languare];
	var a=0;
	for(var i=0;i<story_script.parameters.languares.length;i++){
		if(arr[key][story_script.parameters.languares[i]]){
			if(n.length==0||n==arr[key][story_script.parameters.languares[i]]||arr[key][story_script.parameters.languares[i]].length==0){a++}
			else{n=arr[key][story_script.parameters.languares[i]]}
		}else{a++}
	} if(a==story_script.parameters.languares.length){arr[key]=n}
}else if(arr[key].length==0){delete arr[key];if(key=='art'){delete arr.art_size}}}
function creaton_line(id){
    var newLine=document.createElementNS("http://www.w3.org/2000/svg",'line');
    newLine.id=id+"l"
    story_lines.appendChild(newLine);
}
new_novel()
function save_file(){
    var n="new";
    var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(story_script));
    if(story_script.parameters.title){
        if(story_script.parameters.title.en){n=story_script.parameters.title.en}
        else if (story_script.parameters.title[story_script.parameters.languares[0]]){n=story_script.parameters.title[story_script.parameters.languares[0]]}
        else {n=story_script.parameters.title}
        n=correct_name(String(n).toLowerCase());
    }
	else{n="new_novel";}
    download_files(n+'.json',dataStr)
}
function download_files(n,c){
    var dlAnchorElem=document.getElementById('downloadAnchorElem');
    dlAnchorElem.setAttribute("href",c);
    dlAnchorElem.setAttribute("download",n); //data_time()
    dlAnchorElem.click();
}
function data_time(){
    var d=new Date();
    var dm=String(d.getMonth()+1);
    var dd=String(d.getDate());
    var dh=String(d.getHours());
    var di=String(d.getMinutes());
    var ds=String(d.getSeconds());
    return d.getFullYear()+'_'+(dm.length<2?'0'+dm :dm)+'_'+(dd.length<2?'0'+dd :dd)+'_'+(dh.length<2?'0'+dh :dh)+"-"+(di.length<2?'0'+di:di)+"-"+(ds.length<2?'0'+ds:ds)
}
function lines(elem){
    var to_go=document.getElementsByClassName("to_go");
    for(var x=0;x<to_go.length;x++){
        if(!setup_editor.lines){
            if(elem==line_controll[x][1]||elem==line_controll[x][0]){document.getElementById(line_controll[x][2]+"l").style.visibility='visible'}
            else{document.getElementById(line_controll[x][2]+"l").style.visibility='hidden'}
        }
        var title_block;
        if(document.getElementById(line_controll[x][1]+"_content").style.display=='none'){
            title_block=document.getElementById(line_controll[x][0]).getBoundingClientRect();
            var rect=document.getElementById(line_controll[x][1]).getBoundingClientRect();
            var l1=(html.scrollLeft+rect.left)/scale;
            var l2=(html.scrollLeft+title_block.left)/scale
            if(l1>l2){
                moveSlider(l1,'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(22*scale))/scale,'y2',line_controll[x][2]);
                moveSlider((l2+(256)),'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }else{
                moveSlider((l1+256),'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(22*scale))/scale,'y2',line_controll[x][2]);
                moveSlider(l2,'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }
        }else{
            title_block=document.getElementById(line_controll[x][0]).getBoundingClientRect();
            var rect=document.getElementById(line_controll[x][2]).getBoundingClientRect();
            var l1=(html.scrollLeft+rect.left)/scale;
            var l2=(html.scrollLeft+title_block.left)/scale
            if(l1>l2){
                moveSlider((l1-12),'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(12*scale))/scale,'y2',line_controll[x][2]);
                moveSlider((l2+256),'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }else{
                moveSlider((l1+244),'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(12*scale))/scale,'y2',line_controll[x][2]);
                moveSlider(l2,'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }
        }
    }
}
var moveSlider=function(slider,direction,id){
    var value=slider;
    var element=document.getElementById(id+"l");
    var coord=direction;
    element.setAttributeNS(null,coord,value);
}
function control_dlock(){
    all_blocks=document.getElementsByClassName("story_block");
    for(var i=0;i<all_blocks.length;i++){movie_dlock(all_blocks[i].id)}
}
var scroll_block=false;
function movie_dlock(id){
    var focus_block=document.getElementById(id);
    focus_block.onmousedown=function(e){
        menu_add.style.visibility="hidden";
        var coords=getCoords(focus_block);
        var shiftX=(e.pageX-coords.left);
        var shiftY=(e.pageY-coords.top);
        scroll_block=true;
        focus_block.style.position='absolute';
        focus_block.style.animation=false;
        focus_block.style.WebkitAnimation=false;
        story_blocks.appendChild(focus_block);
        moveAt(e);
        function moveAt(e){
            focus_block.style.left=((e.pageX-shiftX)/scale)+'px';
            focus_block.style.top=((e.pageY-shiftY)/scale)+'px';
            lines(id)
        }
        document.onmousemove=function(e){moveAt(e);};
        focus_block.onmouseup=function(){
			story_script.blocks[focus_block.id]=[focus_block.style.left,focus_block.style.top,document.getElementById(focus_block.id+"_content").style.display,focus_block.style.backgroundColor]
            document.onmousemove=null;
            focus_block.onmouseup=null;
            if(window_zone.style.visibility!="visible"){scroll_block=false};
            world_size()
        };
    }
    focus_block.ontouchstart=function(e){
        menu_add.style.visibility="hidden";
        var coords=getCoords(focus_block);
        var shiftX=(e.touches[0].pageX-coords.left);
        var shiftY=(e.touches[0].pageY-coords.top);
        scroll_block=true;
        focus_block.style.position='absolute';
        focus_block.style.animation=false;
        focus_block.style.WebkitAnimation=false;
        story_blocks.appendChild(focus_block);
        moveAt(e);
        function moveAt(e){
            focus_block.style.left=((e.touches[0].pageX-shiftX)/scale)+'px';
            focus_block.style.top=((e.touches[0].pageY-shiftY)/scale)+'px';
            lines(id)
        }
        document.ontouchmove=function(e){moveAt(e);};
        focus_block.ontouchend=function(){
			story_script.blocks[focus_block.id]=[focus_block.style.left,focus_block.style.top,document.getElementById(focus_block.id+"_content").style.display,focus_block.style.backgroundColor]
            document.ontouchmove=null;
            focus_block.ontouchend=null;
            if(window_zone.style.visibility!="visible"){scroll_block=false};
            world_size()
        };
    }
    focus_block.ondragstart=function(){return false;};
    function getCoords(elem){
        var box=elem.getBoundingClientRect();
        return {
            top:box.top+pageYOffset,
            left:box.left+pageXOffset
        };
    }
}
function world_size(){
    var height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);
    var width=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollWidth,html.offsetWidth);
    story_lines.setAttribute("height",height/scale);
    story_lines.setAttribute("width",width/scale);
    story_lines.setAttribute("viewBox","0,0,"+width/scale+","+height/scale);
}
function block_open(id){
    var e=document.getElementById(id);
    if(e.style.display === "block"){e.style.display="none";}
	else{e.style.display="block";}
    lines()
}
var startmove_x=null;
var startmove_y=null;
var scroll_x=null;
var scroll_y=null;
var scroll_xz=null;
var scroll_yz=null;
html.ontouchstart=function(e){
    if(!scroll_block||scene_screen){
        html.style.overflow='scroll';
        startmove_x=e.touches[0].clientX;
        startmove_y=e.touches[0].clientY;
        scroll_x=html.scrollTop;
        scroll_y=html.scrollLeft;
        html.ontouchmove=function(e){
            html.scrollTop=scroll_x-(e.touches[0].clientY-startmove_y);
            html.scrollLeft=scroll_y-(e.touches[0].clientX-startmove_x);
        }
        html.ontouchend=function(e){
            startmove_x=null;
            startmove_y=null;
            html.ontouchmove=null;
            html.ontouchend=null;
            scroll_z();
        };
    }else{html.style.overflow='hidden';}
}
scene_view.ontouchstart=function(e){
    if(scene_screen&&scene_scroll){
        startmove_x=e.touches[0].clientX;
        startmove_y=e.touches[0].clientY;
        scroll_x=scene_view.scrollTop;
        scroll_y=scene_view.scrollLeft;
        html.ontouchmove=function(e){
            scene_view.scrollTop=scroll_x-(e.touches[0].clientY-startmove_y);
            scene_view.scrollLeft=scroll_y-(e.touches[0].clientX-startmove_x);
        }
        html.ontouchend=function(e){
            startmove_x=null;
            startmove_y=null;
            html.ontouchmove=null;
            html.ontouchend=null;
            scroll_z();
        };
    }
}
html.onmousedown=function(e){
    if(!scroll_block&&!scene_screen){
        startmove_x=e.clientX;
        startmove_y=e.clientY;
        scroll_x=html.scrollTop;
        scroll_y=html.scrollLeft;
        html.onmousemove=function(e){
            html.scrollTop=scroll_x-(e.clientY-startmove_y);
            html.scrollLeft=scroll_y-(e.clientX-startmove_x);
        }
        html.onmouseup=function(e){
            startmove_x=null;
            startmove_y=null;
            html.onmousemove=null;
            html.onmouseup=null;
            scroll_z();
        };
		html.onmouseleave=function(){
			html.onmousemove=null;
			html.onmouseup=null;
			document.onmousemove=null;
			document.onmouseup=null;
		};
    }
}
scene_view.onmousedown=function(e){
    if(scene_screen&&scene_scroll){
        startmove_x=e.clientX;
        startmove_y=e.clientY;
        scroll_x=scene_view.scrollTop;
        scroll_y=scene_view.scrollLeft;
        html.onmousemove=function(e){
            scene_view.scrollTop=scroll_x-(e.clientY-startmove_y);
            scene_view.scrollLeft=scroll_y-(e.clientX-startmove_x);
        }
        html.onmouseup=function(e){
            startmove_x=null;
            startmove_y=null;
            html.onmousemove=null;
            html.onmouseup=null;
        };
        html.onmouseleave=function(){
            html.onmousemove=null;
            html.onmouseup=null;
            document.onmousemove=null;
            document.onmouseup=null;
        };
    }
}
function scroll_z(){
    scroll_xz=((html.scrollTop+(html.clientHeight/2))/scale)-(html.clientHeight/2);
    scroll_yz=((html.scrollLeft+(html.clientWidth/2))/scale)-(html.clientWidth/2);
}
function modal_window(action,content){
    var window_zone=document.getElementById("window_zone");
    if(action=='close'){
        menu_add.style.visibility="hidden";
        window_zone.style.visibility="hidden"
        window_zone.style.backgroundColor='rgba(110,95,165,0)';
        html.style.overflow='scroll';
        scroll_block=false;
        window_zone.innerHTML="";
    }else if(action=='open'&&window_zone.style.visibility!="visible"){
        window_zone.style.visibility="visible";
        window_zone.style.backgroundColor='var(--cm)'//'#efefff';
        html.style.overflow='hidden';
        window_zone.innerHTML=content;
        scroll_block=true;
    }
}
function play_novel(bl){
    var story_preview=JSON.stringify(story_script)
    for(var f=0;f<project_files.length;f++){for(var r=JSON.stringify(story_script).split(project_files[f][0]).length+2;r>0;r--){story_preview=story_preview.replace(project_files[f][0],project_files[f][1])}}
    var plugins_code=" ";
    var plugins_file="";
    if(story_script.parameters.plugins){for(var i=0;i<story_script.parameters.plugins.length;i++){
        if(plugins_list[story_script.parameters.plugins[i]]){
            if(plugins_list[story_script.parameters.plugins[i]].code){plugins_code+=plugins_list[story_script.parameters.plugins[i]].code+" "}
        else if(plugins_list[story_script.parameters.plugins[i]].file){plugins_file+="<script type='text/javascript' src='"+open_file(plugins_list[story_script.parameters.plugins[i]].file)+"'><\/script>"}
        }else{plugins_file+=((plugins_list[story_script.parameters.plugins[i]])?"<script type='text/javascript' src='"+open_file(plugins_list[story_script.parameters.plugins[i]].file)+"'><\/script>":"<script type='text/javascript' src='"+open_file(story_script.parameters.plugins[i])+"'><\/script>")}
    }}
    var fonts="";
    if(story_script.parameters.font_files){for(var i=0;i<Object.keys(story_script.parameters.font_files).length;i++){fonts+="@font-face{font-family:"+Object.keys(story_script.parameters.font_files)[i]+";src:url("+open_file(story_script.parameters.font_files[Object.keys(story_script.parameters.font_files)[i]])+");} "}}
    var preview=window.open("","preview","location=no,scrollbars=no,width="+setup_editor.pvw[0]+",height="+setup_editor.pvw[1]);
    preview.document.write("<html><head><title>"+languare_data(story_script.parameters.title)+"</title><style>"+fonts+" "+((story_script.parameters.font)?"*{font-family:"+story_script.parameters.font+";} ":"")+"body{font-size:"+story_script.parameters.font_size+";background-color:#fff;border-collapse:collapse;border:none;margin:0;padding:0;border:0;border-spacing:0px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}<\/style><\/head><body><div id='tuesday' style='width:100%;height:100vh;'> <\/div><script type='text/javascript'>"+runtime+plugins_code+"<\/script>"+plugins_file+"<script>let story_preview="+story_preview+";tuesday.addEventListener('script_executed',function(event){languare='"+languare+"'});"+((bl)?"tuesday.addEventListener('script_loaded',function(event){go_to('"+bl+"')});" :"")+" load_story('data',story_preview);<\/script><\/body><\/html>");
}
function search_block(){
    var i,txt;
    var input=document.getElementById("search_block");
    var filter=input.value.toUpperCase();
    var li=document.getElementsByClassName("story_block");
    var ferst=false
    for(i=0;i<li.length;i++){
        txt=li[i].id.toUpperCase();
        if(txt.toUpperCase().indexOf(filter)>-1){
            li[i].style.opacity=1;
            if(filter.length>0&&!ferst){
                scroll_to_block(li[i]);
                ferst=true;
            }else if(filter==txt){
                scroll_to_block(li[i]);
                ferst=true;
            }
        }else{li[i].style.opacity=0.25;}
    }
}
function search_file(){
    var i,txt;
    var input=document.getElementById("search_file");
    var filter=input.value.toUpperCase();
    var li=document.getElementsByClassName("add_file");
    for(i=0;i<li.length;i++){
        txt=li[i].title.toUpperCase();
        if(txt.toUpperCase().indexOf(filter)>-1){
            li[i].style.display="block";
        }else{li[i].style.display="none";}
    }
}
var search
function search_text(id,s){
    const i = document.getElementById(id);
    i.focus();
    var n = i.value.indexOf(s,[search])
    search = n+s.length;
    i.setSelectionRange(n,search);
    var w,y=0;
    for (w=0;w<i.value.split("\n").length;w++) {
        if(y>search){break}
       else{y=i.value.indexOf("\n",[y+1])}
    }
    i.scrollTop = ((i.rows+2) * w)-(i.rows+2);
}
function go_to_block(bl){bl=document.getElementById(bl);scroll_to_block(bl);}
function scroll_to_block(bl){
    var rect=bl.getBoundingClientRect();
    html.scrollTop=(html.scrollTop+(rect.top-(html.clientHeight/2)+22));
    html.scrollLeft=(html.scrollLeft+(rect.left-(html.clientWidth/2)+(rect.width/2)));
    bl.style.animation="flash 2s 1";
    bl.style.WebkitAnimation="flash 2s 1";
    story_blocks.appendChild(bl);
}
function toast(message, color){
    var x=document.getElementById("toast");
    if(color){x.style.backgroundColor=color} else {x.style.backgroundColor='#fff'}
    x.classList.remove("toast_anim");
    toast_message.innerHTML=message
    void x.offsetParent;
    x.classList.add("toast_anim");
}
function about(){
    var html="<div class='window' style='padding:24px 16px;width:412px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><div align='center'><p style='font-size:22px;'>Tuesday js visual editor</p><hr><p style=''>Version:0.46 (Beta)</p><br><table style=' border-spacing:10px;border-collapse:separate;'><tr><td align='right'>E-Mail:</td><td align='left'><a href='mailto:tuesdayjsengine@gmail.com' target='_blank'>tuesdayjsengine@gmail.com</a></td></tr><tr><td align='right'>Home:</td><td align='left'><a href='https://kirilllive.github.io/tuesday-js' target='_blank'>https://kirilllive.github.io/tuesday-js</a></td></tr><tr><td align='right'>itch.io:</td><td align='left'><a href='https://kirill-live.itch.io/tuesday-js' target='_blank'>https://kirill-live.itch.io/tuesday-js</a></td></tr><tr><td align='right'>Steam:</td><td align='left'><a href='https://store.steampowered.com/app/1575970/Tuesday_JS_visual_novel_engine' target='_blank'>https://store.steampowered.com/app/1575970/Tuesday_JS...</a></td></tr><tr><td align='right'>GitHub:</td><td align='left'><a href='https://github.com/Kirilllive/tuesday-js' target='_blank'>https://github.com/Kirilllive/tuesday-js</a></td></tr></table><br><p>Thanks for the help from users</p><hr><br><table width='100%' align='center'><tbody><tr>"
    +"<td width='25%' align='center'></td>"
    +"<td width='25%' align='center'><a href='https://twitter.com/laurentgontier' target='_blank'>Laurent Gontier</a></td>"
    +"<td width='25%' align='center'>Argosa</td>"
    +"<td width='25%' align='center'></td>"
    +"</tr></tbody></table><br><br><p><a href='https://www.patreon.com/kirill_live' target='_blank'><svg height='40' width='198' viewBox='0 0 1000 200' xmlns='http://www.w3.org/2000/svg'><path d='M0 0h1000v200H0z' fill='#FF424D'/><path d='M310 129V72h19c7 0 12 1 15 4 4 2 5 6 5 11 0 3 0 5-2 7-1 3-3 4-6 5a13 13 0 0110 13c0 6-2 10-6 13-3 2-8 4-14 4zm10-26v18h11l7-2c2-2 3-4 3-7 0-6-3-9-9-9zm0-7h10l7-2c2-2 2-4 2-6 0-3 0-5-2-6l-8-2h-9zm58 34c-6 0-11-2-14-6-4-4-6-9-6-15v-1l2-12c2-3 4-6 7-7 3-2 6-3 10-3 6 0 10 2 13 5 4 4 5 9 5 16v4h-27c0 3 1 6 3 8s5 3 8 3c4 0 8-2 10-5l5 5-6 6zm-1-37c-3 0-5 1-6 3-2 2-3 5-3 8h18v-1c0-3-1-5-3-7-1-2-3-3-6-3zm43 29l6-2 2-5h9l-2 7-7 6-8 2c-6 0-11-2-14-6-4-4-5-9-5-16v-1c0-6 1-12 5-15 3-4 8-6 14-6 5 0 9 1 12 4s5 7 5 12h-9l-2-6-6-3c-3 0-6 2-7 4-2 2-3 5-3 10v1c0 5 1 8 3 11 1 2 4 3 7 3zm23-15c0-4 0-8 2-11s4-6 7-7c3-2 6-3 10-3 6 0 11 2 14 5 4 4 6 9 6 15v2c0 4-1 8-3 11-1 4-3 6-6 8s-7 3-11 3c-6 0-10-2-14-6s-5-10-5-16zm9 1c0 5 1 8 3 10 2 3 4 4 7 4s6-1 8-4c2-2 2-6 2-11 0-4 0-7-2-10-2-2-5-4-8-4s-5 2-7 4c-2 3-3 6-3 11zm47-21v4c3-3 7-5 12-5 6 0 10 2 12 6 3-4 7-6 13-6 5 0 8 1 10 4 3 2 4 6 4 11v28h-10v-28l-1-6-6-1-6 1-2 5v29h-10v-28c0-5-3-7-8-7-3 0-6 1-8 4v31h-9V87zm79 43c-6 0-11-2-15-6-3-4-5-9-5-15v-1l2-12c2-3 4-6 7-7 3-2 6-3 10-3 6 0 10 2 13 5 4 4 5 9 5 16v4h-28l4 8c2 2 5 3 8 3 4 0 8-2 10-5l5 5-6 6zm-1-37c-3 0-5 1-6 3-2 2-3 5-3 8h18v-1c-1-3-1-5-3-7-1-2-3-3-6-3zm71 36l-1-4c-3 3-7 5-12 5-4 0-7-2-10-4s-4-5-4-9 2-8 5-10c3-3 8-4 14-4h6v-3c0-2 0-4-2-5l-5-2-6 2-2 4h-9l2-7 6-4c3-2 6-2 9-2 5 0 9 1 12 4 3 2 5 6 5 10v19l1 9v1zm-11-7l5-1 4-4v-8h-5l-8 2c-2 1-2 3-2 5l1 4zm59-14v21h-10V72h22c7 0 12 2 15 5 4 3 6 8 6 13 0 6-2 10-6 13-3 3-8 5-15 5zm0-8h12c4 0 6-1 8-3 2-1 3-4 3-7s-1-5-3-7-4-3-7-3h-13zm66 29l-1-4c-3 3-7 5-11 5s-8-2-11-4c-2-2-4-5-4-9s2-8 5-10c4-3 9-4 15-4h6v-3l-2-5-6-2-5 2c-2 1-2 2-2 4h-10c0-3 1-5 3-7 1-2 3-3 6-4 2-2 5-2 9-2 5 0 9 1 12 4 2 2 4 6 4 10v19l2 9v1zm-10-7l5-1 4-4v-8h-6l-8 2-2 5c0 2 0 3 2 4 1 1 2 2 5 2zm40-46v11h7v7h-7v23l1 4 3 1 4-1v8l-7 1c-7 0-11-4-11-12V94h-7v-7h7V76zm37 19h-4c-5 0-7 2-9 5v29h-9V87h9v4c2-3 5-5 9-5h4zm4 12l2-11c2-3 4-6 7-7 3-2 7-3 11-3 5 0 10 2 13 5 4 4 6 9 6 15v2l-2 11c-2 4-4 6-7 8s-6 3-10 3c-6 0-11-2-15-6-3-4-5-10-5-16zm9 1c0 5 1 8 3 10 2 3 4 4 8 4 3 0 5-1 7-4 2-2 3-6 3-11 0-4-1-7-3-10-2-2-4-4-7-4-4 0-6 2-8 4-2 3-3 6-3 11zm47-21v4c3-3 8-5 13-5 8 0 13 5 13 15v28h-9v-28l-2-5c-1-2-3-2-6-2-4 0-7 1-8 5v30h-10V87z' fill='#fff'/><path d='M165 39c-25 0-45 21-45 46s20 46 45 46 45-21 45-46-20-46-45-46' fill='#fff'/><path d='M83 161V39h23v122z' fill='#fff'/></svg></a></p><br><p><a href='https://ko-fi.com/E1E54DM6V' target='_blank'><svg width='198' viewBox='0 0 223 30' version='1.1' xmlns='http://www.w3.org/2000/svg'><g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'><rect fill='#FF5E5B' x='0' y='0' width='223' height='30' rx='8'></rect><g transform='translate(24, 7)' fill-rule='nonzero'><path d='M17,0 L19,0 C22,0 24,2 24,5 L24.6,5 C24,9 22,11 19,11 L17,11 L17,13 C17,14 16,15 14,15 L2,15 C1,15 0,14 -3e-13,13 L-2.9e-13,1 C-2.9e-13,0 0,0 1,0 L17,-1.7e-12Z M17,2 L17.4,9 L18.8,9 C20.4,9 22,7 22,6 C21.6,4 20,3 19,3 L17.4,3 Z' fill='#FFFFFF'></path><path d='M8,5 C8.7,4 10,4 11,4 C13.4,4 14,6 13,8 C12.3,9 11,11 8,13 C5.9,11 4,9 4,8 C2.4,6 3,4 6,4 C7.0,4 8,4 8.3,5.2' fill='#FF5E5B'></path></g><path d='M66.2,19.1 C65.5,19.1 64.9,19.0 64.4,18.8 C63.8,18.7 63.3,18.4 62.9,18.0 C62.6,17.8 62.5,17.5 62.5,17.2 C62.5,17.0 62.6,16.8 62.7,16.7 C62.9,16.5 63.1,16.4 63.3,16.4 C63.5,16.4 63.7,16.5 63.8,16.6 C64.2,16.9 64.5,17.1 64.9,17.3 C65.2,17.4 65.7,17.5 66.2,17.5 C66.7,17.5 67.1,17.4 67.5,17.1 C67.9,16.9 68.1,16.6 68.1,16.3 C68.1,15.8 67.9,15.5 67.5,15.3 C67.1,15.0 66.5,14.9 65.7,14.7 C63.7,14.4 62.7,13.5 62.7,11.9 C62.7,11.3 62.8,10.8 63.1,10.3 C63.4,9.9 63.9,9.6 64.4,9.4 C64.9,9.1 65.5,9.0 66.2,9.0 C66.8,9.0 67.3,9.1 67.8,9.3 C68.3,9.5 68.8,9.7 69.1,10.0 C69.4,10.2 69.5,10.4 69.5,10.7 C69.5,10.9 69.4,11.1 69.3,11.3 C69.1,11.4 68.9,11.5 68.7,11.5 C68.6,11.5 68.5,11.5 68.3,11.4 C68.1,11.2 67.8,11.0 67.3,10.9 C66.9,10.7 66.5,10.6 66.2,10.6 C65.6,10.6 65.1,10.7 64.8,10.9 C64.5,11.2 64.3,11.5 64.3,11.8 C64.3,12.2 64.5,12.5 64.8,12.7 C65.1,12.9 65.7,13.1 66.4,13.2 C67.2,13.4 67.8,13.5 68.3,13.8 C68.8,14.0 69.1,14.3 69.4,14.7 C69.6,15.0 69.7,15.5 69.7,16.2 C69.7,16.8 69.6,17.3 69.3,17.7 C68.9,18.2 68.5,18.5 67.9,18.7 C67.4,19.0 66.8,19.1 66.2,19.1 Z M76.8,11.5 C77.0,11.5 77.2,11.5 77.4,11.7 C77.5,11.9 77.6,12.1 77.6,12.3 L77.6,15.9 C77.6,16.9 77.3,17.7 76.8,18.2 C76.2,18.8 75.4,19.1 74.4,19.1 C73.4,19.1 72.6,18.8 72.0,18.2 C71.5,17.7 71.2,16.9 71.2,15.9 L71.2,12.3 C71.2,12.1 71.3,11.9 71.5,11.7 C71.6,11.5 71.8,11.5 72.1,11.5 C72.3,11.5 72.5,11.5 72.7,11.7 C72.8,11.9 72.9,12.1 72.9,12.3 L72.9,15.9 C72.9,16.4 73.0,16.9 73.3,17.1 C73.5,17.4 73.9,17.6 74.4,17.6 C74.9,17.6 75.3,17.4 75.6,17.1 C75.8,16.9 75.9,16.4 75.9,15.9 L75.9,12.3 C75.9,12.1 76.0,11.9 76.2,11.7 C76.3,11.5 76.5,11.5 76.8,11.5 Z M83.3,11.3 C84.0,11.3 84.5,11.5 85.1,11.8 C85.6,12.1 86.0,12.6 86.3,13.2 C86.6,13.8 86.8,14.5 86.8,15.2 C86.8,15.9 86.6,16.6 86.3,17.2 C86.0,17.8 85.6,18.3 85.1,18.6 C84.6,18.9 84.0,19.1 83.4,19.1 C82.9,19.1 82.5,19.0 82.1,18.8 C81.7,18.6 81.4,18.4 81.1,18.2 L81.1,20.9 C81.1,21.1 81.0,21.3 80.9,21.5 C80.7,21.7 80.5,21.8 80.3,21.8 C80.0,21.8 79.8,21.7 79.7,21.5 C79.5,21.4 79.4,21.1 79.4,20.9 L79.4,12.3 C79.4,12.1 79.5,11.9 79.7,11.7 C79.8,11.5 80.0,11.5 80.3,11.5 C80.5,11.5 80.7,11.5 80.9,11.7 C81.0,11.9 81.1,12.1 81.1,12.3 L81.1,12.4 C81.3,12.1 81.7,11.8 82.1,11.6 C82.5,11.4 82.9,11.3 83.3,11.3 Z M83.1,17.6 C83.7,17.6 84.2,17.3 84.6,16.9 C85.0,16.4 85.1,15.9 85.1,15.2 C85.1,14.5 85.0,14.0 84.6,13.5 C84.2,13.1 83.7,12.9 83.1,12.9 C82.5,12.9 82.0,13.1 81.6,13.5 C81.2,14.0 81.0,14.5 81.0,15.2 C81.0,15.9 81.2,16.4 81.6,16.9 C82.0,17.3 82.5,17.6 83.1,17.6 Z M92.0,11.3 C92.7,11.3 93.3,11.5 93.8,11.8 C94.3,12.1 94.7,12.6 95.0,13.2 C95.3,13.8 95.5,14.5 95.5,15.2 C95.5,15.9 95.3,16.6 95.0,17.2 C94.7,17.8 94.3,18.3 93.8,18.6 C93.3,18.9 92.7,19.1 92.1,19.1 C91.6,19.1 91.2,19.0 90.8,18.8 C90.4,18.6 90.1,18.4 89.8,18.2 L89.8,20.9 C89.8,21.1 89.8,21.3 89.6,21.5 C89.4,21.7 89.2,21.8 89.0,21.8 C88.8,21.8 88.6,21.7 88.4,21.5 C88.2,21.4 88.2,21.1 88.2,20.9 L88.2,12.3 C88.2,12.1 88.2,11.9 88.4,11.7 C88.6,11.5 88.8,11.5 89.0,11.5 C89.2,11.5 89.4,11.5 89.6,11.7 C89.8,11.9 89.8,12.1 89.8,12.3 L89.8,12.4 C90.1,12.1 90.4,11.8 90.8,11.6 C91.2,11.4 91.6,11.3 92.0,11.3 Z M91.8,17.6 C92.4,17.6 92.9,17.3 93.3,16.9 C93.7,16.4 93.9,15.9 93.9,15.2 C93.9,14.5 93.7,14.0 93.3,13.5 C92.9,13.1 92.4,12.9 91.8,12.9 C91.2,12.9 90.7,13.1 90.3,13.5 C90.0,14.0 89.8,14.5 89.8,15.2 C89.8,15.9 90.0,16.4 90.3,16.9 C90.7,17.3 91.2,17.6 91.8,17.6 Z M104.1,15.2 C104.1,16.0 103.9,16.6 103.6,17.2 C103.2,17.8 102.8,18.3 102.2,18.6 C101.6,18.9 101.0,19.1 100.3,19.1 C99.6,19.1 98.9,18.9 98.3,18.6 C97.8,18.3 97.3,17.8 97.0,17.2 C96.6,16.6 96.5,16.0 96.5,15.2 C96.5,14.5 96.6,13.8 97.0,13.2 C97.3,12.6 97.8,12.1 98.3,11.8 C98.9,11.5 99.6,11.3 100.3,11.3 C101.0,11.3 101.6,11.5 102.2,11.8 C102.8,12.1 103.2,12.6 103.6,13.2 C103.9,13.8 104.1,14.5 104.1,15.2 Z M102.4,15.2 C102.4,14.8 102.3,14.3 102.1,14.0 C101.9,13.6 101.7,13.4 101.3,13.2 C101.0,13.0 100.7,12.9 100.3,12.9 C99.9,12.9 99.5,13.0 99.2,13.2 C98.9,13.4 98.6,13.6 98.4,14.0 C98.2,14.3 98.1,14.8 98.1,15.2 C98.1,15.7 98.2,16.1 98.4,16.4 C98.6,16.8 98.9,17.1 99.2,17.3 C99.5,17.5 99.9,17.6 100.3,17.6 C100.7,17.6 101.0,17.5 101.3,17.3 C101.7,17.1 101.9,16.8 102.1,16.4 C102.3,16.1 102.4,15.7 102.4,15.2 Z M109.4,11.3 C109.6,11.3 109.9,11.4 110.1,11.6 C110.3,11.7 110.4,11.9 110.4,12.1 C110.4,12.4 110.3,12.6 110.1,12.8 C110.0,12.9 109.8,13.0 109.6,13.0 C109.5,13.0 109.3,13.0 109.1,12.9 C109.1,12.9 109.0,12.9 108.9,12.8 C108.8,12.8 108.7,12.8 108.6,12.8 C108.4,12.8 108.2,12.9 107.9,13.0 C107.7,13.2 107.5,13.4 107.4,13.7 C107.2,14.0 107.2,14.4 107.2,14.8 L107.2,18.1 C107.2,18.3 107.1,18.5 106.9,18.7 C106.8,18.9 106.6,19 106.3,19 C106.1,19 105.9,18.9 105.7,18.7 C105.6,18.5 105.5,18.3 105.5,18.1 L105.5,12.3 C105.5,12.1 105.6,11.9 105.7,11.7 C105.9,11.5 106.1,11.5 106.3,11.5 C106.6,11.5 106.8,11.5 106.9,11.7 C107.1,11.9 107.2,12.1 107.2,12.3 L107.2,12.5 C107.4,12.1 107.7,11.8 108.1,11.6 C108.5,11.4 108.9,11.3 109.4,11.3 Z M115.2,17.4 C115.3,17.4 115.4,17.4 115.5,17.6 C115.6,17.7 115.7,17.8 115.7,18.1 C115.7,18.3 115.5,18.5 115.3,18.7 C115.0,18.9 114.7,19 114.3,19 C113.8,19 113.3,18.8 112.9,18.6 C112.5,18.3 112.3,17.8 112.3,17.0 L112.3,13.1 L111.6,13.1 C111.4,13.1 111.2,13.1 111.1,12.9 C110.9,12.8 110.9,12.6 110.9,12.4 C110.9,12.1 110.9,12.0 111.1,11.8 C111.2,11.7 111.4,11.6 111.6,11.6 L112.3,11.6 L112.3,10.7 C112.3,10.5 112.4,10.3 112.5,10.1 C112.7,9.9 112.9,9.9 113.1,9.9 C113.4,9.9 113.6,9.9 113.7,10.1 C113.9,10.3 114.0,10.5 114.0,10.7 L114.0,11.6 L115.0,11.6 C115.2,11.6 115.4,11.7 115.5,11.8 C115.7,12.0 115.7,12.2 115.7,12.4 C115.7,12.6 115.7,12.8 115.5,12.9 C115.4,13.1 115.2,13.1 115.0,13.1 L114.0,13.1 L114.0,16.9 C114.0,17.1 114.0,17.3 114.1,17.4 C114.2,17.4 114.4,17.5 114.5,17.5 C114.6,17.5 114.7,17.5 114.8,17.4 C115.0,17.4 115.1,17.4 115.2,17.4 Z M129.8,11.3 C130.8,11.3 131.4,11.6 131.8,12.2 C132.1,12.7 132.3,13.5 132.3,14.5 L132.3,18.1 C132.3,18.3 132.2,18.5 132.0,18.7 C131.9,18.9 131.7,19 131.4,19 C131.2,19 131.0,18.9 130.8,18.7 C130.7,18.5 130.6,18.3 130.6,18.1 L130.6,14.5 C130.6,14.0 130.5,13.6 130.3,13.3 C130.1,13.0 129.8,12.9 129.2,12.9 C128.7,12.9 128.3,13.0 128.0,13.3 C127.7,13.6 127.6,14.0 127.6,14.5 L127.6,18.1 C127.6,18.3 127.5,18.5 127.3,18.7 C127.2,18.9 127.0,19 126.7,19 C126.5,19 126.3,18.9 126.1,18.7 C126.0,18.5 125.9,18.3 125.9,18.1 L125.9,14.5 C125.9,14.0 125.8,13.6 125.6,13.3 C125.4,13.0 125.0,12.9 124.5,12.9 C124.0,12.9 123.6,13.0 123.3,13.3 C123.0,13.6 122.9,14.0 122.9,14.5 L122.9,18.1 C122.9,18.3 122.8,18.5 122.6,18.7 C122.5,18.9 122.3,19 122.0,19 C121.8,19 121.6,18.9 121.4,18.7 C121.3,18.5 121.2,18.3 121.2,18.1 L121.2,12.3 C121.2,12.1 121.3,11.9 121.4,11.7 C121.6,11.5 121.8,11.5 122.0,11.5 C122.3,11.5 122.5,11.5 122.6,11.7 C122.8,11.9 122.9,12.1 122.9,12.3 L122.9,12.5 C123.1,12.2 123.4,11.9 123.8,11.7 C124.2,11.4 124.7,11.3 125.1,11.3 C126.3,11.3 127.1,11.8 127.4,12.9 C127.6,12.5 127.9,12.1 128.4,11.8 C128.8,11.5 129.3,11.3 129.8,11.3 Z M140.8,15.0 C140.8,15.3 140.7,15.4 140.6,15.6 C140.4,15.7 140.2,15.8 140.0,15.8 L135.4,15.8 C135.5,16.3 135.7,16.8 136.1,17.1 C136.5,17.4 137.0,17.6 137.5,17.6 C137.9,17.6 138.2,17.5 138.4,17.4 C138.6,17.4 138.8,17.3 138.9,17.2 C139.0,17.1 139.1,17.1 139.1,17.1 C139.3,17.0 139.5,16.9 139.6,16.9 C139.8,16.9 140.0,17.0 140.1,17.1 C140.3,17.3 140.3,17.4 140.3,17.6 C140.3,17.9 140.2,18.1 139.9,18.3 C139.7,18.5 139.3,18.7 138.9,18.9 C138.5,19.0 138.0,19.1 137.6,19.1 C136.8,19.1 136.1,18.9 135.5,18.6 C134.9,18.3 134.5,17.8 134.2,17.2 C133.8,16.7 133.7,16.0 133.7,15.3 C133.7,14.5 133.9,13.8 134.2,13.2 C134.5,12.6 135.0,12.1 135.5,11.8 C136.1,11.5 136.7,11.3 137.3,11.3 C137.9,11.3 138.5,11.5 139.0,11.8 C139.6,12.2 140.0,12.6 140.3,13.2 C140.7,13.8 140.8,14.4 140.8,15.0 Z M137.3,12.9 C136.2,12.9 135.6,13.4 135.4,14.4 L139.0,14.4 L139.0,14.3 C139.0,13.9 138.8,13.6 138.5,13.3 C138.1,13.0 137.7,12.9 137.3,12.9 Z M153.3,15.2 C153.3,16.0 153.2,16.6 152.8,17.2 C152.5,17.8 152.0,18.3 151.5,18.6 C150.9,18.9 150.2,19.1 149.5,19.1 C148.8,19.1 148.2,18.9 147.6,18.6 C147.0,18.3 146.6,17.8 146.2,17.2 C145.9,16.6 145.7,16.0 145.7,15.2 C145.7,14.5 145.9,13.8 146.2,13.2 C146.6,12.6 147.0,12.1 147.6,11.8 C148.2,11.5 148.8,11.3 149.5,11.3 C150.2,11.3 150.9,11.5 151.5,11.8 C152.0,12.1 152.5,12.6 152.8,13.2 C153.2,13.8 153.3,14.5 153.3,15.2 Z M151.7,15.2 C151.7,14.8 151.6,14.3 151.4,14.0 C151.2,13.6 150.9,13.4 150.6,13.2 C150.3,13.0 149.9,12.9 149.5,12.9 C149.1,12.9 148.8,13.0 148.5,13.2 C148.1,13.4 147.9,13.6 147.7,14.0 C147.5,14.3 147.4,14.8 147.4,15.2 C147.4,15.7 147.5,16.1 147.7,16.4 C147.9,16.8 148.1,17.1 148.5,17.3 C148.8,17.5 149.1,17.6 149.5,17.6 C149.9,17.6 150.3,17.5 150.6,17.3 C150.9,17.1 151.2,16.8 151.4,16.4 C151.6,16.1 151.7,15.7 151.7,15.2 Z M158.7,11.3 C159.7,11.3 160.4,11.6 160.7,12.2 C161.1,12.7 161.3,13.5 161.3,14.5 L161.3,18.1 C161.3,18.3 161.2,18.5 161.0,18.7 C160.9,18.9 160.7,19 160.4,19 C160.2,19 160.0,18.9 159.8,18.7 C159.7,18.5 159.6,18.3 159.6,18.1 L159.6,14.5 C159.6,14.0 159.5,13.6 159.3,13.3 C159.0,13.0 158.7,12.9 158.2,12.9 C157.6,12.9 157.2,13.0 156.9,13.3 C156.6,13.6 156.4,14.0 156.4,14.5 L156.4,18.1 C156.4,18.3 156.3,18.5 156.2,18.7 C156.0,18.9 155.8,19 155.6,19 C155.3,19 155.1,18.9 155.0,18.7 C154.8,18.5 154.7,18.3 154.7,18.1 L154.7,12.3 C154.7,12.1 154.8,11.9 155.0,11.7 C155.1,11.5 155.3,11.5 155.6,11.5 C155.8,11.5 156.0,11.5 156.2,11.7 C156.3,11.9 156.4,12.1 156.4,12.3 L156.4,12.6 C156.7,12.2 157.0,11.9 157.4,11.7 C157.8,11.4 158.3,11.3 158.7,11.3 Z M174.7,17.5 C174.7,17.6 174.8,17.7 174.8,17.8 C174.8,17.9 174.8,18.0 174.8,18.1 C174.8,18.3 174.8,18.5 174.6,18.7 C174.4,18.9 174.1,19 173.9,19 C173.8,19 173.7,18.9 173.5,18.9 C173.4,18.8 173.3,18.7 173.3,18.6 L170.2,14.6 L168.9,15.9 L168.9,18.1 C168.9,18.3 168.8,18.6 168.7,18.7 C168.5,18.9 168.3,19 168.0,19 C167.8,19 167.6,18.9 167.4,18.7 C167.2,18.5 167.1,18.3 167.1,18.1 L167.1,10.0 C167.1,9.8 167.2,9.6 167.4,9.4 C167.6,9.2 167.8,9.2 168.0,9.2 C168.3,9.2 168.5,9.2 168.7,9.4 C168.8,9.5 168.9,9.8 168.9,10.0 L168.9,13.8 L173.4,9.4 C173.6,9.2 173.8,9.1 174.1,9.1 C174.3,9.1 174.5,9.2 174.6,9.3 C174.8,9.5 174.8,9.7 174.8,9.9 C174.8,10.1 174.7,10.3 174.6,10.5 L171.5,13.4 L174.7,17.5 Z M183.4,15.2 C183.4,16.0 183.2,16.6 182.9,17.2 C182.5,17.8 182.1,18.3 181.5,18.6 C180.9,18.9 180.3,19.1 179.6,19.1 C178.9,19.1 178.2,18.9 177.6,18.6 C177.1,18.3 176.6,17.8 176.3,17.2 C175.9,16.6 175.8,16.0 175.8,15.2 C175.8,14.5 175.9,13.8 176.3,13.2 C176.6,12.6 177.1,12.1 177.6,11.8 C178.2,11.5 178.9,11.3 179.6,11.3 C180.3,11.3 180.9,11.5 181.5,11.8 C182.1,12.1 182.5,12.6 182.9,13.2 C183.2,13.8 183.4,14.5 183.4,15.2 Z M181.7,15.2 C181.7,14.8 181.6,14.3 181.4,14.0 C181.2,13.6 181.0,13.4 180.6,13.2 C180.3,13.0 180.0,12.9 179.6,12.9 C179.2,12.9 178.8,13.0 178.5,13.2 C178.2,13.4 177.9,13.6 177.7,14.0 C177.5,14.3 177.4,14.8 177.4,15.2 C177.4,15.7 177.5,16.1 177.7,16.4 C177.9,16.8 178.2,17.1 178.5,17.3 C178.8,17.5 179.2,17.6 179.6,17.6 C180.0,17.6 180.3,17.5 180.6,17.3 C181.0,17.1 181.2,16.8 181.4,16.4 C181.6,16.1 181.7,15.7 181.7,15.2 Z M185.4,15.5 C185.2,15.5 185.0,15.4 184.8,15.3 C184.6,15.1 184.6,14.9 184.6,14.7 C184.6,14.4 184.6,14.2 184.8,14.1 C185.0,13.9 185.2,13.8 185.4,13.8 L187.9,13.8 C188.1,13.8 188.3,13.9 188.5,14.1 C188.6,14.2 188.7,14.4 188.7,14.7 C188.7,14.9 188.6,15.1 188.5,15.3 C188.3,15.4 188.1,15.5 187.9,15.5 L185.4,15.5 Z M193.9,10.1 C193.6,10.1 193.4,10.2 193.2,10.3 C193.1,10.5 193.0,10.7 193.0,10.9 L193.0,11.6 L194.3,11.6 C194.5,11.6 194.7,11.7 194.9,11.8 C195.0,12.0 195.1,12.1 195.1,12.4 C195.1,12.6 195.0,12.8 194.9,12.9 C194.7,13.1 194.5,13.1 194.3,13.1 L193.0,13.1 L193.0,18.1 C193.0,18.3 193.0,18.5 192.8,18.7 C192.6,18.9 192.4,19 192.2,19 C192.0,19 191.8,18.9 191.6,18.7 C191.4,18.5 191.4,18.3 191.4,18.1 L191.4,13.1 L190.6,13.1 C190.4,13.1 190.2,13.1 190.1,12.9 C189.9,12.8 189.8,12.6 189.8,12.4 C189.8,12.1 189.9,12.0 190.1,11.8 C190.2,11.7 190.4,11.6 190.6,11.6 L191.4,11.6 L191.4,11.0 C191.4,10.3 191.6,9.7 192.1,9.2 C192.6,8.8 193.3,8.6 194.2,8.6 C194.5,8.6 194.8,8.7 195.1,8.8 C195.3,8.9 195.5,9.2 195.5,9.4 C195.5,9.7 195.4,9.8 195.3,10.0 C195.1,10.1 195.0,10.2 194.8,10.2 C194.7,10.2 194.7,10.2 194.6,10.2 C194.6,10.2 194.5,10.2 194.5,10.2 C194.2,10.1 194.1,10.1 193.9,10.1 Z M197.7,18.1 C197.7,18.3 197.7,18.5 197.5,18.7 C197.3,18.9 197.1,19 196.9,19 C196.7,19 196.5,18.9 196.3,18.7 C196.1,18.5 196.1,18.3 196.1,18.1 L196.1,12.3 C196.1,12.1 196.1,11.9 196.3,11.7 C196.5,11.5 196.7,11.5 196.9,11.5 C197.1,11.5 197.3,11.5 197.5,11.7 C197.7,11.9 197.7,12.1 197.7,12.3 L197.7,18.1 Z M196.9,10.6 C196.6,10.6 196.3,10.5 196.2,10.4 C196.1,10.3 196.0,10.1 196.0,9.9 L196.0,9.6 C196.0,9.3 196.1,9.1 196.2,9.0 C196.4,8.9 196.6,8.9 196.9,8.9 C197.2,8.9 197.5,8.9 197.6,9.0 C197.7,9.1 197.8,9.3 197.8,9.6 L197.8,9.9 C197.8,10.1 197.7,10.3 197.6,10.4 C197.4,10.5 197.2,10.6 196.9,10.6Z' fill='#FFFFFF' fill-rule='nonzero'></path></g></svg></a></p></div></div>"
    modal_window("open",html);
}
function build_choice(){
    var html="<div class='window' style='padding:24px 0px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Build project</p><br><hr style='margin:0px;'>"
        +'<table style="border-spacing:10px;border-collapse:separate;border-bottom:1px solid var(--cb);" class="button_menu" onclick="modal_window(\'close\');build(0);"><tbody><tr>'
        +'<td style="width:82px;min-width:82px;height:82px;background-repeat:no-repeat;background-size: 48px 48px;background-position:center;" class="img_html"></td><td><p style="font-size:12px;text-align:left;width:320px;" class="select_tutorials">'+texts.tutorials[8].en+'</p></td></tr>'
        +'</tbody></table>'
        +'<table style="border-spacing:10px;border-collapse:separate;border-bottom:1px solid var(--cb);" class="button_menu" onclick="modal_window(\'close\');build(1);"><tbody><tr>'
        +'<td style="width:82px;height:82px;background-repeat:no-repeat;background-size: 48px 48px;background-position:center;" class="img_zip"></td><td><p style="font-size:12px;text-align:left;width:320px;" class="select_tutorials">'+texts.tutorials[9].en+'</p></td></tr>'
        +'</tbody></table>'
        +'<table style="border-spacing:10px;border-collapse:separate;border-bottom:1px solid var(--cb);" class="button_menu" onclick="modal_window(\'close\');if(project_files.length>0){copy_arr=JSON.stringify(story_script);arr_n=0;build_base(arr_n);}else{build(0)}"><tbody><tr>'
        +'<td style="width:82px;height:82px;background-repeat:no-repeat;background-size: 48px 48px;background-position:center;" class="img_base"></td><td><p style="font-size:12px;text-align:left;width:320px;" class="select_tutorials">'+texts.tutorials[10].en+'</p></td></tr>'
        +'</tbody></table>'
        +"</div>"
    modal_window("open",html);
}
function new_project(){
    scen_editor_apply();
    new_novel();
    var html="<div class='window' style='padding:24px 8px; width:360px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>New project</p><hr><br><div style='overflow-x:hidden; overflow-y:auto; width:100%; max-height:60vh;'>"
        +"<p align='left' style=' margin-left:8px;'>Project folder/location</p>"
        +"<table style='width:100%;'><tbody><tr><td><input id='project_foler' onclick=\"load_new=true;json_file.click()\" class='input_text' style='padding-top:10px;' type='text'></td><td onclick=\"load_new=true;json_file.click()\" style='width:40px; cursor:pointer;' title='delet' class='icon icon_load'></td></tr></tbody></table><p class='text_tutorials_b select_tutorials'>"+texts.tutorials[3].en+"</p><br><br>"
        +"<p align='left' style=' margin-left:8px;'>Name project</p><table id='new_title'><tbody>"
        +"<tr><td style='padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;'><select class='input_text title_lang'>"+big_languares()+"</select></td><td><input class='title_name input_text' placeholder='translated title' style='padding-top:10px;' type='text' value='"+
        story_script.parameters.title.en+"'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"
        +"</tbody></table><div onclick=\"add_tr('new_title')\" class='icon icon_add' style='margin-top:16px;height:26px; width:26px; cursor:pointer;'></div>"
        +"</div><br><br><table class='big_button' width='256px' onclick='create_project()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Create project</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function build(tip){
    let story_build=(story_script.base)?JSON.parse(copy_arr):JSON.parse(JSON.stringify(story_script));
    if(story_script.base){story_build.base=JSON.parse(JSON.stringify(story_script.base))}
    var plugins_file="";
    var plugins_code=" ";
    if(story_script.parameters.plugins){for(var i=0;i<story_script.parameters.plugins.length;i++){
        if(plugins_list[story_script.parameters.plugins[i]]){
            if(plugins_list[story_script.parameters.plugins[i]].code){plugins_code+=plugins_list[story_script.parameters.plugins[i]].code+" "}
        else if(plugins_list[story_script.parameters.plugins[i]].file){plugins_file+="<script type='text/javascript' src='"+plugins_list[story_script.parameters.plugins[i]].file+"'><\/script>"}
        }else{plugins_file+=((plugins_list[story_script.parameters.plugins[i]])?"<script type='text/javascript' src='"+plugins_list[story_script.parameters.plugins[i]].file+"'><\/script>":"<script type='text/javascript' src='"+story_script.parameters.plugins[i]+"'><\/script>")}
    }}
    var fonts=""
    if(story_build.parameters.font_files){for(var i=0;i<Object.keys(story_build.parameters.font_files).length;i++){fonts+="@font-face{font-family:"+Object.keys(story_build.parameters.font_files)[i]+";src:url("+story_build.parameters.font_files[Object.keys(story_build.parameters.font_files)[i]]+");} "}}
    var par=[((story_script.parameters.font)?story_script.parameters.font:0),((story_script.parameters.font_size)?story_script.parameters.font_size:0),((story_script.parameters.icon)?story_script.parameters.icon:0)]
    if(story_script.parameters.characters&&Object.keys(story_script.parameters.characters).length==0){delete story_script.parameters.characters}
    if(story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length==0){delete story_script.parameters.variables}
    if(story_script.parameters.sounds&&Object.keys(story_script.parameters.sounds).length==0){delete story_script.parameters.sounds}
    if(story_script.parameters.key&&Object.keys(story_script.parameters.key).length==0){delete story_script.parameters.key}
    if(story_script.parameters.style_file&&story_script.parameters.style_file.length==0){delete story_script.parameters.style_file}
    delete story_build.parameters['plugins'];
    delete story_build.parameters['font_size'];
    delete story_build.parameters['icon'];
    delete story_build.parameters.font_files;
    delete story_build.blocks;
    var story_preview=JSON.stringify(story_build)
    if(tip==0){
        var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent("<html><head>"+((par[2]!=0)?"<link rel='shortcut icon' href='"+par[2]+"' type='image/x-icon'>":"")+"<meta charset='UTF-8'><meta name='viewport' content='initial-scale=1,width=device-width,height=device-height,viewport-fit=cover,maximum-scale=1,user-scalable=no'><style>"+fonts+" "+((par[0]!=0)?"*{font-family:"+par[0]+";} ":"")+"body {"+((par[1]!=0)?"font-size:"+par[1]:"")+";background-color:#fff;border-collapse:collapse;border:none;margin:0;padding:0;border:0;border-spacing:0px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}<\/style><\/head><body><div id='tuesday' style='width:100%;height:100vh;'> <\/div><script type='text/javascript'>"+runtime+plugins_code+"<\/script>"+plugins_file+"<script>let story_novel="+story_preview+";load_story('data',story_novel);<\/script><\/body><\/html>");
        download_files('index.html',dataStr)
        modal_window("close")
        if(story_script.base){delete story_script.base}
        toast("index.html file is created");
    }
    else if(tip==1){
        var dataStr="<html><head>"+((par[2]!=0)?"<link rel='shortcut icon' href='"+par[2]+"' type='image/x-icon'>":"")+"<meta charset='UTF-8'><meta name='viewport' content='initial-scale=1,width=device-width,height=device-height,viewport-fit=cover,maximum-scale=1,user-scalable=no'><style>"+fonts+" "+((par[0]!=0)?"*{font-family:"+par[0]+";} ":"")+"body {"+((par[1]!=0)?"font-size:"+par[1]:"")+";background-color:#fff;border-collapse:collapse;border:none;margin:0;padding:0;border:0;border-spacing:0px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}<\/style><\/head><body><div id='tuesday' style='width:100%;height:100vh;'> <\/div><script type='text/javascript'>"+runtime+plugins_code+"<\/script>"+plugins_file+"<script>let story_novel="+story_preview+";load_story('data',story_novel);<\/script><\/body><\/html>";
        build_zip(dataStr)
    }
}
function build_base(file){
    modal_window("open","<div class='window' style='padding:24px 24px;'><table><tbody><tr><td style='width:32px;height:32px;background-repeat:no-repeat;background-size: 32px 32px;background-position:center;' class='img_wait'></td><td align='center' style='width:188px;'>Converting data to base64</td></tr></tbody></table></div>");
    const reader = new FileReader();
    reader.readAsDataURL(load_files[arr_n]);
    reader.onload=function(){
        if(!story_script.base){story_script.base=[]}
        if((project_files[arr_n][2].indexOf("image")>-1||project_files[arr_n][2].indexOf("video")>-1)&&copy_arr.indexOf(project_files[arr_n][0])>-1 ){story_script.base.push(reader.result); copy_arr=copy_arr.replace(new RegExp('"'+project_files[arr_n][0]+'"',"g"),story_script.base.length);}
        else if(project_files[arr_n][2]!="audio/mpeg"){copy_arr=copy_arr.replace(new RegExp(project_files[arr_n][0],"g"),reader.result);}
        if(arr_n<load_files.length-1){arr_n++;build_base(arr_n);}
        else if (arr_n==load_files.length-1){build(0);}
    }
}
function build_zip(dataStr){
    modal_window("open","<div class='window' style='padding:24px 24px;'><table><tbody><tr><td style='width:32px;height:32px;background-repeat:no-repeat;background-size: 32px 32px;background-position:center;' class='img_wait'></td><td align='center' style='width:144px;'>Creation ZIP archive</td></tr></tbody></table></div>");
    var arhiv = new JSZip();
    arhiv.file("index.html", dataStr);
    for(var f=0;f<project_files.length;f++){if(project_files[f][2]!="application/json"&&dataStr.indexOf(project_files[f][0])>-1){arhiv.file(((project_files[f][2].indexOf('audio/mpeg')>-1)?project_files[f][0]+'.mp3':project_files[f][0]),load_files[f],{binary:true});}}
    arhiv.generateAsync({type:"blob"})
    .then(function(content) {
        var n="new";
        if(story_script.parameters.title){n=(story_script.parameters.title.en)?story_script.parameters.title.en :story_script.parameters.title;}
        download_files(n+'_'+data_time()+'.zip',URL.createObjectURL(content))
        modal_window("close")
        toast('zip archive complete')
    });
}
function jsonedit(arr){
	if(arr){var html="<div class='window' style='padding:0px 2px 16px 0px;width:75vw;'>"
    +"<table style='width:100%;'><tbody><tr>"
    +"<td style='width:168px;'></td>"
    +"<td align='center'>JSON Edit</td>"
    +"<td style='width:88px;'><input id='search_edit' type='text' class='search' style='height:40px;width:100%;' placeholder='search text'></td>"
    +"<td class='icon icon_search' style='width:60px;' onclick='search_text(\"editJson\",search_edit.value)'></td>"
    +"<td class='icon icon_close' style='width:40px;' onclick='modal_window(\"close\")'></td>"
    +"</tr></tbody></table>"
    +"<p><textarea id='editJson' rows='12' class='input_text' wrap='off' style='font-family:monospace;resize:none;padding-left:0px;height:calc(90vh - 128px);width:100%;border:1px solid var(--cb);'>"+JSON.stringify(arr_l[arr_n],null,'\t')+"</textarea></p><br><table class='big_button' width='256px' onclick='arr_l[arr_n]=JSON.parse(editJson.value);update_novel();modal_window(\"close\");toast(\"script updated\");menu_add.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"}
    else{var html="<div class='window' style='padding:0px 2px 16px 0px;width:75vw;'>"
    +"<table style='width:100%;'><tbody><tr>"
    +"<td style='width:168px;'></td>"
    +"<td align='center'>JSON Edit</td>"
    +"<td style='width:88px;'><input id='search_edit' type='text' class='search' style='height:40px;width:100%;' placeholder='search text'></td>"
    +"<td class='icon icon_search' style='width:60px;' onclick='search_text(\"editJson\",search_edit.value)'></td>"
    +"<td class='icon icon_close' style='width:40px;' onclick='modal_window(\"close\")'></td>"
    +"</tr></tbody></table>"
    +"<textarea id='editJson' rows='12' class='input_text' wrap='off' style='font-family:monospace;resize:none;padding-left:0px;height:calc(90vh - 128px);width:100%;border:1px solid var(--cb);'>"+JSON.stringify(story_script,null,'\t')+"</textarea></p><br><table class='big_button' width='256px' onclick='story_script=JSON.parse(editJson.value);update_novel();state_save();modal_window(\"close\");toast(\"script updated\");'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"}
    modal_window("open",html);
}
function big_languares(s){
    var lang='<optgroup>';
    for(l=0;l<Object.keys(languares).length;l++){lang+="<option value='"+languares[Object.keys(languares)[l]]+"' "+((languares[Object.keys(languares)[l]]==s)?"selected":"")+">"+languares[Object.keys(languares)[l]].toUpperCase()+" - "+Object.keys(languares)[l]+"</option>"+((l==7)?"</optgroup><optgroup>":"")}
    return lang+='</optgroup>';
}
function create_project(){
    li_n=document.getElementsByClassName("title_lang");
    li_v=document.getElementsByClassName("title_name");
    story_script.parameters.title={};
    story_script.parameters.languares=[];
    for(var i=0;i<li_n.length;i++){
        story_script.parameters.title[li_n[i].value]=li_v[i].value
        story_script.parameters.languares.push(li_n[i].value);
    }
    modal_window("close");
    document.dispatchEvent(new Event('tue_story_new'));
    state_num=0;back_up=[];state_save();
}
function new_block(){
	var html="<div class='window' style='padding:24px 8px;width:380px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>New story block</p><hr><br>"
		+"<form id='color_chec' onsubmit='return false;create_block();'><table style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody><tr><td style='width:50px' align='right'>block id </td><td align='left'><input id='block_id' value='block "+(Object.keys(story_script).length-1)+"' class='input_text' type='text'></td></tr></tbody></table><br><p style=':14px;margin-left:12px;' align='left'>color block</p><br><table style='width:100%;border-spacing:4px;border-collapse:separate;'><tbody><tr>"
		+"<td align='center'><input style='background-color:"+color_bg[0]+";' class='checkbox_b' type='radio' name='color' value='0'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[1]+";' class='checkbox_b' type='radio' name='color' value='1'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[2]+";' class='checkbox_b' type='radio' name='color' value='2'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[3]+";' class='checkbox_b' type='radio' name='color' value='3'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[4]+";' class='checkbox_b' type='radio' name='color' value='4'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[5]+";' class='checkbox_b' type='radio' name='color' value='5'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[6]+";' class='checkbox_b' type='radio' name='color' value='6'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[7]+";' class='checkbox_b' type='radio' name='color' value='7'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[8]+";' class='checkbox_b' type='radio' name='color' value='8'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[9]+";' class='checkbox_b' type='radio' name='color' value='9'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[10]+";' class='checkbox_b' type='radio' name='color' value='10'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[11]+";' class='checkbox_b' type='radio' name='color' value='11'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[12]+";' class='checkbox_b' type='radio' name='color' value='12'></td>"
		+"</tr></tbody></table></form><br><br><table class='big_button' width='256px' onclick='create_block()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Create block</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function create_block(){
    if(/^[\w\s]+$/i.test(block_id.value)){
        var color_chec= document.forms.color_chec;
        for(i=0;i<color_chec.length;i++){
            if(color_chec[i].checked){
            color_chec=color_bg[color_chec[i].value]
            break;}
        }
        var new_id=correct_name(block_id.value);
        if(new_id!=''&&!story_script[new_id]){
            if(Object.keys(story_script).length<=2){story_script.parameters.launch_story=new_id}
            story_script[new_id]=[];
            for(var i=0 ;i<Object.keys(story_script).length;i++){if(Object.keys(story_script)[i]==new_id){creation_block(i);break;}}
            new_id=document.getElementById(new_id)
            var rect=new_id.getBoundingClientRect();
            new_id.style.backgroundColor=color_chec;
            new_id.style.left=html.scrollLeft+((html.clientWidth/2)-(rect.width/2))+"px";
            new_id.style.top=html.scrollTop+((html.clientHeight/2)-(rect.height/2))+"px";
            new_id.style.animation="flash 2s 1";
            new_id.style.WebkitAnimation="flash 2s 1";
            control_dlock()
            toast("new block created");
            modal_window('close');
        }else if(story_script[new_id]){
            toast("this name is used by other blocks");
            modal_window('close');
        }else{
            toast("block id not entered");
            modal_window('close');
        }
        story_script.blocks[new_id.id]=[new_id.style.left,new_id.style.top,document.getElementById(new_id.id+"_content").style.display,new_id.style.backgroundColor]
        state_save();
    }else{toast('Only <b>latin</b> characters & numbers')}
}
function edit_block(id){
	var html="<div class='window' style='padding:24px 8px;width:360px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>New story block</p><hr>"
		+"<form id='color_chec' onsubmit='return false;updata_block(\""+id+"\");'><table style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody><tr><td style='width:50px' align='right'>block id </td><td align='left'><input id='block_id' class='input_text' type='text' value="+id+"></td></tr></tbody></table><br><p style=' margin-left:12px;' align='left'>color block</p><br><table style='border-spacing:4px;border-collapse:separate;'><tbody><tr>"
		+"<td align='center'><input style='background-color:"+color_bg[0]+";' class='checkbox_b' type='radio' name='color' value='0'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[1]+";' class='checkbox_b' type='radio' name='color' value='1'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[2]+";' class='checkbox_b' type='radio' name='color' value='2'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[3]+";' class='checkbox_b' type='radio' name='color' value='3'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[4]+";' class='checkbox_b' type='radio' name='color' value='4'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[5]+";' class='checkbox_b' type='radio' name='color' value='5'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[6]+";' class='checkbox_b' type='radio' name='color' value='6'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[7]+";' class='checkbox_b' type='radio' name='color' value='7'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[8]+";' class='checkbox_b' type='radio' name='color' value='8'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[9]+";' class='checkbox_b' type='radio' name='color' value='9'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[10]+";' class='checkbox_b' type='radio' name='color' value='10'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[11]+";' class='checkbox_b' type='radio' name='color' value='11'></td>"
		+"<td align='center'><input style='background-color:"+color_bg[12]+";' class='checkbox_b' type='radio' name='color' value='12'></td>"
		+"</tr></tbody></table></form><br><br><table class='big_button' width='256px' onclick='delet_block(\""+id+"\")'><tbody><tr><td width='42px' class='icon icon_del'></td><td align='center'>Delet block</td><td width='42px'></td></tr></tbody></table><br><table class='big_button' width='256px' onclick='updata_block(\""+id+"\")'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Update block</td><td width='42px'></td></tr></tbody></table> </div>";
    modal_window("open",html);
}
function delet_block(id){
	delete story_script[id];
    if(story_script.parameters.launch_story==id){
        for(i=0;i<color_chec.length;i++){
            if(Object.keys(story_script)[i]!='parameters'&&Object.keys(story_script)[i]!='blocks'){story_script.parameters.launch_story=Object.keys(story_script)[i];break;}
        }
    }
	update_novel();state_save();
	toast("block removed");
	modal_window ('close');
}
function updata_block(old_id){
    if(/^[\w\s]+$/i.test(block_id.value)){
        var color_chec= document.forms.color_chec;
        for(i=0;i<color_chec.length;i++){
            if(color_chec[i].checked){
            story_script.blocks[old_id][3]=color_bg[color_chec[i].value]
            document.getElementById(old_id).style.backgroundColor=color_bg[color_chec[i].value]
            break;}
        }
        var new_id=correct_name(block_id.value);
        if(old_id!=new_id&&!story_script[new_id]){
            var story_rename=JSON.stringify(story_script)
            new_novel();
            story_script=JSON.parse(story_rename.replace(new RegExp('"'+old_id+'"',"g"),'"'+new_id+'"'));
            parse_story();
            lines();
            toast("block updated");
        }else if(story_script[new_id]){toast("this name is used by other blocks");}
        modal_window ('close');
        state_save();
    }else{toast('Only <b>latin</b> characters & numbers')}
}
function file_catalog(id,files,area,preview,arr){
    var code,f,t,a;
    if(project_files.length==0){
        code="<div class='window' style='position:fixed;padding:24px 8px;width:360px;'><div><div class='window_close icon icon_close' onclick=\"menu_add.style.visibility='hidden';\"></div></div><p>Project folder/location</p><hr><br><div style='overflow-x:hidden;overflow-y:auto;width:100%;max-height:60vh;'>"
        +"<table style='width:100%;'><tbody><tr><td><input id='project_foler' onclick=\"load_new=true;json_file.click();menu_add.style.visibility='hidden';\" class='input_text' style='padding-top:10px;' type='text'></td><td onclick=\"load_new=true;json_file.click();menu_add.style.visibility='hidden';\" style='width:40px;cursor:pointer;' title='delet' class='icon icon_load'></td></tr></tbody></table><p class='text_tutorials_b select_tutorials'>"+texts.tutorials[3].en+"</p><br><br>"
        +"</div><br><br><table class='big_button' width='256px' onclick=\"menu_add.style.visibility='hidden';\"><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    }else{
        code='<div class="window" style="width:480px;position:fixed;"><table style="width:100%;"><tbody><tr>'
            +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" onclick="" width="52px"></td>'
            +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">File selection</td>'
            +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" title="update working folder" onclick="load_new=true;json_file.click();menu_add.style.visibility=\'hidden\';" width="52px" class="icon icon_load"></td>'
            +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" width="88px"><input type="text" class="search" id="search_file" onkeyup="search_file()" placeholder="search file"></td>'
            +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" onclick="menu_add.style.visibility=\'hidden\';" width="52px" class="icon icon_close"></td>'
            +'</tr><tr><td colspan="5"><div style="overflow-x:hidden;overflow-y:auto;max-height:80vh;"><table style="width:100%;"><tbody>'
        if(id.indexOf('artt')>-1){a=id.replace("artt","art")}
        else{a=''}
        if(files=='img'){
            files=['.jpg','.svg','.gif','.jpeg','.png','.webp','.apng','.bmp'];
            for(f=0;f<project_files.length;f++){
                for(t=0;t<files.length;t++){
                    if(project_files[f][0].indexOf(files[t])>-1){
                        code+='<tr><td class="add_el add_file" title="'+project_files[f][0]+'" style="height:64px;padding:4px;border-bottom:1px solid var(--cb);" onclick="'+((a.length>1)?a+'.src=\''+project_files[f][1]+'\';':'')+' '+arr+'=\''+project_files[f][0]+'\';'+area+'.value=\''+project_files[f][0]+'\';'+((preview!=0)?preview+'.style.backgroundImage=\'url('+project_files[f][1]+')\'':'')+';menu_add.style.visibility=\'hidden\';"><table style="height:64px;"><tbody><tr><td width="64px" height="64px" style=\'border-radius:8px;background-image:url(\"'+project_files[f][1]+'\");background-size:cover;background-repeat:no-repeat;background-position:center;\'></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                    }
                }
            }
        }else if(files=='audio'){
            files=['audio/mpeg'];
            for(f=0;f<project_files.length;f++){
                for(t=0;t< files.length;t++){
                    if(project_files[f][2].indexOf(files[t])>-1){
                        code+='<tr><td class="add_el add_file" title="'+project_files[f][0]+'" style="height:64px;padding:4px;border-bottom:1px solid var(--cb);" onclick="var n='+((id!='files_auio')?'add_audio(\''+project_files[f][0]+'\')':'\''+project_files[f][0]+'\'')+';'+arr+'=n;'+area+'.value=n;menu_add.style.visibility=\'hidden\';'+((preview=='update')?'update_novel();':'')+'"><table style="height:64px;"><tbody><tr><td width="40px" height="40px" class="icon_m icon_audio_play"></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                    }
                }
            }
        }else if(files=='video'){
            files=['video/mp4'];
            for(f=0;f<project_files.length;f++){
                for(t=0;t< files.length;t++){
                    if(project_files[f][2].indexOf(files[t])>-1){
                        code+='<tr><td class="add_el add_file" title="'+project_files[f][0]+'" style="height:64px;padding:4px;border-bottom:1px solid var(--cb);" onclick="'+arr+'=\''+project_files[f][0]+'\';'+area+'.value=\''+project_files[f][0]+'\';menu_add.style.visibility=\'hidden\';'+preview+'.innerHTML=preview_video(\''+project_files[f][0]+'\');"><table style="height:64px;"><tbody><tr><td width="40px" height="40px" class="icon_m icon_video"></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                    }
                }
            }
        }else{
            files=[files];
            for(f=0;f<project_files.length;f++){
                for(t=0;t<files.length;t++){
                    if(project_files[f][0].indexOf(files[t])>-1){
                        code+='<tr><td class="add_el add_file" title="'+project_files[f][0]+'" style="height:64px;padding:4px;border-bottom:1px solid var(--cb);" onclick="'+arr+'=\''+project_files[f][0]+'\';'+area+'.value=\''+project_files[f][0]+'\';menu_add.style.visibility=\'hidden\';"><table style="height:64px;"><tbody><tr><td width="40px" height="40px" class="icon_m icon_new"></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                    }
                }
            }
        }
        code+='</tbody></table></div></td></tr><tr><td colspan="5" style="border-radius:0 0 16px 16px;height:16px;"></td></tr></tbody></table></div>'
    }
    menu_file=document.getElementById('add_element');
    menu_file.innerHTML=code
    menu_file.style.visibility='visible';
}
function add_audio(d){
    if(!story_script.parameters.sounds){story_script.parameters.sounds={};}
    n=d.split("/")[d.split("/").length-1]
    if(!story_script.parameters.sounds[n]){story_script.parameters.sounds[n]=d}
    return n
}
function add_element_b(id,arr){
    var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Add to block \''+arr+'\'</td></tr>'
				+((buf[0]=='scene')?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\''+arr+'\';data_past();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_paste"></td><td>Paste scene</td></tr></tbody></table></td></tr>':'')
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scene_add(\''+arr+'\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_art"></td><td>Scene</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="'+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?'legacy_choice_add(\''+arr+'\')':'setup();set_menu(4);')+';menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_choice"></td><td>Legacy choice</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code,48)
}
function add_element_s(id,n){
    var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Add to scene '+n+'</td></tr>'
                +((buf[0]=='dialogs')?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_l=story_script[scen_data[0]];arr_n=scen_data[1];data_past();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_paste"></td><td>Paste dialog</td></tr></tbody></table></td></tr>':'')
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();state_save();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_textadd"></td><td>Add dialog</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="back_to";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_back"></td><td>back to</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="art";scen_editor(scen_data[0],scen_data[1],scen_data[2]);menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_art"></td><td>art</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="text";element_to();dialog_text_edit();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_text"></td><td>text</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'choice\';element_to();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_choice"></td><td>choice</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'video\';element_to();dialog_video_edit();"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_video"></td><td>video</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'sound_stop\';element_to();dialog_audio_edit(\''+id+'\');"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_off"></td><td>stop sound</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'sound\';element_to();dialog_audio_edit(\''+id+'\');"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_play"></td><td>play sound</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'timer\';element_to();state_save();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_timer"></td><td>timer</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\' '+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?'dialog_add();arr_l=arr_l[arr_n];arr_n="variables";element_to();':'setup();set_menu(4);')+' menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_var"></td><td>variables</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="go_to";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_goto"></td><td>go to</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="event";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_event"></td><td>event</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="controll";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_controll"></td><td>interface</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'html\';edit_html();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_html"></td><td>HTML code</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();copy_arr=arr_l[arr_n];edit_code(\'js\',\'JavaScript\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_js"></td><td>JavaScript code</td></tr></tbody></table></td></tr>'
                +((story_script.parameters.plugins)?((story_script.parameters.plugins.includes("show_toast"))?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'toast\';edit_toast();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_toast"></td><td>Toast</td></tr></tbody></table></td></tr>':''):'')
                +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
                +'</tbody></table></div>'
	menu_view(id,code,48)
}
function add_element_d(id,n){
    var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Add element to dialog '+n+'</td></tr>'
				+((buf[0]!='scene'&&buf[0]!='dialogs'&&buf[0]!='')?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_l=story_script[scen_data[0]][scen_data[1]].dialogs;arr_n=scen_data[2]-1;data_past();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_paste"></td><td>Paste '+buf[0]+'</td></tr></tbody></table></td></tr>':'')
                +((arr_l.back_to)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="back_to";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_back"></td><td>back to</td></tr></tbody></table></td></tr>')
				+((arr_l.art)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'scen_editor(scen_data[0],scen_data[1],scen_data[2]);menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_art"></td><td>art</td></tr></tbody></table></td></tr>')
                +((arr_l.text||arr_l.text_add)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="text";element_to();dialog_text_edit();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_text"></td><td>text</td></tr></tbody></table></td></tr>')
				+((arr_l.text||arr_l.text_add)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="text_add";element_to();dialog_text_edit();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_textadd"></td><td>text add</td></tr></tbody></table></td></tr>')
                +((arr_l.choice)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'choice\';element_to();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_choice"></td><td>choice</td></tr></tbody></table></td></tr>')
                +((arr_l.video)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="video";element_to();dialog_video_edit();\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_video"></td><td>video</td></tr></tbody></table></td></tr>')
                +((arr_l.sound_stop)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="sound_stop";element_to();dialog_audio_edit("'+id+'");\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_off"></td><td>stop sound</td></tr></tbody></table></td></tr>')
				+((arr_l.sound)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="sound";element_to();dialog_audio_edit("'+id+'");\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_play"></td><td>play sound</td></tr></tbody></table></td></tr>')
				+((arr_l.timer)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'timer\';element_to();state_save();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_timer"></td><td>timer</td></tr></tbody></table></td></tr>')
                +((arr_l.variables)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\' '+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?'arr_n="variables";element_to();':'setup();set_menu(4);')+' menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_var"></td><td>variables</td></tr></tbody></table></td></tr>')
                +((arr_l.go_to)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="go_to";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_goto"></td><td>go to</td></tr></tbody></table></td></tr>')
				+((arr_l.event)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="event";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_event"></td><td>event</td></tr></tbody></table></td></tr>')
				+((arr_l.controll)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="controll";element_to();state_save();menu_add.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_controll"></td><td>interface</td></tr></tbody></table></td></tr>')
				+((arr_l.html)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'html\';edit_html();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_html"></td><td>HTML code</td></tr></tbody></table></td></tr>')
				+((arr_l.js)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="copy_arr=arr_l;edit_code(\'js\',\'JavaScript\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_js"></td><td>JavaScript code</td></tr></tbody></table></td></tr>')
				+((story_script.parameters.plugins)?((!arr_l.toast&&story_script.parameters.plugins.includes("show_toast"))?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'toast\';edit_toast();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_toast"></td><td>Toast</td></tr></tbody></table></td></tr>':''):'')
                +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code,130)
}
function dialog_m(id,n,block,i){
	var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody>'
              +'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Dialog '+n+'</td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scen_editor(\''+block+'\','+i+','+n+');scen_edit_data();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_layout"></td><td>Scene edit</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="duplicat_arr();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copu"></td><td>Duplicate</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_copy(\'dialogs\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copy"></td><td>Copy dialog</td></tr></tbody></table></td></tr>'
              +((buf[0]!='scene'&&buf[0]!='dialogs'&&buf[0]!='')?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_past();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_paste"></td><td>Paste '+buf[0]+'</td></tr></tbody></table></td></tr>':'')
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="element_del();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
              +'</tbody></table></div>'
	menu_view(id,code,48)
}
function legacy_choice_m(id){
    var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Legacy choice</td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="legacy_choice_edit();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_copy(\'scene\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copy"></td><td>Copy scene</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="element_del();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code,48)
}
function scene_m(id,i,block){
    var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Scene '+i+'</td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scene_edit();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
				+((story_script[block][i-1].dialogs[0])?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scen_data[1]='+(i-1)+';scen_editor(\''+block+'\',scen_data[1],1);scen_edit_data();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_layout"></td><td>Scene edit</td></tr></tbody></table></td></tr>':'')
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="duplicat_arr();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copu"></td><td>Duplicate</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_copy(\'scene\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copy"></td><td>Copy scene</td></tr></tbody></table></td></tr>'
                +((buf[0]=='dialogs')?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_past();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_paste"></td><td>Paste dialog</td></tr></tbody></table></td></tr>':'')
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="element_del();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code,48)
}
function dialog_el(id,n,e){
    var code='<div class="add_w" style="width:220px;"><table style="width:100%;"><tbody><tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">'+n+'</td></tr>'
        if(e){
            if(arr_n=='html'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="edit_html();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='text'||arr_n=='text_add'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_text_edit();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='variables'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="variables_set_edit();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='toast'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="edit_toast();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='choice'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="edit_choice();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='sound'||arr_n=='sound_stop'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="menu_add.style.visibility=\'hidden\';dialog_audio_edit(\''+id+'\');"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='js'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="copy_arr=arr_l;edit_code(\'js\',\'JavaScript\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='art'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scen_editor(scen_data[0],scen_data[1],scen_data[2]);menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }else if(arr_n=='video'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_video_edit();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }
        }
        code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_copy(\''+arr_n+'\');menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copy"></td><td>Copy '+arr_n+'</td></tr></tbody></table></td></tr>'
        +((arr_n==buf[0])?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="data_past();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_refrash"></td><td>Replayce '+arr_n+'</td></tr></tbody></table></td></tr>':'')
        +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
        +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="delete arr_l.name;element_dialog_del();menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
        +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="menu_add.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
        +'</tbody></table></div>'
	menu_view(id,code,48)
}
function menu_view(id,code,top){
	var rect=document.getElementById(id).getBoundingClientRect();
	menu_add=document.getElementById('add_element');
    menu_add.style.visibility='visible';
	menu_add.innerHTML=code;
    menu_add.style.left=html.scrollLeft+rect.right+"px";
    menu_add.style.top=html.scrollTop+rect.top-top+"px";
}
function data_copy(name){buf[0]=name;buf[1]=JSON.stringify(arr_l[arr_n]);}
function data_past(){
    if(buf[0]=='dialogs'){
        arr_l[arr_n].dialogs.splice(arr_l[arr_n].dialogs.length,0,JSON.parse(buf[1]));
    } else if(buf[0]=='scene'){
        story_script[arr_n].push(JSON.parse(buf[1]));
    } else if(buf[0]==arr_n){
        arr_l[arr_n]=JSON.parse(buf[1]);
    } else {
        arr_l[arr_n][buf[0]]=JSON.parse(buf[1]);
    }
    update_novel();state_save();
}
function scene_add(arr){
	story_script[arr].push({"background_image":"","background_music":"","dialogs":[]});
	arr_l=story_script[arr]
	arr_n=story_script[arr].length-1
	scene_edit();
	update_novel();
}
function legacy_choice_add(arr){
	story_script[arr].push({"legacy_choice":[["","=",0,""],{"go_to":""}]});
	arr_n=story_script[arr].length-1
	arr_l=story_script[arr]
	legacy_choice_edit();
    state_save();
}
function option_var(d){
	var var_list='';
	if(story_script.parameters.variables){for(l=0;l<Object.keys(story_script.parameters.variables).length;l++){var_list+="<option value='"+Object.keys(story_script.parameters.variables)[l]+"' "+((d==Object.keys(story_script.parameters.variables)[l])?"selected" :"")+">"+Object.keys(story_script.parameters.variables)[l]+"</option>"}}
	return var_list
}
function project_languares(d){
	var lang='';
	for(l=0;l<story_script.parameters.languares.length;l++){lang+="<option value='"+story_script.parameters.languares[l]+"' "+((d==story_script.parameters.languares[l])?"selected":"")+">"+story_script.parameters.languares[l].toUpperCase()+"</option>"}
	return lang
}
function option_block(d,g){
	var scene_list="";
    if(g>=1){scene_list+="<option value='tue_no' "+((d=="tue_no")?"selected":"")+">None</option><optgroup label='Story blocks'><option value='tue_go' "+((d=="tue_go")?"selected":"")+">Next scene</option>"}else{scene_list+="<optgroup label='Story blocks'>"}
    for(var l=0;l<Object.keys(story_script).length;l++){if(Object.keys(story_script)[l]!="parameters"&&Object.keys(story_script)[l]!="blocks"){scene_list+="<option value='"+Object.keys(story_script)[l]+"' "+((d==Object.keys(story_script)[l])?"selected":"")+">"+Object.keys(story_script)[l]+"</option>"}}
    if(g>=2){scene_list+='</optgroup><optgroup label="System function">';
        for(var s=0;s<Object.keys(button_name).length;s++){
            var y=true
            if(g==2){for(var f=0;f<story_script.parameters.buttons.length;f++){
                if(story_script.parameters.buttons[f].name==Object.keys(button_name)[s]){y=false;break;}
            }}
            if(y){scene_list+="<option value='"+Object.keys(button_name)[s]+"' "+((d==Object.keys(button_name)[s])?"selected":"")+">"+button_name[Object.keys(button_name)[s]]+"</option>"}
        }
    }
    return scene_list+'</optgroup>'
}
function legacy_choice_edit(){
	var var_if="<table width='100%' id='legacy_choice_edit'><tbody>";
	for(var i=0;i<arr_l[arr_n].legacy_choice.length-1;i++){
		var_if +="<tr><td style='padding-right:4px;white-space:nowrap;' align='right'>"+((i==0)?"if {":"else if {")+"</td>"
		+"<td style='width:128px;' valign='bottom'><select class='input_text legacy_var'>"+option_var(arr_l[arr_n].legacy_choice[i][0])+"</select></td>"
		+"<td style='width:24px;border-right:1px solid var(--cb);border-left:1px solid var(--cb);' valign='bottom'><select class='input_text legacy_compare'><option value='&#61'>&#61</option><option value='&lt;'>&lt;</option><option value='&gt;'>&gt;</option></select></td>"
		+"<td style='width:64px;' valign='bottom'><input class='input_text legacy_value' value='"+arr_l[arr_n].legacy_choice[i][2]+"' type='text'></td>"
		+"<td style='width:92px;font-size:12px;' align='center' valign='center'>} go to block:</td>"
		+"<td style='width:128px;' valign='bottom'><select class='input_text legacy_block'>"+option_block(arr_l[arr_n].legacy_choice[i][3],0)+"</select></td>"
		+"<td style='width:40px;cursor:pointer;' onclick=\"var a=this.closest('tr');a.parentElement.removeChild(a);\" title='delet' class='icon icon_del'></td>"
		+"</tr>";
	}
	var_if+="</tbody><tbody><tr><td style='width:40px;'>else</td><td colspan='5'><select id='legacy_go_to' class='input_text'>"+option_block(arr_l[arr_n].legacy_choice[i].go_to,0)+"</select></td><td style='width:40px;'></td></tr></tbody></table><div aling='center' onclick=\"legacy_choice_new()\" class='icon icon_add' style='margin-top:16px;height:26px;width:26px;cursor:pointer;'></div>"
    var html="<div class='window' style='padding:24px 8px;min-width:512px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>legacy choice edit</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[0].en+"</p><br><div style='max-height:70vh;overflow-x:hidden;overflow-y:auto;'>"+var_if+"</div><br><table class='big_button' width='256px' onclick='legacy_choice_apply()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
	modal_window("open",html);
}
function legacy_choice_new(){
	var tbody=document.getElementById('legacy_choice_edit').getElementsByTagName('tbody')[0];
	var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    var td4=document.createElement("td");
    var td5=document.createElement("td");
    var td6=document.createElement("td");
    var td7=document.createElement("td");
	td1.innerHTML="else if {";
    td1.align="right";
	td1.style="padding-right:4px;white-space:nowrap;";
	td2.innerHTML="<select class='input_text legacy_var'>"+option_var()+"</select>";
	td2.setAttribute("valign","bottom");
	td3.innerHTML="<select class='input_text legacy_compare'><option value='&#61'>&#61</option><option value='&lt;'>&lt;</option><option value='&gt;'>&gt;</option></select>";
	td3.style="border-right:1px solid var(--cb);border-left:1px solid var(--cb);";
	td3.setAttribute("valign","bottom");
	td4.innerHTML="<input class='input_text legacy_value' value='' type='text'>";
	td4.setAttribute("valign","bottom");
	td5.innerHTML="} go to block:";
    td5.style="font-size:12px;";
	td5.setAttribute("valign","center");
	td5.setAttribute("align","center");
	td6.innerHTML="<select class='input_text legacy_block'>"+option_block(story_script.parameters.launch_story,0)+"</select>";
	td6.setAttribute("valign","bottom");
    td7.style="cursor:pointer;";
    td7.title="delet";
    td7.className="icon icon_del";
    td7.setAttribute("onclick","var a=this.closest('tr');a.parentElement.removeChild(a);");
	row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
	row.appendChild(td4);
    row.appendChild(td5);
    row.appendChild(td6);
    row.appendChild(td7);
    tbody.appendChild(row);
}
function legacy_choice_apply(){
    arr_l[arr_n].legacy_choice=[];
    li_v=document.getElementsByClassName("legacy_var");
    li_c=document.getElementsByClassName("legacy_compare");
    li_z=document.getElementsByClassName("legacy_value");
    li_b=document.getElementsByClassName("legacy_block");
    for(var i=0;i<li_v.length;i++){if(li_z[i].value){arr_l[arr_n].legacy_choice.push([li_v[i].value,li_c[i].value,parseInt(li_z[i].value),li_b[i].value])}}
	arr_l[arr_n].legacy_choice.push({"go_to":legacy_go_to.value})
	modal_window('close');
	update_novel();state_save();
}
function duplicat_arr(){arr_l.splice(arr_n,0,JSON.parse(JSON.stringify(arr_l[arr_n])));update_novel();state_save();}
function element_del(){arr_l.splice(arr_n,1);update_novel();state_save();}
function element_dialog_del(){delete arr_l[arr_n];update_novel();state_save();}
function dialog_add(){arr_l.push({});arr_n=arr_l.length-1;update_novel();}
function element_to(){
    if(arr_n=='go_to'||arr_n=='back_to'){arr_l[arr_n]=story_script.parameters.launch_story;}
    else if(arr_n=='event'){arr_l[arr_n]="event";}
    else if(arr_n=='controll'){arr_l[arr_n]="visible"}
    else if(arr_n=='variables'){arr_l[arr_n]=[[Object.keys(story_script.parameters.variables)[0], "add", 1]];variables_set_edit()}
    else if(arr_n=='choice'){arr_l.choice=[];edit_choice();}
    else if(arr_n=='text'){arr_l.text={};for(var i=0;i<story_script.parameters.languares.length;i++){arr_l.text[story_script.parameters.languares[i]]='';}}
    else if(arr_n=='text_add'){arr_l.text_add={};for(var i=0;i<story_script.parameters.languares.length;i++){arr_l.text_add[story_script.parameters.languares[i]]='';}}
    else if(arr_n=='sound'){arr_l[arr_n]=""}
    else if(arr_n=='video'){arr_l[arr_n]={"url":"","fit":"cover"}}
    else if(arr_n=='sound_stop'){arr_l[arr_n]=""}
    else if(arr_n=='timer'){arr_l[arr_n]=["3000",story_script.parameters.launch_story]}
	update_novel();
}
let copy_arr={};
function dialog_audio_edit(id){copy_arr=arr_l;file_catalog(id,'audio',id,'update','copy_arr[arr_n]');}
function preview_video(data){return "<div style='position:relative;overflow:hidden;width:356px;height:286px;border-radius:10px;background-color:var(--cw);'><video id='video_preview' muted loop onloadedmetadata='video_set();' style='transform:translate(-50%,-50%);position:absolute;top:50%;left:50%;"+((copy_arr[arr_n].fit=='contain'||copy_arr[arr_n].fit=='position')?'width:100%;height:100%;':'')+"'><source src='"+open_file(data)+"' type='video/mp4'></video></div>";}
function dialog_video_edit(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    if(!copy_arr[arr_n].url){copy_arr[arr_n].url=''}
    if(!copy_arr[arr_n].url[languare]){data_la(copy_arr[arr_n],'url')}
	var html="<div class='window' style='padding:24px 8px;width:640px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><p>Video</p><br><hr style='margin:0;'><br>"
	+"<table width='100%'><tbody><tr>"
        +"<td rowspan='8' width='356px' id='v_pv'>"+preview_video(open_file(languare_data(copy_arr[arr_n].url)))+"</td>"
        +"<td align='right' style='width:64px;height:28px;padding-right:8px;'>Video:</td>"
        +"<td style='width:40px;'><select id='video_la' class='input_text' onchange='v_pv.innerHTML=preview_video(copy_arr[arr_n].url[this.value]);video_url.value=copy_arr[arr_n].url[this.value];' style='height:28px;width:40px;border-left:1px solid var(--cb);border-right:1px solid var(--cb);'>"+project_languares(languare)+"</select></td>"
        +"<td><input id='video_url' class='input_text' style='height:28px;width:100%;' onchange='v_pv.innerHTML=preview_video(this.value);copy_arr[arr_n].url[video_la.value]=this.value;video_preview.volume=this.value;' value='"+((copy_arr[arr_n].url[languare].length>0)?copy_arr[arr_n].url[languare]:'')+"' type='text'></td>"
        +"<td class='icon icon_load' style='height:40px;width:40px;' onclick='file_catalog(\"video_url\",\"video\",\"video_url\",\"v_pv\",\"copy_arr[arr_n].url[video_la.value]\");'></td>"
    +"</tr><tr><td align='right' style='height:40px;padding-right:8px;'>Sound:</td>"
        +"<td colspan='2'><input id='video_sv' class='input_slider' oninput='video_st.value=this.value;' onchange='copy_arr[arr_n].sound=this.value;video_preview.volume=this.value/100' type='range' value='"+((copy_arr[arr_n].sound)?copy_arr[arr_n].sound:0)+"' min='0' max='100' step='0.1' style='width:100%;'></td>"
        +"<td style='height:40px;width:40px;' align='center'><input id='video_st' class='input_text' onchange='copy_arr[arr_n].sound=correct_value(this.value,true);video_preview.volume=this.value/100;video_sv.value=copy_arr[arr_n].sound;this.value=copy_arr[arr_n].sound;' style='height:28px;width:32px;' value='"+((copy_arr[arr_n].sound)?copy_arr[arr_n].sound:0)+"' type='text'></td>"
    +"</tr><tr><td align='right' style='height:40px;padding-right:8px;'>Size:</td>"
        +"<td colspan='2'><select onchange='copy_arr[arr_n].fit=this.value;v_pv.innerHTML=preview_video(copy_arr[arr_n].url[video_la.value]);video_set();' class='input_text'>"
            +"<option "+((copy_arr[arr_n].fit=='cover')?'selected':'')+" value='cover'>cover</option>"
            +"<option "+((copy_arr[arr_n].fit=='contain')?'selected':'')+" value='contain'>contain</option>"
            +"<option "+((copy_arr[arr_n].fit=='position')?'selected':'')+" value='position'>position</option>"
        +"</select></td>"
        +"<td style='height:40px;width:40px;'></td>"
	+"</tr><tr><td height='40px' align='right' style='height:40px;padding-right:8px;'>loop:</td>"
        +"<td colspan='2'><select onchange='copy_arr[arr_n].loop=((this.selectedIndex==1)?true:false);video_set();' class='input_text'>"
            +"<option "+((!copy_arr[arr_n].loop)?'selected':'')+">No</option>"
            +"<option "+((copy_arr[arr_n].loop)?'selected':'')+">Yes</option>"
        +"</select></td>"
        +"<td style='height:40px;width:40px;'></td>"
    +"</tr><tr><td height='40px' align='right' style='height:40px;padding-right:8px;'>autoplay:</td>"
        +"<td colspan='2'><select onchange='copy_arr[arr_n].stop=((this.selectedIndex==0)?true:false);video_set();' class='input_text'>"
            +"<option "+((copy_arr[arr_n].stop)?'selected':'')+">No</option>"
            +"<option "+((!copy_arr[arr_n].stop)?'selected':'')+">Yes</option>"
        +"</select></td>"
        +"<td style='height:40px;width:40px;'></td>"
	+"</tr><tr><td align='right' style='height:40px;padding-right:8px;'>time start:</td>"
        +"<td colspan='2'><input id='scene_class' class='input_text' onchange='copy_arr[arr_n].time_start=correct_value(this.value,true);video_set();this.value=copy_arr[arr_n].time_start;' style='height:28px;' value='"+((copy_arr[arr_n].time_start)?copy_arr[arr_n].time_start:'')+"' type='text'></td>"
        +"<td style='height:40px;width:40px;'></td>"
	+"</tr><tr><td align='right' style='height:40px;padding-right:8px;'>time end:</td>"
        +"<td colspan='2'><input id='scene_class' class='input_text' onchange='copy_arr[arr_n].time_end=correct_value(this.value,true);video_set();this.value=copy_arr[arr_n].time_end;' style='height:28px;' value='"+((copy_arr[arr_n].time_end)?copy_arr[arr_n].time_end:'')+"' type='text'></td>"
        +"<td style='height:40px;width:40px;'></td>"
	+"</tr><tr><td align='right' style='height:40px;padding-right:8px;'>go to</td>"
        +"<td colspan='2'><select class='input_text' onchange='copy_arr[arr_n].go_to=this.value;video_set()' style='width:100%;height:28px' oninput=''>"+option_block(copy_arr[arr_n].go_to,1)+"</select></td>"
        +"<td style='height:40px;width:40px;'></td>"
	+"</tr></tbody></table><br>"
	+"<table class='big_button' width='256px' onclick='dialog_video_apply();'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
    video_set();
}
function video_set(){
    if(copy_arr[arr_n].fit=='cover'||!copy_arr[arr_n].fit){
        if(video_preview.videoWidth>video_preview.videoHeight){video_preview.style.height='100%';video_preview.style.width='auto';}
        else{video_preview.style.height='auto';video_preview.style.width='100%';}
    }
    if(copy_arr[arr_n].fit=='position'){copy_arr[arr_n].size=[video_preview.videoWidth+'px',video_preview.videoHeight+'px'];copy_arr[arr_n].position=['0px',0,'0px',0]}
    if(copy_arr[arr_n].sound && copy_arr[arr_n].sound>0){
        video_preview.muted=false;
        video_preview.volume=copy_arr[arr_n].sound/100
    }else{video_preview.muted=true;}
    if(copy_arr[arr_n].time_start){video_preview.currentTime=copy_arr[arr_n].time_start}
    if(copy_arr[arr_n].time_end&&copy_arr[arr_n].time_end!=0){video_preview.ontimeupdate = function(){if(this.currentTime>=copy_arr[arr_n].time_end){this.currentTime=copy_arr[arr_n].time_start}};}
    if(!copy_arr[arr_n].stop||copy_arr[arr_n].stop!=true){video_preview.play();}else{video_preview.pause();}
}
function dialog_video_apply(){
    data_only(copy_arr[arr_n],'url');
    if(copy_arr[arr_n].time_start==''){delete copy_arr[arr_n].time_start}
    if(copy_arr[arr_n].go_to=='tue_no'){delete copy_arr[arr_n].go_to}
    if(copy_arr[arr_n].time_end==''){delete copy_arr[arr_n].time_end}
    if(copy_arr[arr_n].fit=='cover'){delete copy_arr[arr_n].fit}
    if(copy_arr[arr_n].stop!=true){delete copy_arr[arr_n].stop}
    if(copy_arr[arr_n].fit!='position'){delete copy_arr[arr_n].position;delete copy_arr[arr_n].size;}
    if(copy_arr[arr_n].sound==0){delete copy_arr[arr_n].sound}
    arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]))
    modal_window("close");state_save();
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2])}
    else{update_novel()}
}
function dialog_text_edit(){
	copy_arr=JSON.parse(JSON.stringify(arr_l));
    var n
	if(!copy_arr.name){copy_arr.name={}}
    if(story_script.parameters.characters&&story_script.parameters.characters[copy_arr.name]){n=story_script.parameters.characters[copy_arr.name]}
    if(!copy_arr[arr_n][languare]){data_la(copy_arr,arr_n)};
	var html="<div class='window' style='padding:24px 8px;width:90%;max-width:800px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Dialog text</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[1].en+"</p>"
	+"<table width='100%'><tbody><tr><td width='80px' align='center'>languare:</td>"
	+"<td width='40px'><select class='input_text' id='text_la' onchange='"+((n)?"name_text.value=((story_script.parameters.characters[copy_arr.name][this.value])?story_script.parameters.characters[copy_arr.name][this.value]:\"\")":"name_text.value=((copy_arr.name[this.value])?copy_arr.name[this.value]:\"\")")+";dialogtext.value=((copy_arr.text[this.value])?copy_arr.text[this.value]:\"\");text_hars.innerHTML=dialogtext.value.length' style='height:40px;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:0'>"+project_languares(languare)+"</select></td>"
	+"<td width='90px' align='center'>symbols:</td><td id='text_hars'>"+copy_arr[arr_n][languare].length+"</td><td></td></tr></tbody></table><table width='100%'><tbody><tr>"
	+"<td><textarea id='dialogtext' oninput='text_hars.innerHTML=this.value.length;copy_arr[arr_n][text_la.value]=this.value;' class='input_text' style='resize:none;padding:4px;-moz-box-sizing:border-box;box-sizing:border-box;height:calc(90vh - 256px);width:100%;border:1px solid var(--cb);'>"+((copy_arr[arr_n][languare].length>0)?copy_arr[arr_n][languare]:"")+"</textarea></td>"
	+"<td width='286px' valign='top'><div style='width:100%;height:calc(90vh - 256px);overflow-x:hidden;overflow-y:auto;'><table width='100%'><tbody>"
	+"<tr><td width='80px' height='40px' align='left' style='padding-left:8px;border-bottom:1px solid var(--cb);' colspan='3'>Settings text panel</td></tr>"
    +"<tr><td height='40px' align='right' style='padding-right:8px;'>Text color</td><td><input id='text_color' class='input_text' value='"+((copy_arr.color_text)?copy_arr.color_text:"")+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px;width:40px;' onclick='color_element(\"text_color\",text_color.value);'></td></tr>"
    +"<tr><td height='40px' align='right' style='padding-right:8px;'>Panel color</td><td><input id='p_color' class='input_text' value='"+((copy_arr.color)?copy_arr.color:"")+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px;width:40px;' onclick='color_element(\"p_color\",p_color.value);'></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>Style</td><td><input id='text_style' class='input_text' value='"+((copy_arr[arr_n].style)?copy_arr[arr_n].style:"")+"' type='text'></td><td></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>ClassName</td><td><input id='text_class' class='input_text' value='"+((copy_arr[arr_n].className)?copy_arr[arr_n].className:"")+"' type='text'></td><td></td></tr>"
	+"<tr><td height='28px' align='left' colspan='3'></td></tr>"
	+"<tr><td height='40px' align='left' style='padding-left:8px;border-bottom:1px solid var(--cb);' colspan='3'>Settings name panel</td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>Character name</td><td><input id='name_text' class='input_text' oninput='"+((n)?"story_script.parameters.characters[copy_arr.name][text_la.value]=this.value;":"copy_arr.name[text_la.value]=this.value;")+"' value='"+((n&&n[languare])?n[languare]:((copy_arr.name[languare])?copy_arr.name[languare]:""))+"' type='text'></td><td class='icon icon_char' style='cursor:pointer;' onclick='dialog_char();'></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>Style</td><td><input id='c_style' class='input_text' value='"+((n&&n.style)?n.style:((copy_arr.name.style)?copy_arr.name.style:""))+"' type='text'></td><td></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>ClassName</td><td><input id='c_class' class='input_text' value='"+((n&&n.className)?n.className:((copy_arr.name.className)?copy_arr.name.className:""))+"' type='text'></td><td></td></tr>"
    +"<tr><td height='40px' align='right' style='padding-right:8px;'>Text color</td><td><input id='t_color' class='input_text' value='"+((n&&n.color_text)?n.color_text:((copy_arr.name.color_text)?copy_arr.name.color_text:""))+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px;width:40px;' onclick='color_element(\"t_color\",t_color.value);'></td></tr>"
    +"<tr><td align='right' style='padding-right:8px;'>Panel color</td><td><input id='c_color' class='input_text' value='"+((n&&n.color)?n.color:((copy_arr.name.color_text)?copy_arr.name.color:""))+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px;width:40px;' onclick='color_element(\"c_color\",c_color.value);'></td></tr>"
    +"</tbody></table></div></td>"
	+"</tr></tbody></table><br><table class='big_button' width='256px' onclick='dialog_text_apply()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function dialog_char(){
    var code,f,t,a;
    code='<div class="window" style="width:480px;position:fixed;"><table style="width:100%;"><tbody><tr>'
        +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" onclick="" width="52px"></td>'
        +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Character selection</td>'
        +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" width="88px"><input type="text" class="search" id="search_file" onkeyup="search_file()" placeholder="search name"></td>'
        +'<td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center" onclick="menu_add.style.visibility=\'hidden\';" width="52px" class="icon icon_close"></td>'
        +'</tr><tr><td colspan="5"><div style="overflow-x:hidden;overflow-y:auto;max-height:80vh;"><table style="width:100%;"><tbody>'
        if(copy_arr.name&&copy_arr.name.length>0){code+='<tr><td class="add_el add_file" style="height:42px;padding:4px;border-bottom:1px solid var(--cb);" onclick="name_text.setAttribute(\'oninput\',\'copy_arr.name[text_la.value]=this.value;\');copy_arr.name={};dialog_char_update();menu_add.style.visibility=\'hidden\';"><table style="height:42px;"><tbody><tr><td class="icon icon_clear" width="42px"></td><td style="padding:0px 8px;">Clear</td></tr></tbody></table></td></tr>'}
    for(t=0;t<Object.keys(story_script.parameters.characters).length;t++){
        var p=story_script.parameters.characters[Object.keys(story_script.parameters.characters)[t]][languare]
        code+='<tr><td class="add_el add_file" title="'+((p)?p:'no translation ( '+Object.keys(story_script.parameters.characters)[t]+' )')+'" style="height:42px;padding:4px;border-bottom:1px solid var(--cb);" onclick="copy_arr.name=\''+Object.keys(story_script.parameters.characters)[t]+'\';dialog_char_update();menu_add.style.visibility=\'hidden\';"><table style="height:42px;"><tbody><tr><td class="icon icon_char" width="42px"></td><td style="padding:0px 8px;">'+((p)?p:'no translation ( '+Object.keys(story_script.parameters.characters)[t]+' )')+'</td></tr></tbody></table></td></tr>'
    }
    code+='</tbody></table></div></td></tr><tr><td colspan="5" style="border-radius:0 0 16px 16px;height:16px;"></td></tr></tbody></table></div>'
    menu_file=document.getElementById('add_element');
    menu_file.innerHTML=code
    menu_file.style.visibility='visible';
}
function dialog_char_update(){
    var arr_s=story_script.parameters.characters[copy_arr.name]
    name_text.value=(arr_s&&arr_s[languare])?arr_s[languare]:((copy_arr.name[languare])?copy_arr.name[languare]:"")
    c_class.value=(arr_s&&arr_s.className)?arr_s.className:'';
    t_color.value=(arr_s&&arr_s.color_text)?arr_s.style:'';
    c_style.value=(arr_s&&arr_s.style)?arr_s.style:'';
    c_color.value=(arr_s&&arr_s.color)?arr_s.color:'';
}
function dialog_text_apply(){
	if(text_style.value!=""){copy_arr[arr_n].style=text_style.value;}else{delete copy_arr[arr_n].style};
	if(text_class.value!=""){copy_arr[arr_n].className=text_class.value;}else{delete copy_arr[arr_n].className};
    if(text_color.value!=""){arr_l.color_text=text_color.value;}else{delete arr_l.color_text};
    if(p_color.value!=""){arr_l.color=p_color.value;}else{delete arr_l.color};
    data_only(copy_arr,arr_n);
    var arr_s=story_script.parameters.characters,n=0,l,c=0;
    if(copy_arr.name.length!=0&&!story_script.parameters.characters[copy_arr.name]){
        for(l=0;l<story_script.parameters.languares.length;l++){
            var z=copy_arr.name[story_script.parameters.languares[l]];
            if(z){c+=z.length;}
            if(z && z.length>0 && /^[\w\s]+$/i.test(z) ){n=correct_name(z);break;}
        }
        if(c>0){
            if(n==0){n='char'+Object.keys(arr_s).length}
            arr_s[n]=JSON.parse(JSON.stringify(copy_arr.name))
        } toast('Added new character '+n);
    }else if(copy_arr.name&&copy_arr.name.length!=0){n=copy_arr.name;};
    if(n){
        if(c_style.value!=""){arr_s[n].style=c_style.value;}else{delete arr_s[n].style}
        if(c_class.value!=""){arr_s[n].className=c_class.value;}else{delete arr_s[n].className}
        if(t_color.value!=""){arr_s[n].color_text=t_color.value;}else{delete arr_s[n].color_text};
        if(c_color.value!=""){arr_s[n].color=c_color.value;}else{delete arr_s[n].color};
        arr_l.name=n
    }
    if(Object.keys(copy_arr.name).length==0){delete arr_l.name}
	arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]));
	modal_window("close");state_save();
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2])}
    else{update_novel();}
}
function scene_edit(){
	copy_arr=JSON.parse(JSON.stringify(arr_l));
    if(!copy_arr[arr_n].background_image){copy_arr[arr_n].background_image=""}
    if(!copy_arr[arr_n].background_image[languare]){data_la(copy_arr[arr_n],'background_image')}
    var html="<div class='window' style='padding:24px 8px;width:640px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Settings scene</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[2].en+"</p><br><br>"
    +"<table width='100%' height='256px'><tbody><tr>"
    +"<td id='scene_bg_preview' rowspan='6' style='background-size:"+((copy_arr[arr_n].background_size)?copy_arr[arr_n].background_size:"cover")+";width:256px;border-radius:10px;background-image:url("+open_file((copy_arr[arr_n].background_image[languare])?copy_arr[arr_n].background_image[languare]:copy_arr[arr_n].background_image)+");background-color:"+((copy_arr[arr_n].background_color)?copy_arr[arr_n].background_color:"var(--cw)")+";background-repeat:no-repeat;background-position:center;'>&nbsp;</td>"
    +"<td align='right' style='width:50px;height:28px;padding-right:8px;'>Image:</td>"
    +"<td style='width:40px;'><select class='input_text' id='scene_la' onchange='scene_bg_preview.style.backgroundImage=\"url(\"+open_file(copy_arr[arr_n].background_image[this.value])+\")\";scene_bg_url.value=copy_arr[arr_n].background_image[this.value];' style='height:28px;width:40px;border-left:1px solid var(--cb);border-right:1px solid var(--cb);'>"+project_languares(languare)+"</select></td>"
    +"<td><input id='scene_bg_url' class='input_text' style='height:28px;width:100%;' oninput='copy_arr[arr_n].background_image[scene_la.value]=this.value;scene_bg_preview.style.backgroundImage=\"url(\"+open_file(copy_arr[arr_n].background_image[scene_la.value])+\")\";' value='"+((copy_arr[arr_n].background_image[languare].length>0)?copy_arr[arr_n].background_image[languare]:'&nbsp;')+"' type='text'></td>"
    +"<td id='files_img' class='icon icon_load' style='height:40px;width:40px;' onclick='file_catalog(\"scene_bg_url\",\"img\",\"scene_bg_url\",\"scene_bg_preview\",\"copy_arr[arr_n].background_image[scene_la.value]\")'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Music:</td>"
    +"<td colspan='2'><input id='scene_music' class='input_text' style='height:28px;' value='"+((copy_arr[arr_n].background_music)?copy_arr[arr_n].background_music:"")+"' type='text'></td>"
    +"<td id='files_auio' class='icon icon_load' style='height:40px;width:40px;' onclick='file_catalog(this.id,\"audio\",\"scene_music\",0,\"copy_arr[arr_n].background_music\")'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Color:</td>"
    +"<td colspan='2'><input id='scene_color' class='input_text' style='height:28px;' value='"+((copy_arr[arr_n].background_color)?copy_arr[arr_n].background_color:"")+"' type='text' onkeyup='scene_bg_preview.style.backgroundColor=this.value'></td>"
    +"<td class='icon icon_color' style='height:40px;width:40px;' onclick='color_element(\"scene_color\",\""+copy_arr[arr_n].background_color+"\")'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Size:</td>"
    +"<td colspan='2'><select id='scene_size' oninput='scene_bg_preview.style.backgroundSize=this.value' class='input_text'>"
        +"<option value='cover'>cover</option>"
        +"<option "+((copy_arr[arr_n].background_size=='contain')?'selected':'')+" value='contain'>contain</option>"
        +"<option "+((copy_arr[arr_n].background_size=='100% 100%')?'selected':'')+" value='100% 100%'>fill</option>"
    +"</select></td>"
    +"<td style='height:40px;width:40px;'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Class:</td>"
    +"<td colspan='2'><input id='scene_class' class='input_text' style='height:28px;' value='"+((copy_arr[arr_n].background_class)?copy_arr[arr_n].background_class:"")+"' type='text'></td>"
    +"<td style='height:40px;width:40px;'></td>"
    +"</tr><tr>"
    +"<td>&nbsp;</td>"
    +"<td colspan='3'>&nbsp;</td>"
    +"</tr></tbody></table><br>"
	+"<table class='big_button' width='256px' onclick='scene_edit_apply();'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function scene_edit_apply(){
	if(copy_arr[arr_n].background_image){
        data_only(copy_arr[arr_n],'background_image');
        if(copy_arr[arr_n].background_image){arr_l[arr_n].background_image=JSON.parse(JSON.stringify(copy_arr[arr_n].background_image))}
    }
	if(scene_music.value!=""){arr_l[arr_n].background_music=scene_music.value;}else{delete arr_l[arr_n].background_music};
    if(scene_color.value!=""){arr_l[arr_n].background_color=scene_color.value;}else{delete arr_l[arr_n].background_color};
    if(scene_class.value!=""){arr_l[arr_n].background_class=scene_class.value;}else{delete arr_l[arr_n].background_class};
    if(scene_size.value!="cover"){arr_l[arr_n].background_size=scene_size.value;}else{delete arr_l[arr_n].background_size};
    modal_window("close");state_save();
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2])}
    else{update_novel();}
}
function edit_html(){
    var html="<div class='window' style='padding:0px 2px 16px 0px;width:75vw;'>"
    +"<table style='width:100%;'><tbody><tr>"
    +"<td style='width:168px;'></td>"
    +"<td align='center'>HTML code edit</td>"
    +"<td style='width:88px;'><input id='search_edit' type='text' class='search' style='height:40px;width:100%;' placeholder='search text'></td>"
    +"<td class='icon icon_search' style='width:60px;' onclick='search_text(\"editHtml\",search_edit.value)'></td>"
    +"<td class='icon icon_close' style='width:40px;' onclick='modal_window(\"close\")'></td>"
    +"</tr></tbody></table>"
    +"<p><textarea id='editHtml' rows='12' class='input_text' wrap='off' style='font-family:monospace;resize:none;padding-left:0px;height:calc(90vh - 128px);width:100%;border:1px solid var(--cb);'>"+((arr_l[arr_n])?arr_l[arr_n]:'')+"</textarea></p><br><table class='big_button' width='256px' onclick='arr_l[arr_n]=editHtml.value;update_novel();state_save();modal_window(\"close\");menu_add.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_code(vol,n){
    var html="<div class='window' style='padding:0px 2px 16px 0px;width:75vw;'>"
    +"<table style='width:100%;'><tbody><tr>"
    +"<td style='width:168px;'></td>"
    +"<td align='center'>"+n+" code edit</td>"
    +"<td style='width:88px;'><input id='search_edit' type='text' class='search' style='height:40px;width:100%;' placeholder='search text'></td>"
    +"<td class='icon icon_search' style='width:60px;' onclick='search_text(\"editcode\",search_edit.value)'></td>"
    +"<td class='icon icon_close' style='width:40px;' onclick='modal_window(\"close\")'></td>"
    +"</tr></tbody></table>"
    +"<p><textarea id='editcode' rows='12' class='input_text' wrap='off' style='font-family:monospace;resize:none;padding-left:0px;height:calc(90vh - 128px);width:100%;border:1px solid var(--cb);'>"+((copy_arr[vol])?copy_arr[vol]:'')+"</textarea></p><br><table class='big_button' width='256px' onclick='copy_arr[\""+vol+"\"]=editcode.value;update_novel();state_save();modal_window(\"close\");menu_add.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_toast(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    if(!copy_arr[arr_n]){copy_arr[arr_n]=""}
    if(!copy_arr[arr_n][languare]){data_la(copy_arr,arr_n)}
    var toast_list="<table width='90%' id='var_toast' style='margin:10px 0 10px 0;'><tbody>";
    for(var l=0;l<story_script.parameters.languares.length;l++){toast_list+="<tr><td align='center' style='width:40px;'>"+story_script.parameters.languares[l]+"</td><td style='calc(100% - 40px)'><input class='addon_path input_text' oninput='copy_arr[arr_n]."+story_script.parameters.languares[l]+"=this.value;' value='"+copy_arr[arr_n][story_script.parameters.languares[l]]+"' type='text'></td></tr>";}
    toast_list+="</tbody></table>"
    var html="<div class='window' style='padding:24px 8px;width:512px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Toast edit</p><br><hr style='margin:0;'><div style='max-height:75vh;overflow-x:hidden;overflow-y:auto;'>"+toast_list+"</div><br><table class='big_button' width='256px' onclick='data_only(copy_arr,arr_n);arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]));update_novel();state_save();modal_window(\"close\");menu_add.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_choice(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    var choice_list="<table width='98%' id='var_choice' style='margin:10px 0 10px 0;'><tbody>";
        for(var l=0;l<copy_arr[arr_n].length;l++){
        if(!copy_arr[arr_n][l].text[languare]){data_la(copy_arr[arr_n][l],'text')}
        choice_list+="<tr><td style='width:32px;height:26px;'>Text</td><td valign='bottom' style='height:26px;width:28px;'><select id='chol"+l+"' class='input_text' onchange='cho"+l+".value=copy_arr."+arr_n+"["+l+"].text[this.value];' style='height:26px;width:30px;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);'>"+project_languares(languare)+"</select></td><td><input id='cho"+l+"' class='input_text' oninput='copy_arr."+arr_n+"["+l+"].text[chol"+l+".value]=this.value;' style='height:26px;' value='"+copy_arr[arr_n][l].text[languare]+"' type='text'></td><td style='width:64px;padding-right:8px;' align='right'>Position X</td><td style='width:48px;'><input class='input_text' style='height:26px;' oninput='copy_arr."+arr_n+"["+l+"].position[0]=this.value;' value='"+copy_arr[arr_n][l].position[0]+"' type='text'></td><td style='width:16px;' align='center'>Y</td><td style='width:48px;'><input class='input_text' oninput='copy_arr."+arr_n+"["+l+"].position[2]=this.value;' style='height:26px;' value='"+copy_arr[arr_n][l].position[2]+"' type='text'></td><td style='width:48px;' align='right'>go to:</td><td style='width:92px;'><select onchange='copy_arr."+arr_n+"["+l+"].go_to=this.value;' class='input_text'>"+option_block(copy_arr[arr_n][l].go_to,2)+"</select></td><td onclick='copy_arr."+arr_n+"["+l+"]={};var a=this.closest(\"tr\");a.parentElement.removeChild(a);' style='width:32px;cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"
    }
    choice_list+="</tbody></table>"
    var html="<div class='window' style='padding:24px 8px;width:568px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><p>Choice edit</p><br><hr style='margin:0;'><div style='max-height:70vh;overflow-x:hidden;overflow-y:auto;'>"+choice_list+"<div onclick=\"edit_choice_new()\" class='icon icon_add' style='margin-top:16px;height:26px;width:26px;cursor:pointer;'></div></div><br><br><table class='big_button' width='256px' onclick='for(var l=copy_arr[arr_n].length;l>=0;l--){if(!copy_arr[arr_n][l]||!copy_arr[arr_n][l].go_to){copy_arr[arr_n].splice(l,1);}else{data_only(copy_arr[arr_n][l],\"text\");}};arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]));update_novel();state_save();modal_window(\"close\");menu_add.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_choice_new(){
	var tbody=document.getElementById('var_choice').getElementsByTagName('tbody')[0];
    var l=copy_arr[arr_n].length;
    copy_arr[arr_n].push({"go_to":"tue_no","position":["50%","0","50%","0"],"size":[0,story_script.parameters.buttons[0].size[1]],"color":story_script.parameters.text_panel.color,"color_text":story_script.parameters.text_panel.color_text,"text":"button"});
    data_la(copy_arr[arr_n][l],'text')
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    var td4=document.createElement("td");
    var td5=document.createElement("td");
    var td6=document.createElement("td");
    var td7=document.createElement("td");
    var td8=document.createElement("td");
    var td9=document.createElement("td");
    var td10=document.createElement("td");
	td1.innerHTML="Text";
	td1.style="width:32px;height:26px;";
	td2.innerHTML="<select id='chol"+l+"' class='input_text choice_la' onchange='cho"+l+".value=copy_arr."+arr_n+"["+l+"].text[this.value];' style='height:26px;width:30px;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);'>"+project_languares(languare)+"</select>";
	td2.setAttribute("valign","bottom");
    td2.style="height:26px;width:28px;";
    td3.innerHTML="<input id='cho"+l+"' class='addon_path input_text' oninput='copy_arr."+arr_n+"["+l+"].text[chol"+l+".value]=this.value;' style='height:26px;' value='button' type='text'>";
    td4.innerHTML="Position X";
	td4.setAttribute("align","right");
    td4.style="width:64px;padding-right:8px;";
	td5.innerHTML="<input class='addon_path input_text' style='height:26px;' oninput='copy_arr."+arr_n+"["+l+"].position[0]=this.value;' value='50%' type='text'>";
	td5.setAttribute("valign","center");
    td5.style="height:26px;width:28px;";
    td6.innerHTML="Y";
	td6.setAttribute("align","center");
    td6.style="width:16px;";
    td7.innerHTML="<input class='addon_path input_text' style='height:26px;' oninput='copy_arr."+arr_n+"["+l+"].position[2]=this.value;' value='50%' type='text'>";
    td7.style="width:48px;";
    td8.innerHTML="go to:";
    td8.setAttribute("align","right");
    td8.style="width:48px;";
    td9.innerHTML="<select onchange='copy_arr."+arr_n+"["+l+"].go_to=this.value;' class='input_text'>"+option_block("tue_no",2)+"</select>";
    td9.style="width:92px;";
    td10.style="width:32px;cursor:pointer;";
    td10.title="delet";
    td10.className="icon icon_del";
    td10.setAttribute("onclick","copy_arr."+arr_n+"["+l+"]={};var a=this.closest('tr');a.parentElement.removeChild(a);");
	row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
	row.appendChild(td4);
    row.appendChild(td5);
    row.appendChild(td6);
    row.appendChild(td7);
    row.appendChild(td8);
    row.appendChild(td9);
    row.appendChild(td10);
    tbody.appendChild(row);
}
function scen_edit_data(){
    var arr_t=story_script.parameters.text_panel
    var arr_p=story_script.parameters.name_panel
    s_scene_audio_play.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].sound){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].sound=''};arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='sound';dialog_audio_edit('s_scene_audio_play');");
    s_scene_audio_off.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].sound_stop){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].sound_stop=''};arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='sound_stop';dialog_audio_edit('s_scene_audio_off');");
    s_scene_video.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].video){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].video={'url':'','fit':'cover'}};arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='video';dialog_video_edit();");
    s_scene_edit.setAttribute("onclick","arr_l=story_script['"+scen_data[0]+"'];arr_n="+scen_data[1]+";scene_edit();");
    s_scene_json.setAttribute("onclick","arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs;arr_n="+(scen_data[2]-1)+";jsonedit(true);");
    s_scene_text.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].text){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].text=''};arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='text';dialog_text_edit();");
    s_scene_html.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].html){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].html=''};arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='html';edit_html();");
    s_scene_var.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].variables  ){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].variables=[]}if(story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0){arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='variables';variables_set_edit();}else{setup();set_menu(4);}");
    s_scene_js.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].js){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].js=''};copy_arr=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];edit_code(\'js\',\'JavaScript\');");
    size_w.value=((arr_t.size[0])?arr_t.size[0]:"")
    size_h.value=((arr_t.size[1])?arr_t.size[1]:"")
    className.value=((arr_t.className)?arr_t.className:"")
    style.value=((arr_t.style)?arr_t.style:"")
    if(arr_t.position){
        position_l.value=((arr_t.position[0])?arr_t.position[0]:0)
        position_r.value=((arr_t.position[1])?arr_t.position[1]:0)
        position_t.value=((arr_t.position[2])?arr_t.position[2]:0)
    } if(arr_t.color){
        color_t.value=arr_t.color
        color_t_b.value=arr_t.color
        color_t_s.style.backgroundColor=arr_t.color
    }else{color_t.value=""}
    if(arr_t.color_text){
        color_text.value=arr_t.color_text
        color_text_b.value=arr_t.color_text
        color_text_s.style.backgroundColor=arr_t.color_text
    }else{color_text.value=""}
    indent_bottom.value=((arr_t.indent_bottom)?arr_t.indent_bottom:0)
    indent_text.value=arr_t.indent_text
    size_text.value=arr_t.size_text
    font_family.value=story_script.parameters.font
    dialog_speed.value=arr_t.dialog_speed
    n_size_w.value=((arr_p.size[0])?arr_p.size[0]:0)
    n_size_h.value=((arr_p.size[1])?arr_p.size[1]:0)
    if(arr_p.position){
        n_position_l.value=arr_p.position[0]
        n_position_r.value=arr_p.position[1]
        n_position_t.value=arr_p.position[2]
        n_position_b.value=arr_p.position[3]
    }
    n_className.value=((arr_p.className)?arr_p.className:"")
    n_style.value=((arr_p.style)?arr_p.style:"")
    n_indent_text.value=((arr_p.indent_text)?arr_p.indent_text:"")
    n_size_text.value=((arr_p.size_text)?arr_p.size_text:"")
    n_font_family.value=((arr_p.font_family)?arr_p.font_family:"")
    if(arr_p.color){
        n_color.value=arr_p.color
        n_color_b.value=arr_p.color
        n_color_s.style.backgroundColor=arr_p.color
    }else{n_color.value=""}
    if(arr_p.color_text){
        n_color_text.value=arr_p.color_text
        n_color_text_b.value=arr_p.color_text
        n_color_text_s.style.backgroundColor=arr_p.color_text
    }else{n_color_text.value=""}
}
function scen_edit_updare(show){
    var arr_t=story_script.parameters.text_panel
    var arr_p=story_script.parameters.name_panel
    if(document.getElementById('editcode')&&editcode.value!=""){style.value=(arr_t.style)?arr_t.style:''}
    else if(!style.value==""){arr_t.style=style.value}
    arr_t.size[0]=correct_value(size_w.value);
    arr_t.size[1]=correct_value(size_h.value);
    arr_t.className=className.value
    arr_t.dialog_speed=dialog_speed.value;
    arr_t.position=[correct_value(position_l.value),correct_value(position_r.value),correct_value(position_t.value)];
    arr_t.color_text=color_text.value
    arr_t.color=color_t.value
    arr_t.size_text=correct_value(size_text.value);
    arr_t.font_family=font_family.value
    arr_t.indent_text=((indent_text.value)?correct_value(indent_text.value):0);
    arr_t.indent_bottom=((indent_bottom.value)?correct_value(indent_bottom.value):0);
    arr_p.position=[correct_value(n_position_l.value),correct_value(n_position_r.value),correct_value(n_position_t.value),correct_value(n_position_b.value)];
    arr_p.indent_text=((n_indent_text.value)?correct_value(n_indent_text.value):0);
    arr_p.className=n_className.value
    if(document.getElementById('editcode')&&editcode.value!=""){n_style.value=(arr_p.style)?arr_p.style:''}
    else if(!n_style.value==""){arr_p.style=n_style.value}
    arr_p.size_text=correct_value(n_size_text.value)
    arr_p.font_family=n_font_family.value
    arr_p.size[0]=correct_value(n_size_w.value);
    arr_p.size[1]=correct_value(n_size_h.value);
    arr_p.color_text=n_color_text.value
    arr_p.color=n_color.value
    if(show){scen_editor(scen_data[0],scen_data[1],scen_data[2])}else{scen_element={};scen_editor_apply()}
}
var scene_scroll=false;
function scen_editor(block,i,n){
    var arr_s=story_script[block][i].dialogs[n-1]
    var arr_t=story_script.parameters.text_panel
    var arr_p=story_script.parameters.name_panel
    if(scen_data[2]<n){
        if(i>=story_script[block].length-1){i=story_script[block].length-1;}
        if(!arr_s){i+=1;n=1;}
        if(!story_script[block][i]||story_script[block][i].dialogs.length==0){i-=1;n=story_script[block][i].dialogs.length;toast('not scene')}
    }else if(scen_data[2]>n&&!arr_s&&story_script[block][i-1]){i-=1;n=story_script[block][i].dialogs.length;}else if(n<1){n=1;toast('not scene')}
    arr_s=story_script[block][i].dialogs[n-1];
    scen_data=[block,i,n];
    p_width.value=setup_editor.preview[0];
    ratio_screen.selectedIndex=setup_editor.preview[1];
    world.style.display="none";
    new_story_block.style.display="none";
    scene_maker.style.display="initial";
    scroll_block=true;
    scene_screen=true;
    scene_scroll=true;
    html.style.overflow="hidden"
    scrnr_title.innerHTML=block+" (scene:"+(i+1)+" | dialog:"+n+")"
    preview_size();
    scene_layout.style.backgroundImage='none';
    scene_layout.style.backgroundImage='url('+open_file(languare_data(story_script[block][i].background_image))+')';
    scene_layout.style.backgroundSize=((!story_script[block][i].background_size)?"cover":story_script[block][i].background_size);
    scene_layout.style.backgroundColor=story_script[block][i].background_color;
    if(story_script[block][i].dialogs[n-1].video){
        var video=document.getElementById("scen_video");
        if(!video){video=document.createElement("video");}
        else{video.style.display="block";}
        video.classList.add("tue_video");
        video.src=open_file(languare_data(story_script[block][i].dialogs[n-1].video.url))
        video.style.position="absolute";
        video.style.left=0;
        video.style.top=0;
        video.style.left="50%";
        video.style.top="50%";
        video.style.transform='translate(-50%,-50%)';
        video.id='scen_video'
        video.setAttribute('onclick','');
        video.setAttribute('ondblclick','arr_l=story_script.'+block+'['+i+'].dialogs['+(n-1)+'];arr_n=\'video\';dialog_video_edit();');
        if(story_script[block][i].dialogs[n-1].video.fit){
            if(story_script[block][i].dialogs[n-1].video.fit=='contain'){
                video.style.width="100%";
                video.style.height="100%";
            }else if(story_script[block][i].dialogs[n-1].video.fit=='position'){
                video.setAttribute('onclick','objSelect(this.id);arr_e=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].video');
                video.setAttribute('ondblclick','');
                video.style.transform='none';
                if(story_script[block][i].dialogs[n-1].video.size){
                    video.style.width=story_script[block][i].dialogs[n-1].video.size[0];
                    video.style.height=story_script[block][i].dialogs[n-1].video.size[1];
                }
                if(story_script[block][i].dialogs[n-1].video.position){
                    if(story_script[block][i].dialogs[n-1].video.position[0]!=0){video.style.left=story_script[block][i].dialogs[n-1].video.position[0];}
                    if(story_script[block][i].dialogs[n-1].video.position[1]!=0){video.style.right=story_script[block][i].dialogs[n-1].video.position[1];}
                    if(story_script[block][i].dialogs[n-1].video.position[2]!=0){video.style.top=story_script[block][i].dialogs[n-1].video.position[2];}
                    if(story_script[block][i].dialogs[n-1].video.position[3]!=0){video.style.bottom=story_script[block][i].dialogs[n-1].video.position[3];}
                }
            }else if(story_script[block][i].dialogs[n-1].video.fit=='cover'){tue_video;video.setAttribute('onloadedmetadata','video_size();');}
        }else{video.setAttribute('onloadedmetadata','video_size();');}
        if(story_script[block][i].dialogs[n-1].video.sound&&story_script[block][i].dialogs[n-1].video.sound>0){
            video.muted=false;
            video.volume=story_script[block][i].dialogs[n-1].video.sound/100
        }else{video.muted=true;}
        video.loop=true;
        if(!story_script[block][i].dialogs[n-1].video.stop||story_script[block][i].dialogs[n-1].video.stop!=true){video.autoplay=true;video.play();}
        if(story_script[block][i].dialogs[n-1].video.time_start){video.onloadedmetadata = function() { this.currentTime=story_script[block][i].dialogs[n-1].video.time_start;if(!story_script[block][i].dialogs[n-1].video.fit||story_script[block][i].dialogs[n-1].video.fit=='cover'){video_size();}if(story_script[block][i].dialogs[n-1].video.stop){this.pause();}};}
        if(story_script[block][i].dialogs[n-1].video.time_end && story_script[block][i].dialogs[n-1].video.time_end!=0){video.ontimeupdate = function(){if(this.currentTime>=story_script[block][i].dialogs[n-1].video.time_end){this.currentTime=story_script[block][i].dialogs[n-1].video.time_start}};}
        scene_layout.appendChild(video);
        
    }else if(document.getElementById("scen_video")){scen_video.style.display="none";}
    if(story_script[block][i].dialogs[n-1]){
        if(story_script[block][i].dialogs[n-1].text&&(typeof story_script[block][i].dialogs[n-1].text!=='object'||(story_script[block][i].dialogs[n-1].text[languare]&&typeof story_script[block][i].dialogs[n-1].text[languare]!=='object'))){
            if(arr_t.style){tue_text_block.style=arr_t.style;}else{tue_text_block.style=null};
            tue_text_block.style.visibility='visible';
            tue_text_element.style.position="relative";
            if(arr_t.className){tue_text_block.className=arr_t.className;}else{tue_text_block.className=""};
            tue_text_block.style.position="absolute";
            tue_text_block.style.margin="auto";
            tue_text_block.style.borderCollapse="separate";
            if(arr_t.size){
                tue_text_block.style.width=arr_t.size[0];
                tue_text_block.style.height=arr_t.size[1];
            }
            if(arr_t.position){
                tue_text_block.style.left=(arr_t.position[0]!=0)?arr_t.position[0]:"0";
                tue_text_block.style.right=(arr_t.position[1]!=0)?arr_t.position[1]:"0";
                if(arr_t.position[2]!=0){tue_text_block.style.top=arr_t.position[2];}
                if(arr_t.position[3]!=0){tue_text_block.style.bottom=arr_t.position[3];}
            }else{
                tue_text_block.style.left="0";
                tue_text_block.style.right="0";
            }
            tue_text_block.style.bottom=arr_t.indent_bottom;
            tue_text_block.style.zIndex="1000";
            tue_text_block.style.borderSpacing="0";
            tue_text_block.style.zIndex=1998;
            tue_text_view=document.getElementById("tue_text_view");
            tue_text_view.style.padding=arr_t.indent_text;
            tue_text_view.style.fontSize=((arr_t.size_text)?arr_t.size_text:story_script.parameters.font_size);
            tue_text_view.style.fontFamily=((arr_t.font_family)?arr_t.font_family:story_script.parameters.font);
            tue_text_view.style.height="100%";
            tue_text_view.innerHTML=languare_data(story_script[block][i].dialogs[n-1].text);
            if(story_script[block][i].dialogs[n-1].name&&arr_p){
                if(arr_p.className){tue_name_block.className=arr_p.className;}else{tue_name_block.className=""};
                if(arr_p.style){tue_name_block.style=arr_p.style;}else if(story_script.parameters.characters[story_script[block][i].dialogs[n-1].name] && story_script.parameters.characters[story_script[block][i].dialogs[n-1].name].style){tue_name_block.style=story_script.parameters.characters[story_script[block][i].dialogs[n-1].name].style}else{tue_name_block.style=null};
                if(story_script.parameters.characters[story_script[block][i].dialogs[n-1].name] && story_script.parameters.characters[story_script[block][i].dialogs[n-1].name].color){tue_name_block.style.backgroundColor=story_script.parameters.characters[story_script[block][i].dialogs[n-1].name].color}else if(arr_p.color){tue_name_block.style.backgroundColor=arr_p.color}else{tue_name_block.style.backgroundColor=null};
                if(story_script.parameters.characters[story_script[block][i].dialogs[n-1].name] && story_script.parameters.characters[story_script[block][i].dialogs[n-1].name].color_text){tue_name_block.style.color=story_script.parameters.characters[story_script[block][i].dialogs[n-1].name].color_text}else if(arr_p.color_text){tue_name_block.style.color=arr_p.color_text}else{tue_name_block.style.color=null};
                tue_name_block.style.position="absolute";
                tue_name_block.style.padding=arr_p.indent_text;
                tue_name_block.style.fontSize=((arr_p.size_text)?arr_p.size_text:story_script.parameters.font_size);
                tue_name_block.style.fontFamily=((arr_p.font_family)?arr_p.font_family:story_script.parameters.font);
                tue_name_block.style.textAlign="center";
                if(tue_name_block.style.width=arr_p.size[0]!=0){tue_name_block.style.width=arr_p.size[0];}
                tue_name_block.style.height=arr_p.size[1];
                tue_name_block.style.lineHeight=arr_p.size[1];
                tue_name_block.style.left=arr_p.position[0];
                tue_name_block.style.right=arr_p.position[1];
                tue_name_block.style.top=arr_p.position[2];
                tue_name_block.style.bottom=arr_p.position[3];
                tue_name_block.innerHTML=((story_script.parameters.characters && story_script.parameters.characters[story_script[block][i].dialogs[n-1].name])  ?  languare_data(story_script.parameters.characters[story_script[block][i].dialogs[n-1].name])  :  languare_data(story_script[block][i].dialogs[n-1].name) );
                tue_name_block.style.visibility='visible';
            }else{tue_name_block.style.visibility='hidden';}
            if(arr_s.color){tue_text_block.style.backgroundColor=arr_s.color;}else if(arr_t.color){tue_text_block.style.backgroundColor=arr_t.color;}
            if(arr_s.color_text){tue_text_block.style.color=arr_s.color_text;}else if(arr_t.color_text){tue_text_block.style.color=arr_t.color_text;}
            bg_art(arr_p,'tue_name_block');
            bg_art(arr_t,'tue_text_block');
            function bg_art(arr_u,tue_id){
                tue_id=document.getElementById(tue_id);
                tue_id.style.backgroundRepeat="no-repeat";
                tue_id.style.backgroundPosition="center";
                if(arr_u.art){tue_id.style.backgroundImage="url('"+open_file((arr_u.art[languare])?arr_u.art[languare]:arr_u.art)+"')";}
                if(arr_u.art_size){
                    if(arr_u.art_size=='patch'){tue_id.style.backgroundImage='none'}else if(arr_u.patch){delete arr_u.patch}
                    if(typeof arr_u.art_size==='object'){tue_id.style.backgroundSize=arr_u.art_size[0]+" "+arr_u.art_size[1];}
                    else if(arr_u.art_size=='patch'){
                        if(!arr_u.patch){arr_u.patch=[8,8,8,8]};
                        tue_id.style.backgroundImage="none";
                        tue_id.style.backgroundSize="none";
                        tue_id.style.backgroundClip="padding-box";
                        tue_id.style.borderStyle="solid";
                        tue_id.style.borderWidth=arr_u.patch[0]+"px "+arr_u.patch[1]+"px "+arr_u.patch[2]+"px "+arr_u.patch[3]+"px";
                        tue_id.style.borderImage="url('"+open_file((arr_u.art[languare])?arr_u.art[languare]:arr_u.art)+"') "+arr_u.patch[0]+" "+arr_u.patch[1]+" "+arr_u.patch[2]+" "+arr_u.patch[3]+" stretch stretch";
                    }else{tue_id.style.backgroundSize=arr_u.art_size;}
                }
            }
            tue_text_block.setAttribute("ondblclick","s_scene_text.onclick();");
        }else{tue_text_block.style.visibility='hidden';tue_name_block.style.visibility='hidden';}
        panel_art('anp_edit');panel_art('atp_edit');button_panel_update();
        if(story_script[block][i].dialogs[n-1].art){art_panel_update(block,i,n);}else{arts_ec.innerHTML="";var tue_art=document.getElementsByClassName("tue_art");while(tue_art.length){scene_layout.removeChild(tue_art[0]);}}
        add_art.setAttribute('onclick','art_panel_add("'+block+'",'+i+','+n+')');
        if(story_script[block][i].dialogs[n-1].choice){choice_panel_update(block,i,n);}else{choice_ec.innerHTML="";var tue_choice=document.getElementsByClassName("tue_choice");while(tue_choice.length){scene_layout.removeChild(tue_choice[0]);}}
        add_choice.setAttribute('onclick','choice_panel_add("'+block+'",'+i+','+n+')');
        var html_show=document.getElementsByClassName("tue_html_dialog");
        while(html_show.length){scene_layout.removeChild(html_show[0]);}
        if(story_script[block][i].dialogs[n-1].html){
            if(arr_s.html[languare]){
                html_show=document.createElement("div");
                html_show.className='tue_html_dialog';
                html_show.innerHTML=arr_dialog.html[languare];
                scene_layout.appendChild(html_show);
            }else{
                html_show=document.createElement("div");
                html_show.className='tue_html_dialog';
                html_show.innerHTML=arr_s.html;
                scene_layout.appendChild(html_show);
            }
        }
    }
}
function video_size(){
    if(scen_video && (!story_script[scen_data[0]][scen_data[1]].dialogs[(scen_data[2]-1)].video.fit||story_script[scen_data[0]][scen_data[1]].dialogs[(scen_data[2]-1)].video.fit=='cover')){
        var tue_size=scene_layout.getBoundingClientRect();
        if(tue_size.width<tue_size.height){
            if(scen_video.videoWidth>=scen_video.videoHeight){scen_video.style.height='100%';scen_video.style.width='auto';}
            else{scen_video.style.height='auto';scen_video.style.width='100%';}
        }else{
            if(scen_video.videoWidth>=scen_video.videoHeight){scen_video.style.height='auto';scen_video.style.width='100%';}
            else{scen_video.style.height='100%';scen_video.style.width='auto';}
        }
    }
}
function panel_art(id){
    var arr_s,arr_t,tbody=document.getElementById(id);
    if(id=='atp_edit'){arr_s=story_script.parameters.text_panel;arr_t='story_script.parameters.text_panel'}
    else if(id=='anp_edit'){arr_s=story_script.parameters.name_panel;arr_t='story_script.parameters.name_panel'}
    if(!arr_s.art){arr_s.art="";}
    data_la(arr_s,'art');
    if(!arr_s.art_size){arr_s.art_size=' '}
    tbody.innerHTML='<tr><td height="40px" align="right" style="padding-right:8px;">Art</td>'
        +'<td style="width:28px;" align="center"><select id="la'+id+'" class="input_text" onchange="lat'+id+'.value='+arr_t+'.art[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td><input id="lat'+id+'" class="input_text" onchange="var v=document.getElementById(\'la'+id+'\');'+arr_t+'.art[v.value]=this.value;scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art[languare]&&arr_s.art[languare].length>0)?arr_s.art[languare]:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick=\'file_catalog("lat'+id+'","img","lat'+id+'","'+((id=='atp_edit')?'tue_text_block':'tue_name_block')+'","'+arr_t+'.art[la'+id+'.value]")\'></td>'
    +'<tr></tr><td height="40px" align="right" style="padding-right:8px;">Size</td>'
    +'<td colspan="3"><select oninput="'+arr_t+'.art_size=this.value;scen_edit_updare(true);" class="input_text">'
        +'<option value=" ">none</option>'
        +'<option '+((arr_s.art_size=='cover')?'selected':'')+' value="cover">cover</option>'
        +'<option '+((arr_s.art_size=='contain')?'selected':'')+' value="contain">contain</option>'
        +'<option '+((arr_s.art_size=='100% 100%')?'selected':'')+' value="100% 100%">fill</option>'
        +'<option '+((arr_s.art_size=='patch')?'selected':'')+' value="patch">9-patch</option>'
    +'</select></td></tr>'
    if(!arr_s.art_size||arr_s.art_size==' '||typeof arr_s.art_size==='object'){
        if(arr_s.art_size==' '){delete arr_s.art_size};
        tbody.innerHTML+='<tr><td height="40px" align="right" style="padding-right:8px;">Width art</td>'
            +'<td colspan="3"><input class="input_text" onchange="if(!'+arr_t+'.art_size){'+arr_t+'.art_size=[correct_value(this.value),\'auto\']};'+arr_t+'.art_size[0]=correct_value(this.value);scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art_size)?arr_s.art_size[0]:'')+'"></td>'
        +'</tr><tr><td height="40px" align="right" style="padding-right:8px;">Height art</td>'
            +'<td colspan="3"><input class="input_text" onchange="if(!'+arr_t+'.art_size){'+arr_t+'.art_size=[\'auto\',correct_value(this.value)]};'+arr_t+'.art_size[1]=correct_value(this.value);scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art_size)?arr_s.art_size[1]:'')+'"></td>'
    }else if(arr_s.art_size=='patch'){
        if(!arr_s.patch){arr_s.patch=[8,8,8,8]};
        tbody.innerHTML+='</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Top border</td>'
            +'<td colspan="3"><input class="input_text" onchange="'+arr_t+'.patch[0]=parseInt(correct_value(this.value,true));scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art_size)?arr_s.patch[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Left border</td>'
            +'<td colspan="3"><input class="input_text" onchange="'+arr_t+'.patch[3]=parseInt(correct_value(this.value,true));scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art_size)?arr_s.patch[3]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Right border</td>'
            +'<td colspan="3"><input class="input_text" onchange="'+arr_t+'.patch[1]=parseInt(correct_value(this.value,true));scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art_size)?arr_s.patch[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Bottom border</td>'
            +'<td colspan="3"><input class="input_text" onchange="'+arr_t+'.patch[2]=parseInt(correct_value(this.value,true));scen_edit_updare(true);" type="text" style="width:100%;height:28px" value="'+((arr_s.art_size)?arr_s.patch[2]:'')+'"></td>'
    }
}
function art_panel_update(block,i,n){
    droppFocus();
    arts_ec.innerHTML=""
    var arr_s=story_script[block][i].dialogs[n-1]
    var tue_art=document.getElementsByClassName("tue_art");
    while(tue_art.length){scene_layout.removeChild(tue_art[0]);}
    if(arr_s.art.length==0){delete story_script[block][i].dialogs[n-1].art}
    else{for(var b=0;b<arr_s.art.length;b++){
        if(!arr_s.art[b].url[languare]){data_corr(arr_s.art[b],'url')}
        var art=document.createElement("img");
        art.id='art'+b
        art.setAttribute('draggable','false');
        art.setAttribute('onclick','objSelect(this.id);arr_e=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+']');
        art.src=(arr_s.art[b].url[languare])?open_file(arr_s.art[b].url[languare]):open_file(arr_s.art[b].url)
        art.classList.add("tue_art");
        art.style="user-select:text;"+((arr_s.art[b].style)?arr_s.art[b].style:"")
        art.style.position="absolute";
        art.style.zIndex=1001+b;
        if(arr_s.art[b].fit)art.style.objectFit=arr_s.art[b].fit;
        if(arr_s.art[b].size){
            art.style.width=arr_s.art[b].size[0];
            art.style.height=arr_s.art[b].size[1];
        }
        if(!arr_s.art[b].hotspot){arr_s.art[b].hotspot=['0%','0%']}
        art.style.transform="translate("+arr_s.art[b].hotspot[0]+","+arr_s.art[b].hotspot[1]+") "+((arr_s.art[b].angle)?"rotate("+arr_s.art[b].angle+"deg)":"")
        if(arr_s.art[b].position[0]!=0){art.style.left=arr_s.art[b].position[0];}
        if(arr_s.art[b].position[1]!=0){art.style.right=arr_s.art[b].position[1];}
        if(arr_s.art[b].position[2]!=0){art.style.top=arr_s.art[b].position[2];}
        if(arr_s.art[b].position[3]!=0){art.style.bottom=arr_s.art[b].position[3];}
        if(arr_s.art[b].opacity){art.style.opacity=arr_s.art[b].opacity;}
        scene_layout.appendChild(art);
        arts_ec.innerHTML+=art_panel_edit(block,i,n,b)
    }}
}
function art_panel_add(block,i,n){
    var arr_s=story_script[block][i].dialogs[n-1]
    if(!arr_s.art){arr_s.art=[]}
    arr_s.art.push({"position":["25%","0","25%","0"],"size":["auto","50%"],"url":"","fit":"contain"});
    b=arr_s.art.length-1;
    art_panel_update(block,i,n)
    file_catalog('artt'+b,'img','artt'+b,'artpre'+b,'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url');
    state_save();
}
function art_panel_edit(block,i,n,b){
    var arr_s=story_script[block][i].dialogs[n-1]
    var html='<div id="b_art'+b+'" class="ui_buttons dialog" style="margin:8px;"><table style="width:100%" ondblclick="objSelect(\'art'+b+'\');story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+']"><tbody><tr>'
            +'<td width="24px" class="icon_m icon_up"   onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art,'+b+',-1);art_panel_update(\''+block+'\','+i+','+n+');"height="22px"></td>'
            +'<td width="24px" class="icon_m icon_down" onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art,'+b+',1);art_panel_update(\''+block+'\','+i+','+n+');"></td><td>&nbsp;</td>'
            +'<td width="26px" class="icon_m icon_copu" onclick="var arr_d=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art;arr_d.splice('+b+',0,JSON.parse(JSON.stringify(arr_d['+b+'])));art_panel_update(\''+block+'\','+i+','+n+');"></td>'
            +'<td width="26px" class="icon icon_del" style="cursor:pointer;" onclick="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art.splice('+b+',1);state_save();art_panel_update(\''+block+'\','+i+','+n+');" ></td>'
    +'</tr><tr><td colspan="5" height="40px" align="center"><div id="artpre'+b+'" style="background-image:url('+((arr_s.art[b].url[languare])?open_file(arr_s.art[b].url[languare]):open_file(arr_s.art[b].url))+');background-position:center;background-repeat:no-repeat;background-size:contain;height:100%;width:100%";> </div></td></tr><tr>'
    +'<td class="icon_m icon_more" height="22px" onclick="block_open(\'artsp'+b+'\');scen_element.artsp'+b+'=artsp'+b+'.style.display;"></td><td colspan="2"></td></tr></tbody></table>'
    +'<table width="100%" id=artsp'+b+' style="display:'+((scen_element['artsp'+b])?scen_element['artsp'+b]:'none')+';border-top:1px solid var(--cb);margin-top:8px;"><tbody><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Art</td>'
        +'<td style="width:28px;" align="center"><select id="artl'+b+'" class="input_text" onchange="if(!story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[languare]){data_la(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'],\'url\')} ;artt'+b+'.value=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td ><input id="artt'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[artl'+b+'.value]=this.value;art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].url[languare])?arr_s.art[b].url[languare]:arr_s.art[b].url)+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'artt'+b+'\',\'img\',\'artt'+b+'\',\'artpre'+b+'\',\'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[artl'+b+'.value]\')"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Art width</td>'
        +'<td colspan="2"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].size[0]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+arr_s.art[b].size[0]+'"></td>'
        +'<td height="40px" align="right" rowspan="2"><input id="artp'+b+'" onchange="var f=(this.checked)?\'contain\':\'fill\';art'+b+'.style.objectFit=f;story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].fit=f;" type="checkbox" class="proportion_c" '+((arr_s.art[b].fit=='contain')?'checked':'')+'></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Art height</td>'
        +'<td colspan="2"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].size[1]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+arr_s.art[b].size[1]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Top position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[2]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+arr_s.art[b].position[2]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Left position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[0]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+arr_s.art[b].position[0]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Bottom position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[3]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+arr_s.art[b].position[3]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Right position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[1]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+arr_s.art[b].position[1]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Opacity</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].opacity=correct_value(this.value,true);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].opacity)?arr_s.art[b].opacity:1)+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">HotSpot X</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].hotspot[0]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].hotspot)?arr_s.art[b].hotspot[0]:0)+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">HotSpot Y</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].hotspot[1]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].hotspot)?arr_s.art[b].hotspot[1]:0)+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Angle</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].angle=correct_value(this.value,true);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].angle)?arr_s.art[b].angle:0)+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Time transform</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].move=correct_value(this.value,true);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].move)?arr_s.art[b].move:0)+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Speed transform</td>'
        +'<td colspan="3"><select class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].speed=this.value;" style="width:100%;height:28px"><option value="ease" '+((arr_s.art[b].speed=='ease')?'selected':'')+'>ease</option><option value="linear" '+((arr_s.art[b].speed=='linear')?'selected':'')+'>linear</option><option value="ease-in" '+((arr_s.art[b].speed=='ease-in')?'selected':'')+'>ease-in</option><option value="ease-out" '+((arr_s.art[b].speed=='ease-out')?'selected':'')+'>ease-out</option><option value="ease-in-out" '+((arr_s.art[b].speed=='ease-in-out')?'selected':'')+'>ease-in-out</option></select></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Style CSS</td>'
        +'<td colspan="2"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].style=this.value;art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].style)?arr_s.art[b].style:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'];edit_code(\'style\',\'Style CSS\');"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Class Name</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].className=this.value;art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s.art[b].className)?arr_s.art[b].className:'')+'"></td>'
    +'</tr></tbody></table></div>'
    return html;
}
function choice_panel_update(block,i,n){
    droppFocus();
    choice_ec.innerHTML=""
    var arr_s=story_script[block][i].dialogs[n-1].choice
    var tue_choice=document.getElementsByClassName("tue_choice");
    while(tue_choice.length){scene_layout.removeChild(tue_choice[0]);}
    if(arr_s.length==0){delete story_script[block][i].dialogs[n-1].choice}
    else{for(var b=0;b<arr_s.length;b++){
        if(!arr_s[b].text){arr_s[b].text=''}
        if(!arr_s[b].text[languare]){data_corr(arr_s[b],'text')}
        if(!arr_s[b].art){arr_s[b].art=''}
        if(!arr_s[b].art[languare]){data_corr(arr_s[b],'art')}
        if(!arr_s[b].sound){arr_s[b].sound=''}
        if(!arr_s[b].sound[languare]){data_corr(arr_s[b],'sound')}
        var choice=document.createElement("div");
        choice.id='cho'+b
        choice.setAttribute('onclick','objSelect(this.id);arr_e=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+']');
        if(arr_s[b].className){choice.className=arr_s[b].className;}
        if(arr_s[b].style){choice.style=arr_s[b].style;}
        choice.classList.add("tue_choice");
        choice.style.position="absolute";
        choice.style.backgroundColor=arr_s[b].color;
        choice.style.backgroundRepeat="no-repeat";
        choice.style.backgroundPosition="center";
        if(arr_s[b].size){
            if(arr_s[b].size[0]!=0){choice.style.width=arr_s[b].size[0];}
            if(arr_s[b].size[1]!=0){choice.style.height=arr_s[b].size[1];}
        }
        if(!arr_s[b].hotspot){arr_s[b].hotspot=['0%','0%']}
        choice.style.transform="translate("+arr_s[b].hotspot[0]+","+arr_s[b].hotspot[1]+")"+((arr_s[b].angle)?" rotate("+arr_s[b].angle+"deg)":"")
        if(arr_s[b].art){choice.style.backgroundImage="url('"+open_file((arr_s[b].art[languare])?arr_s[b].art[languare]:arr_s[b].art)+"')";}
        if(arr_s[b].art_size){
            if(arr_s[b].art_size=='patch'){choice.style.backgroundImage='none'}else if(arr_s[b].patch){delete arr_s[b].patch}
            if(typeof arr_s[b].art_size==='object'){choice.style.backgroundSize=arr_s[b].art_size[0]+" "+arr_s[b].art_size[1];}
            else if(arr_s[b].art_size=='patch'){
                if(!arr_s[b].patch){arr_s[b].patch=[8,8,8,8]};
                choice.style.backgroundImage="none";
                choice.style.backgroundSize="none";
                choice.style.backgroundClip="padding-box";
                choice.style.borderStyle="solid";
                choice.style.borderWidth=arr_s[b].patch[0]+"px "+arr_s[b].patch[1]+"px "+arr_s[b].patch[2]+"px "+arr_s[b].patch[3]+"px";
                choice.style.borderImage="url('"+open_file((arr_s[b].art[languare])?arr_s[b].art[languare]:arr_s[b].art)+"') "+arr_s[b].patch[0]+" "+arr_s[b].patch[1]+" "+arr_s[b].patch[2]+" "+arr_s[b].patch[3]+" stretch stretch";
            }else{choice.style.backgroundSize=arr_s[b].art_size;}
        }
        if(arr_s[b].position[0]!=0){choice.style.left=arr_s[b].position[0];}
        if(arr_s[b].position[1]!=0){choice.style.right=arr_s[b].position[1];}
        if(arr_s[b].position[2]!=0){choice.style.top=arr_s[b].position[2];}
        if(arr_s[b].position[3]!=0){choice.style.bottom=arr_s[b].position[3];}
        choice.style.color=arr_s[b].color_text;
        choice.style.fontSize=((arr_s[b].size_text)?arr_s[b].size_text:story_script.parameters.font_size);
        choice.style.fontFamily=((arr_s[b].font_family)?arr_s[b].font_family:story_script.parameters.font_family);
        choice.style.zIndex=2001+b;
        choice.style.display="flex";
        choice.style.justifyContent=((arr_s[b].align)?arr_s[b].align[0]:"center");
        choice.style.alignItems=((arr_s[b].align)?arr_s[b].align[1]:"center");
        if(arr_s[b].text[languare]){
            choice.innerHTML=arr_s[b].text[languare];
            choice.style.padding=arr_s[b].indent_text;
        }
        scene_layout.appendChild(choice);
        choice_ec.innerHTML+=choice_panel_edit(block,i,n,b);
    }}
}
function choice_panel_add(block,i,n){
    var arr_s=story_script[block][i].dialogs[n-1]
    if(!arr_s.choice){arr_s.choice=[]}
    var a=arr_s.choice.length
    if(a>0){
        arr_s.choice.push(JSON.parse(JSON.stringify(arr_s.choice[a-1])))
        arr_s.choice[a].position=["50%","0","50%","0"];
        arr_s.choice[a].go_to=story_script.parameters.launch_story;
        arr_s.choice[a].text="button";
    }else{
        arr_s.choice.push({"go_to":story_script.parameters.launch_story,"position":["50%","0","50%","0"],"size":[0,story_script.parameters.buttons[0].size[1]],"color":story_script.parameters.text_panel.color,"color_text":story_script.parameters.text_panel.color_text,"text":"choice"});
    }
    b=arr_s.choice.length-1;
    choice_panel_update(block,i,n);
    state_save();
}
function choice_panel_edit(block,i,n,b){
    var arr_s=story_script[block][i].dialogs[n-1].choice
    var var_choice="<table id='var_table"+b+"' width='100%'><tbody><tr><td style='width:128px;' valign='bottom'></td><td style='width:48px;border-right:1px solid var(--cb);border-left:1px solid var(--cb);'></td><td></td><td style='width:30px;'></td></tr>"
    if(arr_s[b].variables){
        for(var c=0;c<arr_s[b].variables.length;c++){
            var_choice+="<tr><td valign='bottom'><select class='input_text choice_var_name' onchange='story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][0]=this.value'>"+option_var(arr_s[b].variables[c][0])+"</select></td><td style='border-right:1px solid var(--cb);border-left:1px solid var(--cb);'><select class='input_text choice_var_operation' onchange='story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][1]=this.value'><option value='add'>add</option><option value='set' "+((arr_s[b].variables[c][1]=="set")?"selected":"")+">set</option></select></td><td><input class='input_text choice_var_value' onchange='if(parseFloat(this.value)==this.value){story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][2]=parseFloat(this.value)} else {story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][2]=this.value}' value='"+ arr_s[b].variables[c][2] +"' type='text'></td><td onclick='story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables.splice("+c+", 1); var a=this.closest(\"tr\");a.parentElement.removeChild(a);' style='cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"
        };
    };
    var_choice+="</tbody></table>"+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?"<div onclick=\"if (!story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables){story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables=[]};story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables.push( ['"+Object.keys(story_script.parameters.variables)[0]+"','add',0] );choice_panel_update('"+block+"',"+i+","+n+");\" class='icon_m icon_add' style='margin-top:16px;height:26px;width:100%;cursor:pointer;'></div>":"<div onclick=\"setup();set_menu(4);\" class='icon_m icon_add' style='margin-top:16px;height:26px;width:100%;cursor:pointer;'></div>")
    var html='<div id="b_cho'+b+'" class="ui_buttons dialog" style="margin:8px;"><table style="width:100%" ondblclick="objSelect(\'cho'+b+'\');arr_e=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+']"><tbody><tr>'
            +'<td width="24px" class="icon_m icon_up"   onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice,'+b+',-1);choice_panel_update(\''+block+'\','+i+','+n+');"height="22px"></td>'
            +'<td width="24px" class="icon_m icon_down" onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice,'+b+', 1);choice_panel_update(\''+block+'\','+i+','+n+');"></td><td>&nbsp;</td>'
            +'<td width="26px" class="icon_m icon_copu" onclick="var arr_d=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice;arr_d.splice('+b+',0,JSON.parse(JSON.stringify(arr_d['+b+'])));choice_panel_update(\''+block+'\','+i+','+n+');"></td>'
            +'<td width="24px" class="icon icon_del" style="cursor:pointer;" onclick="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice.splice('+b+',1);state_save();choice_panel_update(\''+block+'\','+i+','+n+');" ></td>'
    +'</tr><tr><td id="chdbn'+b+'" colspan="4" height="40px" align="center" style="background-image:url('+open_file((arr_s[b].art[languare])?arr_s[b].art[languare]:arr_s[b].art)+');background-position:center;background-repeat:no-repeat;background-size:contain;">'+((arr_s[b].text[languare])?arr_s[b].text[languare]:((arr_s[b].text.length>0)?arr_s[b].text:arr_s[b].go_to))+'</td></tr><tr>'
    +'<td class="icon_m icon_more" height="22px" onclick="block_open(\'chosp'+b+'\');scen_element.chosp'+b+'=chosp'+b+'.style.display;"></td><td colspan="3"></td></tr></tbody></table>'
    +'<table id="chosp'+b+'" width="100%" style="display:'+((scen_element['chosp'+b])?scen_element['chosp'+b]:'none')+';border-top:1px solid var(--cb);margin-top:8px;"><tbody><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Go to</td>'
        +'<td colspan="3"><select class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].go_to=this.value;" style="width:100%;height:28px" oninput="chdbn'+b+'.innerHTML=((button_name[this.value])?button_name[this.value]:this.value)">'+option_block(arr_s[b].go_to,2)+'</select></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Text</td>'
        +'<td style="width:28px;" align="center"><select id="ts'+b+'" class="input_text" onchange="t'+b+'.value=((story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].text[this.value].length>0)?story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].text[this.value]:\'\')" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td colspan="2"><input id="t'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].text[ts'+b+'.value]=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].text[languare])?arr_s[b].text[languare]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Indent text</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].indent_text=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].indent_text)?arr_s[b].indent_text:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Align</td>'
        +'<td colspan="3" align="center">'
        +'<table style="background-color:var(--cw);border-radius:4px;"><tbody><tr>'
            +'<td><input class="icon icon_left align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'flex-start\',\'flex-start\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-start'&&arr_s[b].align[1]=='flex-start')?'checked':'')+' style="transform:scaleY(-1);"></td>'
            +'<td><input class="icon icon_cent align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'center\',\'flex-start\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='center'&&arr_s[b].align[1]=='flex-start')?'checked':'')+' style="transform:scaleY(-1);"></td>'
            +'<td><input class="icon icon_left align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'flex-end\',\'flex-start\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-end'&&arr_s[b].align[1]=='flex-start')?'checked':'')+' style="transform:scaleX(-1) scaleY(-1);"></td>'
        +'</tr><tr>'
            +'<td><input class="icon icon_left align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'flex-start\',\'center\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-start'&&arr_s[b].align[1]=='center')?'checked':'')+'></td>'
            +'<td><input class="icon icon_cent align" type="radio" name="align_c'+b+'" onchange="delete story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align;choice_panel_update(\''+block+'\','+i+','+n+');" '+((!arr_s[b].align)?'checked':'')+'></td>'
            +'<td><input class="icon icon_left align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'flex-end\',\'center\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-end'&&arr_s[b].align[1]=='center')?'checked':'')+' style="transform:scaleX(-1);"></td>'
        +'</tr><tr>'
            +'<td><input class="icon icon_left align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'flex-start\',\'flex-end\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-start'&&arr_s[b].align[1]=='flex-end')?'checked':'')+'></td>'
            +'<td><input class="icon icon_cent align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'center\',\'flex-end\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='center'&&arr_s[b].align[1]=='flex-end')?'checked':'')+'></td>'
            +'<td><input class="icon icon_left align" type="radio" name="align_c'+b+'" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].align=[\'flex-end\',\'flex-end\'];choice_panel_update(\''+block+'\','+i+','+n+');" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-end'&&arr_s[b].align[1]=='flex-end')?'checked':'')+' style="transform:scaleX(-1);"></td>'
        +'</tr></tbody></table>'
        +'</td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Style CSS</td>'
        +'<td colspan="2"><input class="input_text"  onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].style=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].style)?arr_s[b].style:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'];edit_code(\'style\',\'Style CSS\');"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Width size</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].size[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].size)?arr_s[b].size[0]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Height size</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].size[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].size)?arr_s[b].size[1]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Color</td>'
        +'<td style="width:28px;" align="center"><div class="show_color" style="background-color:'+arr_s[b].color+';"></div></td>'
        +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].color)?arr_s[b].color:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color=this.value;choice_panel_update(\''+block+'\','+i+','+n+');"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Color text</td>'
        +'<td style="width:28px;" align="center"><div class="show_color" style="background-color:'+arr_s[b].color_text+';"></div></td>'
        +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color_text=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].color_text)?arr_s[b].color_text:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color_text=this.value;choice_panel_update(\''+block+'\','+i+','+n+');"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Font size</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].size_text=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].size_text)?arr_s[b].size_text:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Font family</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].font_family=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].font_family)?arr_s[b].font_family:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Class Name</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].className=this.value;" type="text" style="width:100%;height:28px" value="'+((arr_s[b].className)?arr_s[b].className:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Top position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[2]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[2]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Left position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[0]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Bottom position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[3]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[3]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Right position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[1]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">HotSpot X</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].hotspot[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].hotspot)?arr_s[b].hotspot[0]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">HotSpot Y</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].hotspot[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].hotspot)?arr_s[b].hotspot[1]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Angle</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].angle=correct_value(this.value,true);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].angle)?arr_s[b].angle:0)+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Art</td>'
        +'<td style="width:28px;" align="center"><select id="as'+b+'" class="input_text" onchange="tt'+b+'.value=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td><input id="tt'+b+'" class="input_text" onchange="var v=document.getElementById(\'as'+b+'\');story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art[v.value]=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art[languare]&&arr_s[b].art[languare].length>0)?arr_s[b].art[languare]:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'tt'+b+'\',\'img\',\'tt'+b+'\',\'cho'+b+'\',\'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art[as'+b+'.value]\')"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Size</td>'
        +'<td colspan="3"><select oninput="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" class="input_text">'
            +'<option value="">none</option>'
            +'<option '+((arr_s[b].art_size=='cover')?'selected':'')+' value="cover">cover</option>'
            +'<option '+((arr_s[b].art_size=='contain')?'selected':'')+' value="contain">contain</option>'
            +'<option '+((arr_s[b].art_size=='100% 100%')?'selected':'')+' value="100% 100%">fill</option>'
            +'<option '+((arr_s[b].art_size=='patch')?'selected':'')+' value="patch">9-patch</option>'
        +'</select></td>'
    if(!arr_s[b].art_size||arr_s[b].art_size==''||typeof arr_s[b].art_size==='object'){
        if(arr_s[b].art_size==''){delete arr_s[b].art_size};
        html+='</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Width art</td>'
            +'<td colspan="3"><input class="input_text" onchange="if(!story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size){story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size=[correct_value(this.value),\'auto\']};story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].art_size[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Height art</td>'
            +'<td colspan="3"><input class="input_text" onchange="if(!story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size){story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size=[\'auto\',correct_value(this.value)]};story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].art_size[1]:'')+'"></td>'
    }else if(arr_s[b].art_size=='patch'){
        html+='</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Top border</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].patch[0]=parseInt(correct_value(this.value,true));choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Left border</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].patch[3]=parseInt(correct_value(this.value,true));choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[3]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Right border</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].patch[1]=parseInt(correct_value(this.value,true));choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Bottom border</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].patch[2]=parseInt(correct_value(this.value,true));choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[2]:'')+'"></td>'
    } html+='</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Sound</td>'
        +'<td style="width:28px;" align="center"><select id="sl'+b+'" class="input_text" onchange="st'+b+'.value=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].sound[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td><input id="st'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].sound[sl'+b+'.value]=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].sound[languare]&&arr_s[b].sound[languare].length>0)?arr_s[b].sound[languare]:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'st'+b+'\',\'audio\',\'st'+b+'\',\'update\',\'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].sound[sl'+b+'.value]\')"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">JavaScript</td>'
        +'<td colspan="2"><input id="js'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].js=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((arr_s[b].js)?arr_s[b].js:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'];edit_code(\'js\',\'JavaScript\');"></td>'
    +'</tr><tr>'
        +'<td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Variables</td>'
    +'</tr><tr>'
        +'<td colspan="4">'+var_choice+'</td>'
    +'</tr></tbody></table></div>'
    return html;
}
let button_name={
    'tue_back':'Back dialog',
    'tue_next':'Next dialog',
    'tue_home':'Start block',
    'tue_save':'Save stage',
    'tue_load':'Load stage',
    'tue_load_autosave':'Load autosave',
    'tue_fullScreen':'Full screen',
}
function button_panel_update(){
    droppFocus();
    interface_buttons_c.innerHTML=""
    var arr_s=story_script.parameters.buttons
    var clear_ui=document.getElementsByClassName("tue_controll");
    while(clear_ui.length){scene_layout.removeChild(clear_ui[0]);}
    for(var b=0;b<arr_s.length;b++){
        if(!arr_s[b].text){arr_s[b].text=''}
        if(!arr_s[b].text[languare]){data_corr(arr_s[b],'text')}
        if(!arr_s[b].art){arr_s[b].art=''}
        if(!arr_s[b].art[languare]){data_corr(arr_s[b],'art')}
        if(!arr_s[b].sound){arr_s[b].sound=''}
        if(!arr_s[b].sound[languare]){data_corr(arr_s[b],'sound')}
        var ui_button=document.createElement("div");
        if(arr_s[b].className){ui_button.className=arr_s[b].className;}
        if(arr_s[b].style){ui_button.style=arr_s[b].style;}
        if(arr_s[b].text){
            if(arr_s[b].text[languare]){
                ui_button.innerHTML=arr_s[b].text[languare];
                ui_button.style.padding=arr_s[b].indent_text;
            };
            ui_button.style.display="flex";
            ui_button.style.justifyContent=((arr_s[b].align)?arr_s[b].align[0]:"center");
            ui_button.style.alignItems=((arr_s[b].align)?arr_s[b].align[1]:"center");
            ui_button.style.color=arr_s[b].color_text;
            ui_button.style.fontSize=((arr_s[b].size_text)?arr_s[b].size_text:story_script.parameters.font_size);
            ui_button.style.fontFamily=((arr_s[b].font_family)?arr_s[b].font_family:story_script.parameters.font);
        }
        ui_button.style.zIndex=3000+b;
        ui_button.id=arr_s[b].name+b;
        ui_button.setAttribute('onclick','objSelect(this.id);arr_e=story_script.parameters.buttons['+b+']');
        ui_button.classList.add("tue_controll");
        ui_button.style.position="absolute";
        if(arr_s[b].size){
            if(arr_s[b].size[0]!=0){ui_button.style.width=arr_s[b].size[0];}
            if(arr_s[b].size[1]!=0){ui_button.style.height=arr_s[b].size[1];}
        }
        if(!arr_s[b].hotspot){arr_s[b].hotspot=['0%','0%']}
        ui_button.style.transform="translate("+arr_s[b].hotspot[0]+","+arr_s[b].hotspot[1]+")"+((arr_s[b].angle)?" rotate("+arr_s[b].angle+"deg)":"")
        ui_button.style.backgroundColor=arr_s[b].color;
        ui_button.style.backgroundRepeat="no-repeat";
        ui_button.style.backgroundPosition="center";
        if(arr_s[b].art){ui_button.style.backgroundImage="url('"+open_file((arr_s[b].art[languare])?arr_s[b].art[languare]:arr_s[b].art)+"')";}
        if(arr_s[b].art_size){
            if(arr_s[b].art_size=='patch'){ui_button.style.backgroundImage="none"}else if(arr_s[b].patch){delete arr_s[b].patch}
            if(typeof arr_s[b].art_size==='object'){ui_button.style.backgroundSize=arr_s[b].art_size[0]+" "+arr_s[b].art_size[1];}
            else if(arr_s[b].art_size=='patch'){
                if(!arr_s[b].patch){arr_s[b].patch=[8,8,8,8]};
                ui_button.style.backgroundImage="none";
                ui_button.style.backgroundSize="none";
                ui_button.style.backgroundClip="padding-box";
                ui_button.style.borderStyle="solid";
                ui_button.style.borderWidth=arr_s[b].patch[0]+"px "+arr_s[b].patch[1]+"px "+arr_s[b].patch[2]+"px "+arr_s[b].patch[3]+"px";
                ui_button.style.borderImage="url('"+open_file((arr_s[b].art[languare])?arr_s[b].art[languare]:arr_s[b].art)+"') "+arr_s[b].patch[0]+" "+arr_s[b].patch[1]+" "+arr_s[b].patch[2]+" "+arr_s[b].patch[3]+" stretch stretch"
            }else{ui_button.style.backgroundSize=arr_s[b].art_size;}
        }
        if(arr_s[b].position[0]!=0){ui_button.style.left=arr_s[b].position[0];}
        if(arr_s[b].position[1]!=0){ui_button.style.right=arr_s[b].position[1];}
        if(arr_s[b].position[2]!=0){ui_button.style.top=arr_s[b].position[2];}
        if(arr_s[b].position[3]!=0){ui_button.style.bottom=arr_s[b].position[3];}
        scene_layout.appendChild(ui_button);
        interface_buttons_c.innerHTML+=button_panel_edit(b)
    }
}
function button_panel_edit(b){
    var arr_s=story_script.parameters.buttons
    if(b==-1){
        var a=story_script.parameters.buttons.length
        if(a>0){
            story_script.parameters.buttons.push(JSON.parse(JSON.stringify(story_script.parameters.buttons[a-1])))
            story_script.parameters.buttons[a].position=["50%","0","50%","0"];
            story_script.parameters.buttons[a].name="none";
            story_script.parameters.buttons[a].text="button";
        }
       else{
            story_script.parameters.buttons.push({"name":"none","position":["50%","0","50%","0"],"size":[0,story_script.parameters.buttons[0].size[1]],"color":story_script.parameters.text_panel.color,"art":"","text":"button","color_text":story_script.parameters.text_panel.color_text})
        }
        b=a-1
    }
    var html='<div id=b_'+arr_s[b].name+b+' class="ui_buttons dialog" style="margin:8px;"><table style="width:100%" ondblclick="objSelect(\''+arr_s[b].name+b+'\');arr_e=story_script.parameters.buttons['+b+']"><tbody><tr>'
            +'<td width="24px" class="icon_m icon_up" onclick="move_elenetn(story_script.parameters.buttons,'+b+',-1);button_panel_update();" height="22px"></td>'
            +'<td width="24px" class="icon_m icon_down" onclick="move_elenetn(story_script.parameters.buttons,'+b+', 1);button_panel_update();"></td><td>&nbsp;</td>'
            +'<td width="26px" class="icon_m icon_copu" onclick="var arr_d=story_script.parameters.buttons;arr_d.splice('+b+',0,JSON.parse(JSON.stringify(arr_d['+b+'])));button_panel_update();"></td>'
            +'<td width="24px" '+((arr_s[b].name=='tue_back'||arr_s[b].name=='tue_next')?'':'class="icon icon_del" onmouseup="story_script.parameters.buttons.splice('+b+',1);state_save();button_panel_update();"')+' style="cursor:pointer;"></td>'
            +'</tr><tr><td id="bt'+b+'" colspan="5" height="40px" align="center" style="background-image:url('+open_file((arr_s[b].art[languare])?arr_s[b].art[languare]:arr_s[b].art)+');background-position:center;background-repeat:no-repeat;background-size:contain;">'+((arr_s[b].text[languare])?arr_s[b].text[languare]:((arr_s[b].text.length>0)?arr_s[b].text:arr_s[b].name))+'</td></tr><tr>'
        +'<td height="22px" class="icon_m icon_more" onclick="block_open(\'bpsp'+b+'\');scen_element.bpsp'+b+'=bpsp'+b+'.style.display;"></td><td colspan="3"></td></tr></tbody></table>'
        +'<table id="bpsp'+b+'" width="100%" style="display:'+((scen_element['bpsp'+b])?scen_element['bpsp'+b]:'none')+';border-top:1px solid var(--cb);margin-top:8px;"><tbody><tr>'
            +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Function</td>'
            +'<td colspan="3"><select class="input_text" oninput="bt'+b+'.innerHTML=((button_name[this.value])?button_name[this.value]:this.value);story_script.parameters.buttons['+b+'].name=this.value;" style="width:100%;height:28px">'+option_block(arr_s[b].name,3)+'</select></select></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Text</td>'
            +'<td style="width:28px;" align="center"><select id="bts'+b+'" class="input_text" onchange="btv'+b+'.value=((story_script.parameters.buttons['+b+'].text[this.value].length>0)?story_script.parameters.buttons['+b+'].text[this.value]:\'\');" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
            +'<td colspan="2"><input id="btv'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].text[bts'+b+'.value]=this.value;button_panel_update(true);" type="text" style="width:100%;height:28px;" value="'+((arr_s[b].text[languare])?arr_s[b].text[languare]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Align</td>'
            +'<td colspan="3" align="center">'
            +'<table style="background-color:var(--cw);border-radius:4px;"><tbody><tr>'
                +'<td><input class="icon icon_left align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'flex-start\',\'flex-start\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-start'&&arr_s[b].align[1]=='flex-start')?'checked':'')+' style="transform:scaleY(-1);"></td>'
                +'<td><input class="icon icon_cent align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'center\',\'flex-start\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='center'&&arr_s[b].align[1]=='flex-start')?'checked':'')+' style="transform:scaleY(-1);"></td>'
                +'<td><input class="icon icon_left align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'flex-end\',\'flex-start\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-end'&&arr_s[b].align[1]=='flex-start')?'checked':'')+' style="transform:scaleX(-1) scaleY(-1);"></td>'
            +'</tr><tr>'
                +'<td><input class="icon icon_left align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'flex-start\',\'center\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-start'&&arr_s[b].align[1]=='center')?'checked':'')+'></td>'
                +'<td><input class="icon icon_cent align" type="radio" name="align_b'+b+'" onchange="delete story_script.parameters.buttons['+b+'].align;button_panel_update(true);" '+((!arr_s[b].align)?'checked':'')+'></td>'
                +'<td><input class="icon icon_left align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'flex-end\',\'center\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-end'&&arr_s[b].align[1]=='center')?'checked':'')+' style="transform:scaleX(-1);"></td>'
            +'</tr><tr>'
                +'<td><input class="icon icon_left align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'flex-start\',\'flex-end\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-start'&&arr_s[b].align[1]=='flex-end')?'checked':'')+'></td>'
                +'<td><input class="icon icon_cent align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'center\',\'flex-end\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='center'&&arr_s[b].align[1]=='flex-end')?'checked':'')+'></td>'
                +'<td><input class="icon icon_left align" type="radio" name="align_b'+b+'" onchange="story_script.parameters.buttons['+b+'].align=[\'flex-end\',\'flex-end\'];button_panel_update(true);" '+((arr_s[b].align&&arr_s[b].align[0]=='flex-end'&&arr_s[b].align[1]=='flex-end')?'checked':'')+' style="transform:scaleX(-1);"></td>'
            +'</tr></tbody></table>'
            +'</td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Style CSS</td>'
            +'<td colspan="2"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].style=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].style)?arr_s[b].style:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.buttons['+b+'];edit_code(\'style\',\'Style CSS\');"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Width size</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].size[0]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].size)?arr_s[b].size[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Height size</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].size[1]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].size)?arr_s[b].size[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Color</td>'
            +'<td style="width:28px;" align="center"><div class="show_color" '+((arr_s[b].color)?'style="background-color:'+arr_s[b].color+';"':"")+'></div></td>'
            +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].color=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].color)?arr_s[b].color:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.parameters.buttons['+b+'].color=this.value;button_panel_update();"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Color text</td>'
            +'<td style="width:28px;" align="center"><div class="show_color" '+((arr_s[b].color_text)?'style="background-color:'+arr_s[b].color_text+';"':"")+'></div></td>'
            +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].color_text=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].color_text)?arr_s[b].color_text:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.parameters.buttons['+b+'].color_text=this.value;button_panel_update();"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Font size</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].size_text=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].size_text)?arr_s[b].size_text:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Font family</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].font_family=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].font_family)?arr_s[b].font_family:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Class Name</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].className=this.value" type="text" style="width:100%;height:28px" value="'+((arr_s[b].className)?arr_s[b].className:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Top position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[2]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[2]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Left position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[0]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Bottom position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[3]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[3]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Right position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[1]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].position[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">HotSpot X</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].hotspot[0]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].hotspot[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">HotSpot Y</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].hotspot[1]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].hotspot[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Angle</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].angle=correct_value(this.value,true);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].position)?arr_s[b].angle:0)+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Indent text</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].indent_text=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].indent_text)?arr_s[b].indent_text:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Art</td>'
            +'<td style="width:28px;" align="center"><select id="bpal'+b+'" class="input_text" onchange="bpat'+b+'.value=story_script.parameters.buttons['+b+'].art[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
            +'<td><input id="bpat'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].art[bpal'+b+'.value]=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art[languare]&&arr_s[b].art[languare].length>0)?arr_s[b].art[languare]:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'bpat'+b+'\',\'img\',\'bpat'+b+'\',\''+arr_s[b].name+b+'\',\'story_script.parameters.buttons['+b+'].art[bpal'+b+'.value]\')"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Size</td>'
            +'<td colspan="3"><select oninput="story_script.parameters.buttons['+b+'].art_size=this.value;button_panel_update();" class="input_text">'
                +'<option value="">none</option>'
                +'<option '+((arr_s[b].art_size=='cover')?'selected':'')+' value="cover">cover</option>'
                +'<option '+((arr_s[b].art_size=='contain')?'selected':'')+' value="contain">contain</option>'
                +'<option '+((arr_s[b].art_size=='100% 100%')?'selected':'')+' value="100% 100%">fill</option>'
                +'<option '+((arr_s[b].art_size=='patch')?'selected':'')+' value="patch">9-patch</option>'
            +'</select></td>'
        if(!arr_s[b].art_size||arr_s[b].art_size==''||typeof arr_s[b].art_size==='object'){
            if(arr_s[b].art_size==''){delete arr_s[b].art_size};
            html+='</tr><tr>'
                +'<td height="40px" align="right" style="padding-right:8px;">Width art</td>'
                +'<td colspan="3"><input class="input_text" onchange="if(!story_script.parameters.buttons['+b+'].art_size){story_script.parameters.buttons['+b+'].art_size=[correct_value(this.value),\'auto\']}else{story_script.parameters.buttons['+b+'].art_size[0]=correct_value(this.value)};button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].art_size[0]:'')+'"></td>'
            +'</tr><tr>'
                +'<td height="40px" align="right" style="padding-right:8px;">Height art</td>'
                +'<td colspan="3"><input class="input_text" onchange="if(!story_script.parameters.buttons['+b+'].art_size){story_script.parameters.buttons['+b+'].art_size=[\'auto\',correct_value(this.value)]}else{story_script.parameters.buttons['+b+'].art_size[1]=correct_value(this.value)};button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].art_size[1]:'')+'"></td>'
        }else if(arr_s[b].art_size=='patch'){
            html+='</tr><tr>'
                +'<td height="40px" align="right" style="padding-right:8px;">Top border</td>'
                +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].patch[0]=parseInt(correct_value(this.value,true));button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[0]:'')+'"></td>'
            +'</tr><tr>'
                +'<td height="40px" align="right" style="padding-right:8px;">Left border</td>'
                +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].patch[3]=parseInt(correct_value(this.value,true));button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[3]:'')+'"></td>'
            +'</tr><tr>'
                +'<td height="40px" align="right" style="padding-right:8px;">Right border</td>'
                +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].patch[1]=parseInt(correct_value(this.value,true));button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[1]:'')+'"></td>'
            +'</tr><tr>'
                +'<td height="40px" align="right" style="padding-right:8px;">Bottom border</td>'
                +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].patch[2]=parseInt(correct_value(this.value,true));button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].art_size)?arr_s[b].patch[2]:'')+'"></td>'
        }
        html+='</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Sound</td>'
            +'<td style="width:28px;" align="center"><select id="bpsl'+b+'" class="input_text" onchange="bpst'+b+'.value=story_script.parameters.buttons['+b+'].sound[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb);border-right:1px solid var(--cb);border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
            +'<td><input id="bpst'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].sound[bpsl'+b+'.value]=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].sound[languare]&&arr_s[b].sound[languare].length>0)?arr_s[b].sound[languare]:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'bpst'+b+'\',\'audio\',\'bpst'+b+'\',false,\'story_script.parameters.buttons['+b+'].sound[bpsl'+b+'.value]\')"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">JavaScript</td>'
            +'<td colspan="2"><input id="bjs'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].js=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((arr_s[b].js)?arr_s[b].js:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.buttons['+b+'];edit_code(\'js\',\'JavaScript\');"></td>'
        +'</tr></tbody></table></div>'
    return html;
}
function preview_size(){
    if(screen_size.value==0){
        scale_scene=1;screen_preview.style.transform='scale(1)';scene_canvas.style.transform='scale(1)';
        screen_preview.style.backgroundSize="64px"
        screen_preview.style.width="100%";
        screen_preview.style.height="calc(100vh - 40px)";
        if(ratio_screen.selectedIndex==0){
            scene_layout.style.width="100%";
            scene_layout.style.height=p_width.value+"%";
        }else{
            scene_layout.style.height="100%";
            scene_layout.style.width=p_width.value+"%";
        }
    }else{
        screen_preview.style.width=(screen_size.value*2.5)+"px";
        screen_preview.style.height=screen_preview.style.width;
        if(ratio_screen.selectedIndex==0){
            scene_layout.style.height=(screen_size.value==-1)?setup_editor.pvw[1]+"px":screen_size.value+"px";
            scene_layout.style.width=(screen_size.value==-1)?setup_editor.pvw[0]+"px":((100/p_width.value)*screen_size.value)+"px";
        }else{
            scene_layout.style.width=(screen_size.value==-1)?setup_editor.pvw[1]+"px":screen_size.value+"px";
            scene_layout.style.height=(screen_size.value==-1)?setup_editor.pvw[0]+"px":((100/p_width.value)*screen_size.value)+"px";
        }
    }
    scene_view.scrollTop=(screen_preview.clientHeight/2)-(scene_view.clientHeight/2);
    scene_view.scrollLeft=(screen_preview.clientWidth/2)-(scene_view.clientWidth/2);
}
function scen_editor_apply(){
    world.style.display="initial";
    new_story_block.style.display="initial";
    scene_maker.style.display="none";
    scroll_block=false;
    scene_screen=false;
    html.style.overflow="auto"
    update_novel();
}
function variables_set_edit(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    var t=""
    for(var c=0;c<copy_arr.variables.length;c++){t+="<tr><td style='width:128px;' valign='bottom'><select class='input_text var_name'>"+option_var(arr_l.variables[c][0])+"</select></td><td style='width:48px;border-right:1px solid var(--cb);border-left:1px solid var(--cb);'><select class='input_text var_operation'><option value='add'>add</option><option value='set' "+((arr_l.variables[c][1]=="set")?"selected":"")+">set</option></select></td><td><input class='input_text var_value' value='"+ arr_l.variables[c][2] +"' type='text'></td><td onclick='var a=this.closest(\"tr\");a.parentElement.removeChild(a);' style='width:40px;cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"};
    var html="<div class='window' style='padding:24px 8px;width:480px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Changes to values</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[4].en+"</p><br><br>"
    +"<table id='var_table' width='100%'><tbody>"+t+"</tbody></table>"
    +"<div onclick=\"variables_set_add('var_table')\" class='icon icon_add' style='margin-top:16px;height:26px;width:100%;cursor:pointer;'></div>"
    +"<br><br><table class='big_button' width='256px' onclick='variables_set_apply();'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function variables_set_add(id){
    var tbody=document.getElementById(id).getElementsByTagName('tbody')[0];
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    var td4=document.createElement("td");
    td1.innerHTML="<select class='input_text var_name'>"+option_var()+"</select>";
    td2.innerHTML="<select class='input_text var_operation'><option value='add'>add</option><option value='set'>set</option></select>";
    td2.style='width:48px;border-right:1px solid var(--cb);border-left:1px solid var(--cb);';
    td3.innerHTML="<input class='input_text var_value' value='0' type='text'>";
    td4.style="width:40px;cursor:pointer;";
    td4.title="delet";
    td4.className="icon icon_del";
    td4.setAttribute("onclick","var a=this.closest('tr');a.parentElement.removeChild(a);");
    row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
    row.appendChild(td4);
    tbody.appendChild(row);
}
function variables_set_apply(){
    li_v=document.getElementsByClassName("var_name");
    li_c=document.getElementsByClassName("var_operation");
    li_z=document.getElementsByClassName("var_value");
    copy_arr.variables=[];
    for(var i=0;i<li_v.length;i++){copy_arr.variables.push([li_v[i].value,li_c[i].value,((parseFloat(li_z[i].value)==li_z[i].value)?parseFloat(li_z[i].value):li_z[i].value)])};
    arr_l.variables=JSON.parse(JSON.stringify(copy_arr.variables));
    modal_window("close");
    update_novel();state_save();
}
function scen_compres(block,i,n){
    var a=0,arr_s=story_script[block][i].dialogs[n-1]
    data_only(story_script.parameters.text_panel,'art');
    data_only(story_script.parameters.name_panel,'art');
    for(a=0;a<story_script.parameters.buttons.length;a++){
        data_only(story_script.parameters.buttons[a],'art');
        data_only(story_script.parameters.buttons[a],'text');
        data_only(story_script.parameters.buttons[a],'sound');
    }
    if(arr_s){
        if(arr_s.art){for(a=0;a<arr_s.art.length;a++){data_only(arr_s.art[a],'url');}}
        if(arr_s.choice){for(a=0;a<arr_s.choice.length;a++){
            data_only(arr_s.choice[a],'art');
            data_only(arr_s.choice[a],'text');
            data_only(arr_s.choice[a],'sound');
        }}
    }
    var v=document.getElementById('scen_video');if(v){v.pause();}
}
function correct_name(name){return name.trim().replace(/[\s.,':;]/g,'_');};
let units=['px','%','em',"pc","pt","in","mm","cm","ex","ch","rem","vw","vh"];
function correct_value(name,unit){
    var l=((!unit)?"px":"")
    if(name.indexOf("calc")>-1){return name}
    else if(name.indexOf("+")>-1||name.indexOf("-")>-1||name.indexOf("*")>-1||name.indexOf("/")>-1){
        for(var u=0;u<units.length;u++){if(name.indexOf(units[u])>-1){name=name.replace(new RegExp(units[u],'g'),'');l=units[u];}}
        return (eval(name).toFixed(2)+l).replace('.00','');}
    else if(name==parseInt(name)&&name!=0){return name+l}
    else{return name}
}
function move_elenetn(arr,o,n){
	var new_index=((o+n)<0)?o:o+n;
    arr.splice(new_index,0,arr.splice(o,1)[0]);
    update_novel();
};
function setup(){
    var block_list;
    var i
    var li=document.getElementsByClassName("story_block");
    if(!story_script.parameters.plugins){story_script.parameters.plugins=[]}
    for(i=0;i<li.length;i++){block_list+="<option value='"+li[i].id+"' "+((li[i].id==story_script.parameters.launch_story)?"selected" :"")+">"+li[i].id+"</option>"}
    var var_list="<table width='100%' id='var_tablet'><tbody>";
    if(story_script.parameters.variables){for(i=0;i<Object.keys(story_script.parameters.variables).length;i++){var_list+="<tr><td style='padding-right:8px;border-right:1px solid var(--cb);width:40%;padding-top:10px;'><input class='var_name input_text' onchange='this.value=correct_name(this.value)' placeholder='Name' value='"+Object.keys(story_script.parameters.variables)[i]+"' type='text'></td><td><input class='var_vol input_text' placeholder='Value' style='padding-top:10px;' value='"+story_script.parameters.variables[Object.keys(story_script.parameters.variables)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr');a.parentElement.removeChild(a);\" style='width:40px;cursor:pointer;' title='delet "+Object.keys(story_script.parameters.variables)[i]+"' class='icon icon_del'></td></tr>";}}
    var_list+="</tbody></table><div onclick=\"add_tr('var_tablet')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px;width:26px;cursor:pointer;'></div>"
    var sound_list="<table width='100%' id='var_sounds'><tbody>";
    if(story_script.parameters.sounds){for(i=0;i<Object.keys(story_script.parameters.sounds).length;i++){sound_list+="<tr><td style='padding-right:8px;border-right:1px solid var(--cb);width:40%;padding-top:10px;'><input class='sound_name input_text' placeholder='Name' value='"+Object.keys(story_script.parameters.sounds)[i]+"' type='text'></td><td><input class='sound_path input_text' placeholder='path to audio file' style='padding-top:10px;' value='"+story_script.parameters.sounds[Object.keys(story_script.parameters.sounds)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr');a.parentElement.removeChild(a);\" style='width:40px;cursor:pointer;' title='delet "+Object.keys(story_script.parameters.sounds)[i]+"' class='icon icon_del'></td></tr>";}}
    sound_list+="</tbody></table><div onclick=\"add_tr('var_sounds')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px;width:26px;cursor:pointer;'></div>"
    var font_list="<table width='100%' id='var_fonts'><tbody>";
    if(story_script.parameters.font_files){for(i=0;i<Object.keys(story_script.parameters.font_files).length;i++){font_list+="<tr><td style='padding-right:8px;border-right:1px solid var(--cb);width:40%;padding-top:10px;'><input class='font_name input_text' placeholder='Name' value='"+Object.keys(story_script.parameters.font_files)[i]+"' type='text'></td><td><input class='font_path input_text' placeholder='path to font file' style='padding-top:10px;' value='"+story_script.parameters.font_files[Object.keys(story_script.parameters.font_files)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr');a.parentElement.removeChild(a);\" style='width:40px;cursor:pointer;' title='delet "+Object.keys(story_script.parameters.font_files)[i]+"' class='icon icon_del'></td></tr>";}}
    font_list+="</tbody></table><div onclick=\"add_tr('var_fonts')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px;width:26px;cursor:pointer;'></div>"
    if(!story_script.parameters.title[languare]){data_la(story_script.parameters,'title')};
    var title_list="<table width='100%' id='var_title'><tbody>";
    if(story_script.parameters.title){
        for(i=0;i<Object.keys(story_script.parameters.title).length;i++){
            title_list+="<tr><td style='padding-right:8px;border-right:1px solid var(--cb);width:40%;padding-top:10px;'><select class='input_text title_lang'>"
            +big_languares(Object.keys(story_script.parameters.title)[i])+"</select></td><td><input class='title_name input_text' placeholder='translated title' style='padding-top:10px;' value='"+story_script.parameters.title[Object.keys(story_script.parameters.title)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr');a.parentElement.removeChild(a);\" style='width:40px;cursor:pointer;' title='delet' class='icon icon_del'></td></tr>";
        }
    }
    var plugins_show="<table id='plugin' style='width:100%;border-spacing:10px;border-collapse:separate;'>"
    var plugins_name
    for(i=0;i<Object.keys(plugins_list).length;i++){plugins_name=Object.keys(plugins_list)[i];plugins_show+="<tr><td align='right' style='padding-top:4px;height:40px;'><input id='"+plugins_name+"' type='checkbox' class='chec_plugin checkbox_a' "+((story_script.parameters.plugins.indexOf(plugins_name)>-1)?'checked' :'')+"></td><td align='left' style='width:80px;'>"+plugins_list[plugins_name].name+"</td><td>"+plugins_list[plugins_name].text+"</td></tr>"}
    plugins_show+="</table>"
    var thems="<table style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody><tr>"
    for(i=0;i<color_ui.length;i++){thems+="<td align='center'><input class='checkbox_b' type='radio' name='color' style='background-color:"+color_ui[i][0]+";' value='"+i+"' "+((setup_editor.ui==i)?'checked' :'')+"></td>"}
    thems+="</tr></tbody></table>"
    var addon_list="<table width='100%' id='var_addon'><tbody>";
    if(story_script.parameters.plugins){for(i=0;i<story_script.parameters.plugins.length;i++){if(!plugins_list[story_script.parameters.plugins[i]]){addon_list+="<tr><td style='padding-right:8px;padding-left:8px;width:calc(100% - 14px);padding-top:10px;'><input class='addon_path input_text' placeholder='path to plugin js file' value='"+story_script.parameters.plugins[i]+"' type='text'></td><td onclick=\"var a=this.closest('tr');a.parentElement.removeChild(a);\" style='width:14px;cursor:pointer;' title='delet' class='icon icon_del'></td></tr>";}}}
    addon_list+="</tbody></table><div onclick='add_addon()' class='icon icon_add' style='margin:16px 0 0 45%;height:26px;width:26px;cursor:pointer;'></div>"
    title_list+="</tbody></table><div onclick=\"add_tr('var_title')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px;width:26px;cursor:pointer;'></div>"
    var html="<div class='window' style='padding:24px 16px;width:480px;'><div><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><p>Settings project</p><br>"+
        "<table width='100%' style='height:60vh;border-radius:8px;border-top:1px solid var(--cb);'><tbody>"+
        "<tr><td id='set_1' onclick='set_menu(0)' align='right' class='set_button set_select'>Project</td><td width='100%' valign='top' rowspan='6' style='position:relative;'>"+
        //
        "<div id='blank_0' style='visibility:visible;' class='set_blank'><table style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody>"+
        "<tr><td align='right'>story launch block </td><td align='left' colspan='2'><select class='input_text' id='launch_story'>"+((block_list)?block_list :'')+"</select></td></tr>"+
        "<tr><td align='right'>working folder </td><td align='left'><input id='project_foler' class='input_text' value='"+((wf)?wf:"")+"' onclick='load_new=true;json_file.click();' type='text'></td><td id='l_icon' style='width:14px;cursor:pointer;' class='icon icon_load' onclick='load_new=true;json_file.click();'></td></tr>"+
        "<tr><td align='right'>css styles file </td><td align='left'><input id='style_file' class='input_text' value='"+((story_script.parameters.style_file)?story_script.parameters.style_file:'')+"' type='text'></td><td id='l_css' style='width:14px;cursor:pointer;' class='icon icon_load' onclick='file_catalog(this.id,\".css\",\"style_file\",0,\"story_script.parameters.style_file\")'></td></tr>"+
        "<tr><td align='right'>dialog speed </td><td align='left' colspan='2'><input id='dialog_speed_s' onchange='this.value=parseInt(correct_value(this.value,true))' class='input_text' value='"+((story_script.parameters.text_panel.dialog_speed)?story_script.parameters.text_panel.dialog_speed:'')+"' type='text'></td></tr><tr><td align='right'>font family </td><td align='left' colspan='2'><input id='font' class='input_text' value='"+((story_script.parameters.font)?story_script.parameters.font :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>font size </td><td align='left' colspan='2'><input id='font_size' class='input_text' onchange='this.value=correct_value(this.value)' value='"+((story_script.parameters.font_size)?story_script.parameters.font_size:'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>icon </td><td align='left'><input id='icon' class='input_text' value='"+((story_script.parameters.icon)?story_script.parameters.icon :'')+"' type='text'></td><td id='l_icon'style='width:14px;cursor:pointer;' class='icon icon_load' onclick='file_catalog(this.id,\"img\",\"icon\",0,\"story_script.parameters.icon\")'></td></tr>"+
        "<tr><td height='20px'></td><td></td></tr>"+
        "<tr><td align='right'>autosave </td><td align='left' style='padding-top:4px;width:60%;'><table style='width:100%'><tbody><tr><td><input id='autosave' type='checkbox' class='checkbox_a' "+((story_script.parameters.autosave)?'checked':'')+"></td><td align='right'>Clear localStorage:</td></tr></tbody></table></td><td onclick=\"localStorage.clear();toast('localStorage clear');\" style='width:40px;cursor:pointer;' title='clear autosave' class='icon icon_del'></td></tr>"+
        "</table></div>"+
        //
        "<div id='blank_3' style='visibility:hidden;' class='set_blank'><table style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody>"+
        "<tr><td align='right'>next </td><td align='left'><input id='key_next' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.next)?story_script.parameters.key.next :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>back </td><td align='left'><input id='key_back' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.back)?story_script.parameters.key.back :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>save stage</td><td align='left'><input id='key_save' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.save)?story_script.parameters.key.save :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>load stage</td><td align='left'><input id='key_load' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.load)?story_script.parameters.key.load :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>full screen</td><td align='left'><input id='key_full_screen' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.full_screen)?story_script.parameters.key.full_screen :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>launch screen</td><td align='left'><input id='key_launch_story' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.launch_story)?story_script.parameters.key.launch_story :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>load autosave</td><td align='left' style='width:60%;'><input id='key_load_autosave' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.load_autosave)?story_script.parameters.key.load_autosave :'')+"' type='text'></td></tr>"+
        "</table></div>"+
        //
        "<div id='blank_1' style='visibility:hidden;' class='set_blank'>"+title_list+"</div>"+
        "<div id='blank_4' style='visibility:hidden;' class='set_blank'>"+var_list+"</div>"+
        "<div id='blank_5' style='visibility:hidden;' class='set_blank'>"+sound_list+"</div>"+
        "<div id='blank_2' style='visibility:hidden;' class='set_blank'>"+chars_list()+"</div>"+
        "<div id='blank_7' style='visibility:hidden;' class='set_blank'>"+font_list+"</div>"+
        //
        "<div id='blank_8' style='visibility:hidden;' class='set_blank'><br><p align='left' style=' margin-left:8px;'>Devices control</p><hr><form id='devices'><table id='controll' style='width:100%;border-spacing:10px;border-collapse:separate;'>"+
        "<tr><td align='right' style='padding-top:4px;height:40px;'><input type='radio' name='devices' class='chec_plugin checkbox_a' "+((setup_editor.wheel==true)?'checked' :'')+"></td><td align='left' style='width:80px;'>Mouse </td><td> scrolling with the mouse cursor, zooming with the wheel</td></tr>"+
        "<tr><td align='right' style='padding-top:4px;height:40px;'><input type='radio' name='devices' class='chec_plugin checkbox_a' "+((setup_editor.wheel==false)?'checked' :'')+"></td><td align='left' style='width:80px;'>TouchPad </td><td> swipe scrolling is recommended for Laptops and MacBooks</td></tr>"+
        "</tbody></table></form><br>"+
        "<p align='left' style='margin-left:8px;'>Preview window size</p><hr>"+
        "<table style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody>"+
        "<tr><td align='right'>Width</td><td align='left' colspan='2'><input id='pv_v' class='input_text' value='"+setup_editor.pvw[0]+"' type='text'></td></tr>"+
        "<tr><td align='right'>Height</td><td align='left' colspan='2'><input id='pv_h' class='input_text' value='"+setup_editor.pvw[1]+"' type='text'></td></tr>"+
        "</tbody></table><br>"+
        "<p align='left' style=' margin-left:8px;'>Display script</p><hr><table id='controll' style='width:100%;border-spacing:10px;border-collapse:separate;'><tbody>"+
        "<tr><td align='right' style='padding-top:4px;height:40px;'><input id='all_lines' type='checkbox' class='chec_plugin checkbox_a' "+((setup_editor.lines)?'checked' :'')+"></td><td align='left' style='width:80px;'>All Lines </td><td> Show all lines of a block or only a selected block</td></tr>"+
        "</tbody></table><br>"+
        "<p align='left' style='margin-left:8px;'>Color them</p><hr><form id='ui_color'>"+thems+
        "</form><br>"+
        "<p align='left' style='margin-left:8px;'>Background</p><hr><form id='bg_edit'><table style='width:100%;'><tbody><tr>"+
        "<td align='center' height='92px'><input type='radio' name='bg_edit' class='chec_bg' value='' "+((setup_editor.fon=='')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_1' value='bg_1' "+((setup_editor.fon=='bg_1')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_2' value='bg_2' "+((setup_editor.fon=='bg_2')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_8' value='bg_8' "+((setup_editor.fon=='bg_8')?'checked' :'')+"></td></tr><tr>"+
        "<td align='center' height='92px'><input type='radio' name='bg_edit' class='chec_bg bg_4' value='bg_4' "+((setup_editor.fon=='bg_4')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_5' value='bg_5' "+((setup_editor.fon=='bg_5')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_6' value='bg_6' "+((setup_editor.fon=='bg_6')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_3' value='bg_3' "+((setup_editor.fon=='bg_3')?'checked' :'')+"></td></tr><tr>"+
        "<td align='center' height='92px'><input type='radio' name='bg_edit' class='chec_bg bg_7' value='bg_7' "+((setup_editor.fon=='bg_7')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_9' value='bg_9' "+((setup_editor.fon=='bg_9')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_0' value='bg_0' "+((setup_editor.fon=='bg_0')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_a' value='bg_a' "+((setup_editor.fon=='bg_a')?'checked' :'')+"></td>"+
        "</tr></tbody></table></form></div>"+
        //
        "<div id='blank_6' style='visibility:hidden;' class='set_blank'>"+plugins_show+"<br>"+addon_list+"</div>"+
        //
        "</td></tr>"+
        "<tr><td id='set_1' onclick='set_menu(1)' align='right' class='set_button'>Languares</td></tr>"+
        "<tr><td id='set_2' onclick='set_menu(2)' align='right' class='set_button'>Characters</td></tr>"+
        "<tr><td id='set_3' onclick='set_menu(3)' align='right' class='set_button'>Keyboard</td></tr>"+
        "<tr><td id='set_4' onclick='set_menu(4)' align='right' class='set_button'>Variables</td></tr>"+
        "<tr><td id='set_5' onclick='set_menu(5)' align='right' class='set_button'>Sounds</td></tr>"+
        "<tr><td id='set_6' onclick='set_menu(6)' align='right' class='set_button'>Add-on</td></tr>"+
        "<tr><td id='set_7' onclick='set_menu(7)' align='right' class='set_button'>Fonts</td></tr>"+
        "<tr><td id='set_8' onclick='set_menu(8)' align='right' class='set_button' style='border-radius:0 0 0 16px;padding-left:20px;'>Editor</td></tr>"+
        "<tr><td style='border-right:1px solid var(--cb);'></td></tr></tbody></table><br><table class='big_button' width='256px' onclick='apply_setup()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function chars_list(){
    var chars_list='';
    if(!story_script.parameters.characters){story_script.parameters.characters={}}
    if(story_script.parameters.characters){
        var arr_s=story_script.parameters.characters
        for(var i=0;i<Object.keys(arr_s).length;i++){
            chars_list+="<table class='ui_buttons dialog' style='width:calc(100% - 16px);margin:8px;border-spacing:4px;border-collapse:separate;'><tbody>"
            +"<tr><td colspan='2' align='center'><table style='height:22px;width:100%;'><tbody><tr>"
                +"<td width='20px'></td>"
                +"<td width='24px'></td>"
                +"<td></td>"
                +"<td width='32px' class='icon_m icon_copu' title='duplicate' onclick='story_script.parameters.characters."+Object.keys(arr_s)[i]+"_copu=JSON.parse(JSON.stringify(story_script.parameters.characters."+Object.keys(arr_s)[i]+"));chars_list_update();'></td>"
                +"<td width='32px' class='icon icon_del' title='delete' style='cursor:pointer;' onclick='delete story_script.parameters.characters."+Object.keys(arr_s)[i]+";chars_list_update();'></td>"
            +"</tr></tbody></table></td></tr>"
            for(var l=0;l<story_script.parameters.languares.length;l++){chars_list+="<tr><td align='right'>"+story_script.parameters.languares[l]+"</td><td><input class='input_text' onchange='story_script.parameters.characters."+Object.keys(arr_s)[i]+"."+story_script.parameters.languares[l]+"=this.value' value='"+((arr_s[Object.keys(arr_s)[i]][story_script.parameters.languares[l]])?arr_s[Object.keys(arr_s)[i]][story_script.parameters.languares[l]]:"")+"' type='text'></td></tr>"}
            chars_list+="<tr><td align='right'>class name</td><td><input class='input_text' onchange='story_script.parameters.characters."+Object.keys(arr_s)[i]+".className=this.value' value='"+((arr_s[Object.keys(arr_s)[i]].className)?arr_s[Object.keys(arr_s)[i]].className:"")+"' type='text'></td></tr>"
            +"<tr><td align='right'>style</td><td><input class='input_text' onchange='story_script.parameters.characters."+Object.keys(arr_s)[i]+".style=this.value' value='"+((arr_s[Object.keys(arr_s)[i]].style)?arr_s[Object.keys(arr_s)[i]].style:"")+"' type='text'></td></tr>"
            +"<tr><td align='right'>color</td><td><input class='input_text' onchange='story_script.parameters.characters."+Object.keys(arr_s)[i]+".color=this.value' value='"+((arr_s[Object.keys(arr_s)[i]].color)?arr_s[Object.keys(arr_s)[i]].color:"")+"' type='text'></td></tr>"
            +"<tr><td align='right'>color text</td><td><input class='input_text' onchange='story_script.parameters.characters."+Object.keys(arr_s)[i]+".color_text=this.value' value='"+((arr_s[Object.keys(arr_s)[i]].color_text)?arr_s[Object.keys(arr_s)[i]].color_text:"")+"' type='text'></td></tr>"
            +"</tbody></table>"
        }
    } return chars_list+"<div onclick='story_script.parameters.characters.char"+Object.keys(story_script.parameters.characters).length+"={};chars_list_update();' class='icon icon_add' style='margin:16px 0 0 45%;height:26px;width:26px;cursor:pointer;'></div>";
}
function chars_list_update(){blank_2.innerHTML=chars_list();}
function set_menu(name){
    var li=document.getElementsByClassName("set_button");
    for(var i=0;i<li.length;i++){
        if(i==name){
            li[i].className='set_button set_select'
            document.getElementById('blank_'+i).style.visibility='visible';
        }else{
            li[i].className='set_button'
            document.getElementById('blank_'+i).style.visibility='hidden';
        }
    }
}
function add_tr(id){
    var tbody=document.getElementById(id).getElementsByTagName('tbody')[0];
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    if(id=='var_title'||id=='new_title'){
        td1.innerHTML="<select class='input_text title_lang'>"+big_languares()+"</select>";
        td1.style="padding-right:8px;border-right:1px solid var(--cb);width:40%;padding-top:10px;";
        td2.innerHTML="<input class='title_name input_text' value='"+languare_data(story_script.parameters.title)+"' style='padding-top:10px;' type='text' placeholder='translated title'>";
    }else if(id=='var_tablet'){
        td1.innerHTML="<input class='var_name input_text' value='varible"+(tbody.getElementsByTagName('tr').length+1)+"' placeholder='name' onchange='this.value=correct_name(this.value)' style='padding-top:10px;' type='text'>";
        td1.style="padding-right:8px;border-right:1px solid var(--cb);width:40%;";
        td2.innerHTML="<input class='var_vol input_text' style='padding-top:10px;' type='text' placeholder='value'>";
    }else if(id=='var_sounds'){
        td1.innerHTML="<input class='sound_name input_text' placeholder='name' style='padding-top:10px;' type='text'>";
        td1.style="padding-right:8px;border-right:1px solid var(--cb);width:40%;";
        td2.innerHTML="<input class='sound_path input_text' style='padding-top:10px;' type='text' placeholder='path to audio file'>";
    }else if(id=='var_fonts'){
        td1.innerHTML="<input class='font_name input_text' placeholder='name' style='padding-top:10px;' type='text'>";
        td1.style="padding-right:8px;border-right:1px solid var(--cb);width:40%;";
        td2.innerHTML="<input class='font_path input_text' style='padding-top:10px;' type='text' placeholder='path to font file'>";
    }
    td3.style="width:40px;cursor:pointer;";
    td3.title="delet";
    td3.className="icon icon_del";
    td3.setAttribute("onclick","var a=this.closest('tr');a.parentElement.removeChild(a);");
    row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
    tbody.appendChild(row);
}
function add_addon(){
    var tbody=document.getElementById('var_addon').getElementsByTagName('tbody')[0];
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td3=document.createElement("td");
    td1.innerHTML="<input class='addon_path input_text' placeholder='path to plugin js file' type='text'>";
    td1.style="padding-right:8px;padding-left:8px;width:calc(100% - 14px);padding-top:10px;";
    td3.style="width:14px;cursor:pointer;";
    td3.title="delet";
    td3.className="icon icon_del";
    td3.setAttribute("onclick","var a=this.closest('tr');a.parentElement.removeChild(a);");
    row.appendChild(td1);
    row.appendChild(td3);
    tbody.appendChild(row);
}
function apply_setup(){
    var i,li_n,li_v,forms;
    story_script.parameters.launch_story=launch_story.value
    story_script.parameters.style_file=style_file.value
    story_script.parameters.icon=icon.value
    story_script.parameters.autosave=autosave.checked
    if(key_next.value.length>0){story_script.parameters.key.next=key_next.value} else {delete story_script.parameters.key.next}
    if(key_back.value.length>0){story_script.parameters.key.back=key_back.value} else {delete story_script.parameters.key.back}
    if(key_save.value.length>0){story_script.parameters.key.save=key_save.value} else {delete story_script.parameters.key.save}
    if(key_load.value.length>0){story_script.parameters.key.load=key_load.value} else {delete story_script.parameters.key.load}
    if(key_full_screen.value.length>0){story_script.parameters.key.full_screen=key_full_screen.value} else {delete story_script.parameters.key.full_screen}
    if(key_launch_story.value.length>0){story_script.parameters.key.launch_story=key_launch_story.value} else {delete story_script.parameters.key.launch_story}
    if(key_load_autosave.value.length>0){story_script.parameters.key.load_autosave=key_load_autosave.value} else {delete story_script.parameters.key.load_autosave}
    story_script.parameters.font=font.value
    story_script.parameters.font_size=correct_value(font_size.value)
    story_script.parameters.text_panel.dialog_speed=dialog_speed_s.value
    //
    forms=document.forms.devices;
    setup_editor.wheel=(forms[0].checked)?true:false;
    setup_editor.lines=all_lines.checked;
    setup_editor.pvw=[pv_v.value,pv_h.value];
    forms=document.forms.bg_edit;
    for(i=0;i<forms.length;i++){if(forms[i].checked){setup_editor.fon=forms[i].value;break;}}
    forms=document.forms.ui_color;
    for(i=0;i<forms.length;i++){if(forms[i].checked){setup_editor.ui=forms[i].value;if(setup_editor.ui==0){set_ui(0)};break;}}
    editor_setup();
    localStorage.setItem("editor_setup",JSON.stringify(setup_editor));
    //
    li_n=document.getElementsByClassName("var_name");
    li_v=document.getElementsByClassName("var_vol");
    story_script.parameters.variables={};
    for(i=0;i<li_n.length;i++){
        if(li_n[i].value!=""){
            if(parseFloat(li_v[i].value)==li_v[i].value){story_script.parameters.variables[correct_name(li_n[i].value)]=parseFloat(li_v[i].value)}
            else{story_script.parameters.variables[correct_name(li_n[i].value)]=li_v[i].value}
        }
    }
    li_n=document.getElementsByClassName("font_name");
    li_v=document.getElementsByClassName("font_path");
    story_script.parameters.font_files={};
    for(i=0;i<li_n.length;i++){if(li_n[i].value!=""){ story_script.parameters.font_files[li_n[i].value]=li_v[i].value}}
    li_n=document.getElementsByClassName("sound_name");
    li_v=document.getElementsByClassName("sound_path");
    story_script.parameters.sounds={};
    for(i=0;i<li_n.length;i++){if(li_n[i].value!=""){ story_script.parameters.sounds[li_n[i].value]=li_v[i].value}}
    li_n=document.getElementsByClassName("title_lang");
    li_v=document.getElementsByClassName("title_name");
    story_script.parameters.title={};
    story_script.parameters.languares=[];
    for(i=0;i<li_n.length;i++){story_script.parameters.title[li_n[i].value]=li_v[i].value;story_script.parameters.languares.push(li_n[i].value);}
    data_only(story_script.parameters,'title');
    li_v=document.getElementsByClassName("chec_plugin");
    story_script.parameters.plugins=[];
    for(i=0;i<li_v.length;i++){if(li_v[i].checked&&plugins_list[li_v[i].id] ){story_script.parameters.plugins.push(li_v[i].id);}}
    li_v=document.getElementsByClassName("addon_path");
    for(i=0;i<li_v.length;i++){if(li_n[i].value!=""){story_script.parameters.plugins.push(li_v[i].value);}}
    lang_select();
    update_novel();
    modal_window('close');
    toast("parameters updated");
}
var scale=1;
var scale_scene=1;
document.addEventListener('keydown',function(event){
    if(event.altKey){
        if(!scroll_block||scene_screen){
            if(event.code=='Equal'){world_scale(2)}
            else if(event.code=='Minus'){world_scale(false)}
            else if(event.code=='Digit0'){world_scale(1)}
            else if(scene_screen&&event.code=='Comma'){scen_editor(scen_data[0],scen_data[1],scen_data[2]-1)}
            else if(scene_screen&&event.code=='Period'){scen_editor(scen_data[0],scen_data[1],scen_data[2]+1)}
        }
        if(event.code=='KeyR'){play_novel();}
    }
});
var scene_screen=false
var scroll_xs=null;
var scroll_ys=null;
function scene_z(){
    scroll_xs=((scene_view.scrollTop+(scene_view.clientHeight/2))/scale_scene)-(scene_view.clientHeight/2);
    scroll_ys=((scene_view.scrollLeft+(scene_view.clientWidth/2))/scale_scene)-(scene_view.clientWidth/2);
}
function world_scale(s){
    if(scene_screen){
        scene_z();
        if(screen_size.value!=0){
            if(s==1){scale_scene=1;scene_canvas.style.transform='scale(1)';}
         else if(s==2){scale_scene=Math.min(2,scale_scene+0.05);scene_canvas.style.transform='scale('+scale_scene+')';}
            else{scale_scene=Math.max(0.25,scale_scene-0.05);scene_canvas.style.transform='scale('+scale_scene+')';}
            scene_view.scrollTop=((scroll_xs+(scene_view.clientHeight/2))*scale_scene)-(scene_view.clientHeight/2);
            scene_view.scrollLeft=((scroll_ys+(scene_view.clientWidth/2))*scale_scene)-(scene_view.clientWidth/2);
            screen_preview.style.width=(screen_size.value*2.5)*scale_scene+"px";
            screen_preview.style.height=(screen_size.value*2.5)*scale_scene+"px";
            screen_preview.style.backgroundSize=64*scale_scene+"px"
        }else{
            if(s==1){scale_scene=1;screen_preview.style.transform='scale(1)';}
         else if(s==2){scale_scene=Math.min(2,scale_scene+0.05);screen_preview.style.transform='scale('+scale_scene+')';}
            else{scale_scene=Math.max(1,scale_scene-0.05);screen_preview.style.transform='scale('+scale_scene+')';}
            scene_view.scrollTop=((scroll_xs+(scene_view.clientHeight/2))*scale_scene)-(scene_view.clientHeight/2);
            scene_view.scrollLeft=((scroll_ys+(scene_view.clientWidth/2))*scale_scene)-(scene_view.clientWidth/2);
        }
    }else{
        scroll_z();
        menu_add.style.visibility='hidden';
        if(s==1){scale=1;world.style.transform='scale(1)';}
     else if(s==2){scale=Math.min(2,scale+0.05);world.style.transform='scale('+scale+')';}
        else{scale=Math.max(0.25,scale-0.05);world.style.transform='scale('+scale+')';}
        html.scrollTop=((scroll_xz+(html.clientHeight/2))*scale)-(html.clientHeight/2);
        html.scrollLeft=((scroll_yz+(html.clientWidth/2))*scale)-(html.clientWidth/2);
    }
}
function csv_export(){
    var n,i,d,l,r;
    var CSV='name\t';
	for(i=0;i<story_script.parameters.languares.length;i++){CSV+=story_script.parameters.languares[i]+'\t';}
	CSV+='\rtitle\t';
	if(story_script.parameters.title[languare]){for(i=0;i<story_script.parameters.languares.length;i++){CSV+=story_script.parameters.title[story_script.parameters.languares[i]]+'\t';}}
    else{CSV+=story_script.parameters.title}
	CSV+='\r';
	all_blocks=0;
    while(Object.keys(story_script)[all_blocks]){
		var k=Object.keys(story_script)[all_blocks]
		if(k!="parameters"&&k!="blocks"){
			CSV+=k+'\r';
			for(var i=0;i<story_script[k].length;i++){
				if(story_script[k][i].dialogs){
					for(d=0;d<story_script[k][i].dialogs.length;d++){
						if(story_script[k][i].dialogs[d].text){
							CSV+=languare_data(story_script[k][i].dialogs[d].name)+'\t';
							if(story_script[k][i].dialogs[d].text[languare]){for(l=0;l<story_script.parameters.languares.length;l++){
                                if(typeof story_script[k][i].dialogs[d].text[story_script.parameters.languares[l]]==='string'){CSV+=story_script[k][i].dialogs[d].text[story_script.parameters.languares[l]].replace(new RegExp('\t',"g"),'')+'\t';}
                                else{CSV+='\t';}
                                }
                            }
                            else if(typeof story_script[k][i].dialogs[d].text==='string'){CSV+=story_script[k][i].dialogs[d].text.replace(new RegExp('\t',"g"),'')+'\t';}
							CSV+='\r';
						}else if(story_script[k][i].dialogs[d].text_add){
							CSV+=languare_data(story_script[k][i].dialogs[d].name)+'\t';
							if(story_script[k][i].dialogs[d].text_add[languare]){for(l=0;l<story_script.parameters.languares.length;l++){
                                if(typeof story_script[k][i].dialogs[d].text_add[story_script.parameters.languares[l]]==='string'){CSV+=story_script[k][i].dialogs[d].text_add[story_script.parameters.languares[l]].replace(new RegExp('\t',"g"),'')+'\t';}
                                else{CSV+='\t';}
                                }
                            }
							else if(typeof story_script[k][i].dialogs[d].text_add==='string'){CSV+=story_script[k][i].dialogs[d].text_add.replace(new RegExp('\t',"g"),'')+'\t';}
                            CSV+='\r';
						}else if(story_script[k][i].dialogs[d].choice){
							for(r=0;r<story_script[k][i].dialogs[d].choice.length;r++){
								if(story_script[k][i].dialogs[d].choice[r].text){
									if(story_script[k][i].dialogs[d].choice[r].text[languare] && story_script[k][i].dialogs[d].choice[r].text.length>0){CSV+='choice \t';for(l=0;l<story_script.parameters.languares.length;l++){
										if(story_script[k][i].dialogs[d].choice[r].text[story_script.parameters.languares[l]]){CSV+=story_script[k][i].dialogs[d].choice[r].text[story_script.parameters.languares[l]].replace(new RegExp('\t',"g"),'')+'\t\r'}
										else{CSV+='\t\r'}
									}}else if(typeof story_script[k][i].dialogs[d].choice[r].text==='string' && story_script[k][i].dialogs[d].choice[r].text.length>0){CSV+='choice \t'+story_script[k][i].dialogs[d].choice[r].text.replace(new RegExp('\t',"g"),'')+'\t\r'}
								}
							}
						}
					}
				}
			}
		} all_blocks++;
    }
    if(story_script.parameters.title){n="translate_kit_"+((story_script.parameters.title.en)?story_script.parameters.title.en :story_script.parameters.title)}
    else{n="translate_kit";}
    var uri='data:text/csv;charset=utf-8,'+encodeURIComponent(CSV);
    download_files(n+".csv",uri)
}
var objFocus;
let arr_e;
function droppFocus(){
    if(objFocus){
        objFocus.style.width=resizers.style.width;
        objFocus.style.height=resizers.style.height;
        objFocus.style.top=resizers.style.top;
        objFocus.style.left=resizers.style.left;
        objFocus.style.zIndex=resizers.style.zIndex;
        objFocus.style.transform=resizers.style.transform;
        var j=document.getElementById('b_'+objFocus.id);
        if(j){
            j.style.animation="false";
            j.style.WebkitAnimation="false";
            j.style.backgroundColor='var(--cw)'
        }
        resizers.style.transform="";
        scene_layout.appendChild(objFocus);
        objFocus='';
        resizers.style.visibility="hidden"
    }
}
function objSelect(id){
    droppFocus();
    objFocus=document.getElementById(id);
    resizers.style.height=objFocus.offsetHeight+"px"
    resizers.style.width=objFocus.offsetWidth+"px"
    resizers.style.top=objFocus.offsetTop+"px";
    resizers.style.left=objFocus.offsetLeft+"px";
    resizers.style.visibility="visible"
    resizers.style.zIndex=objFocus.style.zIndex;
    resizers.style.transform=objFocus.style.transform;
    objFocus.style.transform="";
    objFocus.style.boxSizing='border-box';
    objFocus.style.width='100%';
    objFocus.style.height='100%';
    objFocus.style.top='0px';
    objFocus.style.left='0px';
    objFocus.style.bottom='none';
    objFocus.style.right='none';
    var j=document.getElementById('b_'+id);
    if(j){
        j.style.animation="flash2 2s 1";
        j.style.WebkitAnimation="flash2 2s 1";
        j.style.backgroundColor='var(--cb)'
    }
    resizers.appendChild(objFocus);
}
var moveSize=true;
function makeResizableDiv(s){
    s.onmousedown=dragMouseDown;
    function dragMouseDown(e){
        if(moveSize){
            e=e||window.event;
            e.preventDefault();
            original_x=e.clientX;
            original_y=e.clientY;
            scene_scroll=false
            document.onmouseup=closeDragElement;
            document.onmousemove=elementDrag;
        }
    }
    function elementDrag(e){
        e=e||window.event;
        e.preventDefault();
        original_mouse_x=original_x-e.clientX;
        original_mouse_y=original_y-e.clientY;
        original_x=e.clientX;
        original_y=e.clientY;
        s.style.top=(s.offsetTop-original_mouse_y/scale_scene)+"px";
        s.style.left=(s.offsetLeft-original_mouse_x/scale_scene)+"px";
    }
    s.ontouchstart=dragTouchDown;
    function dragTouchDown(e){
        if(moveSize){
            e=e||window.event;
            e.preventDefault();
            original_x=e.touches[0].clientX;
            original_y=e.touches[0].clientY;
            scene_scroll=false
            document.ontouchend=closeDragElement;
            document.ontouchmove=elementDragTouch;
        }
    }
    function elementDragTouch(e){
        e=e||window.event;
        e.preventDefault();
        original_mouse_x=original_x-e.touches[0].clientX;
        original_mouse_y=original_y-e.touches[0].clientY;
        original_x=e.touches[0].clientX;
        original_y=e.touches[0].clientY;
        s.style.top=(s.offsetTop-original_mouse_y/scale_scene)+"px";
        s.style.left=(s.offsetLeft-original_mouse_x/scale_scene)+"px";
    }
    function closeDragElement(){saveResize();}
    const resizers=document.getElementsByClassName("resizer");
    const minSize=26;
    let original_width=0,original_height=0,original_x=0,original_y=0,original_mouse_x=0,original_mouse_y=0,angle=0;
    for (let i=0;i<resizers.length;i++){
        const sizer=resizers[i];
        sizer.addEventListener('mousedown',function(e){
            moveSize=false
            scene_scroll=false
            e.preventDefault()
            original_width=parseFloat(getComputedStyle(s,null).getPropertyValue('width').replace('px',''));
            original_height=parseFloat(getComputedStyle(s,null).getPropertyValue('height').replace('px',''));
            original_x=parseFloat(getComputedStyle(s,null).getPropertyValue('left').replace('px',''));
            original_y=parseFloat(getComputedStyle(s,null).getPropertyValue('top').replace('px',''));
            original_mouse_x=e.pageX;
            original_mouse_y=e.pageY;
            window.addEventListener('mousemove',resize)
            screen_preview.addEventListener('mouseup',stopResize)
        })
        function resize(e){
            if(sizer.classList.contains('bottom-right')){
                const width=original_width+(e.pageX-original_mouse_x)/scale_scene;
                const height=original_height+(e.pageY-original_mouse_y)/scale_scene
                if(width>minSize){s.style.width=width+'px'}
                if(height>minSize){s.style.height=height+'px'}
            }else if(sizer.classList.contains('bottom-left')){
                const height=original_height+(e.pageY-original_mouse_y)/scale_scene
                const width=original_width-(e.pageX-original_mouse_x)/scale_scene
                if(height>minSize){s.style.height=height+'px'}
                if(width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.pageX-original_mouse_x)/scale_scene+'px'}
            }else if(sizer.classList.contains('top-right')){
                const width=original_width+(e.pageX-original_mouse_x)/scale_scene
                const height=original_height-(e.pageY-original_mouse_y)/scale_scene
                if(width>minSize){s.style.width=width+'px'}
                if(height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.pageY-original_mouse_y)/scale_scene+'px'}
            }else if(sizer.classList.contains('top-left')){
                const width=original_width-(e.pageX-original_mouse_x)/scale_scene
                const height=original_height-(e.pageY-original_mouse_y)/scale_scene
                if(width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.pageX-original_mouse_x)/scale_scene+'px'}
                if(height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.pageY-original_mouse_y)/scale_scene+'px'}
            }else if(sizer.classList.contains('size-top')){
                const height=original_height-(e.pageY-original_mouse_y)/scale_scene
                if(height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.pageY-original_mouse_y)/scale_scene+'px'}
            }else if(sizer.classList.contains('size-bottom')){
                const height=original_height+(e.pageY-original_mouse_y)/scale_scene
                if(height>minSize){s.style.height=height+'px'}
            }else if(sizer.classList.contains('size-left')){
                const width=original_width-(e.pageX-original_mouse_x)/scale_scene
                if(width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.pageX-original_mouse_x)/scale_scene+'px'}
            }else if(sizer.classList.contains('size-right')){
                const width=original_width+(e.pageX-original_mouse_x)/scale_scene
                if(width>minSize){s.style.width=width+'px'}
            }else if (sizer.classList.contains('rotate')) {
                let b=s.getBoundingClientRect();original_x=b.left+b.width/2;original_y=b.top+b.height/2;
                angle=Math.atan2(e.pageX-original_x,-(e.pageY-original_y))*(180/Math.PI);
                s.style.transform='rotate('+angle+'deg)';
            };
        };
        function stopResize(){
            window.removeEventListener('mousemove',resize);
            moveSize=true;
            saveResize(angle);angle=0;
        }
        sizer.addEventListener('touchstart',function(e){
            moveSize=false
            scene_scroll=false
            e.preventDefault()
            original_width=parseFloat(getComputedStyle(s,null).getPropertyValue('width').replace('px',''));
            original_height=parseFloat(getComputedStyle(s,null).getPropertyValue('height').replace('px',''));
            original_x=parseFloat(getComputedStyle(s,null).getPropertyValue('left').replace('px',''));
            original_y=parseFloat(getComputedStyle(s,null).getPropertyValue('top').replace('px',''));
            original_mouse_x=e.touches[0].pageX;
            original_mouse_y=e.touches[0].pageY;
            window.addEventListener('touchmove',resizeTouch)
            screen_preview.addEventListener('touchend',stopResizeTouch)
        })
        function resizeTouch(e){
            if(sizer.classList.contains('bottom-right')){
                const width=original_width+(e.touches[0].pageX-original_mouse_x)/scale_scene;
                const height=original_height+(e.touches[0].pageY-original_mouse_y)/scale_scene
                if(width>minSize){s.style.width=width+'px'}
                if(height>minSize){s.style.height=height+'px'}
            }else if(sizer.classList.contains('bottom-left')){
                const height=original_height+(e.touches[0].pageY-original_mouse_y)/scale_scene
                const width=original_width-(e.touches[0].pageX-original_mouse_x)/scale_scene
                if(height>minSize){s.style.height=height+'px'}
                if(width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.touches[0].pageX-original_mouse_x)/scale_scene+'px'}
            }else if(sizer.classList.contains('top-right')){
                const width=original_width+(e.touches[0].pageX-original_mouse_x)/scale_scene
                const height=original_height-(e.touches[0].pageY-original_mouse_y)/scale_scene
                if(width>minSize){s.style.width=width+'px'}
                if(height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.touches[0].pageY-original_mouse_y)/scale_scene+'px'}
            }else if(sizer.classList.contains('top-left')){
                const width=original_width-(e.touches[0].pageX-original_mouse_x)/scale_scene
                const height=original_height-(e.touches[0].pageY-original_mouse_y)/scale_scene
                if(width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.touches[0].pageX-original_mouse_x)/scale_scene+'px'}
                if(height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.touches[0].pageY-original_mouse_y)/scale_scene+'px'}
            }else if(sizer.classList.contains('size-top')){
                const height=original_height-(e.touches[0].pageY-original_mouse_y)/scale_scene
                if(height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.touches[0].pageY-original_mouse_y)/scale_scene+'px'}
            }else if(sizer.classList.contains('size-bottom')){
                const height=original_height+(e.touches[0].pageY-original_mouse_y)/scale_scene
                if(height>minSize){s.style.height=height+'px'}
            }else if(sizer.classList.contains('size-left')){
                const width=original_width-(e.touches[0].pageX-original_mouse_x)/scale_scene
                if(width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.touches[0].pageX-original_mouse_x)/scale_scene+'px'}
            }else if(sizer.classList.contains('size-right')){
                const width=original_width+(e.touches[0].pageX-original_mouse_x)/scale_scene
                if(width>minSize){s.style.width=width+'px'}
            }else if (sizer.classList.contains('rotate')) {
                let b=s.getBoundingClientRect();original_x=b.left+b.width/2;original_y=b.top+b.height/2;
                angle=Math.atan2(e.touches[0].pageX-original_x,-(e.touches[0].pageY-original_y))*(180/Math.PI);
                s.style.transform='rotate('+angle+'deg)';
            };
        };
        function stopResizeTouch(){
            window.removeEventListener('touchmove',resizeTouch);
            moveSize=true;
            saveResize(angle);angle=0;
        }
    }
}
function saveResize(a){
    if(!scene_scroll){
        arr_e.position[0]=0;arr_e.position[1]=0;arr_e.position[2]=0;arr_e.position[3]=0
        var layout_width=parseFloat(getComputedStyle(scene_layout,null).getPropertyValue('width').replace('px',''));
        var layout_height=parseFloat(getComputedStyle(scene_layout,null).getPropertyValue('height').replace('px',''));
        var z=resizers.style.left.replace('px','')
        var b=((objFocus.style.paddingTop.replace('px',''))*2) + ((objFocus.style.borderTopWidth)?parseFloat(objFocus.style.borderTopWidth):0) + ((objFocus.style.borderBottomWidth)?parseFloat(objFocus.style.borderBottomWidth):0);
        var r=((objFocus.style.paddingLeft.replace('px',''))*2) + ((objFocus.style.borderRightWidth)?parseFloat(objFocus.style.borderRightWidth):0) + ((objFocus.style.borderLeftWidth)?parseFloat(objFocus.style.borderLeftWidth):0);
        if((layout_width/2)>=z){arr_e.position[0]=(z/layout_width*100).toFixed(2)+'%';}
        else{ z=parseFloat(getComputedStyle(resizers,null).getPropertyValue('right').replace('px',''));arr_e.position[1]=(z/layout_width*100).toFixed(2)+'%';}
        z=resizers.style.top.replace('px','')
        if((layout_height/2)>=z){arr_e.position[2]=(z/layout_height*100).toFixed(2)+'%';}
        else{z=parseFloat(getComputedStyle(resizers,null).getPropertyValue('bottom').replace('px',''));arr_e.position[3]=(z/layout_height*100).toFixed(2)+'%';}
        if(!a==0){arr_e.angle=a.toFixed(2);}
        if(arr_e.url){
            arr_e.size[0]=((resizers.style.width.replace('px','')-r)/layout_width*100).toFixed(2)+'%';
            arr_e.size[1]=((resizers.style.height.replace('px','')-b)/layout_height*100).toFixed(2)+'%';
        }else{
            arr_e.size[0]=(resizers.style.width.replace('px','')-r)+'px';
            arr_e.size[1]=(resizers.style.height.replace('px','')-b)+'px';
        }
        objFocus.style.transform=resizers.style.transform;
        resizers.style.transform="";
        scen_edit_updare(true)
    }
    document.onmouseup=null;
    document.onmousemove=null;
    document.ontouchend=null;
    document.ontouchmove=null;
    scene_scroll=true
    state_save();
}
makeResizableDiv(document.getElementById("resizers"));
var state_num=0;
function state_save(){
    if(state_num>0){back_up.splice(0,state_num);state_num=0;}
    back_up.unshift(JSON.stringify(story_script));
    if(back_up.length>10){back_up.pop();}
}
function state_back(n){
    state_num+=n
    if(state_num<0){state_num=0}else if(state_num>=back_up.length-1){state_num=back_up.length-1};
    story_script=JSON.parse(back_up[state_num]);
    if(scene_screen){scen_edit_updare(true)}else{update_novel();}
}
document.addEventListener("DOMContentLoaded", function() {
        var s=document.createElement("script");
        s.type = "text/javascript";
        s.src = "https://tuesday.wantasoul.com/js/tue_cloud.js";
        document.body.appendChild(s);}
);
</script>
</body>
</html>
