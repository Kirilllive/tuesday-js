<!doctype html>
<html>
<head>
<title>Tuesday JS web visual editor</title>
<link rel="shortcut icon" href="icon.jpg" type="image/x-icon">
<meta charset="UTF-8">
<meta name='viewport' content='width=device-width,initial-scale=1,user-scalable=no'/>
<link rel="stylesheet" href="styles.css">
</head>
<body onload="world_size();" style='background-color:var(--cw);font-size:12px;'>
    <input type="file" id="json_file" style="display:none;position:fixed;" multiple webkitdirectory/>
    <audio id='audio_preplay' onended='this.currentTime=0' style="display:none;position:fixed;"></audio>
	<div id="menu_panel" style='overflow:hidden;'>
		<table width="100%" height="100%">
			<tbody>
				<tr>
					<td title='New project' onclick='new_project();menu_add.style.visibility="hidden";' class='icon button_menu icon_new'></td>
                    <td title='Load project folder' onclick='json_file.value=null;load_new=false;json_file.click();menu_add.style.visibility="hidden";' class='icon button_menu icon_load'></td>
					<td title='Save JSON script project' onclick='save_file();menu_add.style.visibility="hidden";' class='icon button_menu icon_save'></td>
                    <td title='Undo' onclick='state_back(1);' class='icon button_menu icon_undo'></td>
                    <td title='Redo' onclick='state_back(-1);' class='icon button_menu icon_undo' style='transform:scaleX(-1);'></td>
                    <td title='Settings project' onclick='setup();menu_add.style.visibility="hidden";' class='icon button_menu icon_setup'></td>
                    <td title='Project code' onclick='global_scripts();menu_add.style.visibility="hidden";' class='icon button_menu icon_json'></td>
                    <td title='Dialogues & texts' onclick='text_export();menu_add.style.visibility="hidden";' class='icon button_menu icon_text'></td>
                    <td title='About visual editor' onclick='about();menu_add.style.visibility="hidden";' class='icon button_menu icon_about small_menu'></td>
                    <td style='width:88px;' class="small_menu"><input type="text" id="search_block" class="search" oninput="search_block()" onkeyup="search_block()" placeholder="Search block" list="list_blocks"><datalist id="list_blocks"></datalist></td>
                    <td style='width:40px;'><select id='language_view' style='height:40px;border-right:1px solid var(--cb);border-bottom:0;'><option value='en'>EN</option></select></td>
					<!-- Builds directly to ZIP -->
                    <td title='Build project' onclick='build();menu_add.style.visibility="hidden";' class='icon button_menu img_zip'></td>
					<td title='Run preview Project' style='border-radius:0 0 16px 0;' onclick='play_novel();menu_add.style.visibility="hidden";' class='icon button_menu icon_play'></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div id="new_story_block">
        <table height="100%">
        <tbody>
            <tr>
                <td class='button_menu' style='border-radius:20px 0 0 20px;border-right:1px solid var(--cb);'><table onclick='new_block()' height="100%"><tbody><tr><td width='42px' class='icon icon_add'></td><td align='center'>Add story block</td><td width='16px'></td></tr></tbody></table></td>
                <td width="42px" class='icon button_menu icon_about' onclick='project_statist()' style='border-right:1px solid var(--cb);'></td>
                <td width="42px" class='icon button_menu icon_equal' onclick='world_scale(2)'></td>
                <td width="42px" class='icon button_menu icon_scale' onclick='world_scale(1)'></td>
                <td width="42px" class='icon button_menu icon_minus' onclick='world_scale(false)' style='border-radius:0 20px 20px 0;'></td>
            </tr>
        </tbody>
        </table>
	</div>
	<a id="downloadAnchorElem" style="display:none;position:fixed;"></a>
    <div id='world'>
	<svg id="story_lines" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"></svg>
	<div id="story_blocks"></div>
    </div>
    <!--scene_maker-->
    <div id='scene_maker'>
        <table style="height:100vh;width:100%;">
            <tbody>
                <tr><td rowspan="3" style="position:relative;">
                    <div id='scene_view' style='width:calc(100vw - 286px);height:100vh;overflow:auto;box-sizing:border-box;' align='center' onmouseover='this.tabindex=1' onmouseout='this.tabindex=0'>
                        <div id='screen_preview' style='background-color:var(--cw);background-blend-mode:overlay;transform-origin:0 0;min-width:100%;min-height:100%;padding-top:40px;display:flex;justify-content:center;align-items:center;transform:scale(1);'> <!--onmouseup="window.getSelection().removeAllRanges();"-->
                        <div class="offselect" onclick='if(objFocus){scene_scroll=false;saveResize()};'></div>
                            <div id='scene_canvas'><div class="offselect" onclick='if(objFocus){scene_scroll=false;saveResize()};'></div>
                            <div id='scene_layout'><div class="offselect" onclick='if(objFocus){scene_scroll=false;saveResize()};'></div>
                                <div id='resizers' class='drag' style='visibility:hidden;'>
                                    <div class='resizer size-right'></div>
                                    <div class='resizer size-left'></div>
                                    <div class='resizer size-bottom'></div>
                                    <div class='resizer size-top'></div>
                                    <div class='resizer top-right'></div>
                                    <div class='resizer top-left'></div>
                                    <div class='resizer bottom-right'></div>
                                    <div class='resizer bottom-left'></div>
                                    <div class='resizer rotate'></div>
                                </div>
                            <table id="tue_text_block" align="center" onclick='if(objFocus){scene_scroll=false;saveResize()};'>
                                <tbody>
                                   <tr>
                                        <td id="tue_text_element" style="position:relative;" valign='top'>
                                            <div id="tue_text_view" ></div>
                                            <div id="tue_name_block"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div></div>
                        </div>
                    </div>
                    <div id="scene_controll" style="right:320px;">
                        <table height="100%">
                        <tbody>
                            <tr>
                                <td width="42px" class='icon button_menu icon_right' onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_editor(scen_data[0],scen_data[1],scen_data[2]-1);scen_edit_data();menu_add.style.visibility="hidden";' style='border-radius:20px 0 0 20px;'></td>
                                <td width="42px" class='icon button_menu icon_go'    onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_editor(scen_data[0],scen_data[1],scen_data[2]+1);scen_edit_data();menu_add.style.visibility="hidden";' style='border-right:1px solid var(--cb);'></td>
                                <td width="42px" class='icon button_menu icon_equal' onclick='world_scale(2)'></td>
                                <td width="42px" class='icon button_menu icon_scale' onclick='world_scale(1)'></td>
                                <td width="42px" class='icon button_menu icon_minus' onclick='world_scale(false)'></td>
                                <td width="42px" class='icon button_menu icon_play'  onclick="play_novel(scen_data[0],true)" style='border-left:1px solid var(--cb);border-radius:0 20px 20px 0;'></td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                    <div class="scene_close" onclick='saveResize();scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_edit_update(false);'><div class="icon button_menu icon_undo"></div></div>
                </td>
                    <td id='scrnr_title' height="40px" align='center' style="background-color:var(--wn);width:286px;" class='namber set_layout_panel'>block name (scene:1 | dialog:1)</td></tr>
                <tr>
                    <td style="background-color:var(--wn);border-bottom:1px solid var(--cb);border-top:1px solid var(--cb);" class='set_layout_panel'><div id='scen_setup' style='height:calc(100vh - 80px);overflow-x:hidden;overflow-y:auto;position:relative;'>
                        <table onclick="block_open('set_preview');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Preview</td></tr></tbody></table>
                        <div class="set_panel" id="set_preview" style="width:100%;display:block;">
                        <table id="set_layout" style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Orientation</td><td style='padding-right:8px;'>
                                <select id='ratio_screen' oninput='setup_editor.preview[1]=this.selectedIndex;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));if(objFocus){scene_scroll=false;saveResize()};preview_size(false);video_size();' style='width:100%;'>
                                      <option value=true selected>landscape</option>
                                      <option value=false>Portrait</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Backstage</td><td style='padding-right:8px;'>
                               <select id='off_screen' oninput='setup_editor.preview[3]=this.value;scene_layout.style.overflow=(this.value==1)?"visible":"hidden";localStorage.setItem("editor_setup",JSON.stringify(setup_editor));' style='width:100%;'>
                                    <option value="0">Hidden</option>
                                    <option value="1">Show</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Size</td><td style='padding-right:8px;'>
                               <select id='screen_size' oninput='setup_editor.preview[2]=this.selectedIndex;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));if(objFocus){scene_scroll=false;saveResize()};preview_size(true);' style='width:100%;'>
                                    <option value="0" selected>Default screen</option>
                                    <option value="-1">Preview size</option>
                                    <option value="-2">Screen size</option>
                                    <option disabled></option>
                                    <option value="1080">1080p FHD</option>
                                    <option value="720">720p HD</option>
                                    <option value="480">480i SDTV</option>
                                    <option value="360">360i LDTV</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Screen</td><td style='padding-right:8px;'>
                               <select id='aspect_ratio' oninput='p_width.value=this.value;setup_editor.preview[0]=this.value;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));if(objFocus){scene_scroll=false;saveResize()};preview_size(false);video_size();' style='width:100%;'>
                                    <option value="100">1:1</option>
                                    <option value="76">4:3</option>
                                    <option value="56">16:9</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Ratio</td><td style='padding-right:8px;'>
                                <input id='p_width' class='input_slider input_slider_progress' onchange='aspect_ratio.selectedIndex="-1";setup_editor.preview[0]=this.value;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));' oninput='if(objFocus){scene_scroll=false;saveResize();}preview_size(false);video_size();' type="range" value='100' min="50" max="100" style='width:100%;'>
                            </td></tr>
                        </tbody></table></div>
                        <table onclick="block_open('set_scene');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Scene content</td></tr></tbody></table>
                        <div class="set_panel" id="set_scene" style="width:100%;display:none;">
                            <table style="width:100%;"><tbody>
                                <tr><td align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_edit'><tbody><tr><td width='60px' class='icon_m icon_art'></td><td align='left'>Scene edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_json'><tbody><tr><td width='60px' class='icon_m icon_json'></td><td align='left'>JSON edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_text'><tbody><tr><td width='60px' class='icon_m icon_edit2'></td><td align='left'>Text edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_video'><tbody><tr><td width='60px' class='icon_m icon_video'></td><td align='left'>Video</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_audio_play'><tbody><tr><td width='60px' class='icon_m icon_audio_play'></td><td align='left'>Play sound</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_audio_off'><tbody><tr><td width='60px' class='icon_m icon_audio_off'></td><td align='left'>Stop sound</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_var'><tbody><tr><td width='60px' class='icon_m icon_var'></td><td align='left'>Variable</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_html'><tbody><tr><td width='60px' class='icon_m icon_html'></td><td align='left'>HTML</td><td width='42px'></td></tr></tbody></table>
                                </td></tr><tr><td height='40px' align='center' valign='center' style='border-bottom:1px solid var(--cw);'>
                                    <table class='edit_button' width='100%' id='s_scene_js'><tbody><tr><td width='60px' class='icon_m icon_js'></td><td align='left'>JavaScript</td><td width='42px'></td></tr></tbody></table>
                                </td></tr>
                            </tbody></table>
                        </div>
                        <table onclick="block_open('text_panel_g');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Text panel</td></tr></tbody></table>
                        <div class="set_panel" id="text_panel_g" style="width:100%;display:none;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_w' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.size[0]=this.value;scen_edit_update(true);state_save()' type="text" value='95%' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_h' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.size[1]=this.value;scen_edit_update(true);state_save()' type="text" value='25%' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Indent text</td><td style='padding-right:8px;' colspan='3'>
                                <input id='indent_text' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.indent_text=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Text</td>
                            </tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color text</td><td style='width:40px;' align='center'><div class='show_color' id='color_text_s'></div></td><td style='padding-right:8px;'>
                                <input id='color_text' class='input_text' onchange='story_script.parameters.text_panel.color_text=this.value;color_text_s.style.backgroundColor=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color' onclick='edit_color("color_text",color_text.value)'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_text' class='input_text' onchange='if(this.value.length>0){this.value=correct_value(this.value);story_script.parameters.text_panel.size_text=this.value;}else{delete story_script.parameters.text_panel.size_text}scen_edit_update(true);state_save()' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font family</td><td style='padding-right:8px;' colspan='3'>
                                <input id='font_family' class='input_text' onchange='if(this.value.length>0){story_script.parameters.text_panel.font_family=this.value}else{delete story_script.parameters.text_panel.font_family};scen_edit_update(true);state_save()' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Dialog speed</td><td style='padding-right:8px;' colspan='3'>
                                <input id='dialog_speed' class='input_text' onchange='this.value=correct_value(this.value,true);story_script.parameters.text_panel.dialog_speed=this.value;state_save()' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Console mode</td><td style='padding-right:8px;' colspan='3'>
                                <select id="console_mode" oninput="if(this.selectedIndex!=0){story_script.parameters.text_panel.scroll=true}else{delete story_script.parameters.text_panel.scroll};state_save()">
                                    <option>Off</option>
                                    <option>Text autoscroll</option>
                                </select>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Position</td>
                            </tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Top position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_t' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.position[2]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Left position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_l' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.position[0]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Bottom position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='indent_bottom' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.indent_bottom=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Right position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_r' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.text_panel.position[1]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Style</td>
                            </tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='2'>
                                <input id='style' class='input_text' onchange='scen_edit_update(true)' type="text" value='' style='width:100%;'>
                            </td><td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.text_panel;edit_code('style','Style CSS');">
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Class name</td><td style='padding-right:8px;' colspan='3'>
                                <input id='className' class='input_text' onchange='scen_edit_update(true)' type="text" value='100' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color panel</td><td style='width:40px;' align='center'><div class='show_color' id='color_t_s'></div></td><td style='padding-right:8px;'>
                                <input id='color_t' class='input_text' onchange='story_script.parameters.text_panel.color=this.value;color_t_s.style.backgroundColor=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color' onclick='edit_color("color_t",color_t.value)'>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">End text cursor</td>
                            </tr>
                            <tr><td height="40px" align="right" style="padding-right:8px;">Art</td>
                                <td colspan='2'><input id="etc_i" class="input_text" onchange='if(!story_script.parameters.text_panel.end_text_cursor){story_script.parameters.text_panel.end_text_cursor=[0,0,0,""]};story_script.parameters.text_panel.end_text_cursor[0]=this.value;scen_edit_update(true);' type="text" style="width:100%;height:28px" ></td>
                                <td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="if(!story_script.parameters.text_panel.end_text_cursor){story_script.parameters.text_panel.end_text_cursor=[0,0,0,'']};file_catalog('','img','etc_i',1,'story_script.parameters.text_panel.end_text_cursor[0]')">
                            </td></tr>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='etc_w' class='input_text' onchange='if(!story_script.parameters.text_panel.end_text_cursor){story_script.parameters.text_panel.end_text_cursor=[0,0,0,""]};this.value=correct_value(this.value);story_script.parameters.text_panel.end_text_cursor[1]=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='etc_h' class='input_text' onchange='if(!story_script.parameters.text_panel.end_text_cursor){story_script.parameters.text_panel.end_text_cursor=[0,0,0,""]};this.value=correct_value(this.value);story_script.parameters.text_panel.end_text_cursor[2]=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='2'>
                                <input id='etc_s' class='input_text' onchange='if(!story_script.parameters.text_panel.end_text_cursor){story_script.parameters.text_panel.end_text_cursor=[0,0,0,""]};story_script.parameters.text_panel.end_text_cursor[3]=this.value;scen_edit_update(true);' type="text" style='width:100%;'>
                            </td><td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.text_panel.end_text_cursor;edit_code('3','Style CSS');">
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Background image</td>
                            </tr>
                            </tbody><tbody id='atp_edit'>
                        </tbody></table>
                        </div>
                        <table onclick="block_open('name_panel_g');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Name panel</td></tr></tbody></table>
                        <div class="set_panel" id="name_panel_g" style="width:100%;display:none;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%;padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_w' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.size[0]=this.value;scen_edit_update(true);state_save();' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_h' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.size[1]=this.value;scen_edit_update(true);state_save();' type="text" value='48px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Indent text</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_indent_text' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.indent_text=(this.value.length>0)?this.value:0;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Text</td>
                            </tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color text</td><td style='width:40px;' align='center'><div class='show_color' id='n_color_text_s'></div></td><td style='padding-right:8px;'>
                                <input id='n_color_text' class='input_text' onchange='story_script.parameters.name_panel.color_text=n_color_text.value;n_color_text_s.style.backgroundColor=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color' onclick='edit_color("n_color_text",n_color_text.value)'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_text' class='input_text' onchange='if(this.value.length>0){this.value=correct_value(this.value);story_script.parameters.name_panel.size_text=this.value;}else{delete story_script.parameters.name_panel.size_text;}scen_edit_update(true);state_save()' type="text" value='18px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font family</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_font_family' class='input_text' onchange='if(this.value.length>0){this.value=correct_value(this.value);story_script.parameters.name_panel.font_family=this.value;}else{delete story_script.parameters.name_panel.font_family;}scen_edit_update(true);state_save()' type="text" value='20px' style='width:100%;'>
                            </tr><tr>
                                <td height="40px" align="right" style="padding-right:8px;">Align text</td>
                                <td colspan="3" align="center">
                                <table style="border-radius:4px;"><tbody id='n_align_tp'></tbody></table>
                                </td>
                            </tr><tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Position</td>
                            </tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Top position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_t' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.position[2]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Left position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_l' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.position[0]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Bottom position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_b' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.position[3]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Right position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_r' class='input_text' onchange='this.value=correct_value(this.value);story_script.parameters.name_panel.position[1]=this.value;scen_edit_update(true);state_save()' type="text" value='0' style='width:100%;'>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Style</td>
                            </tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='2'>
                                <input id='n_style' class='input_text' onchange='scen_edit_update(true)' type="text" style='width:100%;'>
                            </td><td height="40px" align="right" style="width:30px;" class="icon icon_edit" onclick="copy_arr=story_script.parameters.name_panel;edit_code('style','Style CSS');">
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Class name</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_className' class='input_text' onchange='story_script.parameters.name_panel.className=this.value;scen_edit_update();state_save()' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color panel</td><td style='width:40px;' align='center'><div class='show_color' id='n_color_s'></div></td><td style='padding-right:8px;'>
                                <input id='n_color' class='input_text' onchange='story_script.parameters.name_panel.color=this.value;n_color_s.style.backgroundColor=this.value;scen_edit_update(true);state_save()' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color' onclick='edit_color("n_color",n_color.value)'>
                            </td></tr>
                                <tr><td colspan="4" height="40px" align="left" style="padding-left:8px;border-bottom:1px solid var(--cb);">Background image</td>
                            </tr>
                            </tbody><tbody id='anp_edit'>
                        </tbody></table>
                        </div>
                        <table onclick="block_open('interface_buttons');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Interface buttons</td></tr></tbody></table>
                        <div class="interface_buttons" id="interface_buttons" style="width:100%;display:none;"><div id='interface_buttons_c' style='margin-bottom:12px;'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_scen_items' class='add_button icon_m icon_add' onclick='interface_buttons_c.innerHTML+=button_panel_edit(-1);state_save();button_panel_update();'></div></div>
                        </div>
                        <table onclick="block_open('arts_e');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Arts</td></tr></tbody></table>
                        <div class="set_panel" id="arts_e" style="width:100%;display:block;"><div id='arts_ec' style='margin-bottom:12px;'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_art' class='add_button icon_m icon_add'></div></div>
                        </div>
                        <table onclick="block_open('choice_e');" class="set_title"  height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Buttons & Choice</td></tr></tbody></table>
                        <div class="set_panel" id="choice_e" style="width:100%;display:block;"><div id='choice_ec' style='margin-bottom:12px;'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_choice' class='add_button icon_m icon_add'></div></div>
                        </div>
                        <div id='menu_element' align='center' style='z-index:10040;position:absolute;right:64px;top:0;visibility:hidden;width:190px;'></div>
                    </div></td>
                </tr>
                <tr>
                    <td height="40px" align='center' style="background-color:var(--wn);" class='button_menu set_layout_panel'><table class='button_menu' width='100%' height="100%" onclick='saveResize();scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_edit_update(false);'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Back</td><td width='42px'></td></tr></tbody></table></td>
                </tr>
            </tbody>
        </table>
    </div>
    <!--scene_maker-->
    <div id='tools_zone' align='center'></div>
	<div id='window_zone' align='center'></div>
    <div id='add_element' align='center' style='z-index:10030;'></div>
    <div id="toast"></div>
<script id="runtime" type="text">
let story_json = [];
var tue_text_view, tue_text_block, tue_text_element, languare, dialog_text, dialog_timeout, tue_story, tue_bg_music, arr_dialog, timers, tuesday = document.getElementById("tuesday"),
  tue_name_block = document.createElement("div"),
  scene = 0,
  dialog = 0,
  dialog_speed = 50,
  dialog_letter = 0,
  tue_set_audio = 0,
  tue_fullScreen = !1,
  controll = !0,
  ruby_rt = [];

function cmenu() {
  return !1
}

function get_lang() {
  languare = void 0 != navigator.languages ? navigator.languages[0].substring(0, 2) : navigator.languagesubstring(0, 2);
  for (var e, t = 0; t < story_json.parameters.languares.length; t++) languare == story_json.parameters.languares[t] && (e = !0);
  e || (languare = story_json.parameters.languares[0])
}

function load_story(e, t) {
  if ("data" == e) story_json = t, base_creation(), tuesday.dispatchEvent(new Event("script_loaded")), story_json.parameters.sounds && creation_sound();
  else if ("file" == e) {
    var a = new XMLHttpRequest;
    a.onreadystatechange = function() {
      if (4 == this.readyState && (200 == this.status || 0 == this.status)) {
        try {
          story_json = JSON.parse(this.responseText)
        } catch (e) {
          this.status > 0 && alert("Json structure error")
        }
        base_creation(), tuesday.dispatchEvent(new Event("script_loaded")), story_json.parameters.sounds && creation_sound()
      }
    }, a.open("GET", t, !0), a.send(), a.onerror = function() {
      0 == this.status && alert("Error load json file Cross-Origin Resource Sharing(CORS)")
    }
  }
}

function name_block_update() {
  story_json.parameters.name_panel.color && (tue_name_block.style.backgroundColor = story_json.parameters.name_panel.color), story_json.parameters.name_panel.color_text ? tue_name_block.style.color = story_json.parameters.name_panel.color_text : tue_name_block.style.color = story_json.parameters.text_panel.color_text, tue_name_block.style.position = "absolute", tue_name_block.id = "tue_name_block", tue_name_block.style.padding = story_json.parameters.name_panel.indent_text, tue_name_block.style.fontSize = story_json.parameters.name_panel.size_text ? story_json.parameters.name_panel.size_text : story_json.parameters.font_size, tue_name_block.style.fontFamily = story_json.parameters.name_panel.font_family ? story_json.parameters.name_panel.font_family : story_json.parameters.font, tue_name_block.style.display = "flex", tue_name_block.style.justifyContent = story_json.parameters.name_panel.align ? story_json.parameters.name_panel.align[0] : "center", tue_name_block.style.alignItems = story_json.parameters.name_panel.align ? story_json.parameters.name_panel.align[1] : "center", (tue_name_block.style.width = 0 != story_json.parameters.name_panel.size[0]) && (tue_name_block.style.width = story_json.parameters.name_panel.size[0]), tue_name_block.style.height = story_json.parameters.name_panel.size[1], tue_name_block.style.left = "" == story_json.parameters.name_panel.position[0] || "0" == story_json.parameters.name_panel.position[0] ? null : story_json.parameters.name_panel.position[0], tue_name_block.style.right = "" == story_json.parameters.name_panel.position[1] || "0" == story_json.parameters.name_panel.position[1] ? null : story_json.parameters.name_panel.position[1], tue_name_block.style.top = "" == story_json.parameters.name_panel.position[2] || "0" == story_json.parameters.name_panel.position[2] ? "" == story_json.parameters.name_panel.position[3] || "0" == story_json.parameters.name_panel.position[3] ? "0px" : null : story_json.parameters.name_panel.position[2], tue_name_block.style.bottom = "" == story_json.parameters.name_panel.position[3] || "0" == story_json.parameters.name_panel.position[3] ? null : story_json.parameters.name_panel.position[3], tue_name_block.style.zIndex = 1001
}

function base_creation() {
  if (get_lang(), localStorage.getItem("tue_set_audio") && (tue_set_audio = JSON.parse(localStorage.getItem("tue_set_audio"))), story_json.parameters.style_file && add_style(story_json.parameters.style_file), dialog_speed = story_json.parameters.text_panel.dialog_speed, story_json.parameters.title && (story_json.parameters.title[languare] ? document.title = story_json.parameters.title[languare] : document.title = story_json.parameters.title), story_json.parameters.pixelmode && (tuesday.style.imageRendering = "pixelated", tuesday.style.fontSmooth = "never"), tuesday.style.backgroundRepeat = "no-repeat", tuesday.style.backgroundPosition = "center", tuesday.style.position = "relative", tuesday.style.overflow = "hidden", story_json.parameters.cursors && story_json.parameters.cursors.main && (tuesday.style.cursor = "url(" + art_data(story_json.parameters.cursors.main[0]) + ") " + story_json.parameters.cursors.main[1] + " " + story_json.parameters.cursors.main[2] + ",auto"), tuesday.innerHTML = "<table id='tue_text_block' align='center'><tbody><tr><td id='tue_text_element'><div id='tue_text_view'></div></td></tr></tbody></table>", tue_text_block = document.getElementById("tue_text_block"), (tue_text_element = document.getElementById("tue_text_element"))
    .style.position = "relative", story_json.parameters.text_panel.className && (tue_text_block.className = story_json.parameters.text_panel.className), story_json.parameters.text_panel.style && (tue_text_block.style = story_json.parameters.text_panel.style), tue_text_block.style.position = "absolute", story_json.parameters.text_panel.size && (tue_text_block.style.width = story_json.parameters.text_panel.size[0], tue_text_block.style.height = story_json.parameters.text_panel.size[1], tue_text_element.style.height = story_json.parameters.text_panel.size[1]), story_json.parameters.text_panel.position ? (story_json.parameters.text_panel.position[0] && "0" != story_json.parameters.text_panel.position[0] || story_json.parameters.text_panel.position[1] && "0" != story_json.parameters.text_panel.position[1] ? (tue_text_block.style.left = "0" != story_json.parameters.text_panel.position[0] ? story_json.parameters.text_panel.position[0] : null, tue_text_block.style.right = "0" != story_json.parameters.text_panel.position[1] ? story_json.parameters.text_panel.position[1] : null, tue_text_block.style.margin = null) : (tue_text_block.style.marginLeft = "auto", tue_text_block.style.marginRight = "auto", tue_text_block.style.left = 0, tue_text_block.style.right = 0), tue_text_block.style.top = "0" != story_json.parameters.text_panel.position[2] ? story_json.parameters.text_panel.position[2] : null) : (tue_text_block.style.left = 0, tue_text_block.style.right = 0), tue_text_block.style.bottom = "0" != story_json.parameters.text_panel.indent_bottom ? story_json.parameters.text_panel.indent_bottom : null, tue_text_block.style.zIndex = 1e3, tue_text_block.style.borderSpacing = 0, (tue_text_view = document.getElementById("tue_text_view"))
    .style.boxSizing = "border-box", tue_text_view.style.padding = story_json.parameters.text_panel.indent_text, tue_text_view.style.fontSize = story_json.parameters.text_panel.size_text ? story_json.parameters.text_panel.size_text : story_json.parameters.font_size, tue_text_view.style.fontFamily = story_json.parameters.text_panel.font_family ? story_json.parameters.text_panel.font_family : story_json.parameters.font, tue_text_view.style.whiteSpace = "pre-wrap", tue_text_view.style.height = "100%", story_json.parameters.text_panel.scroll && (tue_text_block.style.paddingTop = story_json.parameters.text_panel.indent_text, tue_text_view.style.height = tue_text_element.offsetHeight + "px", tue_text_view.style.position = "relative", tue_text_view.style.overflowY = "hidden"), story_json.parameters.name_panel && (story_json.parameters.name_panel.className && (tue_name_block.className = story_json.parameters.name_panel.className), story_json.parameters.name_panel.style && (tue_name_block.style = story_json.parameters.name_panel.style), tue_text_element.appendChild(tue_name_block), name_block_update()), (tue_bg_music = document.createElement("AUDIO"))
    .id = "tue_bg_music", tuesday.appendChild(tue_bg_music), story_json.parameters.launch_story) tue_story = story_json.parameters.launch_story;
  else
    for (var e = 0; e < 2; e++)
      if ("parameters" != Object.getOwnPropertyNames(story_json)[e]) {
        story_json.parameters.launch_story = Object.getOwnPropertyNames(story_json)[1], tue_story = story_json.parameters.launch_story;
        break
      } bg_art(story_json.parameters.text_panel, "tue_text_block"), tuesday.dispatchEvent(new Event("script_executed")), story_json.parameters.autosave && localStorage.getItem("tue_auto_data") && (story_json.parameters.variables = JSON.parse(localStorage.getItem("tue_auto_data"))), creation_buttons(), creation_scene()
}

function bg_art(e, t, a) {
  if ((t = document.getElementById(t))
    .style.backgroundRepeat = "no-repeat", t.style.backgroundPosition = e.art_align ? e.art_align[0] + " " + e.art_align[1] : "center", a = a || e.art) {
    var r = art_data(a);
    r.length > 0 && (t.style.backgroundImage = "url('" + r + "')")
  }
  e.art_size && ("patch" == e.art_size && (t.style.backgroundImage = "none"), "object" == typeof e.art_size ? t.style.backgroundSize = e.art_size[0] + " " + e.art_size[1] : "patch" == e.art_size ? (t.style.backgroundImage = "none", t.style.backgroundSize = "none", t.style.backgroundClip = "padding-box", t.style.borderStyle = "solid", t.style.borderWidth = e.patch[0] + "px " + e.patch[1] + "px " + e.patch[2] + "px " + e.patch[3] + "px", t.style.borderImage = "url('" + art_data(e.art) + "') " + e.patch[0] + " " + e.patch[1] + " " + e.patch[2] + " " + e.patch[3] + " stretch stretch") : t.style.backgroundSize = e.art_size)
}

function creation_buttons() {
  for (a = 0; a < story_json.parameters.buttons.length; a++) {
    var e = document.createElement("div"),
      t = "";
    story_json.parameters.buttons[a].sound && (t += story_json.parameters.buttons[a].sound ? get_sound(story_json.parameters.buttons[a].sound) : (story_json.parameters.buttons[a].sound_stop ? ";" + get_stop_sound(story_json.parameters.buttons[a].sound_stop) : "") + ";"), story_json.parameters.buttons[a].js && (t += story_json.parameters.buttons[a].js), e.setAttribute("onclick", t + ";" + ("tue_audio" == story_json.parameters.buttons[a].name ? "set_audio(this,story_json.parameters.buttons[" + a + "]);" : "") + ("tue_fullScreen" == story_json.parameters.buttons[a].name ? "full_screen(this,story_json.parameters.buttons[" + a + "]);" : "") + ("tue_speech" == story_json.parameters.buttons[a].name ? "play_synth(art_data(story_json.parameters.buttons[" + a + "].text1),art_data(story_json.parameters.buttons[" + a + "].text2));" : "") + (story_json[story_json.parameters.buttons[a].name] ? "go_to('" + story_json.parameters.buttons[a].name + "');" : "")), story_json.parameters.buttons[a].className && (e.className = story_json.parameters.buttons[a].className), story_json.parameters.buttons[a].style && (e.style = story_json.parameters.buttons[a].style), story_json.parameters.buttons[a].text && ("object" != typeof story_json.parameters.buttons[a].text || story_json.parameters.buttons[a].text[languare] && "object" != typeof story_json.parameters.buttons[a].text[languare]) && (e.innerHTML = values_button(art_data(story_json.parameters.buttons[a].text)), e.style.padding = story_json.parameters.buttons[a].indent_text, e.style.display = "flex", e.style.whiteSpace = "pre-wrap", e.style.justifyContent = story_json.parameters.buttons[a].align ? story_json.parameters.buttons[a].align[0] : "center", e.style.alignItems = story_json.parameters.buttons[a].align ? story_json.parameters.buttons[a].align[1] : "center", e.style.textAlign = e.style.justifyContent, e.style.color = story_json.parameters.buttons[a].color_text, e.style.fontSize = story_json.parameters.buttons[a].size_text ? story_json.parameters.buttons[a].size_text : story_json.parameters.font_size, e.style.fontFamily = story_json.parameters.buttons[a].font_family ? story_json.parameters.buttons[a].font_family : story_json.parameters.font), e.style.zIndex = 2e3 + a, "none" == story_json.parameters.buttons[a].name || story_json[story_json.parameters.buttons[a].name] || (e.id = story_json.parameters.buttons[a].name), e.classList.add("tue_controll"), e.style.position = "absolute", e.style.transformOrigin = "top left", "0" != story_json.parameters.buttons[a].size[0] && (e.style.width = story_json.parameters.buttons[a].size[0]), "0" != story_json.parameters.buttons[a].size[1] && (e.style.height = story_json.parameters.buttons[a].size[1]), e.style.backgroundColor = story_json.parameters.buttons[a].color, e.style.backgroundRepeat = "no-repeat", story_json.parameters.cursors && story_json.parameters.cursors.button && (e.style.cursor = "url(" + art_data(story_json.parameters.cursors.button[0]) + ") " + story_json.parameters.cursors.button[1] + " " + story_json.parameters.cursors.button[2] + ",auto"), e.style.backgroundPosition = story_json.parameters.buttons[a].art_align ? story_json.parameters.buttons[a].art_align[0] + " " + story_json.parameters.buttons[a].art_align[1] : "center", story_json.parameters.buttons[a].art && (e.style.backgroundImage = "url('" + art_data(story_json.parameters.buttons[a].art) + "')"), story_json.parameters.buttons[a].art_size && ("patch" == story_json.parameters.buttons[a].art_size && (e.style.backgroundImage = "none"), "object" == typeof story_json.parameters.buttons[a].art_size ? e.style.backgroundSize = story_json.parameters.buttons[a].art_size[0] + " " + story_json.parameters.buttons[a].art_size[1] : "patch" == story_json.parameters.buttons[a].art_size ? (e.style.backgroundImage = "none", e.style.backgroundSize = "none", e.style.backgroundClip = "padding-box", e.style.borderStyle = "solid", e.style.borderWidth = story_json.parameters.buttons[a].patch[0] + "px " + story_json.parameters.buttons[a].patch[1] + "px " + story_json.parameters.buttons[a].patch[2] + "px " + story_json.parameters.buttons[a].patch[3] + "px", e.style.borderImage = "url('" + art_data(story_json.parameters.buttons[a].art) + "') " + story_json.parameters.buttons[a].patch[0] + " " + story_json.parameters.buttons[a].patch[1] + " " + story_json.parameters.buttons[a].patch[2] + " " + story_json.parameters.buttons[a].patch[3] + " stretch stretch") : e.style.backgroundSize = story_json.parameters.buttons[a].art_size), e.style.transform = (story_json.parameters.buttons[a].hotspot && 0 != story_json.parameters.buttons[a].hotspot[0] && 0 != story_json.parameters.buttons[a].hotspot[1] ? " translate(" + story_json.parameters.buttons[a].hotspot[0] + "," + story_json.parameters.buttons[a].hotspot[1] + ")" : "") + (story_json.parameters.buttons[a].angle ? "rotate(" + story_json.parameters.buttons[a].angle + "deg)" : ""), 0 != story_json.parameters.buttons[a].position[0] && (e.style.left = story_json.parameters.buttons[a].position[0]), 0 != story_json.parameters.buttons[a].position[1] && (e.style.right = story_json.parameters.buttons[a].position[1]), 0 != story_json.parameters.buttons[a].position[2] && (e.style.top = story_json.parameters.buttons[a].position[2]), 0 != story_json.parameters.buttons[a].position[3] && (e.style.bottom = story_json.parameters.buttons[a].position[3]), tuesday.appendChild(e)
  }
  if (document.getElementById("tue_next") && document.getElementById("tue_next")
    .addEventListener("click", function() {
      go_story()
    }), document.getElementById("tue_back") && document.getElementById("tue_back")
    .addEventListener("click", function() {
      back_story()
    }), document.getElementById("tue_home") && document.getElementById("tue_home")
    .addEventListener("click", function() {
      go_to(story_json.parameters.launch_story)
    }), document.getElementById("tue_save") && document.getElementById("tue_save")
    .addEventListener("click", function() {
      save_stag("bookmark")
    }), document.getElementById("tue_load") && document.getElementById("tue_load")
    .addEventListener("click", function() {
      load_stag("bookmark")
    }), document.getElementById("tue_fastRewind") && document.getElementById("tue_fastRewind")
    .addEventListener("click", function() {
      fast_rewind()
    }), document.getElementById("tue_load_autosave") && document.getElementById("tue_load_autosave")
    .addEventListener("click", function() {
      load_stag("auto")
    }), story_json.parameters.languares.length > 1)
    for (var a = 0; a < story_json.parameters.languares.length; a++) document.getElementById("tue_" + story_json.parameters.languares[a]) && document.getElementById("tue_" + story_json.parameters.languares[a])
      .setAttribute("onclick", "languare ='" + story_json.parameters.languares[a] + "'")
}

function creation_scene() {
  if (arr_dialog = story_json[tue_story][scene], del_element("tue_html_scene"), arr_dialog.random_choice) {
    let e = arr_dialog.random_choice[Math.floor(Math.random() * arr_dialog.random_choice.length)][1];
    "tue_go" != e ? go_to(e) : (scene++, dialog = 0, creation_scene())
  } else if (arr_dialog.legacy_choice) {
    for (var t = 0; t < arr_dialog.legacy_choice.length; t++) {
      var a = arr_dialog.legacy_choice[t][0],
        r = arr_dialog.legacy_choice[t][1],
        s = arr_dialog.legacy_choice[t][2],
        l = arr_dialog.legacy_choice[t][3];
      if (">" == r && story_json.parameters.variables[a] > s) {
        "tue_go" != l ? go_to(l) : n();
        break
      }
      if ("<" == r && story_json.parameters.variables[a] < s) {
        "tue_go" != l ? go_to(l) : n();
        break
      }
      if ("=" == r && story_json.parameters.variables[a] == s) {
        "tue_go" != l ? go_to(l) : n();
        break
      } else if (arr_dialog.legacy_choice[t].go_to) {
        arr_dialog.legacy_choice[t].go_to && "tue_go" != arr_dialog.legacy_choice[t].go_to ? go_to(arr_dialog.legacy_choice[t].go_to) : n();
        break
      } else if (t == arr_dialog.legacy_choice.length - 1) {
        n();
        break
      }
    }

    function n() {
      scene++, dialog = 0, creation_scene()
    }
  } else {
    if (tuesday.style.backgroundSize = arr_dialog.background_size ? arr_dialog.background_size : "cover", arr_dialog.background_class ? tuesday.className = arr_dialog.background_class : tuesday.className = "", arr_dialog.background_color && (tuesday.style.backgroundColor = arr_dialog.background_color), tuesday.style.backgroundPosition = arr_dialog.background_align ? arr_dialog.background_align : "center", arr_dialog.background_image ? tuesday.style.backgroundImage = "url('" + art_data(arr_dialog.background_image) + "')" : tuesday.style.backgroundImage = null, document.getElementById("tue_home") && (tue_story == story_json.parameters.launch_story ? document.getElementById("tue_home")
        .style.visibility = "hidden" : document.getElementById("tue_home")
        .style.visibility = "visible"), arr_dialog.html) {
      if (arr_dialog.html[languare]) {
        var i = document.createElement("div");
        i.className = "tue_html_scene", i.innerHTML = arr_dialog.html[languare], tuesday.appendChild(i)
      } else {
        var i = document.createElement("div");
        i.className = "tue_html_scene", i.innerHTML = arr_dialog.html, tuesday.appendChild(i)
      }
    }
    arr_dialog.background_music && (tue_bg_music.paused || !tue_bg_music.src.includes(encodeURI(arr_dialog.background_music))) ? search_music() : arr_dialog.background_music && "" != arr_dialog.background_music || tue_bg_music.pause(), arr_dialog.dialogs && arr_dialog.dialogs.length > 0 ? creation_dialog() : (del_element("tue_art"), del_element("tue_choice"), del_element("tue_html_dialog"), tue_text_block.style.visibility = "hidden", tue_name_block.style.visibility = "hidden"), tuesday.dispatchEvent(new Event(Object.keys(arr_dialog)[0]))
  }
}

function creation_dialog(next_scene) {
  if ("hidden" != (arr_dialog = story_json[tue_story][scene].dialogs[dialog])
    .controll && "hidden_here" != arr_dialog.controll && (tue_story != story_json.parameters.launch_story || arr_dialog || 0 != dialog || 0 != scene)) {
    if ("visible" == arr_dialog.controll || !arr_dialog.controll || !0 == controll) {
      controll = !0;
      for (var buttons = document.getElementById("tuesday")
          .getElementsByClassName("tue_controll"), i = 0; i < buttons.length; i++) buttons[i].style.visibility = "visible"
    }
  } else {
    controll = "hidden_here" == arr_dialog.controll;
    for (var buttons = document.getElementById("tuesday")
        .getElementsByClassName("tue_controll"), i = 0; i < buttons.length; i++) buttons[i].style.visibility = "hidden"
  }
  if (document.getElementById("tue_next") && (scene != story_json[tue_story].length - 1 || dialog != story_json[tue_story][scene].dialogs.length - 1 || arr_dialog.go_to ? controll && (document.getElementById("tue_next")
        .style.visibility = "visible") : document.getElementById("tue_next")
      .style.visibility = "hidden"), document.getElementById("tue_back") && (0 != scene || 0 != dialog || arr_dialog.back_to ? controll && (document.getElementById("tue_back")
        .style.visibility = "visible") : document.getElementById("tue_back")
      .style.visibility = "hidden"), arr_dialog.text && "" != arr_dialog.text && "" != arr_dialog.text[languare] ? (tue_text_view.innerHTML = "", tue_text_block.style.visibility = "visible", values_in_text(!1), clearTimeout(dialog_timeout), anim_text(), arr_dialog.text.className && (tue_text_block.className = arr_dialog.text.className)) : arr_dialog.text_add && "" != arr_dialog.text_add && "" != arr_dialog.text_add[languare] ? (tue_text_block.style.visibility = "visible", values_in_text(!0), clearTimeout(dialog_timeout), anim_text()) : tue_text_block.style.visibility = "hidden", arr_dialog.color ? tue_text_block.style.backgroundColor = arr_dialog.color : story_json.parameters.text_panel.color && (tue_text_block.style.backgroundColor = story_json.parameters.text_panel.color), arr_dialog.color_text ? tue_text_view.style.color = arr_dialog.color_text : story_json.parameters.text_panel.color_text && (tue_text_view.style.color = story_json.parameters.text_panel.color_text), arr_dialog.name ? (bg_art(story_json.parameters.name_panel, "tue_name_block", !!story_json.parameters.characters[arr_dialog.name] && !!story_json.parameters.characters[arr_dialog.name].art && story_json.parameters.characters[arr_dialog.name].art), arr_dialog.name[languare] ? (tue_name_block.innerHTML = values_button(arr_dialog.name[languare]), tue_name_block.style.backgroundColor = arr_dialog.name.color, tue_name_block.style.color = arr_dialog.name.color_text, arr_dialog.name.className && (tue_name_block.className = arr_dialog.name.className)) : story_json.parameters.characters ? story_json.parameters.characters[arr_dialog.name] ? (story_json.parameters.characters[arr_dialog.name].style && (tue_name_block.style = story_json.parameters.characters[arr_dialog.name].style, name_block_update()), tue_name_block.innerHTML = values_button(story_json.parameters.characters[arr_dialog.name][languare]), tue_name_block.style.backgroundColor = story_json.parameters.characters[arr_dialog.name].color, tue_name_block.style.color = story_json.parameters.characters[arr_dialog.name].color_text, story_json.parameters.characters[arr_dialog.name].className && (tue_name_block.className = story_json.parameters.characters[arr_dialog.name].className)) : (tue_name_block.innerHTML = arr_dialog.name, tue_name_block.style.backgroundColor = arr_dialog.name.color, tue_name_block.style.color = arr_dialog.name.color_text, arr_dialog.name.className && (tue_name_block.className = arr_dialog.name.className)) : tue_name_block.innerHTML = arr_dialog.name, tue_name_block.style.visibility = "visible") : tue_name_block.style.visibility = "hidden", arr_dialog.video) {
    var video = document.getElementById("tue_video");
    video || ((video = document.createElement("video"))
      .id = "tue_video", video.classList.add("tue_v")), arr_dialog.video.style ? video.style = arr_dialog.video.style : video.style = "", arr_dialog.video.className && (video.style = arr_dialog.video.className + " tue_v"), video.style.position = "absolute", video.setAttribute("onloadedmetadata", ""), video.src = art_data(arr_dialog.video.url), video.style.left = "50%", video.style.top = "50%", video.style.transform = "translate(-50%,-50%)", arr_dialog.video.fit && ("contain" == arr_dialog.video.fit ? (video.style.width = "100%", video.style.height = "100%") : "position" == arr_dialog.video.fit && (video.style.transformOrigin = "top left", arr_dialog.video.angle ? video.style.transform = "rotate(" + arr_dialog.video.angle + "deg)" : video.style.transform = "none", video.style.width = arr_dialog.video.size[0], video.style.height = arr_dialog.video.size[1], 0 != arr_dialog.video.position[0] && (video.style.right = null, video.style.left = arr_dialog.video.position[0]), 0 != arr_dialog.video.position[1] && (video.style.left = null, video.style.right = arr_dialog.video.position[1]), 0 != arr_dialog.video.position[2] && (video.style.bottom = null, video.style.top = arr_dialog.video.position[2]), 0 != arr_dialog.video.position[3] && (video.style.top = null, video.style.bottom = arr_dialog.video.position[3]))), arr_dialog.video.loop ? video.loop = arr_dialog.video.loop : video.loop = !1, arr_dialog.video.sound && arr_dialog.video.sound > 0 ? (video.muted = !1, video.volume = arr_dialog.video.sound / 100) : video.muted = !0, arr_dialog.video.time_start ? video.onloadedmetadata = function() {
      this.currentTime = arr_dialog.video.time_start, arr_dialog.video.fit && "cover" != arr_dialog.video.fit || video_size(), arr_dialog.video.stop && this.pause()
    } : "cover" != arr_dialog.video.fit && arr_dialog.video.fit || (video.onloadedmetadata = function() {
      video_size()
    }), arr_dialog.video.time_end ? arr_dialog.video.loop ? video.ontimeupdate = function() {
      video.currentTime >= arr_dialog.video.time_end && (video.currentTime = arr_dialog.video.time_start ? arr_dialog.video.time_start : 0)
    } : arr_dialog.video.go_to ? video.ontimeupdate = function() {
      video.currentTime >= arr_dialog.video.time_end && (video.pause(), "tue_go" == arr_dialog.video.go_to ? go_story(!0) : go_to(arr_dialog.video.go_to))
    } : video.ontimeupdate = function() {
      video.currentTime >= arr_dialog.video.time_end && video.pause()
    } : video.onended = function() {
      "tue_go" == arr_dialog.video.go_to ? go_story(!0) : go_to(arr_dialog.video.go_to)
    }, arr_dialog.video.stop && !0 == arr_dialog.video.stop || (video.autoplay = !0), tuesday.appendChild(video)
  } else del_element("tue_v");
  if (arr_dialog.art) {
    var old = document.getElementById("tuesday")
      .getElementsByClassName("tue_art"),
      src = !1;
    if (old.length > 0) {
      for (d = 0; d < old.length; d++) old[d].classList.add("img_del");
      for (i = 0; i < arr_dialog.art.length; i++) {
        for (o = 0, src = !1; o < old.length; o++)
          if (arr_dialog.art[i].url == old[o].getAttribute("volume") || arr_dialog.art[i].url[languare] == old[o].getAttribute("volume")) {
            arr_dialog.art[i].style && arr_dialog.art[i].style.length > 0 && (old[o].style = "user-select:text;" + arr_dialog.art[i].style, old[o].style.position = "absolute", old[o].style.transformOrigin = "top left"), arr_dialog.art[i].move && 0 != arr_dialog.art[i].move ? (old[o].style.transitionDuration = arr_dialog.art[i].move + "s", arr_dialog.art[i].speed && "" != arr_dialog.art[i].speed ? old[o].style.transitionTimingFunction = arr_dialog.art[i].speed : old[o].style.transitionTimingFunction = null) : (old[o].style.transitionDuration = null, old[o].style.transitionTimingFunction = null), arr_dialog.art[i].opacity ? old[o].style.opacity = arr_dialog.art[i].opacity : old[o].style.opacity = null, arr_dialog.art[i].fit && (old[o].style.objectFit = arr_dialog.art[i].fit), arr_dialog.art[i].size && (old[o].style.width = arr_dialog.art[i].size[0], old[o].style.height = arr_dialog.art[i].size[1]), arr_dialog.art[i].align ? old[o].style.objectPosition = arr_dialog.art[i].align[0] + " " + arr_dialog.art[i].align[1] : old[o].style.objectPosition = "center", old[o].style.transform = (arr_dialog.art[i].hotspot && 0 != arr_dialog.art[i].hotspot[0] && 0 != arr_dialog.art[i].hotspot[1] ? " translate(" + arr_dialog.art[i].hotspot[0] + "," + arr_dialog.art[i].hotspot[1] + ")" : "") + (arr_dialog.art[i].angle ? "rotate(" + arr_dialog.art[i].angle + "deg)" : ""), 0 != arr_dialog.art[i].position[0] && (old[o].style.left = arr_dialog.art[i].position[0]), 0 != arr_dialog.art[i].position[1] && (old[o].style.left = "calc(100% - " + arr_dialog.art[i].position[1] + " - " + ("auto" == arr_dialog.art[i].size[0] ? arr_dialog.art[i].size[1] : arr_dialog.art[i].size[0]) + ")"), 0 != arr_dialog.art[i].position[2] && (old[o].style.top = arr_dialog.art[i].position[2]), 0 != arr_dialog.art[i].position[3] && (old[o].style.top = "calc(100% - " + arr_dialog.art[i].position[3] + " - " + ("auto" == arr_dialog.art[i].size[1] ? arr_dialog.art[i].size[0] : arr_dialog.art[i].size[1]) + ")"), src = !0, arr_dialog.art[i].show_if && show_if(arr_dialog.art[i].show_if, old[o]), old[o].style.zIndex = i, old[o].classList.remove("img_del");
            break
          }! 1 == src && creation_art(i)
      }
      del_element("img_del")
    } else
      for (i = 0; i < arr_dialog.art.length; i++) creation_art(i);

    function creation_art(e) {
      var t = document.createElement("img"),
        a = art_data(arr_dialog.art[e].url);
      arr_dialog.art[e].className && (t.classList = arr_dialog.art[e].className), t.src = "string" == typeof a && a.length > 0 ? a : "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>", t.setAttribute("volume", arr_dialog.art[e].url[languare] ? arr_dialog.art[e].url[languare] : arr_dialog.art[e].url), t.classList.add("tue_art"), t.style = "user-select:text;" + (arr_dialog.art[e].style ? arr_dialog.art[e].style : ""), t.style.position = "absolute", t.style.transformOrigin = "top left", arr_dialog.art[e].fit && (t.style.objectFit = arr_dialog.art[e].fit), arr_dialog.art[e].opacity ? t.style.opacity = arr_dialog.art[e].opacity : t.style.opacity = null, arr_dialog.art[e].size && (t.style.width = arr_dialog.art[e].size[0], t.style.height = arr_dialog.art[e].size[1]), t.style.transform = (arr_dialog.art[e].hotspot && 0 != arr_dialog.art[e].hotspot[0] && 0 != arr_dialog.art[e].hotspot[1] ? " translate(" + arr_dialog.art[e].hotspot[0] + "," + arr_dialog.art[e].hotspot[1] + ")" : "") + (arr_dialog.art[e].angle ? "rotate(" + arr_dialog.art[e].angle + "deg)" : ""), arr_dialog.art[e].align && (t.style.objectPosition = arr_dialog.art[e].align[0] + " " + arr_dialog.art[e].align[1]), 0 != arr_dialog.art[e].position[0] && (t.style.left = arr_dialog.art[e].position[0]), 0 != arr_dialog.art[e].position[1] && (t.style.left = "calc(100% - " + arr_dialog.art[e].position[1] + " - " + arr_dialog.art[e].size[0] + ")"), 0 != arr_dialog.art[e].position[2] && (t.style.top = arr_dialog.art[e].position[2]), 0 != arr_dialog.art[e].position[3] && (t.style.top = "calc(100% - " + arr_dialog.art[e].position[3] + " - " + arr_dialog.art[e].size[1] + ")"), t.setAttribute("draggable", "false"), t.style.zIndex = e, arr_dialog.art[e].show_if && show_if(arr_dialog.art[e].show_if, t), tuesday.appendChild(t)
    }
  } else del_element("tue_art");
  var button_ui = document.getElementsByClassName("tue_controll");
  for (i = 0; i < button_ui.length; i++) "tue_audio" == story_json.parameters.buttons[i].name ? show_audio(button_ui[i], story_json.parameters.buttons[i]) : "tue_fullScreen" == story_json.parameters.buttons[i].name ? show_fullscreen(button_ui[i], story_json.parameters.buttons[i]) : story_json.parameters.buttons[i].text && art_data(story_json.parameters.buttons[i].text)
    .length > 0 && (button_ui[i].innerHTML = values_button(art_data(story_json.parameters.buttons[i].text)));
  if (arr_dialog.choice) {
    var interfaces = !1;
    for (i = 0; i < arr_dialog.choice.length; i++) {
      var choice = document.createElement("div");
      arr_dialog.choice[i].className && (choice.className = arr_dialog.choice[i].className), arr_dialog.choice[i].style && (choice.style = arr_dialog.choice[i].style), choice.classList.add("tue_choice"), choice.style.position = "absolute", choice.style.transformOrigin = "top left", choice.style.backgroundColor = arr_dialog.choice[i].color, choice.style.whiteSpace = "pre-wrap", choice.style.backgroundRepeat = "no-repeat", choice.style.backgroundPosition = arr_dialog.choice[i].art_align ? arr_dialog.choice[i].art_align[0] + " " + arr_dialog.choice[i].art_align[1] : "center", story_json.parameters.cursors && story_json.parameters.cursors.choice && (choice.style.cursor = "url(" + art_data(story_json.parameters.cursors.choice[0]) + ") " + story_json.parameters.cursors.choice[1] + " " + story_json.parameters.cursors.choice[2] + ",auto"), arr_dialog.choice[i].art && art_data(arr_dialog.choice[i].art)
        .length > 0 && (choice.style.backgroundImage = "url('" + art_data(arr_dialog.choice[i].art) + "')"), arr_dialog.choice[i].size && (0 != arr_dialog.choice[i].size[0] && (choice.style.width = arr_dialog.choice[i].size[0]), 0 != arr_dialog.choice[i].size[1] && (choice.style.height = arr_dialog.choice[i].size[1])), arr_dialog.choice[i].art_size && ("patch" == arr_dialog.choice[i].art_size && (choice.style.backgroundImage = "none"), "object" == typeof arr_dialog.choice[i].art_size ? choice.style.backgroundSize = arr_dialog.choice[i].art_size[0] + " " + arr_dialog.choice[i].art_size[1] : "patch" == arr_dialog.choice[i].art_size ? (choice.style.backgroundImage = "none", choice.style.backgroundSize = "none", choice.style.backgroundClip = "padding-box", choice.style.borderStyle = "solid", choice.style.borderWidth = arr_dialog.choice[i].patch[0] + "px " + arr_dialog.choice[i].patch[1] + "px " + arr_dialog.choice[i].patch[2] + "px " + arr_dialog.choice[i].patch[3] + "px", choice.style.borderImage = "url('" + art_data(arr_dialog.choice[i].art) + "') " + arr_dialog.choice[i].patch[0] + " " + arr_dialog.choice[i].patch[1] + " " + arr_dialog.choice[i].patch[2] + " " + arr_dialog.choice[i].patch[3] + " stretch stretch") : choice.style.backgroundSize = arr_dialog.choice[i].art_size), choice.style.transform = (arr_dialog.choice[i].hotspot && 0 != arr_dialog.choice[i].hotspot[0] && 0 != arr_dialog.choice[i].hotspot[1] ? " translate(" + arr_dialog.choice[i].hotspot[0] + "," + arr_dialog.choice[i].hotspot[1] + ")" : "") + (arr_dialog.choice[i].angle ? "rotate(" + arr_dialog.choice[i].angle + "deg)" : ""), 0 != arr_dialog.choice[i].position[0] && (choice.style.left = arr_dialog.choice[i].position[0]), 0 != arr_dialog.choice[i].position[1] && (choice.style.right = arr_dialog.choice[i].position[1]), 0 != arr_dialog.choice[i].position[2] && (choice.style.top = arr_dialog.choice[i].position[2]), 0 != arr_dialog.choice[i].position[3] && (choice.style.bottom = arr_dialog.choice[i].position[3]), choice.style.color = arr_dialog.choice[i].color_text, choice.style.padding = arr_dialog.choice[i].indent_text, choice.style.fontSize = arr_dialog.choice[i].size_text ? arr_dialog.choice[i].size_text : story_json.parameters.font_size, choice.style.fontFamily = arr_dialog.choice[i].font_family ? arr_dialog.choice[i].font_family : story_json.parameters.font, choice.style.display = "flex", choice.style.justifyContent = arr_dialog.choice[i].align ? arr_dialog.choice[i].align[0] : "center", choice.style.alignItems = arr_dialog.choice[i].align ? arr_dialog.choice[i].align[1] : "center", choice.style.textAlign = choice.style.justifyContent, choice.style.zIndex = 1001 + i, arr_dialog.choice[i].show_if && show_if(arr_dialog.choice[i].show_if, choice), arr_dialog.choice[i].text && ("object" != typeof arr_dialog.choice[i].text || arr_dialog.choice[i].text[languare] && "object" != typeof arr_dialog.choice[i].text[languare]) && (choice.innerHTML = values_button(art_data(arr_dialog.choice[i].text))), "tue_audio" == arr_dialog.choice[i].go_to ? show_audio(choice, arr_dialog.choice[i]) : "tue_fullScreen" == arr_dialog.choice[i].go_to && show_fullscreen(choice, arr_dialog.choice[i]);
      var v = "";
      if (arr_dialog.choice[i].variables)
        for (var g = 0; g < arr_dialog.choice[i].variables.length; g++) "add" == arr_dialog.choice[i].variables[g][1] ? v += "story_json.parameters.variables." + arr_dialog.choice[i].variables[g][0] + "+=" + (void 0 !== story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] ? "number" == typeof story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] ? story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] : "'" + story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] + "'" : "number" == typeof arr_dialog.choice[i].variables[g][2] ? arr_dialog.choice[i].variables[g][2] : "'" + arr_dialog.choice[i].variables[g][2] + "'") + ";" : "set" == arr_dialog.choice[i].variables[g][1] && (v += "story_json.parameters.variables." + arr_dialog.choice[i].variables[g][0] + "=" + (void 0 !== story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] ? "number" == typeof story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] ? story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] : "'" + story_json.parameters.variables[arr_dialog.choice[i].variables[g][2]] + "'" : "number" == typeof arr_dialog.choice[i].variables[g][2] ? arr_dialog.choice[i].variables[g][2] : "'" + arr_dialog.choice[i].variables[g][2] + "'") + ";");
      if (arr_dialog.choice[i].js && (v += arr_dialog.choice[i].js + ";"), arr_dialog.choice[i].go_to) {
        var g = arr_dialog.choice[i].go_to;
        if (interfaces || (interfaces = !arr_dialog.choice[i].url && "tue_no" != g), story_json.parameters.languares.length > 1)
          for (var l = 0; l < story_json.parameters.languares.length; l++) g == "tue_" + story_json.parameters.languares[l] && (g = 8, choice.setAttribute("onclick", v + "languare='" + story_json.parameters.languares[l] + "';if(story_json.parameters.title&&story_json.parameters.title[languare]){document.title=story_json.parameters.title[languare];};del_element('tue_choice');go_story(true);" + add_sound()));
        "tue_go" == g || "tue_update_scene" == g ? arr_dialog.choice[i].text_from ? choice.setAttribute("onclick", v + "dialog=" + (dialog + 1) + ";creation_dialog(true);" + add_sound() + (arr_dialog.choice[i].delete ? "this.remove();" : "")) : choice.setAttribute("onclick", "del_element('tue_choice'); " + v + ("tue_go" == g ? "go_story(true);" : "del_element('tue_art');del_element('tue_choice');del_element('tue_html_dialog');creation_dialog();") + add_sound()) : "tue_load_autosave" == g ? (choice.setAttribute("onclick", v + "load_stag('auto');" + add_sound()), story_json.parameters.autosave && !localStorage.getItem("tue_auto_data") && (choice.style.visibility = "hidden")) : "load" == g || "tue_load" == g ? choice.setAttribute("onclick", v + "load_stag('bookmark');" + add_sound()) : "tue_save" == g ? choice.setAttribute("onclick", v + "save_stag('bookmark');" + add_sound()) : "tue_no" == g || "" == g ? choice.setAttribute("onclick", v + add_sound()) : "tue_fullScreen" == g ? choice.setAttribute("onclick", v + "full_screen(this, story_json['" + tue_story + "'][" + scene + "].dialogs[" + dialog + "].choice[" + i + "]);" + add_sound()) : "tue_fastRewind" == g ? choice.setAttribute("onclick", v + "fast_rewind();" + add_sound()) : "tue_audio" == g ? choice.setAttribute("onclick", v + "set_audio(this, story_json['" + tue_story + "'][" + scene + "].dialogs[" + dialog + "].choice[" + i + "]);" + add_sound()) : "tue_speech" == g ? choice.setAttribute("onclick", v + "play_synth(art_data(story_json['" + tue_story + "'][" + scene + "].dialogs[" + dialog + "].choice[" + i + "].text1),art_data(story_json['" + tue_story + "'][" + scene + "].dialogs[" + dialog + "].choice[" + i + "].text2));" + add_sound()) : "tue_home" == g ? choice.setAttribute("onclick", v + 'go_to("' + story_json.parameters.launch_story + '");' + add_sound()) : "tue_back" == g ? choice.setAttribute("onclick", v + "back_story();" + add_sound()) : "tue_next" == g ? choice.setAttribute("onclick", v + "go_story();" + add_sound()) : 8 != g && arr_dialog.choice[i].text_from ? choice.setAttribute("onclick", v + "tue_story='" + arr_dialog.choice[i].go_to + "';scene=0;dialog=0;creation_dialog(true);" + add_sound() + (arr_dialog.choice[i].delete ? "del_element('tue_choice');" : "")) : 8 != g && arr_dialog.choice[i].url ? choice.setAttribute("onclick", v + "window.open('" + (arr_dialog.choice[i].go_to[languare] ? arr_dialog.choice[i].go_to[languare] : arr_dialog.choice[i].go_to) + "','_" + arr_dialog.choice[i].url + "');" + add_sound() + (arr_dialog.choice[i].delete ? "del_element('tue_choice');" : "")) : 8 != g && choice.setAttribute("onclick", v + "go_to('" + g + "');" + add_sound())
      } else choice.setAttribute("onclick", v + "go_story(true);del_element('tue_choice');" + add_sound());

      function add_sound() {
        var e = "";
        return arr_dialog.choice[i].sound && (e = get_sound(arr_dialog.choice[i].sound)), arr_dialog.choice[i].sound_stop && (e += get_stop_sound(arr_dialog.choice[i].sound_stop)), e
      }
      tuesday.appendChild(choice)
    }
    interfaces && document.getElementById("tue_next") && (tue_next.style.visibility = "hidden")
  }
  if ((!next_scene || arr_dialog.html) && del_element("tue_html_dialog"), arr_dialog.html) {
    if (arr_dialog.html[languare]) {
      var html = document.createElement("div");
      html.className = "tue_html_dialog", html.innerHTML = arr_dialog.html[languare], tuesday.appendChild(html)
    } else {
      var html = document.createElement("div");
      html.className = "tue_html_dialog", html.innerHTML = arr_dialog.html, tuesday.appendChild(html)
    }
  }
  if (arr_dialog.variables)
    for (var i = 0; i < arr_dialog.variables.length; i++) {
      var choice_n = arr_dialog.variables[i][0];
      "add" == arr_dialog.variables[i][1] ? (story_json.parameters.variables[choice_n] += arr_dialog.variables[i][2], tuesday.dispatchEvent(new Event(arr_dialog.variables[i][0] + "_add"))) : "set" == arr_dialog.variables[i][1] && (story_json.parameters.variables[choice_n] = arr_dialog.variables[i][2]), tuesday.dispatchEvent(new Event(arr_dialog.variables[i][0] + "_set"))
    }
  if (arr_dialog.event && tuesday.dispatchEvent(new Event(arr_dialog.event)), arr_dialog.sound_stop) {
    var s = arr_dialog.sound_stop[languare] ? arr_dialog.sound_stop[languare] : arr_dialog.sound_stop;
    if ("object" == typeof s)
      for (var i = 0; i < s.length; i++) sound_stop(s[i]);
    else sound_stop(s[languare] ? s[languare] : s)
  }
  if (arr_dialog.sound && tue_set_audio < 2) {
    var s = arr_dialog.sound[languare] ? arr_dialog.sound[languare] : arr_dialog.sound;
    if ("object" == typeof s)
      for (var i = 0; i < s.length; i++) sound_play(s[i]);
    else sound_play(s[languare] ? s[languare] : s)
  }
  arr_dialog.js && eval(arr_dialog.js), clearTimeout(timers), arr_dialog.timer && !timers && (timers = setTimeout(function() {
    "tue_go" == arr_dialog.timer[1] ? go_story(!0) : "tue_update_scene" == arr_dialog.timer[1] ? (del_element("tue_art"), del_element("tue_choice"), del_element("tue_html_dialog"), creation_dialog()) : go_to(arr_dialog.timer[1])
  }, arr_dialog.timer[0])), timers = !1, tuesday.dispatchEvent(new Event("creation_dialog"))
}

function values_in_text(e) {
  arr_dialog = story_json[tue_story][scene].dialogs[dialog];
  var t = "";
  e ? (dialog_letter = dialog_text ? dialog_text.length : 0, t = void 0 !== dialog_text ? dialog_text : "", t += arr_dialog.text_add[languare] ? arr_dialog.text_add[languare] : arr_dialog.text_add) : (dialog_letter = 0, t = arr_dialog.text[languare] ? arr_dialog.text[languare] : arr_dialog.text);
  let a = /<(.*?)>/g;
  ruby_rt = [];
  let r = t.matchAll(a);
  r = Array.from(r);
  for (var s = 0; s < r.length; s++) {
    let l = r[s];
    if (l[1].includes("=")) {
      var n = l[1].split("=")[0];
      ruby_rt.push([n, ruby(l[1])]), t = t.replace(l[0], n)
    } else t = t.replace(l[0], story_json.parameters.variables[l[1]])
  }
  dialog_text = t
}

function values_button(e) {
  let t = e.matchAll(/<(.*?)>/g);
  t = Array.from(t);
  for (var a = 0; a < t.length; a++) {
    let r = t[a];
    e = r[1].includes("=") ? e.replace(r[0], ruby(r[1])) : e.replace(r[0], story_json.parameters.variables[r[1]])
  }
  return e
}

function ruby(e) {
  var t = e.split("=");
  return "<ruby>" + t[0] + "<rt>" + t[1] + "</rt></ruby>"
}

function go_story(e) {
  0 != story_json[tue_story][scene].dialogs.length && (check_choice(story_json[tue_story][scene].dialogs) || e) ? (((arr_dialog = story_json[tue_story][scene].dialogs[dialog])
    .choice && del_element("tue_choice"), arr_dialog.go_to) ? go_to(arr_dialog.go_to) : dialog < story_json[tue_story][scene].dialogs.length - 1 ? (dialog++, arr_dialog.text ? "skip" == arr_dialog.text[languare] ? go_story() : creation_dialog() : arr_dialog.text_add && "skip" == arr_dialog.text_add[languare] ? go_story() : creation_dialog()) : ++scene >= story_json[tue_story].length ? scene = story_json[tue_story].length - 1 : (dialog = 0, creation_scene()), story_json.parameters.autosave && !story_json[tue_story][scene].dialogs[dialog].no_autosave && save_stag("auto")) : story_json[tue_story][scene + 1] && (scene++, dialog = 0, creation_scene()), e || (timers = !1)
}

function back_story() {
  (arr_dialog = story_json[tue_story][scene].dialogs[dialog], del_element("tue_choice"), del_element("tue_html_dialog"), 0 != story_json[tue_story][scene].dialogs.length && arr_dialog.back_to) ? go_to(arr_dialog.back_to): dialog > 0 ? (dialog -= 1, (arr_dialog = story_json[tue_story][scene].dialogs[dialog])
    .text ? "skip" == arr_dialog.text[languare] ? back_story() : creation_dialog() : arr_dialog.text_add ? "skip" == arr_dialog.text_add[languare] ? back_story() : (dialog_text = arr_dialog.text ? dialog_text.replace(arr_dialog.text_add[languare], "") : "", creation_dialog()) : (creation_dialog(), del_element("tue_choice"), del_element("tue_html_dialog"))) : ((scene -= 1) < 0 ? (scene = 0, dialog = 0) : story_json[tue_story][scene].dialogs && (dialog = story_json[tue_story][scene].dialogs.length - 1), creation_scene()), story_json.parameters.autosave && !story_json[tue_story][scene].dialogs[dialog].no_autosave && save_stag("auto")
}

function save_stag(e) {
  localStorage.setItem("tue_" + e + "_scene", scene), localStorage.setItem("tue_" + e + "_dialog", dialog), localStorage.setItem("tue_" + e + "_story", tue_story), story_json.parameters.variables && localStorage.setItem("tue_" + e + "_data", JSON.stringify(story_json.parameters.variables)), "bookmark" == e && tuesday.dispatchEvent(new Event("save"))
}

function load_stag(e) {
  story_json[localStorage.getItem("tue_" + e + "_story")] && (del_element("tue_choice"), del_element("tue_html_scene"), scene = localStorage.getItem("tue_" + e + "_scene"), dialog = localStorage.getItem("tue_" + e + "_dialog"), tue_story = localStorage.getItem("tue_" + e + "_story"), story_json.parameters.variables = JSON.parse(localStorage.getItem("tue_" + e + "_data")), creation_scene(), search_music(), tuesday.dispatchEvent(new Event("load")))
}

function go_to(e) {
  e.includes(",") ? (tue_story = (e = e.split(","))[0], dialog = e[2], scene = e[1]) : (tue_story = e, dialog = 0, scene = 0), del_element("tue_choice"), del_element("tue_html_dialog"), creation_scene()
}

function del_element(e) {
  for (var t = document.getElementById("tuesday")
      .getElementsByClassName(e), a = t.length, r = 0; r < a; r++) t[0].parentNode.removeChild(t[0])
}

function anim_text() {
  if (0 == dialog_speed) {
    for (var e = 0; e < ruby_rt.length; e++) dialog_text = dialog_text.replaceAll(ruby_rt[e][0], ruby_rt[e][1]);
    tue_text_view.innerHTML = dialog_text.replace(RegExp("\\n", "g"), "<br>")
  } else if (0 != dialog_speed && dialog_letter <= dialog_text.length) dialog_timeout = setTimeout(add_letter, dialog_speed);
  else if (dialog_letter >= dialog_text.length) {
    if (arr_dialog.end_text_cursor || story_json.parameters.text_panel.end_text_cursor) {
      var t = JSON.parse(JSON.stringify(arr_dialog.end_text_cursor ? arr_dialog.end_text_cursor : !!story_json.parameters.text_panel.end_text_cursor && story_json.parameters.text_panel.end_text_cursor));
      "" == t[1] && story_json.parameters.text_panel.end_text_cursor[1] && (t[1] = story_json.parameters.text_panel.end_text_cursor[1]), "" == t[2] && story_json.parameters.text_panel.end_text_cursor[2] && (t[2] = story_json.parameters.text_panel.end_text_cursor[2]), "" == t[3] && story_json.parameters.text_panel.end_text_cursor[3] && (t[3] = story_json.parameters.text_panel.end_text_cursor[3])
    }
    tue_text_view.innerHTML = "<span style=''>" + tue_text_view.innerHTML + (t && t[0] ? '&nbsp<span style="position:relative;">&nbsp<img src="' + art_data(t[0]) + '" style="position:absolute;width:' + (t[1] ? t[1] : "auto") + ";height:" + (t[2] ? t[2] : "auto") + ";" + (t[3] ? t[3] : "") + '"></span></span>' : "</span>"), tuesday.dispatchEvent(new Event("dialog_end"))
  }
  story_json.parameters.text_panel.scroll && (tue_text_view.scrollTop = tue_text_view.scrollHeight)
}

function add_letter() {
  for (var e = dialog_text.slice(0, dialog_letter)
      .replace(RegExp("\\n", "g"), "<br>"), t = 0; t < ruby_rt.length; t++) e = e.replaceAll(ruby_rt[t][0], ruby_rt[t][1]);
  tue_text_view.innerHTML = e, dialog_letter++, anim_text()
}

function search_music() {
  for (var e = scene; e >= 0; e--)
    if (story_json[tue_story][e].background_music) {
      tue_bg_music.canPlayType("audio/mpeg") ? "number" == typeof story_json[tue_story][e].background_music ? tue_bg_music.src = story_json.base[story_json[tue_story][e].background_music - 1] : story_json[tue_story][e].background_music.includes("blob:") ? tue_bg_music.src = story_json[tue_story][e].background_music : story_json[tue_story][e].background_music.includes(".mp3") ? tue_bg_music.src = story_json[tue_story][e].background_music : tue_bg_music.src = story_json[tue_story][e].background_music + ".mp3" : tue_bg_music.src = story_json[tue_story][e].background_music + ".ogg", tue_bg_music.loop = !0, 0 == tue_set_audio && tue_bg_music.play();
      break
    }
}

function creation_sound() {
  for (var e = 0; Object.keys(story_json.parameters.sounds)[e];) {
    var t = document.createElement("audio");
    t.preload = "auto", t.id = Object.keys(story_json.parameters.sounds)[e], t.canPlayType("audio/mpeg") ? story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].includes(";base64") ? t.src = story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]] : story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].includes("blob:") ? t.src = story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]] : story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].includes(".mp3") ? t.src = story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]] : t.src = story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]] + ".mp3" : t.src = story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]] + ".ogg", tuesday.appendChild(t), e++
  }
}

function get_sound(e) {
  return "if(tue_set_audio<2){" + (e[languare] ? "sound_play('" + e[languare] + "');" : "sound_play('" + e + "');") + "}"
}

function get_stop_sound(e) {
  return e[languare] ? "sound_stop('" + e[languare] + "');" : "sound_stop('" + e + "');"
}

function sound_play(e) {
  var t = document.getElementById(e);
  t && (t.currentTime = 0, t.volume = 1, t.play())
}

function sound_stop(e) {
  document.getElementById(e)
    .currentTime = 0, document.getElementById(e)
    .pause()
}

function add_style(e) {
  var t = document.createElement("link");
  t.setAttribute("rel", "stylesheet"), t.setAttribute("type", "text/css"), t.setAttribute("href", e), document.getElementsByTagName("head")
    .item(0)
    .appendChild(t)
}

function full_screen(e, t) {
  if (tue_fullScreen) tue_fullScreen = !1, t && t.text && art_data(t.text)
    .length > 0 && (e.innerHTML = values_button(art_data(t.text))), t && t.art && art_data(t.art)
    .length > 0 && (e.style.backgroundImage = "url('" + art_data(t.art) + "')"), document.exitFullscreen ? document.exitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.webkitExitFullscreen ? document.webkitExitFullscreen() : document.msExitFullscreen && document.msExitFullscreen();
  else {
    let a = story_json.parameters.resolutions ? tuesday.parentNode : tuesday;
    tue_fullScreen = !0, e && t && t.text1 && art_data(t.text1)
      .length > 0 && (e.innerHTML = values_button(art_data(t.text1))), e && t && t.art1 && art_data(t.art1)
      .length > 0 && (e.style.backgroundImage = "url('" + art_data(t.art1) + "')"), a.requestFullscreen ? a.requestFullscreen() : a.mozRequestFullScreen ? a.mozRequestFullScreen() : a.webkitRequestFullscreen ? a.webkitRequestFullscreen() : a.msRequestFullscreen && a.msRequestFullscreen()
  }
}

function art_data(e) {
  return e[languare] ? "number" == typeof e[languare] ? story_json.base[e[languare] - 1] : e[languare] : "number" == typeof e ? story_json.base[e - 1] : e
}

function video_size() {
  var e = document.getElementById("tue_video"),
    t = tuesday.getBoundingClientRect();
  e.videoWidth / e.videoHeight > t.width / t.height ? (e.style.height = "100%", e.style.width = "auto") : (e.style.height = "auto", e.style.width = "100%")
}

function show_if(e, t) {
  show = !0;
  for (var a = 1; a < e.length; a++) {
    var r = e[a][0],
      s = e[a][1],
      l = void 0 !== story_json.parameters.variables[e[a][2]] ? story_json.parameters.variables[e[a][2]] : e[a][2];
    if ("=" == s) {
      if (story_json.parameters.variables[r] != l) {
        show = !1;
        break
      }
    } else if (">" == s) {
      if (story_json.parameters.variables[r] <= l) {
        show = !1;
        break
      }
    } else if ("<" == s && story_json.parameters.variables[r] >= l) {
      show = !1;
      break
    }
    if (!show) break
  }!show && e[0] ? t.style.visibility = "hidden" : show && !e[0] && (t.style.visibility = "hidden")
}

function fast_rewind() {
  let e = story_json[tue_story][scene].dialogs;
  timers = setTimeout(function() {
    go_story(!0), dialog < e.length && check_choice(e) ? fast_rewind() : timers = !1
  }, 350)
}

function check_choice(e) {
  if (!e[dialog].choice) return !0;
  {
    let t = !0;
    return e[dialog].choice.forEach(e => {
      "tue_no" != e.go_to && (t = !1)
    }), t
  }
}

function set_audio(e, t) {
  if (tue_set_audio = tue_set_audio > 1 ? 0 : tue_set_audio + 1, localStorage.setItem("tue_set_audio", tue_set_audio), 0 == tue_set_audio ? tue_bg_music.play() : tue_set_audio > 0 && tue_bg_music.pause(), 2 == tue_set_audio) {
    var a = tuesday.getElementsByTagName("audio");
    for (let r = 0; r < a.length; r++) a[r].pause();
    "undefined" != typeof synth && synth.speaking && synth.cancel()
  }
  show_audio(e, t)
}

function show_audio(e, t) {
  var a = 0 != tue_set_audio ? tue_set_audio : "";
  t["text" + a] && art_data(t["text" + a])
    .length > 0 && (e.innerHTML = values_button(art_data(t["text" + a]))), t["art" + a] && art_data(t["art" + a])
    .length > 0 && (e.style.backgroundImage = "url('" + art_data(t["art" + a]) + "')")
}

function show_fullscreen(e, t) {
  t["text" + (tue_fullScreen ? "1" : "")] && art_data(t["text" + (tue_fullScreen ? "1" : "")])
    .length > 0 && (e.innerHTML = values_button(art_data(t["text" + (tue_fullScreen ? "1" : "")]))), t["art" + (tue_fullScreen ? "1" : "")] && art_data(t["art" + (tue_fullScreen ? "1" : "")])
    .length > 0 && (e.style.backgroundImage = "url('" + art_data(t["art" + (tue_fullScreen ? "1" : "")]) + "')")
}

function autoplaysound() {
  0 == tue_set_audio && tue_bg_music.play(), tuesday.removeEventListener("mousedown", autoplaysound)
}
document.oncontextmenu = cmenu, window.onmousedown = window.onselectstart = function() {
  return !1
}, document.addEventListener("keydown", function(e) {
  var t = e.code;
  t == story_json.parameters.key.next && controll ? go_story() : t == story_json.parameters.key.back && controll ? back_story() : t == story_json.parameters.key.main ? go_to(story_json.parameters.launch_story) : t == story_json.parameters.key.save ? save_stag("bookmark") : t == story_json.parameters.key.load ? load_stag("bookmark") : t == story_json.parameters.key.autosave ? load_stag("auto") : t == story_json.parameters.key.full_screen ? full_screen() : t == story_json.parameters.key.fast_rewind && fast_rewind()
}), tuesday.addEventListener("mousedown", autoplaysound);
</script>
<script type="text/javascript" src="editor.js"></script>
</body>
</html>
